define("taoQtiItem/controller/routes",[],function(){return{QtiPreview:{actions:{index:"taoItems/controller/preview/itemRunner"}}}}),define("util/strPad",[],function(){var t=function(t,e,i,a){var n,r="",o=function(t,e){for(var i="";i.length<e;)i+=t;return i=i.substr(0,e)};return t=t.toString(),t+="",i=void 0!==i?i:" ","STR_PAD_LEFT"!==a&&"STR_PAD_RIGHT"!==a&&"STR_PAD_BOTH"!==a&&(a="STR_PAD_RIGHT"),(n=e-t.length)>0&&("STR_PAD_LEFT"===a?t=o(i,n)+t:"STR_PAD_RIGHT"===a?t+=o(i,n):"STR_PAD_BOTH"===a&&(r=o(i,Math.ceil(n/2)),t=r+t+r,t=t.substr(0,e))),t};return t}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(t){var e={buildSerial:function(t){for(var e=t||"",i="abcdefghijklmnopqrstuvwxyz0123456789",a=0;22>a;a++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},fullpath:function(t,e){return t=t||"",e=e||"",t&&(t=t.replace(/^\//,""),t.match(/^http/i)||(e&&!e.match(/\/$/)&&(e+="/"),t=e+t)),t},findInCollection:function(e,i,a){var n=null;if(t.isString(i)&&(i=[i]),!t.isArray(i))throw new Error("invalid argument : colllectionNames must be an array or a string");return t.each(i,function(i){var r=e;t.each(i.split("."),function(t){r=r[t]});var o=r[a];return o?(n={parent:e,element:o},!1):(t.each(r,function(e){return t.isFunction(e.find)&&(n=e.find(a))?!1:void 0}),n?!1:void 0)}),n}};return e}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(t,e){var i={};return i.getOptionsFromArguments=function(i){var a={data:{},placeholder:null,subclass:"",renderer:null};return t.each(i,function(n){n&&(n.isRenderer?a.renderer=n:n instanceof e&&n.length?a.placeholder=n:t.isString(n)?a.subclass=n:t.isPlainObject(n)?a.data=n:console.log("invalid arg",n,i))}),a},i}),define("taoQtiItem/qtiItem/core/Element",["class","lodash","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,a){var n={},r=t.extend({qtiClass:"",serial:"",relatedItem:null,init:function(t,e){if(this.attributes={},this.metaData={},"object"==typeof t&&(e=t,t=""),t||(t=i.buildSerial(this.qtiClass+"_")),t&&("string"!=typeof t||!t.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+typeof t+") "+t;if(n[t])throw"a QTI Element with the same serial already exists "+t;n[t]=this,this.serial=t,this.setAttributes(e||{}),"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),"function"==typeof this.initObject&&this.initObject()},is:function(t){return t===this.qtiClass},placeholder:function(){return"{{"+this.serial+"}}"},getSerial:function(){return this.serial},getUsedIdentifiers:function(){var t={},e=this.getComposingElements();for(var i in e){var a=e[i],n=a.attr("identifier");n&&(t[n]=a)}return t},attr:function(t,e){if(t)if(void 0!==e)this.attributes[t]=e;else if("object"==typeof t)for(var i in t)this.attr(i,t[i]);else if("string"==typeof t)return void 0===this.attributes[t]?void 0:this.attributes[t];return this},data:function(t,e){if(t)if(void 0!==e)this.metaData[t]=e,$(document).trigger("metaChange.qti-widget",{element:this,key:t,value:e});else if("object"==typeof t)for(var i in t)this.data(i,t[i]);else if("string"==typeof t)return void 0===this.metaData[t]?void 0:this.metaData[t];return this},removeData:function(t){return delete this.metaData[t],this},removeAttr:function(t){return this.removeAttributes(t)},setAttributes:function(t){return this.attributes=t,this},getAttributes:function(){return e.clone(this.attributes)},removeAttributes:function(t){"string"==typeof t&&(t=[t]);for(var e in t)delete this.attributes[t[e]];return this},getComposingElements:function(){var t={};if("function"==typeof this.initContainer){var i=this.getBody();t[i.getSerial()]=i,t=e.extend(t,i.getComposingElements())}if("function"==typeof this.initObject){var a=this.getObject();t[a.getSerial()]=a,t=e.extend(t,a.getComposingElements())}return t},getUsedClasses:function(){var t=[this.qtiClass],i=this.getComposingElements();return e.each(i,function(e){t.push(e.qtiClass)}),e.uniq(t)},find:function(t){var e=null;if("function"==typeof this.initObject){var i=this.getObject();i.serial===t&&(e={parent:this,element:i,location:"object"})}return e||"function"!=typeof this.initContainer||(e=this.getBody().find(t,this)),e},parent:function(){var t=this.getRelatedItem();if(t){var e=t.find(this.getSerial());if(e)return e.parent}return null},setRelatedItem:function(t,e){if(e="undefined"==typeof e?!0:e,r.isA(t,"assessmentItem")){this.relatedItem=t;var i=this.getComposingElements();for(var a in i)i[a].setRelatedItem(t,!1)}},getRelatedItem:function(){var t=null;return r.isA(this.relatedItem,"assessmentItem")&&(t=this.relatedItem),t},setRenderer:function(t){if(!t||!t.isRenderer)throw"invalid qti rendering engine";this.renderer=t;var e=this.getComposingElements();for(var i in e)e[i].setRenderer(t)},getRenderer:function(){return this.renderer},render:function(){var t=a.getOptionsFromArguments(arguments),i=t.renderer||this.getRenderer(),n={},r={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()};if(!i)throw"render: no renderer found for the element "+this.qtiClass+":"+this.serial;if("function"==typeof this.initContainer&&(r.body=this.getBody().render(i)),"function"==typeof this.initObject){r.object={attributes:this.object.getAttributes()};var o=r.object.attributes.data,s=i.getOption("baseUrl");s&&(/^http(s)?:\/\//.test(o)||(r.object.attributes.data=s+o))}n=e.merge(r,t.data||{}),n=i.getData(this,n,t.subclass);var c=i.renderTpl(this,n,t.subclass);return t.placeholder&&t.placeholder.replaceWith(c),c},postRender:function(t,e,i){if(i=i||this.getRenderer(),"function"==typeof this.initContainer&&this.getBody().postRender({},"",i),i)return i.postRender(this,t,e);throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial},getContainer:function(t,e){var i=this.getRenderer();if(i)return i.getContainer(this,t,e);throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function(){var t={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(t.body=this.getBody().toArray()),"function"==typeof this.initObject&&(t.object=this.object.toArray()),t},isEmpty:function(){return!1},addClass:function(t){var e=this.attr("class")||"";o(e,t)||this.attr("class",e+(e.length?" ":"")+t)},hasClass:function(t){return o(this.attr("class"),t)},removeClass:function(t){var e=this.attr("class")||"";if(e){var i=new RegExp("(?:^|\\s)"+t+"(?:\\s|$)","");e=e.replace(i,"").replace(/^\s+/,""),e?this.attr("class",e):this.removeAttr("class")}}}),o=function(t,e){var i=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)","");return t&&i.test(t)};return r.isA=function(t,e){return t instanceof r&&t.is(e)},r.getElementBySerial=function(t){return n[t]},r.unsetElement=function(t){delete n[t]},r}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(t,e){return{convertChoices:function(i,a){var n=[],r=this;return t.each(i,function(i){if(e.isA(i,"choice"))switch(a){case"serial":n.push(i.getSerial());break;case"identifier":n.push(i.id());break;default:n.push(i)}else t.isArray(i)&&n.push(r.convertChoices(i,a))}),n},findChoices:function(e,i,a){var n=[],r=this;return t.each(i,function(i){var o;t.isString(i)?"serial"===a?(o=e.getChoice(i),o&&n.push(o)):"identifier"===a?(o=e.getChoiceByIdentifier(i),o&&n.push(o)):n.push(i):n.push(t.isArray(i)?r.findChoices(e,i,a):i)}),n},shuffleChoices:function(t){var i=[],a={},n=0;for(var r in t){if(!e.isA(t[r],"choice"))throw"invalid element in array: is not a qti choice";var o=t[r];o.attr("fixed")&&(a[n]=o),i.push(o),n++}for(var s=0;s<i.length-1;s++)if(!a[s]){var c=-1;do c=s+Math.floor(Math.random()*(i.length-s));while(a[c]);var l=i[c];i[c]=i[s],i[s]=l}return i},serialToIdentifier:function(t,e){var i=t.getChoice(e);return i?i.id():""}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper"],function(t,e,i,a,n){var r=function(e){var i=!0;if("object"!=typeof e)return!1;var a=!1;if(e.qtiClass)if(t.indexOf(o,e.qtiClass)>=0)a=!0;else{var n=e.qtiClass.indexOf(".");if(n>0){var r=e.qtiClass.slice(0,n),s=e.qtiClass.slice(n+1);c[r]&&t.indexOf(c[r],s)>=0&&(a=!0)}}if(!a)throw i=!1,new Error("invalid qti class name in renderer declaration : "+e.qtiClass);if(!e.template)throw i=!1,new Error("missing template in renderer declaration : "+e.qtiClass);return i},o=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","img","math","object","modalFeedback","rubricBlock","associateInteraction","choiceInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","customInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice"],s={assessmentItem:["stylesheet","_container","prompt","modalFeedback"],rubricBlock:["_container"],associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},c={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]},l=function(l){l=l||{},this.isRenderer=!0,this.name="",this.shuffleChoices=void 0!==l.shuffleChoices?l.shuffleChoices:!0,this.shuffledChoices=[];var d={},h={},p=function(t){var e=null;if(h[t])e=h[t];else{var i=t.indexOf(".");i>0&&(t=t.slice(0,i),h[t]&&(e=h[t]))}return e};this.setOption=function(t,e){return"string"==typeof t&&(l[t]=e),this},this.setOptions=function(e){return t.extend(l,e),this},this.getOption=function(t){return"string"==typeof t&&l[t]?l[t]:null},this.renderTpl=function(t,e,i){var a="",n=!1,r=i||t.qtiClass,o=p(r);if(o&&"function"==typeof o.template&&(a=o.template(e),n=!0),!n)throw new Error("no renderer template loaded under the class name : "+r);return a},this.getData=function(t,e,i){var a=e,n=i||t.qtiClass,r=p(n);return r&&"function"==typeof r.getData&&(a=r.getData.call(this,t,e)),a},this.renderDirect=function(t,e){return i.compile(t)(e)},this.getContainer=function(t,e,i){var a=null,n=i||t.qtiClass,r=p(n);if(!r)throw"no renderer found for the class : "+t.qtiClass;return a=r.getContainer(t,e)},this.postRender=function(t,e,i){var a=!1,n=i||t.qtiClass,r=p(n);return r&&"function"==typeof r.render&&(a=r.render.call(this,t,e)),a},this.setResponse=function(t,i,a){var n=!1,r=a||t.qtiClass,o=p(r);if(!o)throw"no renderer registered under the name : "+r;if("function"==typeof o.setResponse){n=o.setResponse.call(this,t,i);var s=o.getContainer.call(this,t);s instanceof e&&s.length&&s.trigger("responseSet",[t,i])}return n},this.getResponse=function(t,e){var i=!1,a=e||t.qtiClass,n=p(a);if(!n)throw"no renderer registered under the name : "+a;return"function"==typeof n.getResponse&&(i=n.getResponse.call(this,t)),i},this.resetResponse=function(t,e){var i=!1,a=e||t.qtiClass,n=p(a);if(!n)throw"no renderer registered under the name : "+a;return"function"==typeof n.resetResponse&&(i=n.resetResponse.call(this,t)),i},this.getLoadedRenderers=function(){return h},this.register=function(e){t.extend(d,e)},this.load=function(e,i){var a=[];if(i){if(!t.isArray(i))throw new Error('invalid argument type: expected array for arg "requireClasses"');i=t.intersection(i,o),t.each(i,function(e){var a=s[e];a&&(i=t.union(i,a))});for(var n in i){var l=i[n];if(c[l]){var p=t.intersection(i,c[l]);t.each(p,function(t){if(d[l+"."+t])a.push(d[l+"."+t]);else{if(!d[l])throw new Error(this.name+" : missing qti class location declaration: "+l+", subclass: "+t);a.push(d[l])}})}else if(d[l]===!1)h[l]=!1;else{if(!d[l])throw new Error(this.name+" : missing qti class location declaration: "+l);a.push(d[l])}}}else a=t.values(d);var u=this;return require(a,function(){t.each(arguments,function(t){r(t)&&(h[t.qtiClass]=t)}),"function"==typeof e&&e.call(u,h)}),this},this.setShuffledChoices=function(t,e,i){a.isA(t,"interaction")&&(this.shuffledChoices[t.getSerial()]=n.findChoices(t,e,i))},this.getShuffledChoices=function(e,i,r){var o,s=[];if(a.isA(e,"interaction")){var c=e.getSerial();if(!this.shuffledChoices[c]||i)if(a.isA(e,"matchInteraction")){this.shuffledChoices[c]=[];for(var l=0;2>l;l++)this.shuffledChoices[c].push(n.shuffleChoices(e.getChoices(l)))}else this.shuffledChoices[c]=n.shuffleChoices(e.getChoices());o=this.shuffledChoices[c],s="serial"===r||"identifier"===r?n.convertChoices(o,r):t.clone(o)}return s},this.getRenderers=function(){return h},this.getLocations=function(){return d}};return{build:function(t,e){var i=function(){l.apply(this,arguments),this.register(t),this.name=e||""};return i.prototype=l.prototype,i}}}),define("taoQtiItem/qtiDefaultRenderer/renderers/config",[],function(){return{name:"defaultRenderer",locations:{_container:"taoQtiItem/qtiDefaultRenderer/renderers/Container",assessmentItem:"taoQtiItem/qtiDefaultRenderer/renderers/Item",stylesheet:"taoQtiItem/qtiDefaultRenderer/renderers/Stylesheet",outcomeDeclaration:"taoQtiItem/qtiDefaultRenderer/renderers/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiDefaultRenderer/renderers/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiDefaultRenderer/renderers/ResponseProcessing",math:"taoQtiItem/qtiDefaultRenderer/renderers/Math",object:"taoQtiItem/qtiDefaultRenderer/renderers/Object",modalFeedback:"taoQtiItem/qtiDefaultRenderer/renderers/ModalFeedback",rubricBlock:"taoQtiItem/qtiDefaultRenderer/renderers/RubricBlock",associateInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/OrderInteraction",selectPointInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/TextEntryInteraction",prompt:"taoQtiItem/qtiDefaultRenderer/renderers/interactions/Prompt",associableHotspot:"taoQtiItem/qtiDefaultRenderer/renderers/choices/AssociableHotspot",gap:"taoQtiItem/qtiDefaultRenderer/renderers/choices/Gap",gapImg:"taoQtiItem/qtiDefaultRenderer/renderers/choices/GapImg",gapText:"taoQtiItem/qtiDefaultRenderer/renderers/choices/GapText",hotspotChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/HotspotChoice",hottext:"taoQtiItem/qtiDefaultRenderer/renderers/choices/Hottext",inlineChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiDefaultRenderer/renderers/choices/SimpleChoice"}}}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","taoQtiItem/qtiDefaultRenderer/renderers/config"],function(t,e){var i=t.extend(t.clone(e.locations),{assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",outcomeDeclaration:"taoQtiItem/qtiCommonRenderer/renderers/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiCommonRenderer/renderers/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiCommonRenderer/renderers/ResponseProcessing",img:"taoQtiItem/qtiCommonRenderer/renderers/Img",math:"taoQtiItem/qtiCommonRenderer/renderers/Math",object:"taoQtiItem/qtiCommonRenderer/renderers/Object",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",customInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/CustomInteraction.amd"});return{name:"commonRenderer",locations:i}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config","css!taoQtiItem_css/qti","css!tao_css/tao-main-style"],function(t,e){return t.build(e.locations,e.name)}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div id="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" class="small feedback-info item-instruction">\n    <span class="icon-info icon"></span><span class="instruction-message">',(o=i.message)?r=o.call(e,{hash:{},data:n}):(o=e&&e.message,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+"</span>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/Instruction",["lodash","taoQtiItem/qtiItem/helper/util","tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction"],function(t,e,i){var a=["info","warning","error","success"],n=function(t,i,a){this.interaction=t,this.defaultMessage=i||"",this.currentMessage="",this.level="info",this.serial=e.buildSerial("instruction_"),this.callback=a,this.$dom=null,this.state=!1};return n.isValidLevel=function(e){return t.indexOf(a,e)>=0},n.prototype.setState=function(t){this.state=t},n.prototype.checkState=function(t){return this.state===t},n.prototype.getId=function(){return this.serial},n.prototype.create=function(t){t.append(i({message:this.defaultMessage,serial:this.serial})),this.$dom=t.find("#"+this.serial)},n.prototype.update=function(t){var e=t&&t.level?t.level:"",i=t&&t.message?t.message:"",a=t&&t.timeout?t.timeout:0,r=t&&"function"==typeof t.start?t.start:null,o=t&&"function"==typeof t.stop?t.stop:null;if(e&&n.isValidLevel(e)&&(this.$dom.removeClass("feedback-"+this.level).addClass("feedback-"+e),this.$dom.find(".icon").removeClass("icon-"+this.level).addClass("icon-"+e),this.level=e),i&&(this.$dom.find(".instruction-message").html(i),this.currentMessage=i),a){var s=this;r&&r.call(s),s.timer=setTimeout(function(){o&&o.call(s),s.timer=null},a)}},n.prototype.setLevel=function(t,e){var i={level:t};e&&(i.timeout=parseInt(e),i.stop=function(){this.setLevel("info")}),this.update(i)},n.prototype.getLevel=function(){return this.level},n.prototype.setMessage=function(t,e){this.update({message:t,timeout:e})},n.prototype.reset=function(){this.update({level:"info",message:this.defaultMessage}),this.state=!1},n.prototype.validate=function(t){"function"==typeof this.callback&&this.callback.call(this,t)},n}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/notification",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<div class="small feedback-',(o=i.level)?r=o.call(e,{hash:{},data:n}):(o=e&&e.level,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+' item-notification">\n    <span class="icon-',(o=i.level)?r=o.call(e,{hash:{},data:n}):(o=e&&e.level,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'"></span><span class="feedback-message">',(o=i.message)?r=o.call(e,{hash:{},data:n}):(o=e&&e.message,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'</span>\n    <span title="'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Remove Message",s):h.call(e,"__","Remove Message",s)))+'" class="icon-close close-trigger"></span>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/Helper",["lodash","jquery","i18n","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCommonRenderer/helpers/Instruction","tpl!taoQtiItem/qtiCommonRenderer/tpl/notification"],function(t,e,i,a,n,r){var o={},s={},c=e(),l=function(t){var e=t.getSerial(),i="[data-serial="+e+"]";return a.isA(t,"choice")?i=".qti-choice"+i:a.isA(t,"interaction")&&(i=".qti-interaction"+i),i};return{setContext:function(t){c=t},getContainer:function(t,i){var a=t.getSerial();return i instanceof e&&i.length?i.find(l(t)):c instanceof e&&c.length?c.find(l(t)):((!o[a]||o[a].length)&&(o[a]=e(l(t))),o[a])},validateInstructions:function(e,i){var a=e.getSerial();s[a]&&t.each(s[a],function(t){t.validate(i)})},appendInstruction:function(t,e,i){var a=t.getSerial(),r=new n(t,e,i);return s[a]||(s[a]={}),s[a][r.getId()]=r,r.create(this.getContainer(t).find(".instruction-container")),r},removeInstructions:function(t){s[t.getSerial()]={},this.getContainer(t).find(".instruction-container").empty()},resetInstructions:function(e){var i=e.getSerial();s[i]&&t.each(s[i],function(t){t.reset()})},minMaxChoiceInstructions:function(e,a){var n,r=this,o=a.min||0,s=a.max||0,c=a.getResponse,l=a.onError||t.noop(),d=a.choiceCount===!1?!1:t.size(e.getChoices()),h=!1;if(!t.isFunction(c))throw"invalid parameter getResponse";s>0&&(d===!1||d>s)&&(s===o?(h=!0,n=1>=s?i("You must select exactly %d choice",s):i("You must select exactly %d choices",s),r.appendInstruction(e,n,function(t){c(e).length>=s?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:i("Maximum choices reached"),timeout:2e3,start:function(){l(t)},stop:function(){this.update({level:"success",message:n})}}),this.setState("fulfilled")):this.reset()})):s>o&&(n=1>=s?i("You can select maximum %d choice",s):i("You can select maximum %d choices",s),r.appendInstruction(e,n,function(t){c(e).length>=s?(this.setLevel("success"),this.setMessage(i("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){l(t)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!h&&o>0&&(d===!1||d>o)&&(n=1>=o?i("You must at least %d choice",o):i("You must select at least %d choices",s),r.appendInstruction(e,n,function(){c(e).length>=o?this.setLevel("success"):this.reset()}))},appendNotification:function(t,e,i){if(i=i||"info",n.isValidLevel(i)){var a=this.getContainer(t);a.find(".notification-container").prepend(r({level:i,message:e}));var o=a.find(".item-notification:first"),s=function(){o.fadeOut()};return o.find(".close-trigger").on("click",s),setTimeout(s,2e3),o}},removeNotifications:function(t){this.getContainer(t).find(".item-notification").remove()},triggerResponseChangeEvent:function(t,e){this.getContainer(t).trigger("responseChange",[{interaction:t,response:t.getResponse()},e])},targetBlank:function(t){t.on("click","a",function(t){t.preventDefault();var i=e(this).attr("href");i&&i.match(/^http/i)&&window.open(i,"_blank")})}}}),define("taoQtiItem/qtiCreator/helper/commonRenderer",["taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){var i=null,a=new t({baseUrl:"",shuffleChoices:!0}),n={render:function(t,e){n.setContext(e),a.load(function(){e.append(t.render(this)),t.postRender({},"",this)},t.getUsedClasses())},get:function(){return a},setOption:function(t,e){a.setOption(t,e)},setOptions:function(t){a.setOptions(t)},setContext:function(t){i=t,e.setContext(t)},restoreContext:function(){e.setContext(i),i=null}};return n}),define("json!taoQtiItem/qtiCreator/editor/resources/device-list.json",function(){return{tablets:{"193986c3715c81838870f908fa98d69a":{label:"Amazon Kindle Fire HDX 7″",width:960,height:600},"4e8eafab11aad1486992d7ee2c8c16ca":{label:"Apple iPad",width:1024,height:768},"5aac2932d9ad00d6d8a1604b8f9e4e8d":{label:"Google Nexus 10, Motorola Xoom, Xyboard",width:1280,height:800},"9805d9753ad08c7630a9ee5418aa6c6c":{label:"Google Nexus 7",width:966,height:604},d4a431cedf4705d6bf2cba6d5788378b:{label:"Samsung Galaxy Tab 7.7, 8.9, 10.1",width:1280,height:800}},phones:{"1b89338531ef0155c8d6abc2ac02c81a":{label:"Apple iPhone 3GS",width:320,height:480,scaleFactor:1,dpWidth:320,dpHeight:480},"3f89da99d84214cde7df87ebe0699a6f":{label:"Apple iPhone 4",width:640,height:960,scaleFactor:2,dpWidth:320,dpHeight:1920},"0d36971a5b98b367f54ced708c9af849":{label:"Apple iPhone 5",width:640,height:1136,scaleFactor:2,dpWidth:320,dpHeight:2272},"026beffcc051af995660ebdede986ace":{label:"BlackBerry Z10",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},fd2dd53e667d6d49e4fa73356fa941dd:{label:"BlackBerry Z30",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"707584c1ae17d9b5b2cbe8603c91c147":{label:"Google Nexus 4",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},"91823264de952e7f2347e07db5c4058b":{label:"Google Nexus 5",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760},cd69817a6e147e8a4677389e56fcf568:{label:"Google Nexus S",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"75994faa6a38e31e99b53fcd75534a33":{label:"HTC Evo, Touch HD, Desire HD, Desire",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"0cab4dfccdfc880687cb608cfe4159db":{label:"HTC One X, EVO LTE",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},c4ff41fcba24d74fc21dc3490ca1edc9:{label:"HTC Sensation, Evo 3D",width:540,height:960,scaleFactor:1.5,dpWidth:360,dpHeight:1440},fa969a5e0dd2de53700eeee4ba4ba142:{label:"LG Optimus 2X, Optimus 3D, Optimus Black",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"33c4f9364e295ec03531f3a3425819cf":{label:"LG Optimus G",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},bc47f5275f0efd56fee52d43a8082981:{label:"LG Optimus LTE, Optimus 4X HD",width:720,height:1280,scaleFactor:1.7,dpWidth:424,dpHeight:2176},"0732887e6e324fd10777b735520a34cf":{label:"LG Optimus One",width:320,height:480,scaleFactor:1.5,dpWidth:213,dpHeight:720},"2e38a78364f09d0da0e9e1a3a68e7fb0":{label:"Motorola Defy, Droid, Droid X, Milestone",width:480,height:854,scaleFactor:1.5,dpWidth:320,dpHeight:1281},bd4b78dddc7c9625a4141a1b1ddabb87:{label:"Motorola Droid 3, Droid 4, Droid Razr, Atrix 4G, Atrix 2",width:540,height:960,scaleFactor:1,dpWidth:540,dpHeight:960},"3bf1edf21cfa81006183d2b02974c84e":{label:"Motorola Droid Razr HD",width:720,height:1280,scaleFactor:1,dpWidth:720,dpHeight:1280},ab5a352e0e016b97dac986f06c394f55:{label:"Nokia C5, C6, C7, N97, N8, X7",width:360,height:640,scaleFactor:1,dpWidth:360,dpHeight:640},"4826fb7d7257aeaac992ce699df41b3c":{label:"Nokia Lumia 7X0, Lumia 8XX, Lumia 900, N800, N810, N900",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"0a691ab20add7c432200f8fa6527b488":{label:"Samsung Galaxy Note",width:800,height:1280,scaleFactor:2,dpWidth:400,dpHeight:2560},"9c23ee31be29960fbac9e9bbfc2fc7b0":{label:"Samsung Galaxy Note 3",width:1080,height:1920,scaleFactor:2,dpWidth:540,dpHeight:3840},"92177c0508c1d73905a58e2338f2a81f":{label:"Samsung Galaxy Note II",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"5222b8866dc4cc606725e16ffcc0a783":{label:"Samsung Galaxy S III, Galaxy Nexus",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"37c1541e2bd55cfd0f4073b0ccdf68b3":{label:"Samsung Galaxy S, S II, W",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"2f7f64b7dda0144907ff300e83eed465":{label:"Samsung Galaxy S4",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760},"9c24f9057744dad56043702a9703127f":{label:"Sony Xperia S, Ion",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"0a8b2732a016a9395c3af5f12dd9c0da":{label:"Sony Xperia Sola, U",width:480,height:854,scaleFactor:1,dpWidth:480,dpHeight:854},"5a153d7f53d82dcb0801f041574a6a43":{label:"Sony Xperia Z, Z1",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760}},screens:{"9e523ae15b61dc766f5c818726881ecf":{label:"1920 × 1080",width:1920,height:1080,dpWidth:1920,dpHeight:1080,scaleFactor:1},"07769cd8d0a7d09818b2f0b018042fb7":{label:"1366 × 768",width:1366,height:768,dpWidth:1366,dpHeight:768,scaleFactor:1},"72d5478a24194f98b9378e8e0fd65737":{label:"1280 × 1024",width:1280,height:1024,dpWidth:1280,dpHeight:1024,scaleFactor:1},b7a6dd5900cc72e61f0d3479c7e314ec:{label:"1280 × 800",width:1280,height:800,dpWidth:1280,dpHeight:800,scaleFactor:1},"43193b0ff671a37d8232ab664190a125":{label:"1024 × 768",width:1024,height:768,dpWidth:1024,dpHeight:768,scaleFactor:1},c29e48814af5443ff5688d9e967ce917:{label:"800 × 600",width:800,height:600,dpWidth:800,dpHeight:600,scaleFactor:1}}}
}),define("tpl!taoQtiItem/qtiCreator/tpl/preview/preview",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\r\n                        <option value="',(n=i.value)?a=n.call(t,{hash:{},data:e}):(n=t&&t.value,a=typeof n===p?n.call(t,{hash:{},data:e}):n),r+=u(a)+'" ',a=i["if"].call(t,t&&t.selected,{hash:{},inverse:m.noop,fn:m.program(2,o,e),data:e}),(a||0===a)&&(r+=a),r+=">",(n=i.label)?a=n.call(t,{hash:{},data:e}):(n=t&&t.label,a=typeof n===p?n.call(t,{hash:{},data:e}):n),r+=u(a)+"</option>\r\n                        "}function o(){return'selected="selected"'}function s(t,e){var a,n,r="";return r+='\r\n                        <option value="',(n=i.value)?a=n.call(t,{hash:{},data:e}):(n=t&&t.value,a=typeof n===p?n.call(t,{hash:{},data:e}):n),r+=u(a)+'" data-value="',(n=i.dataValue)?a=n.call(t,{hash:{},data:e}):(n=t&&t.dataValue,a=typeof n===p?n.call(t,{hash:{},data:e}):n),r+=u(a)+'" ',a=i["if"].call(t,t&&t.selected,{hash:{},inverse:m.noop,fn:m.program(2,o,e),data:e}),(a||0===a)&&(r+=a),r+=">",(n=i.label)?a=n.call(t,{hash:{},data:e}):(n=t&&t.label,a=typeof n===p?n.call(t,{hash:{},data:e}):n),r+=u(a)+"</option>\r\n                        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d,h="",p="function",u=this.escapeExpression,m=this,f=i.helperMissing;return h+='<div class="preview-overlay tao-scope overlay preview-',(l=i.previewType)?c=l.call(e,{hash:{},data:n}):(l=e&&e.previewType,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+' item-no-print"\r\n     style="overflow-x: hidden;display:none">\r\n    <div class="preview-container-outer">\r\n        <form class="preview-utility-bar plain">\r\n            <div class="preview-utility-bar-inner grid-row">\r\n\r\n                <div class="col-4">\r\n                    <input type="hidden" value="" data-value="" class="standard-device-selector preview-device-selector" data-target="standard">\r\n                    <select class="preview-type-selector">\r\n                        ',c=i.each.call(e,e&&e.previewTypes,{hash:{},inverse:m.noop,fn:m.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+='\r\n                    </select>\r\n                </div>\r\n                <div class="col-6 standard-only device-type-and-orientation"></div>\r\n                <div class="col-6 desktop-only device-type-and-orientation">\r\n                    <select class="desktop-device-selector preview-device-selector" data-target="desktop">\r\n                        ',c=i.each.call(e,e&&e.desktopDevices,{hash:{},inverse:m.noop,fn:m.program(4,s,n),data:n}),(c||0===c)&&(h+=c),h+='\r\n                    </select>\r\n                </div>\r\n                <div class="col-6 mobile-only device-type-and-orientation">\r\n                    <select class="mobile-device-selector preview-device-selector" data-target="mobile">\r\n                        ',c=i.each.call(e,e&&e.mobileDevices,{hash:{},inverse:m.noop,fn:m.program(4,s,n),data:n}),(c||0===c)&&(h+=c),h+='\r\n                    </select>\r\n                    <select tabindex="-1" class="mobile-orientation-selector orientation-selector"\r\n                            data-target="mobile">\r\n                        <option value="landscape">'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Landscape",d):f.call(e,"__","Landscape",d)))+'</option>\r\n                        <option value="portrait">'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Portrait",d):f.call(e,"__","Portrait",d)))+'</option>\r\n                    </select>\r\n                </div>\r\n                <div class="col-2">\r\n                    <!--label>\r\n                        <input type="checkbox"/>\r\n                        <span class="icon-checkbox"></span>\r\n                        '+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Scale ",d):f.call(e,"__","Scale ",d)))+'\r\n                    </label-->\r\n                        <span class="btn-info small preview-closer rgt">\r\n                            '+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Close",d):f.call(e,"__","Close",d)))+'\r\n                            <span class="icon-close r"></span>\r\n                        </span>\r\n                </div>\r\n            </div>\r\n            <div class="preview-message-box">\r\n                <div class="feedback-info small">\r\n                    <span class="icon-info"></span>\r\n                    '+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"This preview may be scaled to fit your screen. The final rendering may differ.",d):f.call(e,"__","This preview may be scaled to fit your screen. The final rendering may differ.",d)))+'\r\n                    <a href="#">'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Don’t show this again!",d):f.call(e,"__","Don’t show this again!",d)))+'</a>\r\n                    <span title="'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Remove this message",d):f.call(e,"__","Remove this message",d)))+'" class="icon-close close-trigger"></span>\r\n                </div>\r\n            </div>\r\n        </form>\r\n        <div class="preview-canvas">\r\n\r\n            <div class="preview-scale-container">\r\n                <div class="',(l=i.previewType)?c=l.call(e,{hash:{},data:n}):(l=e&&e.previewType,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+"-preview-frame preview-outer-frame ",(l=i.previewType)?c=l.call(e,{hash:{},data:n}):(l=e&&e.previewType,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'-preview-landscape">\r\n                    <div class="',(l=i.previewType)?c=l.call(e,{hash:{},data:n}):(l=e&&e.previewType,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'-preview-container preview-container">\r\n                        <div class="preview-item-container"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div id="preview-console">\r\n        <span class="icon-close preview-console-closer" title="'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Close console",d):f.call(e,"__","Close console",d)))+'"></span>\r\n\r\n        <div class="preview-console-header grid-row clearfix">\r\n            <div class="col-12">\r\n                <button type="button" class="btn-info small rgt" id="preview-submit-button">'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Submit",d):f.call(e,"__","Submit",d)))+'</button>\r\n            </div>\r\n        </div>\r\n        <div class="preview-console-body clear">\r\n            <ul></ul>\r\n        </div>\r\n    </div>\r\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\n<li data-css-res="',(n=i.path)?a=n.call(t,{hash:{},data:e}):(n=t&&t.path,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'">\n    <span class="icon-preview style-sheet-toggler" title="',(n=i.title)?a=n.call(t,{hash:{},data:e}):(n=t&&t.title,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'"></span>\n    <span class="file-label truncate" title="',(n=i.editLabelTxt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.editLabelTxt,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'">',(n=i.label)?a=n.call(t,{hash:{},data:e}):(n=t&&t.label,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'</span>\n    <input type="text" class="style-sheet-label-editor" value="',(n=i.label)?a=n.call(t,{hash:{},data:e}):(n=t&&t.label,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'">\n    <span class="icon-bin" title="',(n=i.deleteTxt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.deleteTxt,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'" data-role="css-delete"></span>\n    <span class="icon-download" title="',(n=i.downloadTxt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.downloadTxt,a=typeof n===s?n.call(t,{hash:{},data:e}):n),r+=c(a)+'" data-role="css-download"></span>\n</li>\n'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s="function",c=this.escapeExpression,l=this;return o=i.each.call(e,e&&e.stylesheets,{hash:{},inverse:l.noop,fn:l.program(1,r,n),data:n}),o||0===o?o:""})}),function(t){t.extend({fileDownload:function(e,i){function a(){if(-1!=document.cookie.indexOf(c.cookieName+"="+c.cookieValue)){f.onSuccess(e);var i=new Date(1e3);return document.cookie=c.cookieName+"=; expires="+i.toUTCString()+"; path="+c.cookiePath,void r(!1)}if(v||g)try{var o;if(o=v?v.document:n(g),o&&null!=o.body&&o.body.innerHTML.length>0){var s=!0;if(I&&I.length>0){var l=t(o.body).contents().first();l.length>0&&l[0]===I[0]&&(s=!1)}if(s)return f.onFail(o.body.innerHTML,e),void r(!0)}}catch(d){return f.onFail("",e),void r(!0)}setTimeout(a,c.checkInterval)}function n(t){var e=t[0].contentWindow||t[0].contentDocument;return e.document&&(e=e.document),e}function r(t){setTimeout(function(){v&&(h&&v.close(),d&&(t?(v.focus(),v.close()):v.focus()))},0)}function o(t){return t.replace(/&/gm,"&amp;").replace(/\n/gm,"&#10;").replace(/\r/gm,"&#13;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&apos;")}var s=function(){alert("A file download error has occurred, please try again.")},c=t.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},successCallback:function(){},failCallback:s,httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},i),l=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase(),d=!1,h=!1,p=!1;/ip(ad|hone|od)/.test(l)?d=!0:-1!=l.indexOf("android")?h=!0:p=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(l)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(l.substr(0,4));var u=c.httpMethod.toUpperCase();if(h&&"GET"!=u)return void(t().dialog?t("<div>").html(c.androidPostUnsupportedMessageHtml).dialog(c.dialogOptions):alert(c.androidPostUnsupportedMessageHtml));var m=null;c.preparingMessageHtml&&(m=t("<div>").html(c.preparingMessageHtml).dialog(c.dialogOptions));var f={onSuccess:function(t){m&&m.dialog("close"),c.successCallback(t)},onFail:function(e,i){m&&m.dialog("close"),c.failMessageHtml?(t("<div>").html(c.failMessageHtml).dialog(c.dialogOptions),c.failCallback!=s&&c.failCallback(e,i)):c.failCallback(e,i)}};null!==c.data&&"string"!=typeof c.data&&(c.data=t.param(c.data));var g,v,b,I;if("GET"===u){if(null!==c.data){var C=e.indexOf("?");-1!=C?"&"!==e.substring(e.length-1)&&(e+="&"):e+="?",e+=c.data}d||h?(v=window.open(e),v.document.title=c.popupWindowTitle,window.focus()):p?window.location(e):g=t("<iframe>").hide().attr("src",e).appendTo("body")}else{var y="";null!==c.data&&t.each(c.data.replace(/\+/g," ").split("&"),function(){var t=this.split("="),e=c.encodeHTMLEntities?o(decodeURIComponent(t[0])):decodeURIComponent(t[0]);if(e){var i=t[1]||"";i=c.encodeHTMLEntities?o(decodeURIComponent(t[1])):decodeURIComponent(t[1]),y+='<input type="hidden" name="'+e+'" value="'+i+'" />'}}),p?(I=t("<form>").appendTo("body"),I.hide().attr("method",c.httpMethod).attr("action",e).html(y)):(d?(v=window.open("about:blank"),v.document.title=c.popupWindowTitle,b=v.document,window.focus()):(g=t("<iframe style='display: none' src='about:blank'></iframe>").appendTo("body"),b=n(g)),b.write("<html><head></head><body><form method='"+c.httpMethod+"' action='"+e+"'>"+y+"</form>"+c.popupWindowTitle+"</body></html>"),I=t(b).find("form")),I.submit()}setTimeout(a,c.checkInterval)}})}(jQuery),define("lib/jquery.fileDownload",function(){}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleEditor",["jquery","lodash","helpers","i18n","tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler","lib/jquery.fileDownload"],function(t,e,i,a,n){var r,o=function(t){return i._url(t,"QtiCssAuthoring","taoQtiItem")},s=function(t){return t.substring(t.lastIndexOf("/")+1)},c=function(t,i){var c,l={},d=function(){var e=t("#item-editor-user-styles");return e.length?e.empty():(e=t("<style>",{id:"item-editor-user-styles"}),t("head").append(e)),e}(),h={title:a("Disable this stylesheet temporarily"),deleteTxt:a("Remove this stylesheet"),editLabelTxt:a("Edit stylesheet label"),downloadTxt:a("Download this stylesheet"),preparingMessageHtml:a("Preparing CSS, please wait…"),failMessageHtml:a("There was a problem downloading your CSS, please try again."),listing:t("#style-sheet-toggler")},p="",u=function(t){var i,a,n,r,o="";if(e.isEmpty(l))return f();for(i in l)if(l.hasOwnProperty(i)){o+=i+"{";for(a in l[i])if(l[i].hasOwnProperty(a))if(e.isPlainObject(l[i][a]))for(n in l[i][a]){o+=a+"{";for(r in l[i][a])o+=r+":"+l[i][a][n]+";";o+="}"}else o+=a+":"+l[i][a]+";";o+="}\n"}return t||d.text(o),o},m=function(i,a,n){l[i]=l[i]||{},n?l[i][a]=n:(delete l[i][a],0===e.size(l[i])&&delete l[i]),u(),t(document).trigger("stylechange.qti-creator")},f=function(){return l={},d.text(""),!1},g=function(){return b(),t.post(o("save"),e.extend({},r,{cssJson:JSON.stringify(l),stylesheetUri:p.attr("href")}))},v=function(i){b(),t.fileDownload(o("download"),{preparingMessageHtml:h.preparingMessageHtml,failMessageHtml:h.failMessageHtml,successCallback:function(){},httpMethod:"POST",data:e.extend({},r,{stylesheetUri:i})})},b=function(){if(!r)throw new Error("Missing itemConfig, did you call styleEditor.init()?");return!0},I=function(a){var r,o,p,u=[];e.isString(a)&&(a=c.createStyleSheet(a)),r=s(a.attr("href")),o=function(){var e=t(a.render()),i=e.attr("href"),n=i.indexOf("?")>-1?"&":"?";return e.attr("href",i+n+(new Date).getTime().toString()),e}(),t.when(t.ajax(o.attr("href"))).then(function(){d.before(o),u.push({path:a.attr("href"),label:a.attr("title")||r,title:h.title,deleteTxt:h.deleteTxt,downloadTxt:h.downloadTxt,editLabelTxt:h.editLabelTxt}),p=t(n({stylesheets:u})),p.data("stylesheetObj",a),h.listing.append(p),setTimeout(function(){t(i).trigger("customcssloaded.styleeditor",[l]),t(window).trigger("resize")},500)})},C=function(){var t;for(var e in c.stylesheets)c.stylesheets.hasOwnProperty(e)&&(t=c.stylesheets[e],"tao-user-styles.css"!==s(t.attr("href"))?I(c.stylesheets[e]):p=t);p||(p=c.createStyleSheet("style/custom/tao-user-styles.css"))},y=function(){t("link[data-serial]").remove()},w=function(){return c},q=function(a,n){c=a,r={uri:n.uri,lang:n.lang,baseUrl:n.baseUrl},y(),C();var s=t("#item-editor-item-resizer").data("target"),d=p.attr("href");c.data("responsive",!0),t.when(t.getJSON(o("load"),e.extend({},r,{stylesheetUri:d}))).then(function(e){l=e,u(),l.length&&c.data("responsive",!(!l[s]||!l[s].width)),t(i).trigger("customcssloaded.styleeditor",[l])})},x=function(){return l};return{apply:m,save:g,download:v,erase:f,init:q,create:u,getItem:w,getStyle:x,addStylesheet:I}}(t,document);return c}),define("taoQtiItem/qtiCreator/model/helper/event",["jquery","taoQtiItem/qtiItem/core/Element"],function(t,e){return{choiceCreated:function(e,i){t(document).trigger("choiceCreated.qti-widget",{choice:e,interaction:i})},deleted:function(i,a){e.unsetElement(i.getSerial()),t(document).off("."+i.getSerial()),t(document).trigger("deleted.qti-widget",{element:i,parent:a})},getList:function(){return["containerBodyChange","containerElementAdded","elementCreated.qti-widget","attributeChange.qti-widget","choiceCreated.qti-widget","correctResponseChange.qti-widget","mapEntryChange.qti-widget","mapEntryRemove.qti-widget","deleted.qti-widget","choiceTextChange.qti-widget","responseTemplateChange.qti-widget","mappingAttributeChange.qti-widget","feedbackRuleConditionChange.qti-widget","feedbackRuleCreated.qti-widget","feedbackRuleRemoved.qti-widget","feedbackRuleElseCreated.qti-widget","feedbackRuleElseRemoved.qti-widget"]}}}),define("taoQtiItem/qtiCreator/helper/itemSerializer",["lodash"],function(){var t={serialize:function(t){var e="";if(t)try{e=JSON.stringify(t.toArray())}catch(i){console.error(i)}return e}};return t}),jQuery.cookie=function(t,e,i){if("undefined"==typeof e){var a=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),r=0;r<n.length;r++){var o=jQuery.trim(n[r]);if(o.substring(0,t.length+1)==t+"="){a=decodeURIComponent(o.substring(t.length+1));break}}return a}i=i||{},null===e&&(e="",i.expires=-1);var s="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var c;"number"==typeof i.expires?(c=new Date,c.setTime(c.getTime()+24*i.expires*60*60*1e3)):c=i.expires,s="; expires="+c.toUTCString()}var l=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",h=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),s,l,d,h].join("")},define("jquery.cookie",function(){}),define("taoQtiItem/qtiCreator/editor/preview",["jquery","lodash","i18n","util/strPad","taoQtiItem/qtiCreator/helper/commonRenderer","json!taoQtiItem/qtiCreator/editor/resources/device-list.json","tpl!taoQtiItem/qtiCreator/tpl/preview/preview","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","helpers","iframeResizer","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/helper/itemSerializer","ui/modal","select2","jquery.cookie"],function(t,e,i,a,n,r,o,s,c,l,d,h){var p,u,m,f,g,v,b,I="landscape",C="desktop",y={desktop:i("Desktop preview"),mobile:i("Mobile preview"),standard:i("Actual size")},w=t(document),q=t(window),x=t(document.body),_={width:q.innerWidth(),height:q.innerHeight()},Q={width:0,height:0},k=1,R=!1,E=function(t){var i="mobile"===t?r.tablets:r.screens,a=[];return e.forEach(i,function(t){Q={width:Math.max(Q.width,t.width),height:Math.max(Q.height,t.height)},a.push({value:t.label,label:t.label,dataValue:[t.width,t.height].join(","),selected:C===t.label})}),a},S=function(){f=p.add(p.find(".preview-scale-container").find('[class*="'+C+'"]'))},M=function(t){if(t!==C){var e=new RegExp(C,"g");f.each(function(){this.className=this.className.replace(e,t)}),C=t}},A=function(e){if(e!==I){var i=new RegExp(I,"g"),a=t(".preview-outer-frame")[0];a.className=a.className.replace(i,e),I=e}},T=function(){var e=t(".preview-scale-container"),i="standard"===C?1:k,a=e.width()*i,n=(_.width-a)/2;e.css({left:n,"-webkit-transform":"scale("+i+","+i+")","-ms-transform":"scale("+i+","+i+")",transform:"scale("+i+","+i+")","-webkit-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"})},P=function(){t(".preview-canvas").css({paddingTop:t(".preview-utility-bar").outerHeight()+5})},$=function(){var t={x:1,y:1},e={width:Q.width+150,height:Q.height+275};e.width>_.width&&(t.x=_.width/e.width),e.height>_.height&&(t.y=_.height/e.height),k=Math.min(t.x,t.y)},O=function(){var e=p.find(".preview-device-selector");e.on("change",function(){for(var e,i=t(this),a="select"===this.nodeName.toLowerCase()?this.options[this.selectedIndex]:this,n=i.data("target"),r=t(a).data("value").split(","),o=r.length,s=p.find("."+n+"-preview-container");o--;)r[o]=parseFloat(r[o]);return e="mobile"===n&&"portrait"===I?{width:r[1],height:r[0]}:{width:r[0],height:r[1]},e.width===s.width()&&e.height===s.height()?!1:(M(n),s.css(e),T(),void z())}),e.each(function(){"select"===this.nodeName.toLowerCase()&&t(this).select2({minimumResultsForSearch:-1})})},B=function(){t("select.orientation-selector").on("change",function(){var e,i=t(this).data("target"),a=t("."+i+"-preview-frame"),n=a.find("."+i+"-preview-container"),r=t(this).val();return r===I?!1:(e={height:n.width(),width:n.height()},n.css(e),T(),z(),void A(r))}).select2({minimumResultsForSearch:-1})},F=function(){var e=p.find(".preview-closer"),i=g.find(".close-trigger"),a=g.find("a"),r=t("#preview-iframe");e.on("click",function(){n.setContext(t(".item-editor-item")),p.hide(),r.off("load").attr("src","about:blank")}),w.keyup(function(t){27===t.keyCode&&e.trigger("click")}),i.on("click",function(){g.hide(),P(),T()}),a.on("click",function(e){e.preventDefault(),t.cookie("hidePreviewFeedback",!0,{expires:1e3,path:"/"}),i.trigger("click")})},D=function(){var t=[];return e(y).forEach(function(e,i){t.push({value:i,label:e,selected:C===i})}),t},j=function(){t("select.preview-type-selector").on("change",function(){var e=t(this),i=e.val();M(i),t("."+i+"-device-selector").trigger("change")}).select2({minimumResultsForSearch:-1})},z=function(){var e=t(".preview-container"),i=function(){return i=e.find("iframe"),i.height(""),i}(),a=i.contents().outerHeight(),n=e.innerHeight();"standard"!==C?n>a&&(a=n):e.height(a+10),i.height(a)},L=function(e){var i=t(".standard-device-selector"),a=(i.val()?i.val().split(","):"")||[q.width().toString()],n=a.join(",");a[1]=e||a[1]||"1200",i.val(n).data("value",n)},H=function(){var t=v.find(".preview-console-body"),e=t.find("ul"),i=v.find(".preview-console-closer");v.off("updateConsole").on("updateConsole",function(n,r,o){var s=new Date,c=[a(s.getHours(),2,"0","STR_PAD_LEFT"),a(s.getMinutes(),2,"0","STR_PAD_LEFT"),a(s.getSeconds(),2,"0","STR_PAD_LEFT")].join(":"),l='<span class="log-time">'+a(c,12," ")+'</span> <span class="log-type">'+a(r,18," ")+'</span> <span class="log-message">'+a(o,18," ")+"</span>";e.append("<li><pre>"+l+"</pre></li>"),t.is(":visible")?e.scrollTop(1e4):t.slideDown("slow",function(){i.show(),e.scrollTop(1e4)})}),i.on("click",function(){t.slideUp("slow",function(){i.hide()})})},G=function(){t(".preview-overlay").remove(),u=null,p=t(o({mobileDevices:E("mobile"),desktopDevices:E("desktop"),previewTypes:D(),previewType:C})),x.append(p),b=parseInt(t(".preview-container").css("max-width"),10),g=p.find(".preview-message-box"),t.cookie("hidePreviewFeedback")&&g.hide(),v=p.find("#preview-console"),H(),L(),S(),O(),B(),j(),F(),$(),M(C),A(I),q.on("resize orientationchange",function(){_={width:q.innerWidth(),height:q.innerHeight()},L(),$(),T()})},W=function(){{var e=t(".preview-modal-feedback"),i=e.find(".cancel"),a=e.find(".save");e.find(".modal-close")}e.modal({width:500}),a.on("click",function(){p.trigger("save.preview"),e.modal("close")}),i.on("click",function(){e.modal("close")})},U=function(e,i,a){var n=function(){var i=c._url("index","QtiPreview","taoQtiItem")+"?uri="+encodeURIComponent(a.itemUri)+"&twosix=1";return t.ajax({url:i,dataType:"html"}).done(function(e){t(".preview-item-container").html(e)}),C=t(e).data("preview-type")||"desktop",p.show(),p.height(w.outerHeight()),p.find("select:visible").trigger("change"),T(),P(),!0};if(!R){var r=h.serialize(i);(m!==r||""===r)&&(m=r,R=!0)}R?(W(),p.on("save.preview",function(){p.off("save.preview"),R=!1,t.when(s.save(),a.save()).done(function(){n()})})):n()},N=function(e,i,a){var n=function(){m=h.serialize(i)};setTimeout(n,500),t("#save-trigger").on("click.qti-creator",n),G(),w.on("stylechange.qti-creator",function(){R=!0}),t(e).on("click",function(){U(this,i,a)})};return{init:N}}),define("taoQtiItem/qtiCreator/editor/preparePrint",["jquery"],function(t){"use strict";var e=function(){function e(e){return e.siblings().each(function(){t(this).addClass("item-no-print")}),e.parent()}for(var i=e(t("#item-editor-scope").parent());i.length&&"body"!==i.get(0).nodeName.toLowerCase();)i=e(i);t("#item-editor-toolbar, .item-editor-sidebar").addClass("item-no-print")};return t("#print-trigger").on("click",function(){window.print()}),e}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">\n        ',(o=i.message)?r=o.call(e,{hash:{},data:n}):(o=e&&e.message,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+"\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/editor/editor",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip","ui/tooltipster"],function(t,e,i,a,n){var r=function(){var r={},o=e(window),s=e(document),c=function(t){var i=2*parseInt(r.scrollInner.css("padding-left")),a=t.outerWidth()+i,n=r.scrollInner.innerWidth(),s=e(window).height()-r.itemPanel.offset().top+o.scrollTop(),c=Math.max(a,n);isNaN(parseInt(r.scrollOuter.css("max-height")))&&(r.scrollOuter.css("max-height",r.itemPanel.css("height")),r.itemPanel.css("height","")),a>n?r.scrollInner[0].style.width=c+"px":r.scrollInner.width(""),r.scrollOuter.height(s)},l=function(){var t,i={scope:"#item-editor-scope",toolbar:"#item-editor-toolbar",toolbarInner:"#item-editor-toolbar-inner",sidebars:".item-editor-sidebar",itemBar:"#item-editor-item-bar",itemPanel:"#item-editor-panel",scrollOuter:"#item-editor-scroll-outer",scrollInner:"#item-editor-scroll-inner"};for(t in i)r[t]=e(i[t]);r.columns=r.sidebars.add(r.itemPanel)},d="h2",h="section",p="hr, .panel",u="closed",m="accordion",f=function(){r.sidebars.find("[data-sub-group]").each(function(){var t,i,a,n=e(this),r=n.parents("section"),o=n.data("sub-group");o&&(t=r.find(".sub-group."+o),i=t.find(".tool-list"),t.length||(t=e("<div>",{"class":"panel clearfix sub-group "+o}),i=e("<ul>",{"class":"tool-list plain clearfix"}),t.append(i),r.append(t),a=e("<div>",{"class":"sub-group-cover blocking"}),t.append(a),t.data("cover",a)),i.append(n))}),x()},g=function(){r.sidebars.each(function(){var t=e(this),i=t.find(h),a=(t.children(p).hide(),t.find(d));return 0===a.length?!0:(a.each(function(){var t=e(this),i=t.parents(h),a=i.children(p),n=e("<span>",{"class":"icon-up"}),r=e("<span>",{"class":"icon-down"}),o=a.is(":visible")?"open":"close";t.append(n).append(r).addClass(u),a.on("panelclose."+m+" panelopen."+m,function(t,e){var i="panelclose"===t.type?"add":"remove";e.heading[i+"Class"](u)}),a.trigger("panel"+o+"."+m,{heading:t})}),void i.each(function(){e(this).find(d).on("click",function(t,i){var a,n,r=e(this),o=r.parents(h).children(p),s=(!(!i||!i.preserveOthers),{close:"hide",open:"fadeIn"}),c=i&&i.forceState?i.forceState:!1;c&&(n="open"===c?"addClass":"removeClass",r[n](u)),a=r.hasClass(u)?"open":"close",o.trigger("panel"+a+"."+m,{heading:r})[s[a]]()})}))})},v=function(t,i,a){t.each(function(){e(this).find(d).trigger("click",{preserveOthers:i,forceState:a})})},b=function(t,e){v(t,!!e,"close")},I=function(t,e){v(t,!!e,"open")},C=function(){var t=0;r.columns.each(function(){var i=e(this);t=Math.max(i.height(),t)}).height(t)},y=function(t,i){if(t=e("."+t),t.length){var a="disable"===i?"addClass":"removeClass";t.data("cover")[a]("blocking")}},w=function(t){y(t,"enable")},q=function(t){y(t,"disable")},x=function(){var t,r=e("#sidebar-left-section-inline-interactions .inline-interactions"),o=e(a({message:i("Inline interactions need to be inserted into a text block.")}));r.append(o),n(r),o.css({position:"absolute",zIndex:11,top:0,right:10}),r.on("mouseenter",".sub-group-cover",function(){t=setTimeout(function(){o.find("[data-tooltip]").tooltipster("show")},300)}).on("mouseleave",".sub-group-cover",function(){o.find("[data-tooltip]").tooltipster("hide"),clearTimeout(t)})},_=function(i){var a=i.$container;l(),C(),f(),g(),b(r.sidebars.find(h)),I(e("#sidebar-left-section-common-interactions"),!1),r.itemPanel.addClass("has-item");var n=t.throttle(function(){c(a)},150);n(),s.on("scroll",n),a.on("resize",n),o.on("resize orientationchange",n)};return{initGui:_,openSections:I,closeSections:b,adaptHeight:C,enableSubGroup:w,disableSubGroup:q}}();return r}),define("taoQtiItem/qtiCreator/helper/panel",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,a){var n=function(){return t("#item-editor-panel")},r=function(t,e){t.show(),a.openSections(t.children("section")),e&&e.length&&a.closeSections(e.children("section"))},o=function(){t(document).off(".panel");var o=n(),c={img:"Image",object:"Media",rubricBlock:"Rubric Block",math:"Math"},l=t("#item-editor-interaction-property-bar"),d=t("#item-editor-choice-property-bar"),h=t("#item-editor-response-property-bar"),p=t("#item-editor-item-property-bar"),u=t("#item-editor-body-element-property-bar"),m=t("#item-editor-text-property-bar"),f=t("#item-editor-modal-feedback-property-bar"),g=t("#item-style-editor-bar"),v=t("#appearance-trigger"),b=function(t){t?(v.addClass("active"),g.show(),p.hide(),o.trigger("styleedit"),r(g)):(v.removeClass("active"),g.hide(),r(p))};v.on("click",function(){b(v.hasClass("active")?!1:!0)}),e.delay(function(){r(p)},200),t(document).on("afterStateInit.qti-widget.panel",function(t,e,a){switch(a.name){case"active":b(!1),i.isA(e,"assessmentItem")||p.hide();var n=c[e.qtiClass];n?(u.find("h2").html(n+" Properties"),r(u)):"_container"===e.qtiClass&&r(m),"modalFeedback"===e.qtiClass&&(r(f),h.hide());break;case"question":r(l);break;case"answer":r(h);break;case"choice":r(d,l);break;case"sleep":c[e.qtiClass]?u.hide():"_container"===e.qtiClass&&m.hide(),i.isA(e,"choice")||o.find(".widget-box.edit-active").length||r(p)}}).on("afterStateExit.qti-widget.panel",function(t,e,i){switch(i.name){case"active":"modalFeedback"===e.qtiClass&&(r(h),f.hide());break;case"question":e.is("interaction")&&(d.hide(),l.hide());break;case"choice":d.hide(),r(l);break;case"answer":h.hide()}}).on("elementCreated.qti-widget.panel",function(t,e){"_container"===e.element.qtiClass&&a.enableSubGroup("inline-interactions")}).on("deleted.qti-widget.panel",function(t,e){"_container"===e.element.qtiClass&&s()})},s=function(){var t=n();t.find(".widget-textBlock").length?a.enableSubGroup("inline-interactions"):a.disableSubGroup("inline-interactions")};return{initFormVisibilityListener:o,showPanel:r,toggleInlineInteractionGroup:s}}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",assessmentItem:"taoQtiItem/qtiItem/core/Item",responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",gapText:"taoQtiItem/qtiItem/core/choices/GapText",hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",customInteraction:"taoQtiItem/qtiItem/core/interactions/CustomInteraction"}
}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element"],function(t,e,i,a){var n=e.extend({init:function(t,e){this.qti={},this.classesLocation={},this.item=t||null,this.setClassesLocation(e||i)},setClassesLocation:function(e){return t.extend(this.classesLocation,e),this},getRequiredClasses:function(e){var i=[];for(var a in e)"qtiClass"===a&&"_container"!==e[a]&&"relatedItem"!==a?i.push(e[a]):"object"==typeof e[a]&&(i=t.union(i,this.getRequiredClasses(e[a])));return i},loadRequiredClasses:function(e,i,a){var n=this.getRequiredClasses(e,a),r=[];for(var o in n){var s=n[o];if(!this.classesLocation[s])throw new Error("missing qti class location declaration : "+s);r.push(this.classesLocation[s])}var c=this;require(r,function(){t.each(arguments,function(t){c.qti[t.prototype.qtiClass]=t}),i.call(c,c.qti)})},getLoadedClasses:function(){return t.keys(this.qti)},loadItemData:function(e,i){var a=this;a.loadRequiredClasses(e,function(n){if("object"==typeof e&&"assessmentItem"===e.qtiClass){a.item=new n.assessmentItem(e.serial,e.attributes||{}),a.loadContainer(a.item.getBody(),e.body);for(var r in e.outcomes){var o=a.buildOutcome(e.outcomes[r]);o&&a.item.addOutcomeDeclaration(o)}for(var r in e.feedbacks){var s=a.buildElement(e.feedbacks[r]);s&&a.item.addModalFeedback(s)}for(var r in e.stylesheets){var c=a.buildElement(e.stylesheets[r]);c&&a.item.addStylesheet(c)}for(var r in e.responses){var l=a.buildResponse(e.responses[r]);if(l){a.item.addResponseDeclaration(l);var d=e.responses[r].feedbackRules;d&&t.forIn(d,function(t,e){l.feedbackRules[e]=a.buildSimpleFeedbackRule(t)})}}e.responseProcessing&&a.item.setResponseProcessing(a.buildResponseProcessing(e.responseProcessing)),a.item.setNamespaces(e.namespaces)}"function"==typeof i&&i.call(a,a.item)})},loadElement:function(t,e){var i=this;i.loadRequiredClasses(t,function(){var a=i.buildElement(t);"function"==typeof e&&e.call(i,a)})},loadElements:function(t,e){var i=this;if(!i.item)throw"QtiLoader : cannot load elements in empty item";this.loadRequiredClasses(t,function(){var a=i.item.getComposingElements();for(var n in t){var r=t[n];r&&r.qtiClass&&r.serial&&a[r.serial]&&i.loadElementData(a[r.serial],r)}"function"==typeof e&&e.call(i,i.item)})},buildResponse:function(e){var i=this.buildElement(e);return i.template=e.howMatch||null,i.defaultValue=e.defaultValue||null,i.correctResponse=e.correctResponses||null,i.mapEntries=t.size(e.mapping)?e.mapping:t.size(e.areaMapping)?e.areaMapping:{},i.mappingAttributes=e.mappingAttributes||{},i},buildSimpleFeedbackRule:function(t){var e=this.buildElement(t);return t.condition&&(e.condition=t.condition),t.comparedValue&&(e.comparedValue=t.comparedValue),e.comparedOutcome=this.item.responses[t.comparedOutcome]||null,e.feedbackOutcome=this.item.outcomes[t.feedbackOutcome]||null,e.feedbackThen=this.item.modalFeedbacks[t.feedbackThen]||null,e.feedbackElse=this.item.modalFeedbacks[t.feedbackElse]||null,e},buildOutcome:function(t){var e=this.buildElement(t);return e.defaultValue=t.defaultValue||null,e},buildResponseProcessing:function(t){var e=this.buildElement(t);return t&&t.processingType&&("custom"===t.processingType?(e.xml=t.data,e.processingType="custom"):e.processingType="templateDriven"),e},loadContainer:function(t,e){if(!a.isA(t,"_container"))throw"bodyObject must be a QTI Container";if(!e||"string"!=typeof e.body||"array"!=typeof e.elements&&"object"!=typeof e.elements)throw"wrong bodydata format";for(var i in e.elements){var n=e.elements[i],r=this.buildElement(n);r&&t.setElement(r,e.body)}t.body(e.body)},buildElement:function(t){var e=null;if(!(t&&t.qtiClass&&t.serial))throw"wrong elementData format";var i=t.qtiClass;if(!this.qti[i])throw"the qti element class does not exist: "+i;return e=new this.qti[i](t.serial),this.loadElementData(e,t),e},loadElementData:function(e,i){return e.setAttributes(t.clone(i.attributes)||{}),e.body&&i.body&&e.bdy&&this.loadContainer(e.getBody(),i.body),e.object&&i.object&&e.object&&this.loadObjectData(e.object,i.object),a.isA(e,"interaction")?this.loadInteractionData(e,i):a.isA(e,"choice")?this.loadChoiceData(e,i):a.isA(e,"math")&&this.loadMathData(e,i),e},loadInteractionData:function(t,e){a.isA(t,"blockInteraction")&&e.prompt&&this.loadContainer(t.prompt.getBody(),e.prompt),this.buildInteractionChoices(t,e),a.isA(t,"customInteraction")&&this.loadPciData(t,e)},buildInteractionChoices:function(t,e){if(e.choices){if(a.isA(t,"matchInteraction"))for(var i=0;2>i;i++){if(!e.choices[i])throw"missing match set #"+i;var n=e.choices[i];for(var r in n){var o=this.buildElement(n[r]);o&&t.addChoice(o,i)}}else for(var r in e.choices){var o=this.buildElement(e.choices[r]);o&&t.addChoice(o)}if(a.isA(t,"graphicGapMatchInteraction")&&e.gapImgs)for(var r in e.gapImgs){var s=this.buildElement(e.gapImgs[r]);s&&t.addGapImg(s)}}},loadChoiceData:function(t,e){a.isA(t,"textVariableChoice")?t.val(e.text):a.isA(t,"gapImg")||a.isA(t,"containerChoice")},loadObjectData:function(t,e){t.setAttributes(e.attributes),e._alt&&(t._alt="object"===e._alt.qtiClass?n.buildElement(e._alt):e._alt)},loadMathData:function(t,e){t.ns=e.ns||{},t.setMathML(e.mathML||""),t.annotations=e.annotations||{}},loadPciData:function(t,e){t.typeIdentifier=e.typeIdentifier,t.markup=e.markup,t.properties=e.properties,t.libraries=e.libraries}});return n}),define("taoQtiItem/qtiCreator/model/helper/invalidator",["lodash"],function(t){var e={completelyValid:function(t){var e,i,a=t.getRelatedItem();a&&(e=t.getSerial(),i=a.data("invalid")||{},delete i[e],a.data("invalid",i))},valid:function(e,i){var a,n=e.getRelatedItem(),r=e.getSerial();if(n){if(a=n.data("invalid")||{},!i)throw new Error('missing required argument "key"');a[r]&&a[r][i]&&(delete a[r][i],t.size(a[r])||delete a[r],n.data("invalid",a))}},invalid:function(t,e,i,a){var n,r=t.getRelatedItem(),o=t.getSerial();if(r){if(n=r.data("invalid")||{},!e)throw new Error('missing required arguments "key"');n[o]||(n[o]={}),n[o][e]={message:i||"",stateName:a||"active"},r.data("invalid",n)}},isValid:function(t){var e,i=t.getRelatedItem(),a=t.getSerial();return i?(e=i.data("invalid")||{},!e[a]):!0}};return e}),define("taoQtiItem/qtiCreator/model/mixin/editable",["lodash","jquery","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/invalidator"],function(t,e,i,a,n){var r=function(e){var r=!1,o=e.getRelatedItem();if(!o)throw"no related item found";var s=o.find(e.getSerial());if(s){var c=s.parent;i.isA(c,"interaction")?("gapImg"===e.qtiClass?c.removeGapImg(e):i.isA(e,"choice")&&c.removeChoice(e),r=!0):"body"===s.location&&t.isFunction(c.initContainer)?(t.isFunction(e.beforeRemove)&&e.beforeRemove(),c.getBody().removeElement(e),r=!0):i.isA(c,"_container")&&(t.isFunction(e.beforeRemove)&&e.beforeRemove(),c.removeElement(e),r=!0),r&&(e.data("removed",!0),n.completelyValid(e),a.deleted(e,c))}return r},o=function(t,e,a){if(t[e]){var r,o="";"string"==typeof a?(o=a,r=i.getElementBySerial[o]):a instanceof i&&(o=a.getSerial(),r=a),o&&(n.completelyValid(r),delete t[e][o],i.unsetElement(o))}return t},s={init:function(e,i){"object"==typeof e&&(i=e,e="");var a={};t.isFunction(this.getDefaultAttributes)&&t.extend(a,this.getDefaultAttributes()),t.extend(a,i),this._super(e,a)},attr:function(t,i){var a=this._super(t,i);return void 0!==t&&void 0!==i&&e(document).trigger("attributeChange.qti-widget",{element:this,key:t,value:i}),a},remove:function(){if(0===arguments.length)return r(this);if(2===arguments.length)return o(this,arguments[0],arguments[1]);throw"invalid number of argument given"}};return s}),define("taoQtiItem/qtiCreator/model/qtiClasses",["lodash","taoQtiItem/qtiItem/core/qtiClasses"],function(t,e){return t.defaults({assessmentItem:"taoQtiItem/qtiCreator/model/Item",_container:"taoQtiItem/qtiCreator/model/Container",img:"taoQtiItem/qtiCreator/model/Img",math:"taoQtiItem/qtiCreator/model/Math",object:"taoQtiItem/qtiCreator/model/Object",rubricBlock:"taoQtiItem/qtiCreator/model/RubricBlock",modalFeedback:"taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/model/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCreator/model/interactions/MatchInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",simpleChoice:"taoQtiItem/qtiCreator/model/choices/SimpleChoice",simpleAssociableChoice:"taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",inlineChoice:"taoQtiItem/qtiCreator/model/choices/InlineChoice",mediaInteraction:"taoQtiItem/qtiCreator/model/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/model/interactions/UploadInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCreator/model/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",graphicInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",hotspotChoice:"taoQtiItem/qtiCreator/model/choices/HotspotChoice",gapImg:"taoQtiItem/qtiCreator/model/choices/GapImg",associableHotspot:"taoQtiItem/qtiCreator/model/choices/AssociableHotspot",gapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GapMatchInteraction",hottextInteraction:"taoQtiItem/qtiCreator/model/interactions/HottextInteraction",hottext:"taoQtiItem/qtiCreator/model/choices/Hottext",gapText:"taoQtiItem/qtiCreator/model/choices/GapText",gap:"taoQtiItem/qtiCreator/model/choices/Gap",responseDeclaration:"taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiCreator/model/ResponseProcessing"},e)}),define("taoQtiItem/qtiCreator/model/helper/container",["lodash","taoQtiItem/qtiCreator/model/qtiClasses"],function(t,e){var i={createElements:function(i,a,n){var r=/{{([a-z0-9_]*):new}}/gi,o={};a.replace(r,function(t,i){if(!e[i])throw"missing required class : "+i;o[i]=e[i]}),require(t.values(o),function(){var t={};for(var e in arguments)t[arguments[e].prototype.qtiClass]=arguments[e];var o={},s=a.replace(r,function(e,a){if(t[a]){var n=new t[a];return i.getRenderer()&&n.setRenderer(i.getRenderer()),o[n.getSerial()]=n,n.placeholder()}return e});i.setElements(o,s);for(var e in o){var c=o[e];"function"==typeof c.buildIdentifier&&c.buildIdentifier(),"function"==typeof c.afterCreate&&c.afterCreate(),$(document).trigger("elementCreated.qti-widget",{parent:i.parent(),element:c})}"function"==typeof n&&n.call(i,o)})}};return i}),define("taoQtiItem/qtiCreator/model/mixin/editableContainer",["taoQtiItem/qtiCreator/model/helper/container"],function(t){var e={createElements:function(e,i){var a=this;t.createElements(a.getBody(),e,function(t){i.call(a,t)})}};return e}),define("taoQtiItem/qtiItem/core/IdentifiedElement",["taoQtiItem/qtiItem/core/Element"],function(t){var e=t.extend({buildIdentifier:function(t,e){void 0===e&&(e=!0);var i=this.getRelatedItem();if(!i)throw"cannot build identifier of an element that is not attached to an assessment item";var a="",n=1,r=i.getUsedIdentifiers();t?(t=t.replace(/_[0-9]+$/gi,"_"),t=t.replace(/[^a-zA-Z0-9_]/gi,"_"),t=t.replace(/(_)+/gi,"_"),e&&(a="_"+n)):(t=this.qtiClass,a="_"+n);do{var o=!1,s=t+a;r[s]&&(o=!0,a="_"+n,n++)}while(o);return this.attr("identifier",s),this},id:function(t){return t||this.attr("identifier")||this.buildIdentifier(t),this.attr("identifier",t)}});return e}),define("taoQtiItem/qtiItem/mixin/Mixin",[],function(){return{augment:function(t,e,i){if("function"==typeof t&&"object"==typeof e)for(var a in e)if(Object.hasOwnProperty(t.prototype,a)){if(i&&i.append){var n=t.prototype[a];t.prototype[a]=function(){return e[a].apply(this,arguments),n.apply(this,arguments)}}}else t.prototype[a]=e[a]}}}),define("taoQtiItem/qtiItem/core/Container",["taoQtiItem/qtiItem/core/Element","lodash","jquery","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,a){var n=t.extend({qtiClass:"_container",init:function(t){if(t&&"string"!=typeof t)throw"the body of a container must be a string";this.bdy="",this.body(t||""),this.elements={},this._super()},body:function(t){if("undefined"==typeof t)return this.bdy;if("string"!=typeof t)throw"body must be a string";this.bdy=t,i(document).trigger("containerBodyChange",{body:t,container:this})},setElements:function(e,a){var n=!1;for(var r in e){var o=e[r];if(!(o instanceof t))throw n=!1,"expected a qti element";-1===a.indexOf(o.placeholder())&&(a+=o.placeholder()),o.setRelatedItem(this.getRelatedItem()||null),this.elements[o.getSerial()]=o,i(document).trigger("containerElementAdded",{element:o,container:this}),n=!0}return this.body(a),n},setElement:function(t,e){return this.setElements([t],e)},removeElement:function(e){var i="";return"string"==typeof e?i=e:e instanceof t&&(i=e.getSerial()),delete this.elements[i],this.body(this.body().replace("{{"+i+"}}","")),this},getElements:function(i){var a={};if("string"==typeof i)for(var n in this.elements)t.isA(this.elements[n],i)&&(a[n]=this.elements[n]);else a=e.clone(this.elements);return a},getElement:function(t){return this.elements[t]?this.elements[t]:null},getComposingElements:function(){var t=this.getElements(),i={};for(var a in t)i[a]=t[a],i=e.extend(i,t[a].getComposingElements());return i},render:function(){var t=a.getOptionsFromArguments(arguments),e=t.renderer||this.getRenderer(),i=[],n=this.body();for(var r in this.elements){var o=this.elements[r];if("function"!=typeof o.render)throw"render() is not defined for the qti element: "+r;"_container"===o.qtiClass?n=n.replace(o.placeholder(),o.render(e)):(n=n.replace(o.placeholder(),"{{{"+r+"}}}"),i[r]=o.render(e))}if(e.isRenderer)return this._super({body:e.renderDirect(n,i),contentModel:this.contentModel||"flow"},e,t.placeholder);throw"invalid qti renderer for qti container"},postRender:function(t,e,i){i=i||this.getRenderer();for(var a in this.elements){var n=this.elements[a];"function"==typeof n.postRender&&n.postRender(t,"",i)}this._super(t,e,i)},toArray:function(){var t={serial:this.serial,body:this.bdy,elements:{}};for(var e in this.elements)t.elements[e]=this.elements[e].toArray();return t},find:function(t,i){var a=null;return this.elements[t]?a={parent:i||this,element:this.elements[t],location:"body"}:e.each(this.elements,function(e){return a=e.find(t),a?!1:void 0}),a}});return n}),define("taoQtiItem/qtiItem/mixin/Container",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/core/Container"],function(t,e){var i={initContainer:function(t){this.bdy=new e(t||""),this.bdy.setRelatedItem(this.getRelatedItem()||null),this.bdy.contentModel="blockStatic"},getBody:function(){return this.bdy},body:function(t){var e=this.bdy.body(t);return t?this:e},setElement:function(t,e){return this.bdy.setElement(t,e),this},removeElement:function(t){return this.bdy.removeElement(t)}};return{augment:function(e){t.augment(e,i)},methods:i}}),define("taoQtiItem/qtiItem/mixin/ContainerItemBody",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(t,e,i){var a={};return i.extend(a,e.methods),i.extend(a,{initContainer:function(t){e.methods.initContainer.call(this,t),this.bdy.contentModel="itemBody"}}),{augment:function(e){t.augment(e,a)},methods:a}}),define("taoQtiItem/qtiItem/core/Item",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/ContainerItemBody","lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a,n,r){var o=e.extend({qtiClass:"assessmentItem",init:function(t,e){this._super(t,e),this.relatedItem=this,this.stylesheets={},this.responses={},this.outcomes={},this.modalFeedbacks={},this.namespaces={},this.responseProcessing=null},getInteractions:function(){var e=[],i=this.getComposingElements();for(var a in i)t.isA(i[a],"interaction")&&e.push(i[a]);return e},addResponseDeclaration:function(e){if(!t.isA(e,"responseDeclaration"))throw"is not a qti response declaration";return e.setRelatedItem(this),this.responses[e.getSerial()]=e,this},getResponseDeclaration:function(t){for(var e in this.responses)if(this.responses[e].attr("identifier")===t)return this.responses[e];return null},addOutcomeDeclaration:function(e){if(!t.isA(e,"outcomeDeclaration"))throw"is not a qti outcome declaration";return e.setRelatedItem(this),this.outcomes[e.getSerial()]=e,this},addModalFeedback:function(e){if(!t.isA(e,"modalFeedback"))throw"is not a qti modal feedback";return e.setRelatedItem(this),this.modalFeedbacks[e.getSerial()]=e,this},getComposingElements:function(){var e=this._super(),i=this;return a.each(["responses","outcomes","modalFeedbacks","stylesheets"],function(t){for(var n in i[t]){var r=i[t][n];e[n]=r,e=a.extend(e,r.getComposingElements())}}),this.responseProcessing instanceof t&&(e[this.responseProcessing.getSerial()]=this.responseProcessing),e},find:function(t){var e=this._super(t);return e||(e=r.findInCollection(this,["responses","outcomes","modalFeedbacks","stylesheets"],t)),e},getResponses:function(){return a.clone(this.responses)},getRelatedItem:function(){return this},setNamespaces:function(t){this.namespaces=t},getNamespaces:function(){return a.clone(this.namespaces)},addStylesheet:function(e){if(!t.isA(e,"stylesheet"))throw"is not a qti stylesheet declaration";return e.setRelatedItem(this),this.stylesheets[e.getSerial()]=e,this},removeStyleSheet:function(t){return delete this.stylesheets[t.getSerial()],this},setResponseProcessing:function(e){if(!t.isA(e,"responseProcessing"))throw"is not a response processing";return e.setRelatedItem(this),this.responseProcessing=e,this},toArray:function(){var t=this._super();t.outcomes={};for(var e in this.outcomes)t.outcomes[e]=this.outcomes[e].toArray();t.responses={};for(var e in this.responses)t.responses[e]=this.responses[e].toArray();t.stylesheets={};for(var e in this.stylesheets)t.stylesheets[e]=this.stylesheets[e].toArray();return t.namespaces=this.namespaces,t},isEmpty:function(){var t=this.body().trim();if(t){var e=n("<div>").html(t),i=e.children();return 1===i.length&&i.hasClass("empty")?!0:!1}return!0}});return i.augment(o),o}),define("taoQtiItem/qtiItem/core/Stylesheet",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var a=t.extend({qtiClass:"stylesheet",render:function(){var t=i.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),n={},r=a.getOption("baseUrl")||"",o=this.attr("href");return o.match(/^http/i)||(n.attributes={href:r+o}),this._super(e.merge(n,t.data),t.placeholder,t.subclass,a)}});return a}),define("taoQtiItem/qtiCreator/model/Stylesheet",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Stylesheet"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{href:"css/tao-user-styles.css",title:"",type:"text/css",media:"all"}}}),i.extend(a)}),define("taoQtiItem/qtiItem/core/ResponseProcessing",["taoQtiItem/qtiItem/core/Element","lodash"],function(t){var e=t.extend({qtiClass:"responseProcessing",processingType:"",xml:""});return e}),define("taoQtiItem/qtiCreator/model/ResponseProcessing",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/ResponseProcessing"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{}},setProcessingType:function(e){this.processingType!==e&&("custom"===this.processingType&&t.each(this.getRelatedItem().getResponses(),function(t){t.setTemplate("MATCH_CORRECT")}),this.processingType=e)}}),i.extend(a)}),define("taoQtiItem/qtiItem/core/variables/VariableDeclaration",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(t){var e=t.extend({init:function(t,e){this._super(t,e),this.defaultValue=null},is:function(t){return"variableDeclaration"===t||this._super(t)},toArray:function(){var t=this._super();return t.defaultValue=this.defaultValue,t}});return e}),define("taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration"],function(t){return t.extend({qtiClass:"outcomeDeclaration"})}),define("taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/variables/OutcomeDeclaration"],function(t,e,i){var a={};return t.extend(a,e),i.extend(a)}),define("taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",["taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({qtiClass:"modalFeedback",is:function(t){return"feedback"===t||this._super(t)}});return e.augment(i),i}),define("taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/feedbacks/ModalFeedback"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{title:"modal feedback title",showHide:"show"}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/Item",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableContainer","taoQtiItem/qtiItem/core/Item","taoQtiItem/qtiCreator/model/Stylesheet","taoQtiItem/qtiCreator/model/ResponseProcessing","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration","taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback"],function(t,e,i,a,n,r,o,s){var c={};return t.extend(c,e),t.extend(c,i),t.extend(c,{getDefaultAttributes:function(){return{identifier:"myItem_1",title:"Item title",adaptive:!1,timeDependent:!1}},createResponseProcessing:function(){var t=new r;return t.processingType="templateDriven",this.setResponseProcessing(t),t},createStyleSheet:function(e){if(e&&t.isString(e)){var i=new n({href:e});return i.setRenderer(this.getRenderer()),this.addStylesheet(i),i}throw'missing or invalid type for the required arg "href"'},createOutcomeDeclaration:function(t){var e=t.identifier||"";delete t.identifier;var i=new o(t);return this.addOutcomeDeclaration(i),i.buildIdentifier(e),i},createModalFeedback:function(t){var e=t.identifier||"";delete t.identifier;var i=new s(t);return this.addModalFeedback(i),i.buildIdentifier(e),i.body("Some feedback text."),i},deleteResponseDeclaration:function(e){var i;return t.isString(e)?i=e:e&&"responseDeclaration"===e.qtiClass&&(i=e.getSerial()),delete this.responses[i],this}}),a.extend(c)}),define("taoQtiItem/qtiCreator/helper/itemLoader",["jquery","helpers","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/qtiClasses"],function(t,e,i,a,n){var r=function(t){var e=t.lastIndexOf("#");return t.substr(e+1)},o={loadItem:function(o,s){o.uri&&t.ajax({url:e._url("getItemData","QtiCreator","taoQtiItem"),dataType:"json",data:{uri:o.uri}}).done(function(t){if(t.itemData&&"assessmentItem"===t.itemData.qtiClass){var e=(new i).setClassesLocation(n),c=t.itemData;e.loadItemData(c,function(t){t.isEmpty()&&t.body(""),s(t,this.getLoadedClasses())})}else{var l=(new a).id(r(o.uri)),d=l.createOutcomeDeclaration({cardinality:"single",baseType:"float"});d.buildIdentifier("SCORE",!1),l.createResponseProcessing(),s(l)}})}};return o}),define("taoQtiItem/qtiCreator/renderers/config",["lodash","taoQtiItem/qtiCommonRenderer/renderers/config"],function(t,e){var i=t.defaults({_container:"taoQtiItem/qtiCreator/renderers/Container",assessmentItem:"taoQtiItem/qtiCreator/renderers/Item",rubricBlock:"taoQtiItem/qtiCreator/renderers/RubricBlock",img:"taoQtiItem/qtiCreator/renderers/Img",math:"taoQtiItem/qtiCreator/renderers/Math",object:"taoQtiItem/qtiCreator/renderers/Object",modalFeedback:"taoQtiItem/qtiCreator/renderers/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",matchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",associateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",mediaInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",sliderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",gapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GapMatchInteraction",hottextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HottextInteraction",gap:"taoQtiItem/qtiCreator/renderers/choices/Gap",gapText:"taoQtiItem/qtiCreator/renderers/choices/GapText",hottext:"taoQtiItem/qtiCreator/renderers/choices/Hottext"},e.locations);return{name:"creatorRenderer",locations:i}}),define("taoQtiItem/qtiCreator/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCreator/renderers/config"],function(t,e){return t.build(e.locations,e.name)}),define("util/dom",["jquery"],function(t){return{contains:function(e){return e instanceof t&&(e=e[0]),t.contains(document,e)}}}),define("taoQtiItem/qtiCreator/helper/creatorRenderer",["taoQtiItem/qtiCreator/renderers/Renderer","helpers","jquery","util/dom"],function(t,e,i,a){var n=null,r=function(){return n&&n.getOption("bodyElementOptionForm")&&a.contains(n.getOption("bodyElementOptionForm"))||(n=new t({baseUrl:"",lang:"",uri:"",shuffleChoices:!1,itemOptionForm:i("#item-editor-item-property-bar .panel"),interactionOptionForm:i("#item-editor-interaction-property-bar .panel"),choiceOptionForm:i("#item-editor-choice-property-bar .panel"),responseOptionForm:i("#item-editor-response-property-bar .panel"),bodyElementOptionForm:i("#item-editor-body-element-property-bar .panel"),textOptionForm:i("#item-editor-text-property-bar .panel"),modalFeedbackOptionForm:i("#item-editor-modal-feedback-property-bar .panel"),mediaManager:{appendContainer:"#mediaManager",browseUrl:e._url("files","ItemContent","taoItems"),uploadUrl:e._url("upload","ItemContent","taoItems"),deleteUrl:e._url("delete","ItemContent","taoItems"),downloadUrl:e._url("download","ItemContent","taoItems")}})),n};return{get:function(){return r()},setOption:function(t,e){r().setOption(t,e)},setOptions:function(t){r().setOptions(t)}}}),define("json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json",function(){return{"sans-serif":['Arial, "Helvetica Neue", Helvetica, sans-serif','"Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif','Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif','Candara, Calibri, Segoe, "Segoe UI", Optima, Arial, sans-serif','"Century Gothic", CenturyGothic, AppleGothic, sans-serif','Corbel, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "DejaVu Sans", "Bitstream Vera Sans", "Liberation Sans", Verdana, "Verdana Ref", sans-serif','"Franklin Gothic Medium", "Franklin Gothic", "ITC Franklin Gothic", Arial, sans-serif','Frutiger, "Frutiger Linotype", Univers, Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans Condensed", "Liberation Sans", "Nimbus Sans L", Tahoma, Geneva, "Helvetica Neue", Helvetica, Arial, sans-serif','Futura, "Century Gothic", AppleGothic, "Trebuchet MS", sans-serif','Geneva, Verdana, "Lucida Sans", "Lucida Grande", "Lucida Sans Unicode", sans-serif','"Gill Sans", "Gill Sans MT", Calibri, sans-serif','"Helvetica Neue", Helvetica, Arial, sans-serif','Impact, Haettenschweiler, "Franklin Gothic Bold", Charcoal, "Helvetica Inserat", "Bitstream Vera Sans Bold", "Arial Black", sans-serif','"Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif','Optima, Segoe, "Segoe UI", Candara, Calibri, Arial, sans-serif','"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif',"Tahoma, Verdana, Segoe, sans-serif",'"Trebuchet MS", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Tahoma, sans-serif',"Verdana, Geneva, Tahoma, sans-serif"],serif:['Baskerville, "Baskerville Old Face", "Hoefler Text", Garamond, "Times New Roman", serif','"Big Caslon", "Book Antiqua", "Palatino Linotype", Georgia, serif','"Bodoni MT", Didot, "Didot LT STD", "Hoefler Text", Garamond, "Times New Roman", serif','"Book Antiqua", Palatino, "Palatino Linotype", "Palatino LT STD", Georgia, serif','"Calisto MT", "Bookman Old Style", Bookman, "Goudy Old Style", Garamond, "Hoefler Text", "Bitstream Charter", Georgia, serif','Cambria, "Hoefler Text", Utopia, "Liberation Serif", "Nimbus Roman No9 L Regular", Times, "Times New Roman", serif','Constantia, "Lucida Bright", Lucidabright, "Lucida Serif", Lucida, "DejaVu Serif", "Bitstream Vera Serif", "Liberation Serif", Georgia, serif','Didot, "Didot LT STD", "Hoefler Text", Garamond, "Times New Roman", serif','Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif','Georgia, Palatino," Palatino Linotype", Times, "Times New Roman", serif','"Goudy Old Style", Garamond, "Big Caslon", "Times New Roman", serif','"Hoefler Text", "Baskerville old face", Garamond, "Times New Roman", serif','"Lucida Bright", Georgia, serif','"Palatino Linotype", Palatino, Palladio, "URW Palladio L", "Book Antiqua", Baskerville, "Bookman Old Style", "Bitstream Charter", "Nimbus Roman No9 L", Garamond, "Apple Garamond", "ITC Garamond Narrow", "New Century Schoolbook", "Century Schoolbook", "Century Schoolbook L", Georgia, serif','Perpetua, Baskerville, "Big Caslon", "Palatino Linotype", Palatino, "URW Palladio L", "Nimbus Roman No9 L", serif','Rockwell, "Courier Bold", Courier, Georgia, Times, "Times New Roman", serif','"Times New Roman", TimesNewRoman, Times, Baskerville, Georgia, serif'],monospace:['"Andale Mono", AndaleMono, monospace','Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace','"Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace','"Lucida Console", "Lucida Sans Typewriter", Monaco, "Bitstream Vera Sans Mono", monospace','Monaco, Consolas, "Lucida Console", monospace','"Rockwell Extra Bold", "Rockwell Bold", monospace']}}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSelector",["jquery","json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","select2"],function(t,e,i,a){"use strict";
var n=function(){var n,r,o,s,c=t("select#item-editor-font-selector"),l=c.data("target"),d=t(l),h=function(t){return t.replace(/"/g,"'").replace(/, /g,",")},p=function(t){return t.substring(0,t.indexOf(",")).replace(/'/g,"")},u=c.parent().find('[data-role="font-selector-reset"]'),m=0,f=function(t){return t=t.replace(/-/g," "),(t+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(t){return t.toUpperCase()})},g=function(e){var i=e.element;return e.id?'<span style="font-size: 12px;'+t(i).attr("style")+'">'+e.text+"</span>":e.text},v=function(){i.apply(l,"font-family"),c.select2("val",d.css("font-family"))};c.append('<option value="">'+a("Default")+"</option>");for(n in e)if(e.hasOwnProperty(n)){for(r=t("<optgroup>",{label:f(n)}),s=e[n].length,m=0;s>m;m++)e[n][m]=h(e[n][m]),o=t("<option>",{value:e[n][m],text:p(e[n][m])}).css({fontFamily:e[n][m]}),r.append(o);c.append(r)}u.on("click",v),c.select2({formatResult:g,formatSelection:g,width:"resolve"}),t(document).on("customcssloaded.styleeditor",function(t,e){}),c.on("change",function(){i.apply(l,"font-family",t(this).val())})};return n}),jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){if(t.length){var t=$(t).get(0);return t.farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))}},jQuery._farbtastic=function(t,e){var i=this,a=$("<div>",{"class":"farbtastic"}),n=$("<div>",{"class":"color"}),r=$("<div>",{"class":"wheel"}),o=$("<div>",{"class":"overlay"}),s=$("<div>",{"class":"h-marker marker"}),c=$("<div>",{"class":"sl-marker marker"});t=$(t),$(a).append(n),$(a).append(r),$(a).append(o),$(a).append(s),$(a).append(c),t.append(a),i.wheel=r.get(0),i.radius=70,i.square=o.width(),i.width=a.width(),i.linkTo=function(t){return"object"==typeof i.callback&&$(i.callback).unbind("keyup",i.updateValue),i.color=null,"function"==typeof t?i.callback=t:("object"==typeof t||"string"==typeof t)&&(i.callback=$(t),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value)),this},i.updateValue=function(){this.value&&this.value!=i.color&&i.setColor(this.value)},i.setColor=function(t){var e=i.unpack(t);return i.color!=t&&e&&(i.color=t,i.rgb=e,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(t){return i.hsl=t,i.rgb=i.HSLToRGB(t),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(t){var e,a,n=t.target||t.srcElement,r=i.wheel;if("undefined"!=typeof t.offsetX){for(var o={x:t.offsetX,y:t.offsetY},s=n;s;)s.mouseX=o.x,s.mouseY=o.y,o.x+=s.offsetLeft,o.y+=s.offsetTop,s=s.offsetParent;for(var s=r,c={x:0,y:0};s;){if("undefined"!=typeof s.mouseX){e=s.mouseX-c.x,a=s.mouseY-c.y;break}c.x+=s.offsetLeft,c.y+=s.offsetTop,s=s.offsetParent}for(s=n;s;)s.mouseX=void 0,s.mouseY=void 0,s=s.offsetParent}else{var o=i.absolutePosition(r);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-o.x,a=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-o.y}return{x:e-i.width/2,y:a-i.width/2}},i.mousedown=function(t){document.dragging||($(document).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),document.dragging=!0);var e=i.widgetCoords(t);return i.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>i.square,i.mousemove(t),!1},i.mousemove=function(t){var e=i.widgetCoords(t);if(i.circleDrag){var a=Math.atan2(e.x,-e.y)/6.28;0>a&&(a+=1),i.setHSL([a,i.hsl[1],i.hsl[2]])}else{var n=Math.max(0,Math.min(1,-(e.x/i.square)+.5)),r=Math.max(0,Math.min(1,-(e.y/i.square)+.5));i.setHSL([i.hsl[0],n,r])}return!1},i.mouseup=function(){$(document).unbind("mousemove",i.mousemove),$(document).unbind("mouseup",i.mouseup),document.dragging=!1},i.updateDisplay=function(){var e=6.28*i.hsl[0];$(".h-marker",a).css({left:Math.round(Math.sin(e)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(e)*i.radius+i.width/2)+"px"}),$(".sl-marker",a).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),$(".color",a).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),"object"==typeof i.callback?($(i.callback).css({backgroundColor:i.color,color:i.hsl[2]>.5?"#000":"#fff"}),$(i.callback).each(function(){this.value&&this.value!=i.color&&(this.value=i.color)})):"function"==typeof i.callback&&i.callback.call(i,i.color),t.trigger("colorchange.farbtastic",[i.color])},i.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var a=i.absolutePosition(t.offsetParent);e.x+=a.x,e.y+=a.y}return e},i.pack=function(t){var e=Math.round(255*t[0]),i=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(16>e?"0":"")+e.toString(16)+(16>i?"0":"")+i.toString(16)+(16>a?"0":"")+a.toString(16)},i.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},i.HSLToRGB=function(t){var e,i,a=t[0],n=t[1],r=t[2];return i=.5>=r?r*(n+1):r+n-r*n,e=2*r-i,[this.hueToRGB(e,i,a+.33333),this.hueToRGB(e,i,a),this.hueToRGB(e,i,a-.33333)]},i.hueToRGB=function(t,e,i){return i=0>i?i+1:i>1?i-1:i,1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(.66666-i)*6:t},i.RGBToHSL=function(t){var e,i,a,n,r,o,s=t[0],c=t[1],l=t[2];return e=Math.min(s,Math.min(c,l)),i=Math.max(s,Math.max(c,l)),a=i-e,o=(e+i)/2,r=0,o>0&&1>o&&(r=a/(.5>o?2*o:2-2*o)),n=0,a>0&&(i==s&&i!=c&&(n+=(c-l)/a),i==c&&i!=l&&(n+=2+(l-s)/a),i==l&&i!=s&&(n+=4+(s-c)/a),n/=6),[n,r,o]},$("*",a).mousedown(i.mousedown),i.setColor("#123456"),e&&i.linkTo(e)},define("taoQtiItem/qtiCreator/editor/styleEditor/farbtastic/farbtastic",function(){}),define("taoQtiItem/qtiCreator/editor/styleEditor/colorSelector",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","taoQtiItem/qtiCreator/editor/styleEditor/farbtastic/farbtastic"],function(t,e,i){"use strict";function a(t){if(!_.isString(t))return t;var e=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i.exec(t);return _.isArray(e)&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t}var n=function(){var n,r=t("#item-editor-color-picker"),o=r.find(".color-picker"),s=r.find("#color-picker-container"),c=r.find("#color-picker-title"),l=r.find("#color-picker-input"),d=r.find(".reset-button"),h=r.find(".color-trigger"),p=r.find("label"),u="color",m=t(document),f=function(t,e){c.text(e.parent().find("label").text())},g=function(){h.each(function(){var n,r=t(this),o=r.data("target"),s=t(o),c=e.getStyle()||{};c[o]&&c[o][r.data("value")]?(n=c[o][r.data("value")],r.css("background-color",n),r.attr("title",a(n))):s.css(r.data("value"))?(n=s.css(r.data("value")),r.css("background-color",n),r.attr("title",a(n))):(r.css("background-color",""),r.attr("title",i("No value set")))})};n=t.farbtastic(o).linkTo(l),o.on("colorchange.farbtastic",function(t,i){e.apply(o.prop("target"),u,i),g()}),g(),h.add(p).on("click",function(){{var e=t(this),i="label"===this.nodeName.toLowerCase()?e.parent().find(".color-trigger"):e;i.css("background-color")}o.prop("target",i.data("target")),s.hide(),u=i.data("value"),f(u,i),n.setColor(a(i.css("background-color"))),s.show()}),m.on("mouseup",function(e){return t(e.target).hasClass("closer")?(s.hide(),!1):s.is(e.target)||0!==s.has(e.target).length?void 0:(s.hide(),!1)}),m.on("keyup",function(t){return 27===t.keyCode?(s.hide(),!1):void 0}),d.on("click",function(){var i=t(this),a=i.parent().find(".color-trigger"),n=a.data("target"),r=a.data("value");e.apply(n,r),g()}),m.on("customcssloaded.styleeditor",g)};return n}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor"],function(t,e){"use strict";var i=function(){var i=t("#item-editor-font-size-changer"),a=i.data("target"),n=a+" .item-title",r=a+" .qti-itemBody",o=parseInt(t(n).css("font-size"),10),s=parseInt(t(r).css("font-size"),10),c=o-s,l=i.parents(".reset-group").find('[data-role="font-size-reset"]'),d=t("#item-editor-font-size-text"),h=function(){var t=s+c;e.apply(n,"font-size",t.toString()+"px"),e.apply(r,"font-size",s.toString()+"px")};i.find("a").on("click",function(e){if(e.preventDefault(),"reduce"===t(this).data("action")){if(10>=s)return;s--}else s++;h(),d.val(s),t(this).parent().blur()}),d.on("keydown",function(t){var e=t.keyCode;return _.contains([8,37,39,46],e)||e>=48&&57>=e||e>=96&&105>=e}),d.on("blur",function(){s=parseInt(this.value,10),h()}),d.on("keydown",function(t){var e=t.keyCode;13===e&&d.trigger("blur")}),l.on("click",function(){d.val(""),e.apply(n,"font-size"),e.apply(r,"font-size")}),t(document).on("customcssloaded.styleeditor",function(e,i){i[r]&&i[r]["font-size"]?(d.val(parseInt(i[r]["font-size"],10)),d.trigger("blur")):d.val(parseInt(t(r).css("font-size"),10))})};return i}),function(t){function e(t){throw new RangeError("noUiSlider: "+t)}function i(t,i,a){(t[i]||t[a])&&t[i]===t[a]&&e("(Link) '"+i+"' can't match '"+a+"'.'")}function a(t){return Math.max(Math.min(t,100),0)}function n(t,e){return Math.round(t/e)*e}function r(t,e){return 100/(e-t)}function o(t,e){return typeof t==typeof e}function s(e){return e instanceof t||t.zepto&&t.zepto.isZ(e)}function c(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)}function l(e){return t.isArray(e)?e:[e]}function d(t,e,i){t.addClass(e),setTimeout(function(){t.removeClass(e)},i)}function h(t,e){return 100*e/(t[1]-t[0])}function p(t,e){return h(t,t[0]<0?e+Math.abs(t[0]):e-t[0])}function u(t,e){return e*(t[1]-t[0])/100+t[0]}function m(t,e){if(e>=t.xVal.slice(-1)[0])return 100;for(var i,a,n,o,s=1;e>=t.xVal[s];)s++;return i=t.xVal[s-1],a=t.xVal[s],n=t.xPct[s-1],o=t.xPct[s],n+p([i,a],e)/r(n,o)}function f(t,e){if(e>=100)return t.xVal.slice(-1)[0];for(var i,a,n,o,s=1;e>=t.xPct[s];)s++;return i=t.xVal[s-1],a=t.xVal[s],n=t.xPct[s-1],o=t.xPct[s],u([i,a],(e-n)*r(n,o))}function g(t,e){for(var i,a,r=1;e>=t.xPct[r];)r++;return t.snap?(i=t.xPct[r-1],a=t.xPct[r],e-i>(a-i)/2?a:i):t.xSteps[r-1]?t.xPct[r-1]+n(e-t.xPct[r-1],t.xSteps[r-1]):e}function v(t){t.preventDefault();var e,i,a=0===t.type.indexOf("touch"),n=0===t.type.indexOf("mouse"),r=0===t.type.indexOf("pointer"),o=t;return 0===t.type.indexOf("MSPointer")&&(r=!0),t.originalEvent&&(t=t.originalEvent),a&&(e=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY),(n||r)&&(r||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),e=t.clientX+window.pageXOffset,i=t.clientY+window.pageYOffset),o.points=[e,i],o.cursor=n,o}function b(a){void 0===a&&(a={}),"object"!=typeof a&&e("(Format) 'format' option must be an object.");var n={};t(U).each(function(t,i){void 0===a[i]?n[i]=N[t]:o(a[i],N[t])?("decimals"===i&&(a[i]<0||a[i]>7)&&e("(Format) 'format.decimals' option must be between 0 and 7."),n[i]=a[i]):e("(Format) 'format."+i+"' must be a "+typeof N[t]+".")}),i(n,"mark","thousand"),i(n,"prefix","negative"),i(n,"prefix","negativeBefore"),this.settings=n}function I(e,i){if(!(this instanceof I))throw new Error("Link: Don't use Link as a function. Use the 'new' keyword.");if(!e)throw new RangeError("Link: missing parameters.");this.formatting=e.format||{},this.update=!i;var a=this,n=e.target||function(){},r=e.method,o="string"==typeof n&&0===n.indexOf("-tooltip-"),c="string"==typeof n&&0!==n.indexOf("-"),l="function"==typeof n,d=s(n),h=d&&n.is("input, select, textarea"),p=d&&"function"==typeof r,u=d&&"string"==typeof r&&n[r];if(o)return this.method=r||"html",void(this.el=t(n.replace("-tooltip-","")||"<div/>")[0]);if(c)return this.method="val",this.el=document.createElement("input"),this.el.name=n,void(this.el.type="hidden");if(l)return this.target=!1,void(this.method=n);if(d){if(r&&(p||u))return this.target=n,void(this.method=r);if(!r&&h)return this.method="val",this.target=n,void this.target.on("change",function(e){function i(t,e,i){return[i?t:e,i?e:t]}var n=i(null,t(e.target).val(),a.N);a.obj.val(n,{link:a})});if(!r&&!h)return this.method="html",void(this.target=n)}throw new RangeError("Link: Invalid Link.")}function C(t,i){c(i)||e("'step' is not numeric."),t.xSteps[0]=i}function y(i,a){("object"!=typeof a||t.isArray(a))&&e("'range' is not an object."),t.each(a,function(a,n){var r;"number"==typeof n&&(n=[n]),t.isArray(n)||e("'range' contains invalid value."),r="min"===a?0:"max"===a?100:parseFloat(a),c(r)&&c(n[0])||e("'range' value isn't numeric."),i.xPct.push(r),i.xVal.push(n[0]),r?i.xSteps.push(isNaN(n[1])?!1:n[1]):isNaN(n[1])||(i.xSteps[0]=n[1])}),t.each(i.xSteps,function(t,e){return e?void(i.xSteps[t]=h([i.xVal[t],i.xVal[t+1]],e)/r(i.xPct[t],i.xPct[t+1])):!0})}function w(i,a){"number"==typeof a&&(a=[a]),(!t.isArray(a)||!a.length||a.length>2)&&e("'start' option is incorrect."),i.handles=a.length,i.start=a}function q(t,i){t.snap=i,"boolean"!=typeof i&&e("'snap' option must be a boolean.")}function x(t,i){"lower"===i&&1===t.handles?t.connect=1:"upper"===i&&1===t.handles?t.connect=2:i===!0&&2===t.handles?t.connect=3:i===!1?t.connect=0:e("'connect' option was doesn't match handle count.")}function _(t,i){switch(i){case"horizontal":t.ort=0;break;case"vertical":t.ort=1;break;default:e("'orientation' option is invalid.")}}function Q(t,i){t.xPct.length>2&&e("'margin' option is only supported on linear sliders."),t.margin=h(t.xVal,i),c(i)||e("'margin' option must be numeric.")}function k(t,i){switch(i){case"ltr":t.dir=0;break;case"rtl":t.dir=1,t.connect=[0,2,1,3][t.connect];break;default:e("'direction' option was not recognized.")}}function R(t,i){"string"!=typeof i&&e("'behaviour' must be a string containing options.");var a=i.indexOf("tap")>=0,n=i.indexOf("extend")>=0,r=i.indexOf("drag")>=0,o=i.indexOf("fixed")>=0,s=i.indexOf("snap")>=0;t.events={tap:a||s,extend:n,drag:r,fixed:o,snap:s}}function E(i,a,n){i.ser=[a.lower,a.upper],i.formatting=new b(a.format),t.each(i.ser,function(i,r){t.isArray(r)||e("'serialization."+(i?"upper":"lower")+"' must be an array."),t.each(r,function(){this instanceof I||e("'serialization."+(i?"upper":"lower")+"' can only contain Link instances."),this.N=i,this.obj=n,this.scope=this.scope||n,this.formatting=new b(t.extend({},a.format,this.formatting))})}),i.dir&&i.handles>1&&i.ser.reverse()}function S(i,a){var n,r={xPct:[],xVal:[],xSteps:[!1],margin:0};return n={step:{r:!1,t:C},range:{r:!0,t:y},start:{r:!0,t:w},snap:{r:!1,t:q},connect:{r:!0,t:x},orientation:{r:!1,t:_},margin:{r:!1,t:Q},direction:{r:!0,t:k},behaviour:{r:!0,t:R},serialization:{r:!0,t:E}},i=t.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},i),i.serialization=t.extend({lower:[],upper:[],format:{}},i.serialization),t.each(n,function(t,n){if(void 0===i[t]){if(!n.r)return!0;e("'"+t+"' is required.")}n.t(r,i[t],a)}),r.style=r.ort?"top":"left",r}function M(e,i){var a=t("<div><div/></div>").addClass(W[2]),n=["-lower","-upper"];return e.dir&&n.reverse(),a.children().addClass(W[3]+" "+W[3]+n[i]),a}function A(e,i){return i.el&&(i=new I({target:t(i.el).clone().appendTo(e),method:i.method,format:i.formatting},!0)),i}function T(t,e,i){var a,n=[];for(n.push(new I({format:i},!0)),a=0;a<t.length;a++)n.push(A(e,t[a]));return n}function P(t,e){var i,a=[];for(i=0;i<t.handles;i++)a[i]=T(t.ser[i],e[i].children(),t.formatting);return a}function $(t,e,i){switch(t){case 1:e.addClass(W[7]),i[0].addClass(W[6]);break;case 3:i[1].addClass(W[6]);case 2:i[0].addClass(W[7]);case 0:e.addClass(W[6])}}function O(t,e){var i,a=[];for(i=0;i<t.handles;i++)a.push(M(t,i).appendTo(e));return a}function B(e,i){return i.addClass([W[0],W[8+e.dir],W[4+e.ort]].join(" ")),t("<div/>").appendTo(i).addClass(W[1])}function F(e,i,n){function r(){return y[["width","height"][i.ort]]()}function o(t){var e,i=[x.val()];for(e=0;e<t.length;e++)x.trigger(t[e],i)}function s(e,n,r){var o=e[0]!==q[0][0]?1:0,s=_[0]+i.margin,c=_[1]-i.margin;return r&&q.length>1&&(n=o?Math.max(n,s):Math.min(n,c)),100>n&&(n=g(i,n)),n=a(parseFloat(n.toFixed(7))),n===_[o]?1===q.length?!1:n===s||n===c?0:!1:(e.css(i.style,n+"%"),e.is(":first-child")&&e.toggleClass(W[17],n>50),_[o]=n,i.dir&&(n=100-n),t(w[o]).each(function(){this.write(i,n,e.children(),x)}),!0)}function c(t,e,i){var n=t+e[0],r=t+e[1];return i?(0>n&&(r+=Math.abs(n)),r>100&&(n-=r-100),[a(n),a(r)]):[n,r]}function l(t,e,i){i||d(x,W[14],300),s(t,e,!1),o(["slide","set","change"])}function h(t,e,a,n){return t=t.replace(/\s/g,L+" ")+L,e.on(t,function(t){var e=x.attr("disabled");return e=!(void 0===e||null===e),x.hasClass(W[14])||e?!1:(t=v(t),t.calcPoint=t.points[i.ort],void a(t,n))})}function p(t,e){var i,a=e.handles||q,n=!1,l=100*(t.calcPoint-e.start)/r(),d=a[0][0]!==q[0][0]?1:0;i=c(l,e.positions,a.length>1),n=s(a[0],i[d],1===a.length),a.length>1&&(n=s(a[1],i[d?0:1],!1)||n),n&&o(["slide"])}function u(e){t("."+W[15]).removeClass(W[15]),e.cursor&&t("body").css("cursor","").off(L),z.off(L),x.removeClass(W[12]),o(["set","change"])}function f(e,i){1===i.handles.length&&i.handles[0].children().addClass(W[15]),e.stopPropagation(),h(G.move,z,p,{start:e.calcPoint,handles:i.handles,positions:[_[0],_[q.length-1]]}),h(G.end,z,u,null),e.cursor&&(t("body").css("cursor",t(e.target).css("cursor")),q.length>1&&x.addClass(W[12]),t("body").on("selectstart"+L,!1))}function b(e){var a,n=e.calcPoint,o=0;e.stopPropagation(),t.each(q,function(){o+=this.offset()[i.style]}),o=o/2>n||1===q.length?0:1,n-=y.offset()[i.style],a=100*n/r(),l(q[o],a,i.events.snap),i.events.snap&&f(e,{handles:[q[o]]})}function I(t){var e=t.calcPoint<y.offset()[i.style],a=e?0:100;e=e?0:q.length-1,l(q[e],a,!1)}function C(t){var e,i;if(!t.fixed)for(e=0;e<q.length;e++)h(G.start,q[e].children(),f,{handles:[q[e]]});t.tap&&h(G.start,y,b,{handles:q}),t.extend&&(x.addClass(W[16]),t.tap&&h(G.start,x,I,{handles:q})),t.drag&&(i=y.find("."+W[7]).addClass(W[10]),t.fixed&&(i=i.add(y.children().not(i).children())),h(G.start,i,f,{handles:q}))}var y,w,q,x=t(e),_=[-1,-1];if(!x.is(":empty"))throw new Error("Slider was already initialized.");y=B(i,x),q=O(i,y),w=P(i,q),$(i.connect,x,q),C(i.events),e.vSet=function(e,a,n,r,c){var l,h;for(i.dir&&i.handles>1&&e.reverse(),c&&d(x,W[14],300),l=0;l<(q.length>1?3:1);l++)h=n||w[l%2][0],h=h.valueOf(e[l%2]),h!==!1&&(h=m(i,h),i.dir&&(h=100-h),s(q[l%2],h,!0)!==!0&&t(w[l%2]).each(function(){this.write(i,_[l%2],q[l%2].children(),x,r)}));return a===!0&&o(["set"]),this},e.vGet=function(){var t,e=[];for(t=0;t<i.handles;t++)e[t]=w[t][0].saved;return 1===e.length?e[0]:i.dir&&i.handles>1?e.reverse():e},e.destroy=function(){return t.each(w,function(){t.each(this,function(){this.target&&this.target.off(L)})}),t(this).off(L).removeClass(W.join(" ")).empty(),n},x.val(i.start)}function D(t){if(this.length){var e=S(t,this);return this.each(function(){F(this,e,t)})}}function j(e){return this.each(function(){var i=t(this).val(),a=this.destroy(),n=t.extend({},a,e);t(this).noUiSlider(n),a.start===n.start&&t(this).val(i)})}var z=t(document),L=".nui",H=t.fn.val,G=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},W=["noUi-target","noUi-base","noUi-origin","noUi-handle","noUi-horizontal","noUi-vertical","noUi-background","noUi-connect","noUi-ltr","noUi-rtl","noUi-dragable","","noUi-state-drag","","noUi-state-tap","noUi-active","noUi-extended","noUi-stacking"],U=["decimals","mark","thousand","prefix","postfix","encoder","decoder","negative","negativeBefore"],N=[2,".","","","",function(t){return t},function(t){return t},"-",""];b.prototype.v=function(t){return this.settings[t]},b.prototype.to=function(t){function e(t){return t.split("").reverse().join("")}t=this.v("encoder")(t);var i="",a="",n="",r="";return 0>t&&(i=this.v("negative"),a=this.v("negativeBefore")),t=Math.abs(t).toFixed(this.v("decimals")).toString(),t=t.split("."),0===parseFloat(t)&&(t[0]="0"),this.v("thousand")?(n=e(t[0]).match(/.{1,3}/g),n=e(n.join(e(this.v("thousand"))))):n=t[0],this.v("mark")&&t.length>1&&(r=this.v("mark")+t[1]),a+this.v("prefix")+i+n+r+this.v("postfix")},b.prototype.from=function(t){function e(t){return t.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}var i;return null===t||void 0===t?!1:(t=t.toString(),i=t.replace(new RegExp("^"+e(this.v("negativeBefore"))),""),t!==i?(t=i,i="-"):i="",t=t.replace(new RegExp("^"+e(this.v("prefix"))),""),this.v.negative&&(i="",t=t.replace(new RegExp("^"+e(this.v("negative"))),"-")),t=t.replace(new RegExp(e(this.v("postfix"))+"$"),"").replace(new RegExp(e(this.v("thousand")),"g"),"").replace(this.v("mark"),"."),t=this.v("decoder")(parseFloat(i+t)),isNaN(t)?!1:t)},I.prototype.write=function(t,e,i,a,n){this.update&&n===!1||(e=f(t,e),e=this.format(e),this.saved=e,"function"==typeof this.method?this.method.call(this.target[0]||a[0],e,i,a):this.target[this.method](e,i,a))},I.prototype.format=function(t){return this.formatting.to(t)},I.prototype.valueOf=function(t){return this.formatting.from(t)},t.noUiSlider={Link:I},t.fn.noUiSlider=function(t,e){return(e?j:D).call(this,t)},t.fn.val=function(){var e,i,a,n,r=Array.prototype.slice.call(arguments,0);return r.length?("object"==typeof r[1]?(e=r[1].set,i=r[1].link,a=r[1].update,n=r[1].animate):r[1]===!0&&(e=!0),this.each(function(){t(this).hasClass(W[0])?this.vSet(l(r[0]),e,i,a,n):H.apply(t(this),r)})):this.hasClass(W[0])?this[0].vGet():H.apply(this)}}(window.jQuery||window.Zepto),define("nouislider",function(){}),define("taoQtiItem/qtiCreator/editor/styleEditor/itemResizer",["jquery","lodash","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","nouislider","jqueryui"],function(t,e,i){var a=function(a){var n=t("#item-editor-item-resizer"),r=n.data("target"),o=t(r),s=o.width(),c=n.find('[name="item-width-prompt"]'),l=n.find(".slider-box"),d=n.find("#item-editor-item-resizer-slider"),h=t("#item-editor-item-resizer-text"),p=n.find('[data-role="item-width-reset"]'),u={range:{min:Math.min(768,s),max:Math.max(1200,s)},start:s},m=function(){n.find('[value="no-slider"]').trigger("click")},f=function(t){t=parseInt(t).toString()+"px",i.apply(r,"width",t),i.apply(r,"max-width","none"),a.data("widget").$container.trigger("resize.itemResizer")};c.on("click",function(){"slider"===this.value?(f(o.width()),h.val(o.width()),l.slideDown(),d.val(o.width()).trigger("slide"),a.data("responsive",!1)):(d.val(u.start),l.slideUp(),h.val(""),i.apply(r,"width"),i.apply(r,"max-width"),a.data("responsive",!0))}),d.noUiSlider(u),d.on("slide",function(){var t=Math.round(d.val());h.val(t),f(t)}),h.on("keydown",function(t){var i=t.keyCode;return e.contains([8,37,39,46],i)||i>=48&&57>=i||i>=96&&105>=i}),h.on("blur",function(){f(this.value)}),p.on("click",m),t(document).on("customcssloaded.styleeditor",function(t,e){var i;e[r]&&e[r].width?(i=parseInt(e[r].width,10),h.val(i),d.val(i),n.find('[value="slider"]').trigger("click")):h.val(o.width())})};return a}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<div class="feedback-',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+' popup">\n    <span class="icon-',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'"></span>\n    ',(o=i.message)?r=o.call(e,{hash:{},data:n}):(o=e&&e.message,r=typeof o===l?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(c+=r),c+='\n    <span title="'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Remove Message",s):h.call(e,"__","Remove Message",s)))+'" class="icon-close close-trigger"></span>\n</div>'})}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","helpers","lodash","taoQtiItem/qtiCreator/model/Stylesheet","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","ui/resourcemgr"],function(t,e,i,a,n,r,o){"use strict";var s=t(document),c=function(){var n=function(n){var o=t("#style-sheet-toggler"),l=t("#stylesheet-uploader"),d=t("[data-custom-css]"),h=function(e){e=t(e);var i=e.closest("li"),a=i.data("stylesheetObj")||new r({href:i.data("css-res")}),n=i.find(".style-sheet-label-editor"),o=n.prev(".file-label"),s=n.val();return{li:i,input:n,label:s,labelBox:o,isCustomCss:!!i.data("custom-css"),isDisabled:i.find(".icon-preview").hasClass("disabled"),stylesheetObj:a,cssUri:a.attr("href")}};l.on("click",function(){l.resourcemgr({appendContainer:"#mediaManager",root:"/",browseUrl:a._url("files","ItemContent","taoItems"),uploadUrl:a._url("upload","ItemContent","taoItems"),deleteUrl:a._url("delete","ItemContent","taoItems"),downloadUrl:a._url("download","ItemContent","taoItems"),params:{uri:n.uri,lang:n.lang,filters:"text/css"},pathParam:"path",select:function(t,i){var a,n=i.length;for(a=0;n>a;a++)e.addStylesheet(i[a].file)}})});var p=function(a){var n=h(a),r=n.isDisabled?"disabled-href":"href",o=t("head link");e.getItem().removeStyleSheet(n.stylesheetObj),o.filter("["+r+'*="'+n.cssUri+'"]').remove(),n.li.remove(),t(".feedback-info").hide(),c({message:i("Style Sheet <b>%s</b> removed<br> Click <i>Add Style Sheet</i> to re-apply.").replace("%s",n.label),type:"info"}),s.trigger("customcssloaded.styleeditor",[e.getStyle()])},u=function(t){var e=h(t);e.labelBox.hide(),e.input.show()},m=function(t){e.download(h(t).cssUri)},f=function(e){var i=h(e),a=t.trim(i.input.val());return a?(i.stylesheetObj.attr("title",a),i.input.hide(),void i.labelBox.html(a).show()):(i.stylesheetObj.attr("title",""),!1)},g=function(i){var a,n=h(i),r="disabled-href",o="href";n.isCustomCss?n.isDisabled?(e.create(),d.removeClass("not-available")):(e.erase(),d.addClass("not-available")):(n.isDisabled&&(r="href",o="disabled-href"),a=t("link["+o+'$="'+n.cssUri+'"]'),a.attr(r,a.attr(o)).removeAttr(o)),t(i).toggleClass("disabled")};o.on("click",function(t){var e=t.target,i=e.className;i.indexOf("icon-bin")>-1?p(t.target):i.indexOf("file-label")>-1?u(t.target):i.indexOf("icon-preview")>-1?g(t.target):i.indexOf("icon-download")>-1&&m(t.target)}),o.on("keydown","input",function(e){13===e.keyCode&&t(e.target).trigger("blur")}),o.on("blur","input",function(t){f(t.target)})},c=function(e){var i=t(o(e)),a=i.find(".close-trigger");return t("body").append(i),a.on("click",function(){i.fadeOut(function(){t(this).remove()})}),setTimeout(function(){a.trigger("click")},4523),i};return{init:n}}();return c}),define("taoQtiItem/controller/creator/main",["jquery","lodash","taoQtiItem/qtiCreator/editor/preview","taoQtiItem/qtiCreator/editor/preparePrint","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/helper/itemLoader","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/editor/styleEditor/fontSelector","taoQtiItem/qtiCreator/editor/styleEditor/colorSelector","taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger","taoQtiItem/qtiCreator/editor/styleEditor/itemResizer","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,a,n,r,o,s,c,l,d,h,p,u,m){var f=t("#ajax-loading"),g=f.css("left"),v=function(e,n,r){p.init(n.element,r),u.init(r),c(),l(),d(),h(n.element),i.init(t(".preview-trigger"),e,n),a(),m.initGui(n)};return{start:function(i){var a=t("#tabs"),c=t("ul.ui-tabs-nav > li",a),l=a.tabs("option","selected");f.css("left","-10000px"),r.loadItem({uri:i.uri},function(r){var d=t("#item-editor-scroll-inner");s.setOption("baseUrl",i.baseUrl),s.setContext(d),o.setOptions(i),o.get().load(function(){var o;r.setRenderer(this),d.append(r.render()),o=r.postRender(e.clone(i)),v(r,o,i),n.initFormVisibilityListener(),n.toggleInlineInteractionGroup(),a.off("tabsselect.qti-creator").on("tabsselect.qti-creator",function(){var e=c.index(t(this).parents("li"));e!==l&&(t(window).off(".qti-widget"),t(document).off(".qti-widget"),t(document).off(".qti-creator"),a.off("tabsselect.qti-creator"),f.css("left",g))})},r.getUsedClasses())})}}}),define("taoQtiItem/qtiItem/core/Img",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a){var n=t.extend({qtiClass:"img",render:function(){var t=i.getOptionsFromArguments(arguments),n=t.renderer||this.getRenderer(),r=n.getOption("baseUrl")||"",o=this.attr("src")||"",s={attributes:{src:a.fullpath(o,r)}};return this._super(e.merge(s,t.data),t.placeholder,t.subclass,n)},isEmpty:function(){return!this.attr("src")}});return n}),define("taoQtiItem/qtiItem/core/Math",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var a=function(t,e){var i=new RegExp("<(/)?"+(e?e+":":"")+"math[^>]*>","g");return t.replace(i,"").replace(/^\s*[\r\n]/gm,"").replace(/\s*[\r\n]$/gm,"")},n=function(t,e){var i=new RegExp("<(/)?"+(e?e+":":""),"g");return t.replace(i,"<$1")},r=e.extend({qtiClass:"math",defaultNsName:"m",defaultNsUri:"http://www.w3.org/1998/Math/MathML",init:function(t,e){this._super(t,e),this.ns=null,this.mathML="",this.annotations={}},getNamespace:function(){if(this.ns&&this.ns.name&&this.ns.uri)return t.clone(this.ns);var e=this.getRelatedItem();if(e){var i=e.getNamespaces();for(ns in i)if(i[ns].indexOf("MathML")>0)return{name:ns,uri:i[ns]};return e.namespaces[this.defaultNsName]=this.defaultNsUri,{name:this.defaultNsName,uri:this.defaultNsUri}}return{}},setNamespace:function(t,e){this.ns={name:t,uri:e}},setAnnotation:function(t,e){this.annotations[t]=e},getAnnotation:function(t){return this.annotations[t]},removeAnnotation:function(t){delete this.annotations[t]},setMathML:function(t){var e=this.getNamespace(),i=e.name&&e.uri?e.name:"";t=a(t,i),e&&(t=n(t,i)),this.mathML=t},getMathML:function(){return this.mathML},render:function(){var e=i.getOptionsFromArguments(arguments),a=e.renderer||this.getRenderer(),n=this.qtiClass,r=this.mathML,o=r,s=this.getNamespace(),c="";for(var l in this.annotations)c+='<annotation encoding="'+l+'">'+this.annotations[l]+"</annotation>";c&&(r=r.indexOf("</semantics>")>0?r.replace("</semantics>",c+"</semantics>"):"<semantics>"+r+c+"</semantics>"),s&&s.name&&(o=r.replace(/<(\/)?([^!])/g,"<$1"+s.name+":$2"),n=s.name+":"+n);var d={block:"block"===this.attr("display")?!0:!1,body:o,raw:r,tag:n,ns:s};return this._super(t.merge(d,e.data),e.placeholder,e.subclass,a)},isEmpty:function(){return o(this.mathML)&&(!this.annotations.latex||!this.annotations.latex.trim())}}),o=function(t){var e=!1;if(t&&t.trim()){var i=$(t);e=!!i.text()}return!e};return r}),define("taoQtiItem/qtiItem/core/Object",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a){var n=t.extend({qtiClass:"object",getMediaType:function(){var t="undefined",e=this.attr("type");return e&&(t=0===e.indexOf("video")?"video":0===e.indexOf("audio")?"audio":0===e.indexOf("image")?"image":0===e.indexOf("text/html")?"html":"object"),t},render:function(){var t=i.getOptionsFromArguments(arguments),n=t.renderer||this.getRenderer(),r={},o=n.getOption("baseUrl")||"",s=this.attr("data")||"";switch(this.getMediaType()){case"video":r.video=!0;break;case"audio":r.audio=!0;break;case"html":r.html=!0;break;case"image":default:r.object=!0}return r.attributes={data:a.fullpath(s,o)},r.body=this._alt,this._super(e.merge(r,t.data),t.placeholder,t.subclass,n)},isEmpty:function(){return!this.attr("data")}});return n}),define("taoQtiItem/qtiItem/core/RubricBlock",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({qtiClass:"rubricBlock"});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/choices/Choice",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(t){var e=t.extend({init:function(t,e){this._super(t,e)
},is:function(t){return"choice"===t||this._super(t)},getInteraction:function(){var t,e=null,i=this.getRelatedItem();return i&&(t=i.find(this.serial),t&&(e=t.parent)),e}});return e}),define("taoQtiItem/qtiItem/core/choices/Hotspot",["taoQtiItem/qtiItem/core/choices/Choice"],function(t){var e=t.extend({});return e}),define("taoQtiItem/qtiItem/core/choices/AssociableHotspot",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(t){var e=t.extend({qtiClass:"associableHotspot"});return e}),define("taoQtiItem/qtiItem/core/choices/ContainerChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({init:function(t,e){this._super(t,e)},is:function(t){return"containerChoice"===t||this._super(t)}});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/choices/Gap",["taoQtiItem/qtiItem/core/choices/Choice"],function(t){var e=t.extend({qtiClass:"gap"});return e}),define("taoQtiItem/qtiItem/core/choices/GapImg",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/core/Object"],function(t,e){var i=t.extend({qtiClass:"gapImg",initObject:function(t){this.object=t||new e},getObject:function(){return this.object}});return i}),define("taoQtiItem/qtiItem/core/choices/TextVariableChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e){var i=t.extend({init:function(t,e,i){this._super(t,e),this.val(i||"")},is:function(t){return"textVariableChoice"===t||this._super(t)},val:function(t){if("undefined"==typeof t)return this.text;if("string"!=typeof t)throw"text must be a string";return this.text=t,$(document).trigger("choiceTextChange",{choice:this,text:t}),this},render:function(){var t=e.getOptionsFromArguments(arguments),i=t.renderer||this.getRenderer(),a={body:this.text};return this._super(_.merge(a,t.data),t.placeholder,t.subclass,i)}});return i}),define("taoQtiItem/qtiItem/core/choices/GapText",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(t){var e=t.extend({qtiClass:"gapText"});return e}),define("taoQtiItem/qtiItem/core/choices/HotspotChoice",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(t){var e=t.extend({qtiClass:"hotspotChoice"});return e}),define("taoQtiItem/qtiItem/mixin/ContainerInline",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(t,e,i){var a={};return i.extend(a,e.methods),i.extend(a,{initContainer:function(t){e.methods.initContainer.call(this,t),this.bdy.contentModel="inlineStatic"}}),{augment:function(e){t.augment(e,a)},methods:a}}),define("taoQtiItem/qtiItem/core/choices/Hottext",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/ContainerInline"],function(t,e){var i=t.extend({qtiClass:"hottext"});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/choices/InlineChoice",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(t){var e=t.extend({qtiClass:"inlineChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(t){var e=t.extend({qtiClass:"simpleAssociableChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/SimpleChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(t){var e=t.extend({qtiClass:"simpleChoice"});return e}),define("taoQtiItem/qtiItem/core/choices/TextEntry",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(t){var e=t.extend({qtiClass:"textEntry"});return e}),define("taoQtiItem/qtiItem/core/feedbacks/Feedback",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(t){var e=t.extend({is:function(t){return"feedback"===t||this._super(t)}});return e}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(t){var e=t.extend({});return e}),define("taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",["taoQtiItem/qtiItem/core/feedbacks/Feedback"],function(t){var e=t.extend({});return e}),define("taoQtiItem/qtiItem/core/interactions/Interaction",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a){var n=t.extend({init:function(t,e){this._super(t,e),this.choices={}},is:function(t){return"interaction"===t||this._super(t)},addChoice:function(t){return t.setRelatedItem(this.getRelatedItem()||null),this.choices[t.getSerial()]=t,this},getChoices:function(){var t={};for(var e in this.choices)t[e]=this.choices[e];return t},getChoice:function(t){var e=null;return this.choices[t]&&(e=this.choices[t]),e},getChoiceByIdentifier:function(t){for(var e in this.choices)if(this.choices[e].id()===t)return this.choices[e];return null},getComposingElements:function(){var i=this._super();for(var a in this.choices)t.isA(this.choices[a],"choice")&&(i[a]=this.choices[a],i=e.extend(i,this.choices[a].getComposingElements()));return i},find:function(t){var e=this._super(t);return e||(e=a.findInCollection(this,"choices",t)),e},getResponseDeclaration:function(){var t=null,e=this.attr("responseIdentifier");if(e){var i=this.getRelatedItem();if(!i)throw"cannot get response of an interaction out of its item context";t=i.getResponseDeclaration(e)}return t},render:function(){var a=i.getOptionsFromArguments(arguments),n=a.renderer||this.getRenderer(),r={_type:this.qtiClass.replace(/([A-Z])/g,function(t){return"_"+t.toLowerCase()}),choices:[],choiceShuffle:!0};if(!n)throw"no renderer found for the interaction "+this.qtiClass;var o=this.attr("shuffle")&&n.shuffleChoices?n.getShuffledChoices(this):this.getChoices(),s={interaction:{serial:this.serial,attributes:this.attributes}},c=this;e.each(o,function(i){if(t.isA(i,"choice"))try{var a=i.render(e.clone(s,!0),null,i.qtiClass+"."+c.qtiClass,n);r.choices.push(a)}catch(o){}});var l=a.subclass?this.qtiClass+"."+a.subclass:this.qtiClass;return this._super(e.merge(r,a.data),a.placeholder,l,n)},postRender:function(e,i,a){a=a||this.getRenderer();var n=this.getChoices();for(var r in n){var o=n[r];t.isA(o,"choice")&&o.postRender({},o.qtiClass+"."+this.qtiClass,a)}return this._super(e,i,a)},setResponse:function(t){var e=null,i=this.getRenderer();if(!i)throw"no renderer found for the interaction "+this.qtiClass;return e=i.setResponse(this,t)},getResponse:function(){var t=null,e=this.getRenderer();if(!e)throw"no renderer found for the interaction "+this.qtiClass;return t=e.getResponse(this)},resetResponse:function(){var t=null,e=this.getRenderer();if(!e)throw"no renderer found for the interaction "+this.qtiClass;return t=e.resetResponse(this)},toArray:function(){var e=this._super();e.choices={};for(var i in this.choices)t.isA(this.choices[i],"choice")&&(e.choices[i]=this.choices[i].toArray());return e}});return n}),define("taoQtiItem/qtiItem/core/interactions/Prompt",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline"],function(t,e){var i=t.extend({qtiClass:"prompt"});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/interactions/BlockInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/core/interactions/Prompt","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,a){var n=t.extend({init:function(t,i){this._super(t,i),this.prompt=new e("")},is:function(t){return"blockInteraction"===t||this._super(t)},getComposingElements:function(){var t=this._super();return t=i.extend(t,this.prompt.getComposingElements()),t[this.prompt.getSerial()]=this.prompt,t},find:function(t){return this._super(t)||this.prompt.find(t)},render:function(){var t=a.getOptionsFromArguments(arguments),e=t.renderer||this.getRenderer(),n={prompt:this.prompt.render(e)};return this._super(i.merge(n,t.data),t.placeholder,t.subclass,e)},postRender:function(t,e,i){return i=i||this.getRenderer(),this.prompt.postRender({},"",i),this._super(t,e,i)},toArray:function(){var t=this._super();return t.prompt=this.prompt.toArray(),t}});return n}),define("taoQtiItem/qtiItem/core/interactions/AssociateInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"associateInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"choiceInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/ContainerInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/mixin/Container"],function(t,e){var i=t.extend({});return e.augment(i),i}),define("taoQtiItem/qtiItem/core/interactions/CustomInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var a=t.extend({qtiClass:"customInteraction",init:function(t,e){this._super(t,e),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[]},is:function(t){return"customInteraction"===t||this._super(t)},render:function(){var t=i.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),n={markup:this.markup};return this._super(e.merge(n,t.data),t.placeholder,t.subclass,a)},toArray:function(){var t=this._super();return t.markup=this.markup,t.properties=this.properties,t}});return a}),define("taoQtiItem/qtiItem/core/interactions/InlineInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction"],function(t){return t.extend({})}),define("taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(t){return t.extend({qtiClass:"endAttemptInteraction"})}),define("taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var a=t.extend({qtiClass:"extendedTextInteraction",render:function(){var t=i.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),n={multiple:!1,maxStringLoop:[]},r=this.getResponseDeclaration();if(this.attr("maxStrings")&&("multiple"===r.attr("cardinality")||"ordered"===r.attr("cardinality"))){n.multiple=!0;for(var o=0;o<this.attr("maxStrings");o++)n.maxStringLoop.push(o+"")}return this._super(e.merge(n,t.data),t.placeholder,t.subclass,a)}});return a}),define("taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction"],function(t){var e=t.extend({qtiClass:"gapMatchInteraction",getGaps:function(){return this.getBody().getElements("gap")}});return e}),define("taoQtiItem/qtiItem/core/interactions/ObjectInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/Object"],function(t,e){var i=t.extend({initObject:function(t){this.object=t||new e},getObject:function(){return this.object}});return i}),define("taoQtiItem/qtiItem/core/interactions/GraphicInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i){var a=t.extend({render:function(){var t=i.getOptionsFromArguments(arguments),a=t.renderer||this.getRenderer(),n={backgroundImage:this.object.getAttributes(),object:this.object.render(a)};return this._super(e.merge(n,t.data),t.placeholder,t.subclass,a)}});return a}),define("taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"graphicAssociateInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e,i,a){var n=t.extend({qtiClass:"graphicGapMatchInteraction",init:function(t,e){this._super(t,e),this.gapImgs={}},addGapImg:function(t){e.isA(t,"gapImg")&&(t.setRelatedItem(this.getRelatedItem()||null),this.gapImgs[t.getSerial()]=t)},removeGapImg:function(t){var i="";return"string"==typeof t?i=t:e.isA(t,"gapImg")&&(i=t.getSerial()),delete this.gapImgs[i],this},getGapImgs:function(){return i.clone(this.gapImgs)},getGapImg:function(t){return this.gapImgs[t]},getComposingElements:function(){var t=this._super();for(var e in this.gapImgs)t[e]=this.gapImgs[e],t=i.extend(t,this.gapImgs[e].getComposingElements());return t},find:function(t){var e=this._super(t);return e||this.gapImgs[t]&&(e={parent:this,element:this.gapImgs[t]}),e},render:function(){var t=a.getOptionsFromArguments(arguments),n=t.renderer||this.getRenderer(),r={gapImgs:[]},o=this.getGapImgs();for(var s in o)e.isA(o[s],"choice")&&r.gapImgs.push(o[s].render({},null,"",n));return this._super(i.merge(r,t.data),t.placeholder,t.subclass,n)},toArray:function(){var t=this._super();t.gapImgs={};var e=this.getGapImgs();for(var i in e)t.gapImgs[i]=e[i].toArray();return t}});return n}),define("taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"graphicOrderInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/HotspotInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"hotspotInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/HottextInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/core/Element"],function(t,e){var i=t.extend({qtiClass:"hottextInteraction",getChoices:function(){return this.getBody().getElements("hottext")},getChoice:function(t){var i=this.getBody().getElement(t);return e.isA(i,"choice")?i:null}});return i}),define("taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(t){var e=t.extend({qtiClass:"inlineChoiceInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/MatchInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a,n){var r=t.extend({qtiClass:"matchInteraction",init:function(t,e){this._super(t,e),this.choices=[{},{}]},addChoice:function(t,e){e=parseInt(e),this.choices[e]&&(t.setRelatedItem(this.getRelatedItem()||null),this.choices[e][t.getSerial()]=t)},getChoices:function(t){return t=parseInt(t),i.clone(this.choices[t]?this.choices[t]:this.choices)},getChoice:function(t){return this.choices[0][t]||this.choices[1][t]||null},getComposingElements:function(){for(var t=this._super(),a=0;2>a;a++){var n=this.getChoices(a);for(var r in n)n[r]instanceof e&&(t[r]=n[r],t=i.extend(t,n[r].getComposingElements()))}return t},find:function(t){var e=this._super(t);return e||(e=n.findInCollection(this,["choices.0","choices.1"],t)),e},render:function(){var t,n=a.getOptionsFromArguments(arguments),r=n.renderer||this.getRenderer(),o={matchSet1:[],matchSet2:[]},s={interaction:{serial:this.serial,attributes:this.attributes}};if(!r)throw"no renderer found for the interaction "+this.qtiClass;t=this.attr("shuffle")&&r.shuffleChoices?r.getShuffledChoices(this):this.getChoices();for(var c=0;2>c;c++){var l=t[c];for(var d in l)l[d]instanceof e&&o["matchSet"+(c+1)].push(l[d].render(i.clone(s,!0),null,"simpleAssociableChoice.matchInteraction",r))}return this._super(i.merge(o,n.data),n.placeholder,n.subclass,r)},postRender:function(t,a,n){n=n||this.getRenderer();for(var r=this.getChoices(),o=0;2>o;o++)i.forIn(r[o],function(t){t instanceof e&&t.postRender({},"simpleAssociableChoice.matchInteraction",n)});return this._super(t,a,n)},toArray:function(){var t=this._super();t.choices={0:{},1:{}};for(var i=0;2>i;i++){var a=this.getChoices(i);for(var n in a)a[n]instanceof e&&(t.choices[i][n]=a[n].toArray())}return t}});return r}),define("taoQtiItem/qtiItem/core/interactions/MediaInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","taoQtiItem/qtiItem/helper/rendererConfig"],function(t,e){var i=t.extend({qtiClass:"mediaInteraction",render:function(){var t=e.getOptionsFromArguments(arguments),i=t.renderer||this.getRenderer(),a={media:this.object.render({},null,"",i)};return this._super(_.merge(a,t.data),t.placeholder,t.subclass,i)}});return i}),define("taoQtiItem/qtiItem/core/interactions/OrderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"orderInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(t){var e=t.extend({qtiClass:"selectPointInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/SliderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"sliderInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(t){var e=t.extend({qtiClass:"textEntryInteraction"});return e}),define("taoQtiItem/qtiItem/core/interactions/UploadInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(t){var e=t.extend({qtiClass:"uploadInteraction"});return e}),define("taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",["taoQtiItem/qtiItem/core/Element"],function(t){var e=t.extend({qtiClass:"_simpleFeedbackRule",serial:"",relatedItem:null,init:function(e,i,a,n){this._super(e,{}),this.condition="correct",this.comparedOutcome=null,this.comparedValue=0,this.feedbackOutcome=i,this.feedbackThen=t.isA(a,"feedback")?a:null,this.feedbackElse=t.isA(n,"feedback")?a:null},setCondition:function(e,i,a){if(!t.isA(e,"variableDeclaration"))throw"invalid outcome type: must be a variableDeclaration";switch(i){case"correct":case"incorrect":if(!t.isA(e,"responseDeclaration"))throw"invalid outcome type: must be a responseDeclaration";this.comparedOutcome=e,this.condition=i;break;case"lt":case"lte":case"equal":case"gte":case"gt":if(null===a||void 0===a)throw"compared value must not be null";this.comparedOutcome=e,this.condition=i,this.comparedValue=a;break;default:throw"unknown condition type : ".condition}return this},setFeedbackElse:function(e){t.isA(e,"feedback")&&(this.feedbackElse=e)}});return e}),define("taoQtiItem/qtiItem/core/variables/ResponseDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration","lodash"],function(t,e){var i=t.extend({qtiClass:"responseDeclaration",init:function(t,e){this._super(t,e),this.template="",this.mappingAttributes={},this.mapEntries={},this.correctResponse=null,this.feedbackRules={}},getFeedbackRules:function(){return[]},getComposingElements:function(){var t=this._super();return t=e.extend(t,this.getFeedbackRules())},toArray:function(){var t=this._super();return t.howMatch=this.template,t.correctResponses=this.correctResponse,t.mapping=this.mapEntries,t.mappingAttributes=this.mappingAttributes,t}});return i}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/container",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='<div class="qti-block">',(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===d?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="</div>"}function o(t,e){var a,n,r="";return(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===d?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="function",h=this,p=i.helperMissing;return c=i.equal||e&&e.equal,l={hash:{},inverse:h.program(3,o,n),fn:h.program(1,r,n),data:n},s=c?c.call(e,e&&e.contentModel,"blockStatic",l):p.call(e,"equal",e&&e.contentModel,"blockStatic",l),s||0===s?s:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Container",["tpl!taoQtiItem/qtiCommonRenderer/tpl/container"],function(t){return{qtiClass:"_container",template:t,qitCommonR:!0}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/img",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e,i="";return i+='id="'+u((e=t&&t.attributes,e=null==e||e===!1?e:e.id,typeof e===p?e.apply(t):e))+'"'}function o(t){var e,i="";return i+='class="'+u((e=t&&t.attributes,e=null==e||e===!1?e:e["class"],typeof e===p?e.apply(t):e))+'"'}function s(t){var e,i="";return i+='height="'+u((e=t&&t.attributes,e=null==e||e===!1?e:e.height,typeof e===p?e.apply(t):e))+'" '}function c(t){var e,i="";return i+='width="'+u((e=t&&t.attributes,e=null==e||e===!1?e:e.width,typeof e===p?e.apply(t):e))+'" '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,d,h="",p="function",u=this.escapeExpression,m=this;return h+='<img \n    data-serial="',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'" \n    data-qti-class="img" \n    src="'+u((l=e&&e.attributes,l=null==l||l===!1?l:l.src,typeof l===p?l.apply(e):l))+'" \n    alt="'+u((l=e&&e.attributes,l=null==l||l===!1?l:l.alt,typeof l===p?l.apply(e):l))+'" \n    ',l=i["if"].call(e,(l=e&&e.attributes,null==l||l===!1?l:l.id),{hash:{},inverse:m.noop,fn:m.program(1,r,n),data:n}),(l||0===l)&&(h+=l),h+="\n    ",l=i["if"].call(e,(l=e&&e.attributes,null==l||l===!1?l:l["class"]),{hash:{},inverse:m.noop,fn:m.program(3,o,n),data:n}),(l||0===l)&&(h+=l),h+="\n    ",l=i["if"].call(e,(l=e&&e.attributes,null==l||l===!1?l:l.height),{hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n}),(l||0===l)&&(h+=l),h+="\n    ",l=i["if"].call(e,(l=e&&e.attributes,null==l||l===!1?l:l.width),{hash:{},inverse:m.noop,fn:m.program(7,c,n),data:n}),(l||0===l)&&(h+=l),h+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Img",["tpl!taoQtiItem/qtiCommonRenderer/tpl/img","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"img",template:t,getContainer:e.getContainer}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/item",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return" attributes.id"}function o(){return" attributes.class"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l="",d="function",h=this.escapeExpression,p=this;return l+='<div class="qti-item tao-scope runtime" data-serial="',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===d?c.call(e,{hash:{},data:n}):c),l+=h(s)+'" data-identifier="'+h((s=e&&e.attributes,s=null==s||s===!1?s:s.identifier,typeof s===d?s.apply(e):s))+'">\n    <div',s=i["if"].call(e,(s=e&&e.attributes,null==s||s===!1?s:s.id),{hash:{},inverse:p.noop,fn:p.program(1,r,n),data:n}),(s||0===s)&&(l+=s),l+=' class="qti-itemBody',s=i["if"].call(e,(s=e&&e.attributes,null==s||s===!1?s:s["class"]),{hash:{},inverse:p.noop,fn:p.program(3,o,n),data:n}),(s||0===s)&&(l+=s),l+='">',(c=i.body)?s=c.call(e,{hash:{},data:n}):(c=e&&e.body,s=typeof c===d?c.call(e,{hash:{},data:n}):c),(s||0===s)&&(l+=s),l+='</div>\n    <div id="modalFeedbacks"></div>\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler",["jquery","lodash"],function(t,e){var i=function(){var i=e.throttle(function(){t(document).trigger("customcssloaded.styleeditor")},10,{leading:!1}),a=function(a){var n=t("head");t("body").addClass("tao-scope"),e(a).forEach(function(a){var r=t(a.render()),o=r.attr("href"),s=o.indexOf("?")>-1?"&":"?";0===o.indexOf("/")&&(o=o.slice(1)),o+=s+(new Date).getTime().toString(),r.removeAttr("href").appendTo(n).attr("href",o),e.delay(i,10)})};return{attach:a}}();return i}),define("taoQtiItem/qtiCommonRenderer/renderers/Item",["tpl!taoQtiItem/qtiCommonRenderer/tpl/item","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler"],function(t,e,i){return{qtiClass:"assessmentItem",template:t,getContainer:e.getContainer,render:function(t){e.targetBlank(e.getContainer(t)),i.attach(t.stylesheets)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/math",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\n<span data-serial="',(n=i.serial)?a=n.call(t,{hash:{},data:e}):(n=t&&t.serial,a=typeof n===c?n.call(t,{hash:{},data:e}):n),r+=l(a)+'" data-qti-class="math">\n    <math display = "block">',(n=i.raw)?a=n.call(t,{hash:{},data:e}):(n=t&&t.raw,a=typeof n===c?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="</math>\n</span>\n"}function o(t,e){var a,n,r="";return r+='\n<span data-serial="',(n=i.serial)?a=n.call(t,{hash:{},data:e}):(n=t&&t.serial,a=typeof n===c?n.call(t,{hash:{},data:e}):n),r+=l(a)+'" data-qti-class="math">\n    <math>',(n=i.raw)?a=n.call(t,{hash:{},data:e}):(n=t&&t.raw,a=typeof n===c?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="</math>\n</span>   \n"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c="function",l=this.escapeExpression,d=this;return s=i["if"].call(e,e&&e.block,{hash:{},inverse:d.program(3,o,n),fn:d.program(1,r,n),data:n}),s||0===s?s:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Math",["tpl!taoQtiItem/qtiCommonRenderer/tpl/math","taoQtiItem/qtiCommonRenderer/helpers/Helper","mathJax","lodash"],function(t,e,i,a){return{qtiClass:"math",template:t,getContainer:e.getContainer,render:function(t){"undefined"!=typeof i&&i&&a.delay(function(){i.Hub.Queue(["Typeset",i.Hub,e.getContainer(t).parent()[0]])},60)}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div id="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" class="modal qti-modalFeedback">\n    <h1 class="qti-title modal-title">'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.title,typeof r===c?r.apply(e):r))+'</h1>\n    <div class="modal-body">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/sizeFinder",["jquery"],function(t){var e=function(e){var i;e.each(function(){i=t(this),i.data("originalProperties",{display:i.css("display"),position:i.css("position"),left:i.css("left"),width:i.css("width"),height:i.css("height")}),i.css({position:"relative",left:"-10000px",width:"auto",height:"auto",display:"inline-block"})})},i=function(e){var i;e.each(function(){i=t(this),i.css(e.data("originalProperties")),i.removeData("originalProperties")})},a=function(t){return{width:t.outerWidth(),height:t.outerHeight()}},n=function(t,n){var r;return t&&t.length&&(e(t),r=a(t),i(t),n.call(t[0],r),t.trigger("measured.sizeFinder",r)),r};return{measure:n}}),define("taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",["jquery","lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/sizeFinder","ui/modal"],function(t,e,i,a,n){var r={qtiClass:"modalFeedback",template:i,getContainer:a.getContainer,minWidth:400,maxWidth:800,render:function(i,a){a=a||{};var o=t("#"+i.getSerial());n.measure(o,function(t){o.modal({startClosed:!1,width:Math.max(Math.min(t.width,r.maxWidth),r.minWidth)}),o.on("closed.modal",function(){e.isFunction(a.callback)&&a.callback.call(this)})})}};return r}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/object",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n="";return n+="<video ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.id),{hash:{},inverse:b.noop,fn:b.program(2,o,e),data:e}),(a||0===a)&&(n+=a),n+=' src="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.data,typeof a===g?a.apply(t):a))+'" type="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.type,typeof a===g?a.apply(t):a))+'" ',a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.width),{hash:{},inverse:b.noop,fn:b.program(4,s,e),data:e}),(a||0===a)&&(n+=a),n+=" ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.height),{hash:{},inverse:b.noop,fn:b.program(6,c,e),data:e}),(a||0===a)&&(n+=a),n+='" controls="controls" preload="none"></video>'}function o(t){var e,i="";return i+='id="'+v((e=t&&t.attributes,e=null==e||e===!1?e:e.id,typeof e===g?e.apply(t):e))+'"'}function s(t){var e,i="";return i+='width="'+v((e=t&&t.attributes,e=null==e||e===!1?e:e.width,typeof e===g?e.apply(t):e))+'"'}function c(t){var e,i="";return i+='height="'+v((e=t&&t.attributes,e=null==e||e===!1?e:e.height,typeof e===g?e.apply(t):e))}function l(t,e){var a,n="";return n+="<audio ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.id),{hash:{},inverse:b.noop,fn:b.program(2,o,e),data:e}),(a||0===a)&&(n+=a),n+=' src="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.data,typeof a===g?a.apply(t):a))+'" type="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.type,typeof a===g?a.apply(t):a))+'"></audio>'}function d(t,e){var a,n="";return n+="<object ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.id),{hash:{},inverse:b.noop,fn:b.program(2,o,e),data:e}),(a||0===a)&&(n+=a),n+=' data="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.data,typeof a===g?a.apply(t):a))+'" type="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.type,typeof a===g?a.apply(t):a))+'" ',a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.width),{hash:{},inverse:b.noop,fn:b.program(4,s,e),data:e}),(a||0===a)&&(n+=a),n+=" ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.height),{hash:{},inverse:b.noop,fn:b.program(11,h,e),data:e}),(a||0===a)&&(n+=a),n+=">"+v((a=t&&t.attributes,a=null==a||a===!1?a:a.alt,typeof a===g?a.apply(t):a))+"</object>"}function h(t){var e,i="";return i+='height="'+v((e=t&&t.attributes,e=null==e||e===!1?e:e.height,typeof e===g?e.apply(t):e))+'"'}function p(t,e){var a,n="";return n+="<iframe ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.id),{hash:{},inverse:b.noop,fn:b.program(2,o,e),data:e}),(a||0===a)&&(n+=a),n+=' src="'+v((a=t&&t.attributes,a=null==a||a===!1?a:a.data,typeof a===g?a.apply(t):a))+'" ',a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.width),{hash:{},inverse:b.noop,fn:b.program(4,s,e),data:e}),(a||0===a)&&(n+=a),n+=" ",a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a.height),{hash:{},inverse:b.noop,fn:b.program(11,h,e),data:e}),(a||0===a)&&(n+=a),n+=">"+v((a=t&&t.attributes,a=null==a||a===!1?a:a.alt,typeof a===g?a.apply(t):a))+"</iframe>"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var u,m,f="",g="function",v=this.escapeExpression,b=this;return f+='<div class="qti-object-container" data-serial="',(m=i.serial)?u=m.call(e,{hash:{},data:n}):(m=e&&e.serial,u=typeof m===g?m.call(e,{hash:{},data:n}):m),f+=v(u)+'" >\n    ',u=i["if"].call(e,e&&e.video,{hash:{},inverse:b.noop,fn:b.program(1,r,n),data:n}),(u||0===u)&&(f+=u),f+="\n    ",u=i["if"].call(e,e&&e.audio,{hash:{},inverse:b.noop,fn:b.program(8,l,n),data:n}),(u||0===u)&&(f+=u),f+="\n    ",u=i["if"].call(e,e&&e.object,{hash:{},inverse:b.noop,fn:b.program(10,d,n),data:n}),(u||0===u)&&(f+=u),f+="\n    ",u=i["if"].call(e,e&&e.html,{hash:{},inverse:b.noop,fn:b.program(13,p,n),data:n}),(u||0===u)&&(f+=u),f+="\n</div>"})}),define("taoQtiItem/qtiDefaultRenderer/widgets/Object",["jquery","class","mediaElement"],function(t,e,i){var a=e.extend({init:function(e,a){if(this.playCounter=0,this.mediaType=e.getMediaType(),"video"===this.mediaType||"audio"===this.mediaType){var n=this;this.playerOptions={loop:!1,maxPlays:0,autostart:!1,pauseOtherPlayers:!1,features:["playpause","current","duration","progress","volume"],pluginPath:i.pluginPath,audioWidth:300};var r=parseInt(e.attr("width"));r>10&&("video"===this.mediaType?this.playerOptions.videoWidth=r:this.playerOptions.audioWidth=r);var o=parseInt(e.attr("height"));if(o>10&&("video"===this.mediaType?this.playerOptions.videoHeight=o:this.playerOptions.audioHeight=o),this.id=e.getSerial(),this.media=null,a&&(this.pluginPath=a.pluginPath||"",this.pluginPath&&(this.playerOptions.pluginPath=this.pluginPath),"object"==typeof a.playerOptions)){this.playerOptions=t.extend(this.playerOptions,a.playerOptions);
var s="function"==typeof a.playerOptions.success?a.playerOptions.success:function(){};this.playerOptions.success=function(e,i){setTimeout(function(){var a=function(){n.playerOptions.maxPlays&&n.playCounter>=n.playerOptions.maxPlays&&n.stop()};e.addEventListener("ended",function(){n.playCounter++,a()},!1),e.addEventListener("play",a),e.addEventListener("pause",function(){}),n.playerOptions.autostart&&(e.play(),setTimeout(function(){t(i).parent("div.mejs-mediaelement").siblings("div.mejs-layers").find("div.mejs-overlay-button").click().mousedown()},1e3)),s(e,i)},300)}}}},render:function(){("video"===this.mediaType||"audio"===this.mediaType)&&(this.media=new i("#"+this.id,this.playerOptions))},playCount:function(t){return isNaN(t)?this.playCounter:void(this.playCounter=t)},pause:function(){this.media.pause()},stop:function(){this.pause(),t("#"+this.id).parent("div.mejs-mediaelement").siblings("div.mejs-layers").find("div.mejs-overlay-button").hide()}});return a}),define("taoQtiItem/qtiCommonRenderer/renderers/Object",["tpl!taoQtiItem/qtiCommonRenderer/tpl/object","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiDefaultRenderer/widgets/Object"],function(t,e,i){return{qtiClass:"object",template:t,getContainer:e.getContainer,render:function(t){var e=new i(t);e.render()}}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/empty",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r="";return r})}),define("taoQtiItem/qtiCommonRenderer/renderers/OutcomeDeclaration",["tpl!taoQtiItem/qtiCommonRenderer/tpl/empty"],function(t){return{qtiClass:"outcomeDeclaration",template:t}}),define("taoQtiItem/qtiCommonRenderer/renderers/ResponseDeclaration",["tpl!taoQtiItem/qtiCommonRenderer/tpl/empty"],function(t){return{qtiClass:"responseDeclaration",template:t}}),define("taoQtiItem/qtiCommonRenderer/renderers/ResponseProcessing",["tpl!taoQtiItem/qtiCommonRenderer/tpl/empty"],function(t){return{qtiClass:"responseProcessing",template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="grid-row qti-rubricBlock" data-use="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.use,typeof r===c?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-qti-class="rubricBlock">\n    <div class="col-12">\n        <div class="qti-rubricBlock-body">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</div>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"rubricBlock",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e,i="";return i+='media="'+d((e=t&&t.attributes,e=null==e||e===!1?e:e.media,typeof e===l?e.apply(t):e))+'"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<link \n    href="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.href,typeof o===l?o.apply(e):o))+'" \n    type="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.type,typeof o===l?o.apply(e):o))+'" \n    rel="stylesheet" \n    data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" \n    ',o=i["if"].call(e,(o=e&&e.attributes,null==o||o===!1?o:o.media),{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiCommonRenderer/tpl/stylesheet","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"stylesheet",template:t,getContainer:e.getContainer}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="qti-choice qti-gap" data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\r\n    <span data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" class="gapmatch-content">&nbsp;</span>\r\n</span>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"gap",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e,i="";return i+='alt="'+d((e=t&&t.attributes,e=null==e||e===!1?e:e.objetLabel,typeof e===l?e.apply(t):e))+'" '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<li class="qti-choice qti-gapImg selectable" data-identifier="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.identifier,typeof o===l?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    <img src="'+d((o=e&&e.object,o=null==o||o===!1?o:o.attributes,o=null==o||o===!1?o:o.data,typeof o===l?o.apply(e):o))+'" \n         width="'+d((o=e&&e.object,o=null==o||o===!1?o:o.attributes,o=null==o||o===!1?o:o.width,typeof o===l?o.apply(e):o))+'"\n         height="'+d((o=e&&e.object,o=null==o||o===!1?o:o.attributes,o=null==o||o===!1?o:o.height,typeof o===l?o.apply(e):o))+'"\n         ',o=i["if"].call(e,(o=e&&e.attributes,null==o||o===!1?o:o.objectLabel),{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+="\n    />\n</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"gapImg",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<li class="qti-choice" data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"gapText",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="qti-choice qti-hottext hottext" data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\r\n    <label class="hottext-checkmark">\r\n        <input type="checkbox" value="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'">\r\n        <span class="icon-checkbox small"></span>\r\n    </label>\r\n    <span class="hottext-content">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</span>\r\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"hottext",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<option data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" value="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+"</option>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/inlineChoice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"inlineChoice",getContainer:e.getContainer,template:t}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleAssociableChoice.associateInteraction",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<th class="qti-choice qti-associableChoice qti-simpleAssociableChoice" data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</th>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleAssociableChoice.matchInteraction",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e,i="";return i+='\n            <input type="radio" name="response-'+h((e=t&&t.interaction,e=null==e||e===!1?e:e.serial,typeof e===d?e.apply(t):e))+'" value="'+h((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===d?e.apply(t):e))+'">\n            <span class="icon-radio"></span>\n            '}function o(t){var e,i="";return i+='\n            <input type="checkbox" name="response-'+h((e=t&&t.interaction,e=null==e||e===!1?e:e.serial,typeof e===d?e.apply(t):e))+'" value="'+h((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===d?e.apply(t):e))+'">\n            <span class="icon-checkbox"></span>\n            '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l="",d="function",h=this.escapeExpression,p=this;return l+='<li class="qti-choice qti-simpleChoice" data-identifier="'+h((s=e&&e.attributes,s=null==s||s===!1?s:s.identifier,typeof s===d?s.apply(e):s))+'" data-serial="',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===d?c.call(e,{hash:{},data:n}):c),l+=h(s)+'">\n    <div class="pseudo-label-box">\n        <label class="real-label">\n            ',s=i["if"].call(e,e&&e.unique,{hash:{},inverse:p.program(3,o,n),fn:p.program(1,r,n),data:n}),(s||0===s)&&(l+=s),l+='\n        </label>\n        <div class="label-box">\n            <div class="label-content clear" contenteditable="false">\n                ',(c=i.body)?s=c.call(e,{hash:{},data:n}):(c=e&&e.body,s=typeof c===d?c.call(e,{hash:{},data:n}):c),(s||0===s)&&(l+=s),l+="\n            </div>\n        </div>\n    </div>\n</li>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleChoice.choiceInteraction",getContainer:e.getContainer,getData:function(t,e){return e.unique=1===parseInt(e.interaction.attributes.maxChoices),e},template:t}}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"simpleChoice.orderInteraction",getContainer:e.getContainer,template:t}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===h?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function o(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h="function",p=this.escapeExpression,u=this,m=i.blockHelperMissing;return d+='<div class="qti-interaction qti-blockInteraction qti-associateInteraction" data-serial="',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===h?c.call(e,{hash:{},data:n}):c),d+=p(s)+'" data-qti-class="associateInteraction">\n    ',s=i["if"].call(e,e&&e.prompt,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+='\n    <div class="instruction-container"></div>\n    <ul class="choice-area clearfix  none block-listing solid horizontal source" data-eyecatcher=">li">\n        ',l={hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n},(c=i.choices)?s=c.call(e,l):(c=e&&e.choices,s=typeof c===h?c.call(e,l):c),i.choices||(s=m.call(e,s,{hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n})),(s||0===s)&&(d+=s),d+='\n    </ul>\n    <ul class="result-area none target clearfix">\n    </ul>\n    <div class="notification-container"></div>\n</div>'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return"incomplete-pair"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s="",c=this;return s+='<li class="',o=i["if"].call(e,e&&e.empty,{hash:{},inverse:c.noop,fn:c.program(1,r,n),data:n}),(o||0===o)&&(s+=o),s+='">\n    <div class="target lft"></div>\n    <div class="target rgt"></div>\n</li>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint",["lodash"],function(t){var e={"boolean":function(t){return t?"true":"false"},integer:function(t){return t},"float":function(t){return t},string:function(t){return""===t?"NULL":'"'+t+'"'},point:function(t){return"["+t[0]+", "+t[1]+"]"},pair:function(t){return"["+t[0]+", "+t[1]+"]"},directedPair:function(t){return"["+t[0]+", "+t[1]+"]"},duration:function(t){return t},file:function(){return"binary data"},uri:function(t){return t},intOrIdentifier:function(t){return t},identifier:function(t){return t}},i=function(i,a){var n="",r=i.base;return a="undefined"!=typeof a?a:!0,r?(t.forIn(e,function(t,e){return void 0!==r[e]?(n+=a?"("+e+") ":"",n+=t(r[e]),!1):void 0}),n):void 0},a=function(i,a){var n="",r=i.list;return a="undefined"!=typeof a?a:!0,r?(t.forIn(e,function(e,i){return void 0!==r[i]?(n+=a?"("+i+") ":"",n+="[",t.each(r[i],function(t){n+=e(t)+", "}),t.size(r[i])&&(n=n.substring(0,n.length-2)),n+="]",!1):void 0}),n):void 0};return{printBase:i,printList:a}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciResponse",["lodash","taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint"],function(t,e){var i={single:"base",multiple:"list",ordered:"list",record:"record"};return{unserialize:function(e,a){var n,r=[],o=a.getResponseDeclaration(),s=o.attr("baseType"),c=o.attr("cardinality");if(!i[c])throw"unknown cardinality in the responseDeclaration of the interaction";n=i[c];var l=e[n];if(null===l)r=[];else{if(!t.isObject(l))throw"invalid response cardinality, expected "+c+" ("+n+")";if(void 0===l[s])throw"invalid response baseType";r=l[s],r=t.isArray(r)?r:[r]}return r},serialize:function(e,a){if(!t.isArray(e))throw"invalid argument : responseValues must be an Array";var n,r={},o=a.getResponseDeclaration(),s=o.attr("baseType"),c=o.attr("cardinality");if(!i[c])throw"unknown cardinality in the responseDeclaration of the interaction";return n=i[c],"base"===n?0===e.length?r.base=null:(r.base={},r.base[s]=e[0]):(r[n]={},r[n][s]=e),r},isEmpty:function(e){return null===e||t.isEmpty(e)||null===e.base||t.isArray(e.list)&&t.isEmpty(e.list)||t.isArray(e.record)&&t.isEmpty(e.record)},prettyPrint:function(t){var i="";if("undefined"!=typeof t.base)i+=e.printBase(t,!0);else if("undefined"!=typeof t.list)i+=e.printList(t,!0);else if("undefined"==typeof t.record)throw"Not a valid PCI JSON Response";return i}}}),define("taoQtiItem/qtiCreator/helper/adaptSize",["jquery"],function(t){"use strict";function e(t){return t.charAt(0).toUpperCase()+t.substr(1)}var i=function(){var i=function(t){r(t,{height:0})},a=function(t){r(t,{width:0})},n=function(t){r(t,{height:0,width:0})},r=function(i,a){var n;i instanceof t||(i=t(i)),i.each(function(){var e=t(this);for(n in a)e[n]("auto")}),i.each(function(){var i=t(this);for(n in a)a[n]=Math.max(a[n],i["outer"+e(n)]())}),i.css(a)};return{width:a,height:i,both:n}}();return i}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/helper/adaptSize","eyecatcher"],function(t,e,i,a,n,r,o,s){var c={},l=function(a,o,s){var l=o.data("serial"),d=a.getChoice(l);if(!l)throw"empty choice serial";c[l]||(c[l]=0),c[l]++;var h=function(){s.data("serial",l).html(o.html()).addClass("filled"),!a.responseMappingMode&&d.attr("matchMax")&&c[l]>=d.attr("matchMax")&&o.addClass("deactivated")};if(s.siblings("div").hasClass("filled")){var p=r.getContainer(a).find(".result-area"),u=s.parent(),m=[s.siblings("div").data("serial"),l],f=i();p.children().not(u).each(function(){var e=i(this).children(".filled");if(2===e.length){var a=[i(e[0]).data("serial"),i(e[1]).data("serial")];if(2===t.intersection(m,a).length)return f=e,!1}}),0===f.length?(h(),r.triggerResponseChangeEvent(a,{type:"added",$pair:u,choices:m}),r.validateInstructions(a,{choice:o,target:s}),(a.responseMappingMode||0===parseInt(a.attr("maxAssociations")))&&(u.removeClass("incomplete-pair"),p.children(".incomplete-pair").length||(p.append(n({empty:!0})),p.children(".incomplete-pair").fadeIn(600,function(){i(this).show()})))):(f.css("border","1px solid orange"),s.html(e("identical pair already exists")).css({color:"orange",border:"1px solid orange"}),setTimeout(function(){f.removeAttr("style"),s.empty().removeAttr("style")},2e3))}else h()},d=function(t,e,a){var n=e.data("serial"),o=r.getContainer(t);if(o.find(".choice-area [data-serial="+n+"]").removeClass("deactivated"),c[n]--,e.removeClass("filled").removeData("serial").empty(),!t.swapping&&(r.triggerResponseChangeEvent(t,{type:"removed",$pair:e.parent()}),r.validateInstructions(t,{choice:e}),!e.siblings("div").hasClass("filled")&&(0===parseInt(t.attr("maxAssociations"))||t.responseMappingMode))){var s=e.parent();s.hasClass("incomplete-pair")||(a?s.addClass("removing").fadeOut(500,function(){i(this).remove()}):s.remove())}},h=function(t,e){var i=t.getChoiceByIdentifier(e);if(!i)throw new Error("cannot find a choice with the identifier : "+e);return r.getContainer(t).find(".choice-area [data-serial="+i.getSerial()+"]")},p=function(t){var e=parseInt(t.attr("maxAssociations")),i=r.getContainer(t).find(".result-area");if(t.responseMappingMode||0===e)i.append(n({empty:!0})),i.children(".incomplete-pair").show();else for(var a=0;e>a;a++)i.append(n())},u=function(e){t.delay(function(){s.height(r.getContainer(e).find(".result-area .target, .choice-area .qti-choice"))},200)},m=function(t){p(t);var a=r.getContainer(t),n=a.find(".choice-area"),o=a.find(".result-area"),s=null,c=function(t){return n.find("[data-serial="+t+"]")},h=function(e,i){l(t,e,i),u(t)},m=function(){s&&(o.find(".remove-choice").remove(),s.removeClass("active"),a.find(".empty").removeClass("empty"),s=null)},g=function(e){d(t,e,!0),u(t)},v=function(){return s&&s.data("identifier")},b=function(){return s&&!s.data("identifier")};a.on("mousedown.commonRenderer",function(){m()}),n.on("mousedown.commonRenderer",">li",function(e){return e.stopPropagation(),i(this).hasClass("deactivated")?void e.preventDefault():void(b()?(t.swapping=!0,g(s),h(i(this),s),m(),t.swapping=!1):i(this).hasClass("active")?m():(m(),s=i(this),i(this).addClass("active"),o.find(">li>.target").addClass("empty")))}),o.on("mousedown.commonRenderer",">li>div",function(a){if(a.stopPropagation(),v()){var r=i(this),l=s.data("serial"),d=r.data("serial");d!==l&&(r.hasClass("filled")&&(t.swapping=!0),d&&g(r),h(s,r),t.swapping=!1),m()}else if(b()){var r=i(this),d=r.data("serial"),l=s.data("serial");d!==l&&((r.hasClass("filled")||s.siblings("div")[0]===r[0])&&(t.swapping=!0),g(s),d&&(g(r),h(c(d),s)),h(c(l),r),t.swapping=!1),m()}else if(i(this).data("serial")){var p=i(this).data("serial");s=i(this),s.addClass("active"),o.find(">li>.target").filter(function(){return i(this).data("serial")!==p}).addClass("empty"),n.find(">li:not(.deactivated)").filter(function(){return i(this).data("serial")!==p}).addClass("empty");var u=i("<span>",{"class":"icon-undo remove-choice",title:e("remove")});u.on("mousedown",function(t){t.stopPropagation(),g(s),m()}),i(this).append(u)}}),t.responseMappingMode||f(t),u(t)},f=function(t){var i=parseInt(t.attr("minAssociations")),a=parseInt(t.attr("maxAssociations"));if(0===i)0===a&&r.appendInstruction(t,e("You may make as many association pairs as you want."));else{0===a&&r.appendInstruction(t,e("The maximum number of association is unlimited."));var n=e("You need to make")+" ";n+=i>1?e("at least")+" "+i+" "+e("association pairs"):e("one association pair"),r.appendInstruction(t,n,function(){I(t).length>=i?this.setLevel("success"):this.reset()})}},g=function(t){r.getContainer(t).find(".result-area>li>div").each(function(){d(t,i(this))})},v=function(e,a){var n=0,o=r.getContainer(e).find(".result-area>li:first");return a&&"single"===e.getResponseDeclaration().attr("cardinality")&&a.length&&(a=[a]),t.each(a,function(t){if(!o.length)return!1;var a=o.children("div");l(e,h(e,t[0]),i(a[0])),l(e,h(e,t[1]),i(a[1])),n++,o=o.next("li")}),n},b=function(t,e){v(t,o.unserialize(e,t))},I=function(t){var e=[];return r.getContainer(t).find(".result-area>li").each(function(){var a=[];i(this).find("div").each(function(){var e=i(this).data("serial");e&&a.push(t.getChoice(e).id())}),2===a.length&&e.push(a)}),e},C=function(t){return o.serialize(I(t),t)},y=function(t){var e=r.getContainer(t);e.find(".result-area .active").mousedown(),i(document).off(".commonRenderer"),e.find(".choice-area, .result-area").andSelf().off(".commonRenderer"),g(t),r.removeInstructions(t),r.getContainer(t).find(".result-area").empty()};return{qtiClass:"associateInteraction",template:a,render:m,getContainer:r.getContainer,setResponse:b,getResponse:C,resetResponse:g,destroy:y,renderEmptyPairs:p}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===p?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function o(){return" horizontal"}function s(t){var e;return e=typeof t===p?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d,h="",p="function",u=this.escapeExpression,m=this,f=i.blockHelperMissing;return h+='<div class="qti-interaction qti-blockInteraction qti-choiceInteraction" data-serial="',(l=i.serial)?c=l.call(e,{hash:{},data:n}):(l=e&&e.serial,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'" data-qti-class="choiceInteraction">\n  ',c=i["if"].call(e,e&&e.prompt,{hash:{},inverse:m.noop,fn:m.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+='\n  <div class="instruction-container"></div>\n  <ol class="plain block-listing solid choice-area',c=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:m.noop,fn:m.program(3,o,n),data:n}),(c||0===c)&&(h+=c),h+='">\n      ',d={hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n},(l=i.choices)?c=l.call(e,d):(l=e&&e.choices,c=typeof l===p?l.call(e,d):l),i.choices||(c=f.call(e,c,{hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n})),(c||0===c)&&(h+=c),h+='\n  </ol>\n  <div class="notification-container"></div>\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r){var o=function(t){var i=n.getContainer(t);i.off(".commonRenderer"),i.on("click.commonRenderer",".qti-choice",function(i){i.preventDefault(),i.stopPropagation();var a=e(this),r=a.find("input:radio").not("[disabled]").not(".disabled"),o=a.find("input:checkbox").not("[disabled]").not(".disabled");r.length&&(r.not(":checked").prop("checked",!0),r.trigger("change")),o.length&&(o.prop("checked",!o.prop("checked")),o.trigger("change")),n.validateInstructions(t,{choice:a}),n.triggerResponseChangeEvent(t)})},s=function(t){o(t),c(t)},c=function(e){var a=e.attr("minChoices"),r=e.attr("maxChoices"),o=t.size(e.getChoices()),s=!1;if(r>1&&o>r){var c=function(t){var i=t.find(".real-label > input"),a=t.css("color","#BA122B"),r=t.find(".real-label > span").css("color","#BA122B").addClass("cross error");setTimeout(function(){i.prop("checked",!1),a.removeAttr("style"),r.removeAttr("style").removeClass("cross"),n.triggerResponseChangeEvent(e)},150)};if(r===a){s=!0;var l=i("You must select exactly")+" "+r+" "+i("choices");n.appendInstruction(e,l,function(t){h(e).length>=r?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:i("Maximum choices reached"),timeout:2e3,start:function(){c(t.choice)},stop:function(){this.update({level:"success",message:l})}}),this.setState("fulfilled")):this.reset()})}else r>a&&n.appendInstruction(e,i("You can select maximum")+" "+r+" "+i("choices"),function(t){h(e).length>=r?(this.setMessage(i("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){c(t.choice)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()})}!s&&a>0&&o>a&&n.appendInstruction(e,i("You must select at least")+" "+a+" "+i("choices"),function(){h(e).length>=a?this.setLevel("success"):this.reset()})},l=function(t){n.getContainer(t).find(".real-label > input").prop("checked",!1)},d=function(e,i){var a=n.getContainer(e);try{t.each(r.unserialize(i,e),function(t){a.find(".real-label > input[value="+t+"]").prop("checked",!0)}),n.validateInstructions(e)}catch(o){throw new Error("wrong response format in argument : "+o)}},h=function(t){var i=[];return n.getContainer(t).find(".real-label > input[name=response-"+t.getSerial()+"]:checked").each(function(){i.push(e(this).val())}),i},p=function(t){return r.serialize(h(t),t)},u=function(e,i){return t.merge(i||{},{horizontal:"horizontal"===e.attr("orientation")})},m=function(t){e(document).off(".commonRenderer"),n.getContainer(t).off(".commonRenderer"),l(t),n.removeInstructions(t)};return{qtiClass:"choiceInteraction",template:a,getData:u,render:s,getContainer:n.getContainer,setResponse:d,getResponse:p,resetResponse:l,destroy:m}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="qti-interaction qti-customInteraction" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    ',(o=i.markup)?r=o.call(e,{hash:{},data:n}):(o=e&&e.markup,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="\n</div>"})}),define("taoQtiItem/runtime/qtiCustomInteractionContext",["jquery","lodash"],function(t,e){var i={},a={register:function(t){i[t.getTypeIdentifier()]=t},notifyReady:function(e){t(document).trigger("custominteractionready",[e._taoCustomInteraction])},notifyDone:function(e){t(document).trigger("custominteractiondone",[e._taoCustomInteraction])},getPci:function(t){return i[t]?e.cloneDeep(i[t]):void 0}};return a}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/CustomInteraction.amd",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/runtime/qtiCustomInteractionContext","taoQtiItem/qtiItem/helper/util","context"],function(t,e,i,a,n,r){var o=function(){window.qtiCustomInteractionContext=window.qtiCustomInteractionContext||a},s=function(t){window.require.config({context:"portableCustomInteraction",paths:t})},c=function(t,e){var i=require.config({context:"portableCustomInteraction"});i(t,e)},l=function(t){var e,i=t.data("pci")||void 0;if(!i){if(e=t.typeIdentifier,i=a.getPci(e),!i)throw"no custom interaction hook found for the type "+e;t.data("pci",i),i._taoCustomInteraction=t}return i},d=function(e,i){var a=e.libraries||[],r=[],o={};return t.forIn(a,function(t,e){var a=n.fullpath(t,i);/\.js$/.test(a)?(o[e]=a.replace(/\.js$/,""),r.push(e)):/\.css$/.test(a)&&(o[e]=a.replace(/\.css$/,""),r.push("css!"+e))}),s(o),r},h=function(t){o(),s({css:r.root_url+"tao/views/js/lib/require-css/css"});var e=t.attr("responseIdentifier"),a=i.getContainer(t).find("#"+e),n=null,h=null,p=t.properties,u=d(t,this.getOption("baseUrl"));c(u,function(){var i=l(t);i&&i.initialize(e,a[0],p,n,h)})},p=function(t,e){l(t).setResponse(e)},u=function(t){l(t).getResponse()},m=function(t){l(t).resetResponse()},f=function(t){l(t).destroy()},g=function(t){l(t).getSerializedState()};return{qtiClass:"customInteraction",template:e,render:h,getContainer:i.getContainer,setResponse:p,getResponse:u,resetResponse:m,destroy:f,getSerializedState:g}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/CustomInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/runtime/qtiCustomInteractionContext","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a,n,r){var o=function(){window.qtiCustomInteractionContext=window.qtiCustomInteractionContext||n},s=function(t){var e,i=t.data("pci")||void 0;if(!i){if(e=t.typeIdentifier,i=n.getPci(e),!i)throw"no custom interaction hook found for the type "+e;t.data("pci",i),i._taoCustomInteraction=t}return i},c=function(e,i){var a=e.libraries||[],n=[],o=1;return t.each(a,function(t){var e=r.fullpath(t,i);
/\.js$/.test(e)?n.push(e):/\.css$/.test(e)&&n.push("css!"+e),o++}),n},l=function(t){o();var e=t.attr("responseIdentifier"),i=a.getContainer(t).find("#"+e),n=null,r=null,l=t.properties,d=c(t,this.getOption("baseUrl"));require(d,function(){var a=s(t);a&&a.initialize(e,i[0],l,n,r)})},d=function(t,e){s(t).setResponse(e)},h=function(t){s(t).getResponse()},p=function(t){s(t).resetResponse()},u=function(t){s(t).destroy()},m=function(t){s(t).getSerializedState()};return{qtiClass:"customInteraction",template:i,render:l,getContainer:a.getContainer,setResponse:d,getResponse:h,resetResponse:p,destroy:u,getSerializedState:m}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===u?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function o(t,e){var a,n,r,o="";return o+='\r\n    <div id="'+m((a=t&&t.attributes,a=null==a||a===!1?a:a.identifier,typeof a===u?a.apply(t):a))+'">\r\n        ',r={hash:{},inverse:f.noop,fn:f.program(4,s,e),data:e},(n=i.maxStringLoop)?a=n.call(t,r):(n=t&&t.maxStringLoop,a=typeof n===u?n.call(t,r):n),i.maxStringLoop||(a=g.call(t,a,{hash:{},inverse:f.noop,fn:f.program(4,s,e),data:e})),(a||0===a)&&(o+=a),o+="\r\n    </div>\r\n    "}function s(t){var e,i="";return i+='<input id="'+m((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===u?e.apply(t):e))+"_"+m(typeof t===u?t.apply(t):t)+'" name="'+m((e=t&&t.attributes,e=null==e||e===!1?e:e.identifier,typeof e===u?e.apply(t):e))+"_"+m(typeof t===u?t.apply(t):t)+'"/><br />'}function c(t,e){var a,n="";return n+='\r\n        <div id="text-container">\r\n            <textarea id="'+m((a=t&&t.attributes,a=null==a||a===!1?a:a.identifier,typeof a===u?a.apply(t):a))+'" class="solid',a=i["if"].call(t,(a=t&&t.attributes,null==a||a===!1?a:a["class"]),{hash:{},inverse:f.noop,fn:f.program(7,l,e),data:e}),(a||0===a)&&(n+=a),n+='" cols="72"></textarea>\r\n        </div>\r\n    '}function l(){return" attributes.class"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var d,h,p="",u="function",m=this.escapeExpression,f=this,g=i.blockHelperMissing;return p+='<div class="qti-interaction qti-blockInteraction qti-extendedTextInteraction" data-serial="',(h=i.serial)?d=h.call(e,{hash:{},data:n}):(h=e&&e.serial,d=typeof h===u?h.call(e,{hash:{},data:n}):h),p+=m(d)+'" data-qti-class="extendedTextInteraction">\r\n    ',d=i["if"].call(e,e&&e.prompt,{hash:{},inverse:f.noop,fn:f.program(1,r,n),data:n}),(d||0===d)&&(p+=d),p+='\r\n    <div class="instruction-container"></div>\r\n    ',d=i["if"].call(e,e&&e.multiple,{hash:{},inverse:f.program(6,c,n),fn:f.program(3,o,n),data:n}),(d||0===d)&&(p+=d),p+="\r\n</div>"})}),define("taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler",["lodash"],function(t){"use strict";var e=function(){var e="html",i={},a=function(i){if("xhtml"===i.toLowerCase()&&(i="html"),!t.contains(["html","qti"],i))throw new Error("Unknown mode "+i);return e=i,this},n=["article","aside","bdi","command","datalist","details","dialog","figcaption","figure","footer","header","keygen","main","mark","meter","nav","output","progress","rp","rt","ruby","section","summary","time","wbr","hgroup"],r=function(t){var a,n=[];t=h(t);for(a in i[e])i[e].hasOwnProperty(a)&&0!==a.indexOf("$")&&t in i[e][a]&&n.push(a);return n},o=function(a){return a=h(a),a in i[e]?t.keys(i[e][a]):[]},s=function(e,i){return t.contains(o(i),h(e))},c=function(e,i){return t.contains(r(i),h(e))},l=function(){return i[e]},d=function(){return e},h=function(e){if(t.isObject(e)&&!t.isArray(e)){if("nodeName"in e)return e.nodeName.toLowerCase();if(0 in e&&"nodeName"in e[0])return e[0].nodeName.toLowerCase()}else if(t.isString(e))return e.toLowerCase();throw new Error("Unknown element "+e)};return i.html=function(){var e=t.extend,i=function(e,i){for(var a=t.cloneDeep(e),n=1;n<arguments.length;n++){i=arguments[n];for(var r in i)delete a[r]}return a},a={},n={},r={a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},o={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},s={command:1,link:1,meta:1,noscript:1,script:1,style:1},c={},l={"#":1},d={acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1},h={center:1,dir:1,noframes:1};e(a,r,l,d),e(n,o,a,h);var p={a:i(a,{a:1,button:1}),abbr:a,address:n,area:c,article:e({style:1},n),aside:e({style:1},n),audio:e({source:1,track:1},n),b:a,base:c,bdi:a,bdo:a,blockquote:n,body:n,br:c,button:i(a,{a:1,button:1}),canvas:a,caption:n,cite:a,code:a,col:c,colgroup:{col:1},command:c,datalist:e({option:1},a),dd:n,del:a,details:e({summary:1},n),dfn:a,div:e({style:1},n),dl:{dt:1,dd:1},dt:n,em:a,embed:c,fieldset:e({legend:1},n),figcaption:n,figure:e({figcaption:1},n),footer:n,form:n,h1:a,h2:a,h3:a,h4:a,h5:a,h6:a,head:e({title:1,base:1},s),header:n,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:c,html:e({head:1,body:1},n,s),i:a,iframe:l,img:c,input:c,ins:a,kbd:a,keygen:c,label:a,legend:a,li:n,link:c,map:n,mark:a,menu:e({li:1},n),meta:c,meter:i(a,{meter:1}),nav:n,noscript:e({link:1,meta:1,style:1},a),object:e({param:1},a),ol:{li:1},optgroup:{option:1},option:l,output:a,p:a,param:c,pre:a,progress:i(a,{progress:1}),q:a,rp:a,rt:a,ruby:e({rp:1,rt:1},a),s:a,samp:a,script:l,section:e({style:1},n),select:{optgroup:1,option:1},small:a,source:c,span:a,strong:a,style:l,sub:a,summary:a,sup:a,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:n,textarea:l,tfoot:{tr:1},th:n,thead:{tr:1},time:i(a,{time:1}),title:l,tr:{th:1,td:1},track:c,u:a,ul:{li:1},"var":a,video:e({source:1,track:1},n),wbr:c,acronym:a,applet:e({param:1},n),basefont:c,big:a,center:n,dialog:c,dir:{li:1},font:a,isindex:c,noframes:n,strike:a,tt:a};return e(p,{$block:e({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},o,h),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:a,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:e({body:1,head:1,html:1},p.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),p}(),i.qti=function(){for(var e,a,r,o,s,c,l,d=["remove","add"],h=d.length,p={pre:{add:[],remove:["img","object","big","small","sub","sup"]},table:{remove:["col"]}},u=t.cloneDeep(i.html),m=n.length;m--;)delete u[n[m]];for(e in u)u.hasOwnProperty(e)&&(l=t.intersection(t.keys(u[e]),n),l.length&&(p[e]||(p[e]={remove:[]}),p[e].remove=p[e].remove.concat(l)));for(e in p)if(p.hasOwnProperty(e)&&u.hasOwnProperty(e))for(o=0;h>o;o++)if(s=d[o],s in p[e])if(a=p[e][s].length,"remove"!==s||"all"!==p[e][s])for(;a--;)r=p[e][s][a],c=t.cloneDeep(u[e]),"remove"===s?(delete c[r],u[e]=c):"add"===s&&"undefined"!=typeof u[r]&&(c[r]=1,u[e]=c[r]);else u[e]={};return u}(),{getDtd:l,getChildrenOf:o,getParentsOf:r,isChildOf:s,isParentOf:c,getMode:d,setMode:a}}();return e}),define("ckConfigurator",["lodash","ckeditor","taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler","mathJax"],function(t,e,i,a){var n=t.cloneDeep(CKEDITOR.config),r=function(){var e={TaoMediaManager:{insertAfter:"SpecialChar"}},r={TaoQtiImage:{insertAfter:"SpecialChar"}};a&&(r.TaoQtiMaths={insertAfter:"SpecialChar"});var o={inline:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],flow:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],block:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"links",items:["Link"]},"/",{name:"styles",items:["Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}]},s={disableAutoInline:!0,entities:!1,entities_processNumerical:!0,autoParagraph:!1,extraPlugins:"confighelper",floatSpaceDockedOffsetY:0,forcePasteAsPlainText:!0,skin:"tao",language:"en",removePlugins:"",linkShowAdvancedTab:!1,justifyClasses:["txt-lft","txt-ctr","txt-rgt","txt-jty"],linkShowTargetTab:!1,specialChars:["!","&quot;","#","$","%","&amp;","'","(",")","*","+","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";",["&lt;","Less than"],["&le;","Less than or equal to"],"&asymp;","=","&ne;",["&ge;","Greater than or equal to"],["&gt;","Greater than"],"?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","&euro;","&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;","&sbquo;","&#8219;","&bdquo;","&hellip;","&trade;","&#9658;","&bull;","&rarr;","&rArr;","&hArr;","&diams;","&asymp;"]},c=function(e,i){var a,n,r,o,s,c,l,d,h,p,u=e.toolbar.length,m={};for(e.extraPlugins=function(e,i){for(var a=e.length,n=i.split(",");a--;)e[a]=e[a].toLowerCase();return n=t.compact(t.union(n,e)),n.join(",")}(t.keys(i),e.extraPlugins),p=0;u>p;p++)t.isString(e.toolbar[p])&&(m[p]=e.toolbar[p],e.toolbar[p]={items:[]});for(o in i){for(r=function(t){for(var e=t.length;e--;)if(0===t[e].indexOf("insert")||"replace"===t[e])return t[e];throw"Missing key insertBefore | insertAfter | replace in positionedPlugins"}(t.keys(i[o])),l=i[o][r].toLowerCase(),c=i[o].separator||!1,s=-1;u--;){for(n=e.toolbar[u].items.length,a=0;n>a;a++)if(e.toolbar[u].items[a].toLowerCase()===l){s=a;break}if(s>-1){d=~~("replace"===r),"insertAfter"===r&&s++,c&&(e.toolbar[u].items.splice(s,d,"-"),s++),e.toolbar[u].items.splice(s,d,o);break}}u=e.toolbar.length}for(h in m)e.toolbar[h]=m[h]},l=function(a,l,d){if("reset"===l)return n;d=d||{},d.resourcemgr=d.resourcemgr||{};var h,p,u=t.clone(o,!0),m="html";0===l.indexOf("qti")&&(l=l.slice(3).toLowerCase(),s.allowedContent=!0,s.autoParagraph=!1,m="qti"),d.toolbar&&(u[l]=t.clone(d.toolbar),delete d.toolbar);for(h in u)u.hasOwnProperty(h)&&(s["toolbar_"+h]=u[h]);return"undefined"!=typeof u[l]&&(s.toolbar=u[l]),"undefined"!=typeof d.positionedPlugins&&(d.positionedPlugins={}),!1!==d.positionedPlugins&&(e="qti"===m?t.assign(r,t.clone(d.positionedPlugins)):t.assign(e,t.clone(d.positionedPlugins)),delete d.positionedPlugins,c(s,e)),p=t.assign({},t.cloneDeep(n),s,d),a.on("focus",function(){i.setMode(m),CKEDITOR.dtd=i.getDtd()}),a.on("instanceReady",function(t){$(t.editor.element.$).removeAttr("title")}),CKEDITOR.on("dialogDefinition",function(t){if("link"===t.data.name){for(var e,i=t.data.definition.getContents("info").get("linkType").items,a=i.length;a--;)"anchor"===i[a][1]||(e=a);i.splice(e+1,1)}}),p};return{getConfig:l}}();return r}),function(t){function e(t,e,i){return t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):void 0}function i(t,e){var i,a;for(i=0,a=t.length;a>i;i++)if(t[i]===e)return!0;return!1}function a(t,e){var i;t.createTextRange?(i=t.createTextRange(),i.move("character",e),i.select()):t.selectionStart&&(t.focus(),t.setSelectionRange(e,e))}function n(t,e){try{return t.type=e,!0}catch(i){return!1}}t.Placeholders={Utils:{addEventListener:e,inArray:i,moveCaret:a,changeType:n}}}(this),function(t){function e(){}function i(){try{return document.activeElement}catch(t){}}function a(t,e){var i,a,n=!!e&&t.value!==e,r=t.value===t.getAttribute(T);return(n||r)&&"true"===t.getAttribute(P)?(t.removeAttribute(P),t.value=t.value.replace(t.getAttribute(T),""),t.className=t.className.replace(A,""),a=t.getAttribute(j),parseInt(a,10)>=0&&(t.setAttribute("maxLength",a),t.removeAttribute(j)),i=t.getAttribute($),i&&(t.type=i),!0):!1}function n(t){var e,i,a=t.getAttribute(T);return""===t.value&&a?(t.setAttribute(P,"true"),t.value=a,t.className+=" "+M,i=t.getAttribute(j),i||(t.setAttribute(j,t.maxLength),t.removeAttribute("maxLength")),e=t.getAttribute($),e?t.type="text":"password"===t.type&&W.changeType(t,"text")&&t.setAttribute($,"password"),!0):!1}function r(t,e){var i,a,n,r,o,s,c;if(t&&t.getAttribute(T))e(t);else for(n=t?t.getElementsByTagName("input"):f,r=t?t.getElementsByTagName("textarea"):g,i=n?n.length:0,a=r?r.length:0,c=0,s=i+a;s>c;c++)o=i>c?n[c]:r[c-i],e(o)}function o(t){r(t,a)}function s(t){r(t,n)}function c(t){return function(){v&&t.value===t.getAttribute(T)&&"true"===t.getAttribute(P)?W.moveCaret(t,0):a(t)}}function l(t){return function(){n(t)}}function d(t){return function(e){return I=t.value,"true"===t.getAttribute(P)&&I===t.getAttribute(T)&&W.inArray(E,e.keyCode)?(e.preventDefault&&e.preventDefault(),!1):void 0}}function h(t){return function(){a(t,I),""===t.value&&(t.blur(),W.moveCaret(t,0))}}function p(t){return function(){t===i()&&t.value===t.getAttribute(T)&&"true"===t.getAttribute(P)&&W.moveCaret(t,0)}}function u(t){return function(){o(t)}}function m(t){t.form&&(x=t.form,"string"==typeof x&&(x=document.getElementById(x)),x.getAttribute(O)||(W.addEventListener(x,"submit",u(x)),x.setAttribute(O,"true"))),W.addEventListener(t,"focus",c(t)),W.addEventListener(t,"blur",l(t)),v&&(W.addEventListener(t,"keydown",d(t)),W.addEventListener(t,"keyup",h(t)),W.addEventListener(t,"click",p(t))),t.setAttribute(B,"true"),t.setAttribute(T,w),(v||t!==i())&&n(t)}var f,g,v,b,I,C,y,w,q,x,_,Q,k,R=["text","search","url","tel","email","password","number","textarea"],E=[27,33,34,35,36,37,38,39,40,8,46],S="#ccc",M="placeholdersjs",A=new RegExp("(?:^|\\s)"+M+"(?!\\S)"),T="data-placeholder-value",P="data-placeholder-active",$="data-placeholder-type",O="data-placeholder-submit",B="data-placeholder-bound",F="data-placeholder-focus",D="data-placeholder-live",j="data-placeholder-maxlength",z=document.createElement("input"),L=document.getElementsByTagName("head")[0],H=document.documentElement,G=t.Placeholders,W=G.Utils;if(G.nativeSupport=void 0!==z.placeholder,!G.nativeSupport){for(f=document.getElementsByTagName("input"),g=document.getElementsByTagName("textarea"),v="false"===H.getAttribute(F),b="false"!==H.getAttribute(D),C=document.createElement("style"),C.type="text/css",y=document.createTextNode("."+M+" { color:"+S+"; }"),C.styleSheet?C.styleSheet.cssText=y.nodeValue:C.appendChild(y),L.insertBefore(C,L.firstChild),k=0,Q=f.length+g.length;Q>k;k++)_=k<f.length?f[k]:g[k-f.length],w=_.attributes.placeholder,w&&(w=w.nodeValue,w&&W.inArray(R,_.type)&&m(_));q=setInterval(function(){for(k=0,Q=f.length+g.length;Q>k;k++)_=k<f.length?f[k]:g[k-f.length],w=_.attributes.placeholder,w?(w=w.nodeValue,w&&W.inArray(R,_.type)&&(_.getAttribute(B)||m(_),(w!==_.getAttribute(T)||"password"===_.type&&!_.getAttribute($))&&("password"===_.type&&!_.getAttribute($)&&W.changeType(_,"text")&&_.setAttribute($,"password"),_.value===_.getAttribute(T)&&(_.value=w),_.setAttribute(T,w)))):_.getAttribute(P)&&(a(_),_.removeAttribute(T));b||clearInterval(q)},100)}W.addEventListener(t,"beforeunload",function(){G.disable()}),G.disable=G.nativeSupport?e:o,G.enable=G.nativeSupport?e:s}(this),define("polyfill/placeholders",function(){}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","i18n","ckeditor","ckConfigurator","polyfill/placeholders"],function(t,e,i,a,n,r,o){var s=function(t,e){var i=new RegExp("^"+e+"$");t.on("keyup",function(){t.removeClass("field-error"),i.test(t.val())||t.addClass("field-error")})},c=function(t){var e=t.getAttributes(),i=t.getResponseDeclaration();return!(!e.maxStrings||"multiple"!==i.attr("cardinality")&&"ordered"!==i.attr("cardinality"))},l=function(t){var i,l,d,h=t.getAttributes(),p=t.getContainer(),u=(t.getResponseDeclaration(),c(t));if(r.on("instanceCreated",function(e){var i=e.editor,n="block";i.on("configLoaded",function(){i.config=o.getConfig(i,n,v)}),i.on("change",function(){a.triggerResponseChangeEvent(t,{})})}),u){if(i=p.find("input"),h.minStrings){var m=function(t){var i=0;return t.each(function(){""!==e(this).val()&&i++}),i},g=parseInt(h.minStrings);g>0&&i.on("blur",function(){setTimeout(function(){!i.is(":focus")&&m(i)<g&&a.appendNotification(t,n("The minimum number of answers is ")+" : "+g,"warning")},100)})}h.expectedLength&&(l=parseInt(h.expectedLength,10),l>0&&i.each(function(){e(this).css("width",l+"em")})),h.patternMask&&i.each(function(){s(e(this),h.patternMask)}),h.placeholderText&&(d="first","multiple"===d?i.each(function(){e(this).attr("placeholder",h.placeholderText)}):"first"===d&&i.first().attr("placeholder",h.placeholderText))}else{i=p.find("textarea");var v={extraPlugins:"confighelper",resize_enabled:!0};h.placeholderText&&i.attr("placeholder",h.placeholderText),"xhtml"==f(t)?(r.replace(t.attr("identifier"),v),p.find("#text-container").addClass("solid")):i.bind("keyup change",function(){a.triggerResponseChangeEvent(t,{})})}},d=function(t){t.getContainer().find("input, textarea").val("")},h=function(t,e){var i=function(e,i){t.getContainer().find("#"+e).val(i)},a=function(e){t.getContainer().find("textarea").val(e)},n=t.getResponseDeclaration().attr("baseType");if(e.base&&void 0!==e.base[n])a(e.base[n]);else{if(!e.list||!e.list[n])throw new Error("wrong response format in argument.");for(var r in e.list[n]){var o=void 0===e.list.identifier?"":e.list.identifier[r];i(o+"_"+r,e.list[n][r])}}},p=function(t){var i=t.getContainer(),a=t.getAttributes(),n=t.getResponseDeclaration(),r=n.attr("baseType"),o=a.base||10,s=!(!a.maxStrings||"multiple"!==n.attr("cardinality")&&"ordered"!==n.attr("cardinality")),c=s?{list:{}}:{base:{}};if(s){var l=[];i.find("input").each(function(t){$el=e(this),a.placeholderText&&$el.val()===a.placeholderText?l[t]="":"integer"===r?(l[t]=parseInt($el.val(),o),l[t]=isNaN(l[t])?"":l[t]):"float"===r?(l[t]=parseFloat($el.val()),l[t]=isNaN(l[t])?"":l[t]):"string"===r&&(l[t]=$el.val())}),c.list[r]=l}else{var d="";a.placeholderText&&u(t)===a.placeholderText?d="":"integer"===r?d=parseInt(u(t),o):"float"===r?d=parseFloat(u(t)):"string"===r&&(d=u(t)),c.base[r]=isNaN(d)&&"number"==typeof d?"":d}return c},u=function(t){return"xhtml"===f(t)?m(t):a.getContainer(t).find("textarea").val()},m=function(t){return r.instances[t.attr("identifier")].getData()},f=function(t){var e=t.attr("format");switch(e){case"plain":case"xhtml":case"preFormatted":return e;default:return"plain"}},g=function(t,e){a.getContainer(t);"xhtml"==t.attr("format")?r.replace(t.attr("identifier")):"xhtml"==e&&r.instances[t.attr("identifier")].destroy()},v=function(t){var e=a.getContainer(t);e.find("input, textarea").removeAttr("disabled"),"xhtml"==t.attr("format")&&(r.instances[t.attr("identifier")].destroy(),r.replace(t.attr("identifier")))},b=function(t){var e=a.getContainer(t);e.find("input, textarea").attr("disabled","disabled"),"xhtml"==t.attr("format")&&(r.instances[t.attr("identifier")].destroy(),r.replace(t.attr("identifier")))},I=function(t){C(t,"")},C=function(t,e){var i=a.getContainer(t);"xhtml"==t.attr("format")?r.instances[t.attr("identifier")].setData(e):i.find("textarea").val(e)};return{qtiClass:"extendedTextInteraction",template:i,render:l,getContainer:a.getContainer,setResponse:h,getResponse:p,resetResponse:d,updateFormat:g,enable:v,disable:b,clearText:I,setText:C}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===h?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function o(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h="function",p=this.escapeExpression,u=this,m=i.blockHelperMissing;return d+='<div class="qti-interaction qti-blockInteraction qti-gapMatchInteraction" data-serial="',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===h?c.call(e,{hash:{},data:n}):c),d+=p(s)+'" data-qti-class="gapMatchInteraction">\n    ',s=i["if"].call(e,e&&e.prompt,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+='\n    <ul class="choice-area none block-listing solid horizontal source" data-eyecatcher=">li">\n        ',l={hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n},(c=i.choices)?s=c.call(e,l):(c=e&&e.choices,s=typeof c===h?c.call(e,l):c),i.choices||(s=m.call(e,s,{hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n})),(s||0===s)&&(d+=s),d+='\n    </ul>\n    <div class="instruction-container"></div>\n    <div class="qti-flow-container">',(c=i.body)?s=c.call(e,{hash:{},data:n}):(c=e&&e.body,s=typeof c===h?c.call(e,{hash:{},data:n}):c),(s||0===s)&&(d+=s),d+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","eyecatcher"],function(t,e,i,a,n,r){var o={},s=function(t,e,i){var a=e.data("serial"),r=t.getChoice(a);o[a]||(o[a]=0),o[a]++,i.data("serial",a).html(e.html()).addClass("filled"),!t.responseMappingMode&&r.attr("matchMax")&&o[a]>=r.attr("matchMax")&&e.addClass("deactivated"),n.triggerResponseChangeEvent(t)},c=function(t,e){var i=e.data("serial"),a=n.getContainer(t);a.find(".choice-area [data-serial="+i+"]").removeClass("deactivated"),o[i]--,e.removeClass("filled").removeData("serial").empty(),t.swapping||n.triggerResponseChangeEvent(t)},l=function(t,e){return n.getContainer(t).find(".choice-area [data-identifier="+e+"]")},d=function(t,e){return n.getContainer(t).find(".qti-flow-container [data-identifier="+e+"]")},h=function(t){var a=n.getContainer(t),r=a.find(".choice-area"),o=a.find(".qti-flow-container"),l=null,d=function(t){return r.find("[data-serial="+t+"]")},h=function(e,i){return s(t,e,i)},p=function(){l&&(o.find(".remove-choice").remove(),l.removeClass("active"),a.find(".empty").removeClass("empty"),l=null)},u=function(e){return c(t,e)},m=function(){return l&&!l.hasClass("filled")},f=function(){return l&&l.hasClass("filled")};a.on("mousedown.commonRenderer",function(){p()}),r.on("mousedown.commonRenderer",">li",function(t){return t.stopPropagation(),i(this).hasClass("deactivated")?void t.preventDefault():void(f()||l?(u(l),h(i(this),l),p()):i(this).hasClass("active")?p():(p(),l=i(this),i(this).addClass("active"),o.find(".gapmatch-content").addClass("empty")))}),o.on("mousedown.commonRenderer",".gapmatch-content",function(t){if(t.stopPropagation(),m()){var a=i(this),n=l.data("serial"),s=a.data("serial");s!==n&&(s&&u(a),h(l,a)),p()}else if(f()){var a=i(this),s=a.data("serial"),n=l.data("serial");s!==n&&(u(l),s&&(u(a),h(d(s),l)),h(d(n),a)),p()}else if(i(this).data("serial")&&i(this).hasClass("filled")){var c=i(this).data("serial");l=i(this),l.addClass("active"),o.find(">li>div").filter(function(){return i(this).data("serial")!==c}).addClass("empty"),r.find(">li:not(.deactivated)").filter(function(){return i(this).data("serial")!==c}).addClass("empty");var g=i("<span>",{"class":"icon-undo remove-choice",title:e("remove")});g.on("mousedown",function(t){t.stopPropagation(),u(l),p()}),i(this).append(g)}})},p=function(t){n.getContainer(t).find(".gapmatch-content").each(function(){c(t,i(this))})},u=function(e,i){t.each(i,function(t){t&&s(e,l(e,t[0]),d(e,t[1]).find(".gapmatch-content"))})},m=function(t,e){p(t),u(t,r.unserialize(e,t))},f=function(t){var e=[];return n.getContainer(t).find(".gapmatch-content").each(function(){var a=i(this).data("serial"),n=[];a&&n.push(t.getChoice(a).attr("identifier")),n.push(i(this).data("identifier")),2===n.length&&e.push(n)}),e},g=function(t){return r.serialize(f(t),t)},v=function(t){var e=n.getContainer(t);e.find(".gapmatch-content .active").trigger("mousedown.commonRenderer"),i(document).off(".commonRenderer"),e.off(".commonRenderer"),e.find(".choice-area").off(".commonRenderer"),e.find(".qti-flow-container").off(".commonRenderer"),p(t),e.find(".gapmatch-content").empty(),e.find(".active").removeClass("active"),e.find(".remove-choice").remove(),e.find(".empty").removeClass("empty")};return{qtiClass:"gapMatchInteraction",template:a,render:h,getContainer:n.getContainer,setResponse:m,getResponse:g,resetResponse:p,destroy:v}}),function(t){var e,i,a="0.4.2",n="hasOwnProperty",r=/[\.\/]/,o="*",s=function(){},c=function(t,e){return t-e},l={n:{}},d=function(t,a){t=String(t);var n,r=i,o=Array.prototype.slice.call(arguments,2),s=d.listeners(t),l=0,h=[],p={},u=[],m=e;e=t,i=0;for(var f=0,g=s.length;g>f;f++)"zIndex"in s[f]&&(h.push(s[f].zIndex),s[f].zIndex<0&&(p[s[f].zIndex]=s[f]));for(h.sort(c);h[l]<0;)if(n=p[h[l++]],u.push(n.apply(a,o)),i)return i=r,u;for(f=0;g>f;f++)if(n=s[f],"zIndex"in n)if(n.zIndex==h[l]){if(u.push(n.apply(a,o)),i)break;do if(l++,n=p[h[l]],n&&u.push(n.apply(a,o)),i)break;while(n)}else p[n.zIndex]=n;else if(u.push(n.apply(a,o)),i)break;return i=r,e=m,u.length?u:null};d._events=l,d.listeners=function(t){var e,i,a,n,s,c,d,h,p=t.split(r),u=l,m=[u],f=[];for(n=0,s=p.length;s>n;n++){for(h=[],c=0,d=m.length;d>c;c++)for(u=m[c].n,i=[u[p[n]],u[o]],a=2;a--;)e=i[a],e&&(h.push(e),f=f.concat(e.f||[]));m=h}return f},d.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var i=t.split(r),a=l,n=0,o=i.length;o>n;n++)a=a.n,a=a.hasOwnProperty(i[n])&&a[i[n]]||(a[i[n]]={n:{}});for(a.f=a.f||[],n=0,o=a.f.length;o>n;n++)if(a.f[n]==e)return s;return a.f.push(e),function(t){+t==+t&&(e.zIndex=+t)}},d.f=function(t){var e=[].slice.call(arguments,1);return function(){d.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},d.stop=function(){i=1},d.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},d.nts=function(){return e.split(r)},d.off=d.unbind=function(t,e){if(!t)return void(d._events=l={n:{}});var i,a,s,c,h,p,u,m=t.split(r),f=[l];for(c=0,h=m.length;h>c;c++)for(p=0;p<f.length;p+=s.length-2){if(s=[p,1],i=f[p].n,m[c]!=o)i[m[c]]&&s.push(i[m[c]]);else for(a in i)i[n](a)&&s.push(i[a]);f.splice.apply(f,s)}for(c=0,h=f.length;h>c;c++)for(i=f[c];i.n;){if(e){if(i.f){for(p=0,u=i.f.length;u>p;p++)if(i.f[p]==e){i.f.splice(p,1);break}!i.f.length&&delete i.f}for(a in i.n)if(i.n[n](a)&&i.n[a].f){var g=i.n[a].f;for(p=0,u=g.length;u>p;p++)if(g[p]==e){g.splice(p,1);break}!g.length&&delete i.n[a].f}}else{delete i.f;for(a in i.n)i.n[n](a)&&i.n[a].f&&delete i.n[a].f}i=i.n}},d.once=function(t,e){var i=function(){return d.unbind(t,i),e.apply(this,arguments)};return d.on(t,i)},d.version=a,d.toString=function(){return"You are running Eve "+a},"undefined"!=typeof module&&module.exports?module.exports=d:"undefined"!=typeof define?define("eve",[],function(){return d}):t.eve=d}(this),function(t,e){"function"==typeof define&&define.amd?define("raphael",["eve"],function(i){return e(t,i)}):e(t,t.eve)}(this,function(t,e){function i(t){if(i.is(t,"function"))return C?t():e.on("raphael.DOMload",t);if(i.is(t,N))return i._engine.create[E](i,t.splice(0,3+i.is(t[0],W))).add(t);var a=Array.prototype.slice.call(arguments,0);if(i.is(a[a.length-1],"function")){var n=a.pop();return C?n.call(i._engine.create[E](i,a)):e.on("raphael.DOMload",function(){n.call(i._engine.create[E](i,a))})}return i._engine.create[E](i,arguments)}function a(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var i in t)t[_](i)&&(e[i]=a(t[i]));return e}function n(t,e){for(var i=0,a=t.length;a>i;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}function r(t,e,i){function a(){var r=Array.prototype.slice.call(arguments,0),o=r.join("␀"),s=a.cache=a.cache||{},c=a.count=a.count||[];return s[_](o)?(n(c,o),i?i(s[o]):s[o]):(c.length>=1e3&&delete s[c.shift()],c.push(o),s[o]=t[E](e,r),i?i(s[o]):s[o])}return a}function o(){return this.hex}function s(t,e){for(var i=[],a=0,n=t.length;n-2*!e>a;a+=2){var r=[{x:+t[a-2],y:+t[a-1]},{x:+t[a],y:+t[a+1]},{x:+t[a+2],y:+t[a+3]},{x:+t[a+4],y:+t[a+5]}];e?a?n-4==a?r[3]={x:+t[0],y:+t[1]}:n-2==a&&(r[2]={x:+t[0],y:+t[1]},r[3]={x:+t[2],y:+t[3]}):r[0]={x:+t[n-2],y:+t[n-1]}:n-4==a?r[3]=r[2]:a||(r[0]={x:+t[a],y:+t[a+1]}),i.push(["C",(-r[0].x+6*r[1].x+r[2].x)/6,(-r[0].y+6*r[1].y+r[2].y)/6,(r[1].x+6*r[2].x-r[3].x)/6,(r[1].y+6*r[2].y-r[3].y)/6,r[2].x,r[2].y])}return i}function c(t,e,i,a,n){var r=-3*e+9*i-9*a+3*n,o=t*r+6*e-12*i+6*a;return t*o-3*e+3*i}function l(t,e,i,a,n,r,o,s,l){null==l&&(l=1),l=l>1?1:0>l?0:l;for(var d=l/2,h=12,p=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],u=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],m=0,f=0;h>f;f++){var g=d*p[f]+d,v=c(g,t,i,n,o),b=c(g,e,a,r,s),I=v*v+b*b;m+=u[f]*D.sqrt(I)}return d*m}function d(t,e,i,a,n,r,o,s,c){if(!(0>c||l(t,e,i,a,n,r,o,s)<c)){var d,h=1,p=h/2,u=h-p,m=.01;for(d=l(t,e,i,a,n,r,o,s,u);L(d-c)>m;)p/=2,u+=(c>d?1:-1)*p,d=l(t,e,i,a,n,r,o,s,u);return u}}function h(t,e,i,a,n,r,o,s){if(!(j(t,i)<z(n,o)||z(t,i)>j(n,o)||j(e,a)<z(r,s)||z(e,a)>j(r,s))){var c=(t*a-e*i)*(n-o)-(t-i)*(n*s-r*o),l=(t*a-e*i)*(r-s)-(e-a)*(n*s-r*o),d=(t-i)*(r-s)-(e-a)*(n-o);if(d){var h=c/d,p=l/d,u=+h.toFixed(2),m=+p.toFixed(2);if(!(u<+z(t,i).toFixed(2)||u>+j(t,i).toFixed(2)||u<+z(n,o).toFixed(2)||u>+j(n,o).toFixed(2)||m<+z(e,a).toFixed(2)||m>+j(e,a).toFixed(2)||m<+z(r,s).toFixed(2)||m>+j(r,s).toFixed(2)))return{x:h,y:p}}}}function p(t,e,a){var n=i.bezierBBox(t),r=i.bezierBBox(e);if(!i.isBBoxIntersect(n,r))return a?0:[];
for(var o=l.apply(0,t),s=l.apply(0,e),c=j(~~(o/5),1),d=j(~~(s/5),1),p=[],u=[],m={},f=a?0:[],g=0;c+1>g;g++){var v=i.findDotsAtSegment.apply(i,t.concat(g/c));p.push({x:v.x,y:v.y,t:g/c})}for(g=0;d+1>g;g++)v=i.findDotsAtSegment.apply(i,e.concat(g/d)),u.push({x:v.x,y:v.y,t:g/d});for(g=0;c>g;g++)for(var b=0;d>b;b++){var I=p[g],C=p[g+1],y=u[b],w=u[b+1],q=L(C.x-I.x)<.001?"y":"x",x=L(w.x-y.x)<.001?"y":"x",_=h(I.x,I.y,C.x,C.y,y.x,y.y,w.x,w.y);if(_){if(m[_.x.toFixed(4)]==_.y.toFixed(4))continue;m[_.x.toFixed(4)]=_.y.toFixed(4);var Q=I.t+L((_[q]-I[q])/(C[q]-I[q]))*(C.t-I.t),k=y.t+L((_[x]-y[x])/(w[x]-y[x]))*(w.t-y.t);Q>=0&&1.001>=Q&&k>=0&&1.001>=k&&(a?f++:f.push({x:_.x,y:_.y,t1:z(Q,1),t2:z(k,1)}))}}return f}function u(t,e,a){t=i._path2curve(t),e=i._path2curve(e);for(var n,r,o,s,c,l,d,h,u,m,f=a?0:[],g=0,v=t.length;v>g;g++){var b=t[g];if("M"==b[0])n=c=b[1],r=l=b[2];else{"C"==b[0]?(u=[n,r].concat(b.slice(1)),n=u[6],r=u[7]):(u=[n,r,n,r,c,l,c,l],n=c,r=l);for(var I=0,C=e.length;C>I;I++){var y=e[I];if("M"==y[0])o=d=y[1],s=h=y[2];else{"C"==y[0]?(m=[o,s].concat(y.slice(1)),o=m[6],s=m[7]):(m=[o,s,o,s,d,h,d,h],o=d,s=h);var w=p(u,m,a);if(a)f+=w;else{for(var q=0,x=w.length;x>q;q++)w[q].segment1=g,w[q].segment2=I,w[q].bez1=u,w[q].bez2=m;f=f.concat(w)}}}}}return f}function m(t,e,i,a,n,r){null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+a,this.e=+n,this.f=+r):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function f(){return this.x+T+this.y+T+this.width+" × "+this.height}function g(t,e,i,a,n,r){function o(t){return((h*t+d)*t+l)*t}function s(t,e){var i=c(t,e);return((m*i+u)*i+p)*i}function c(t,e){var i,a,n,r,s,c;for(n=t,c=0;8>c;c++){if(r=o(n)-t,L(r)<e)return n;if(s=(3*h*n+2*d)*n+l,L(s)<1e-6)break;n-=r/s}if(i=0,a=1,n=t,i>n)return i;if(n>a)return a;for(;a>i;){if(r=o(n),L(r-t)<e)return n;t>r?i=n:a=n,n=(a-i)/2+i}return n}var l=3*e,d=3*(a-e)-l,h=1-l-d,p=3*i,u=3*(n-i)-p,m=1-p-u;return s(t,1/(200*r))}function v(t,e){var i=[],a={};if(this.ms=e,this.times=1,t){for(var n in t)t[_](n)&&(a[K(n)]=t[n],i.push(K(n)));i.sort(he)}this.anim=a,this.top=i[i.length-1],this.percents=i}function b(t,a,n,r,o,s){n=K(n);var c,l,d,h,p,u,f=t.ms,v={},b={},I={};if(r)for(y=0,q=ci.length;q>y;y++){var C=ci[y];if(C.el.id==a.id&&C.anim==t){C.percent!=n?(ci.splice(y,1),d=1):l=C,a.attr(C.totalOrigin);break}}else r=+b;for(var y=0,q=t.percents.length;q>y;y++){if(t.percents[y]==n||t.percents[y]>r*t.top){n=t.percents[y],p=t.percents[y-1]||0,f=f/t.top*(n-p),h=t.percents[y+1],c=t.anim[n];break}r&&a.attr(t.anim[t.percents[y]])}if(c){if(l)l.initstatus=r,l.start=new Date-l.ms*r;else{for(var x in c)if(c[_](x)&&(ae[_](x)||a.paper.customAttributes[_](x)))switch(v[x]=a.attr(x),null==v[x]&&(v[x]=ie[x]),b[x]=c[x],ae[x]){case W:I[x]=(b[x]-v[x])/f;break;case"colour":v[x]=i.getRGB(v[x]);var Q=i.getRGB(b[x]);I[x]={r:(Q.r-v[x].r)/f,g:(Q.g-v[x].g)/f,b:(Q.b-v[x].b)/f};break;case"path":var k=Oe(v[x],b[x]),R=k[1];for(v[x]=k[0],I[x]=[],y=0,q=v[x].length;q>y;y++){I[x][y]=[0];for(var E=1,M=v[x][y].length;M>E;E++)I[x][y][E]=(R[y][E]-v[x][y][E])/f}break;case"transform":var A=a._,T=ze(A[x],b[x]);if(T)for(v[x]=T.from,b[x]=T.to,I[x]=[],I[x].real=!0,y=0,q=v[x].length;q>y;y++)for(I[x][y]=[v[x][y][0]],E=1,M=v[x][y].length;M>E;E++)I[x][y][E]=(b[x][y][E]-v[x][y][E])/f;else{var O=a.matrix||new m,B={_:{transform:A.transform},getBBox:function(){return a.getBBox(1)}};v[x]=[O.a,O.b,O.c,O.d,O.e,O.f],De(B,b[x]),b[x]=B._.transform,I[x]=[(B.matrix.a-O.a)/f,(B.matrix.b-O.b)/f,(B.matrix.c-O.c)/f,(B.matrix.d-O.d)/f,(B.matrix.e-O.e)/f,(B.matrix.f-O.f)/f]}break;case"csv":var F=P(c[x])[$](w),D=P(v[x])[$](w);if("clip-rect"==x)for(v[x]=D,I[x]=[],y=D.length;y--;)I[x][y]=(F[y]-v[x][y])/f;b[x]=F;break;default:for(F=[][S](c[x]),D=[][S](v[x]),I[x]=[],y=a.paper.customAttributes[x].length;y--;)I[x][y]=((F[y]||0)-(D[y]||0))/f}var j=c.easing,z=i.easing_formulas[j];if(!z)if(z=P(j).match(J),z&&5==z.length){var L=z;z=function(t){return g(t,+L[1],+L[2],+L[3],+L[4],f)}}else z=ue;if(u=c.start||t.start||+new Date,C={anim:t,percent:n,timestamp:u,start:u+(t.del||0),status:0,initstatus:r||0,stop:!1,ms:f,easing:z,from:v,diff:I,to:b,el:a,callback:c.callback,prev:p,next:h,repeat:s||t.times,origin:a.attr(),totalOrigin:o},ci.push(C),r&&!l&&!d&&(C.stop=!0,C.start=new Date-f*r,1==ci.length))return di();d&&(C.start=new Date-C.ms*r),1==ci.length&&li(di)}e("raphael.anim.start."+a.id,a,t)}}function I(t){for(var e=0;e<ci.length;e++)ci[e].el.paper==t&&ci.splice(e--,1)}i.version="2.1.0",i.eve=e;var C,y,w=/[, ]+/,q={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},x=/\{(\d+)\}/g,_="hasOwnProperty",Q={doc:document,win:t},k={was:Object.prototype[_].call(Q.win,"Raphael"),is:Q.win.Raphael},R=function(){this.ca=this.customAttributes={}},E="apply",S="concat",M="ontouchstart"in Q.win||Q.win.DocumentTouch&&Q.doc instanceof DocumentTouch,A="",T=" ",P=String,$="split",O="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[$](T),B={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},F=P.prototype.toLowerCase,D=Math,j=D.max,z=D.min,L=D.abs,H=D.pow,G=D.PI,W="number",U="string",N="array",V=Object.prototype.toString,X=(i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},J=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Z=D.round,K=parseFloat,te=parseInt,ee=P.prototype.toUpperCase,ie=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ae=i._availableAnimAttrs={blur:W,"clip-rect":"csv",cx:W,cy:W,fill:"colour","fill-opacity":W,"font-size":W,height:W,opacity:W,path:"path",r:W,rx:W,ry:W,stroke:"colour","stroke-opacity":W,"stroke-width":W,transform:"transform",width:W,x:W,y:W},ne=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,re={hs:1,rg:1},oe=/,?([achlmqrstvxz]),?/gi,se=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ce=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,le=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,de=(i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),he=function(t,e){return K(t)-K(e)},pe=function(){},ue=function(t){return t},me=i._rectPath=function(t,e,i,a,n){return n?[["M",t+n,e],["l",i-2*n,0],["a",n,n,0,0,1,n,n],["l",0,a-2*n],["a",n,n,0,0,1,-n,n],["l",2*n-i,0],["a",n,n,0,0,1,-n,-n],["l",0,2*n-a],["a",n,n,0,0,1,n,-n],["z"]]:[["M",t,e],["l",i,0],["l",0,a],["l",-i,0],["z"]]},fe=function(t,e,i,a){return null==a&&(a=i),[["M",t,e],["m",0,-a],["a",i,a,0,1,1,0,2*a],["a",i,a,0,1,1,0,-2*a],["z"]]},ge=i._getPath={path:function(t){return t.attr("path")},circle:function(t){var e=t.attrs;return fe(e.cx,e.cy,e.r)},ellipse:function(t){var e=t.attrs;return fe(e.cx,e.cy,e.rx,e.ry)},rect:function(t){var e=t.attrs;return me(e.x,e.y,e.width,e.height,e.r)},image:function(t){var e=t.attrs;return me(e.x,e.y,e.width,e.height)},text:function(t){var e=t._getBBox();return me(e.x,e.y,e.width,e.height)},set:function(t){var e=t._getBBox();return me(e.x,e.y,e.width,e.height)}},ve=i.mapPath=function(t,e){if(!e)return t;var i,a,n,r,o,s,c;for(t=Oe(t),n=0,o=t.length;o>n;n++)for(c=t[n],r=1,s=c.length;s>r;r+=2)i=e.x(c[r],c[r+1]),a=e.y(c[r],c[r+1]),c[r]=i,c[r+1]=a;return t};if(i._g=Q,i.type=Q.win.SVGAngle||Q.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==i.type){var be,Ie=Q.doc.createElement("div");if(Ie.innerHTML='<v:shape adj="1"/>',be=Ie.firstChild,be.style.behavior="url(#default#VML)",!be||"object"!=typeof be.adj)return i.type=A;Ie=null}i.svg=!(i.vml="VML"==i.type),i._Paper=R,i.fn=y=R.prototype=i.prototype,i._id=0,i._oid=0,i.is=function(t,e){return e=F.call(e),"finite"==e?!Y[_](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||V.call(t).slice(8,-1).toLowerCase()==e},i.angle=function(t,e,a,n,r,o){if(null==r){var s=t-a,c=e-n;return s||c?(180+180*D.atan2(-c,-s)/G+360)%360:0}return i.angle(t,e,r,o)-i.angle(a,n,r,o)},i.rad=function(t){return t%360*G/180},i.deg=function(t){return 180*t/G%360},i.snapTo=function(t,e,a){if(a=i.is(a,"finite")?a:10,i.is(t,N)){for(var n=t.length;n--;)if(L(t[n]-e)<=a)return t[n]}else{t=+t;var r=e%t;if(a>r)return e-r;if(r>t-a)return e-r+t}return e};i.createUUID=function(t,e){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(t,e).toUpperCase()}}(/[xy]/g,function(t){var e=16*D.random()|0,i="x"==t?e:3&e|8;return i.toString(16)});i.setWindow=function(t){e("raphael.setWindow",i,Q.win,t),Q.win=t,Q.doc=Q.win.document,i._engine.initWin&&i._engine.initWin(Q.win)};var Ce=function(t){if(i.vml){var e,a=/^\s+|\s+$/g;try{var n=new ActiveXObject("htmlfile");n.write("<body>"),n.close(),e=n.body}catch(o){e=createPopup().document.body}var s=e.createTextRange();Ce=r(function(t){try{e.style.color=P(t).replace(a,A);var i=s.queryCommandValue("ForeColor");return i=(255&i)<<16|65280&i|(16711680&i)>>>16,"#"+("000000"+i.toString(16)).slice(-6)}catch(n){return"none"}})}else{var c=Q.doc.createElement("i");c.title="Raphaël Colour Picker",c.style.display="none",Q.doc.body.appendChild(c),Ce=r(function(t){return c.style.color=t,Q.doc.defaultView.getComputedStyle(c,A).getPropertyValue("color")})}return Ce(t)},ye=function(){return"hsb("+[this.h,this.s,this.b]+")"},we=function(){return"hsl("+[this.h,this.s,this.l]+")"},qe=function(){return this.hex},xe=function(t,e,a){if(null==e&&i.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(a=t.b,e=t.g,t=t.r),null==e&&i.is(t,U)){var n=i.getRGB(t);t=n.r,e=n.g,a=n.b}return(t>1||e>1||a>1)&&(t/=255,e/=255,a/=255),[t,e,a]},_e=function(t,e,a,n){t*=255,e*=255,a*=255;var r={r:t,g:e,b:a,hex:i.rgb(t,e,a),toString:qe};return i.is(n,"finite")&&(r.opacity=n),r};i.color=function(t){var e;return i.is(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=i.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):i.is(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=i.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):(i.is(t,"string")&&(t=i.getRGB(t)),i.is(t,"object")&&"r"in t&&"g"in t&&"b"in t?(e=i.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=i.rgb2hsb(t),t.v=e.b):(t={hex:"none"},t.r=t.g=t.b=t.h=t.s=t.v=t.l=-1)),t.toString=qe,t},i.hsb2rgb=function(t,e,i,a){this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,t=t.h,a=t.o),t*=360;var n,r,o,s,c;return t=t%360/60,c=i*e,s=c*(1-L(t%2-1)),n=r=o=i-c,t=~~t,n+=[c,s,0,0,s,c][t],r+=[s,c,c,s,0,0][t],o+=[0,0,s,c,c,s][t],_e(n,r,o,a)},i.hsl2rgb=function(t,e,i,a){this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(t>1||e>1||i>1)&&(t/=360,e/=100,i/=100),t*=360;var n,r,o,s,c;return t=t%360/60,c=2*e*(.5>i?i:1-i),s=c*(1-L(t%2-1)),n=r=o=i-c/2,t=~~t,n+=[c,s,0,0,s,c][t],r+=[s,c,c,s,0,0][t],o+=[0,0,s,c,c,s][t],_e(n,r,o,a)},i.rgb2hsb=function(t,e,i){i=xe(t,e,i),t=i[0],e=i[1],i=i[2];var a,n,r,o;return r=j(t,e,i),o=r-z(t,e,i),a=0==o?null:r==t?(e-i)/o:r==e?(i-t)/o+2:(t-e)/o+4,a=(a+360)%6*60/360,n=0==o?0:o/r,{h:a,s:n,b:r,toString:ye}},i.rgb2hsl=function(t,e,i){i=xe(t,e,i),t=i[0],e=i[1],i=i[2];var a,n,r,o,s,c;return o=j(t,e,i),s=z(t,e,i),c=o-s,a=0==c?null:o==t?(e-i)/c:o==e?(i-t)/c+2:(t-e)/c+4,a=(a+360)%6*60/360,r=(o+s)/2,n=0==c?0:.5>r?c/(2*r):c/(2-2*r),{h:a,s:n,l:r,toString:we}},i._path2string=function(){return this.join(",").replace(oe,"$1")};i._preload=function(t,e){var i=Q.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){e.call(this),this.onload=null,Q.doc.body.removeChild(this)},i.onerror=function(){Q.doc.body.removeChild(this)},Q.doc.body.appendChild(i),i.src=t};i.getRGB=r(function(t){if(!t||(t=P(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:o};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:o};!(re[_](t.toLowerCase().substring(0,2))||"#"==t.charAt())&&(t=Ce(t));var e,a,n,r,s,c,l=t.match(X);return l?(l[2]&&(n=te(l[2].substring(5),16),a=te(l[2].substring(3,5),16),e=te(l[2].substring(1,3),16)),l[3]&&(n=te((s=l[3].charAt(3))+s,16),a=te((s=l[3].charAt(2))+s,16),e=te((s=l[3].charAt(1))+s,16)),l[4]&&(c=l[4][$](ne),e=K(c[0]),"%"==c[0].slice(-1)&&(e*=2.55),a=K(c[1]),"%"==c[1].slice(-1)&&(a*=2.55),n=K(c[2]),"%"==c[2].slice(-1)&&(n*=2.55),"rgba"==l[1].toLowerCase().slice(0,4)&&(r=K(c[3])),c[3]&&"%"==c[3].slice(-1)&&(r/=100)),l[5]?(c=l[5][$](ne),e=K(c[0]),"%"==c[0].slice(-1)&&(e*=2.55),a=K(c[1]),"%"==c[1].slice(-1)&&(a*=2.55),n=K(c[2]),"%"==c[2].slice(-1)&&(n*=2.55),("deg"==c[0].slice(-3)||"°"==c[0].slice(-1))&&(e/=360),"hsba"==l[1].toLowerCase().slice(0,4)&&(r=K(c[3])),c[3]&&"%"==c[3].slice(-1)&&(r/=100),i.hsb2rgb(e,a,n,r)):l[6]?(c=l[6][$](ne),e=K(c[0]),"%"==c[0].slice(-1)&&(e*=2.55),a=K(c[1]),"%"==c[1].slice(-1)&&(a*=2.55),n=K(c[2]),"%"==c[2].slice(-1)&&(n*=2.55),("deg"==c[0].slice(-3)||"°"==c[0].slice(-1))&&(e/=360),"hsla"==l[1].toLowerCase().slice(0,4)&&(r=K(c[3])),c[3]&&"%"==c[3].slice(-1)&&(r/=100),i.hsl2rgb(e,a,n,r)):(l={r:e,g:a,b:n,toString:o},l.hex="#"+(16777216|n|a<<8|e<<16).toString(16).slice(1),i.is(r,"finite")&&(l.opacity=r),l)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:o}},i),i.hsb=r(function(t,e,a){return i.hsb2rgb(t,e,a).hex}),i.hsl=r(function(t,e,a){return i.hsl2rgb(t,e,a).hex}),i.rgb=r(function(t,e,i){return"#"+(16777216|i|e<<8|t<<16).toString(16).slice(1)}),i.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},i=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),i.hex},i.getColor.reset=function(){delete this.start},i.parsePathString=function(t){if(!t)return null;var e=Qe(t);if(e.arr)return Re(e.arr);var a={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},n=[];return i.is(t,N)&&i.is(t[0],N)&&(n=Re(t)),n.length||P(t).replace(se,function(t,e,i){var r=[],o=e.toLowerCase();if(i.replace(le,function(t,e){e&&r.push(+e)}),"m"==o&&r.length>2&&(n.push([e][S](r.splice(0,2))),o="l",e="m"==e?"l":"L"),"r"==o)n.push([e][S](r));else for(;r.length>=a[o]&&(n.push([e][S](r.splice(0,a[o]))),a[o]););}),n.toString=i._path2string,e.arr=Re(n),n},i.parseTransformString=r(function(t){if(!t)return null;var e=[];return i.is(t,N)&&i.is(t[0],N)&&(e=Re(t)),e.length||P(t).replace(ce,function(t,i,a){{var n=[];F.call(i)}a.replace(le,function(t,e){e&&n.push(+e)}),e.push([i][S](n))}),e.toString=i._path2string,e});var Qe=function(t){var e=Qe.ps=Qe.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout(function(){for(var i in e)e[_](i)&&i!=t&&(e[i].sleep--,!e[i].sleep&&delete e[i])}),e[t]};i.findDotsAtSegment=function(t,e,i,a,n,r,o,s,c){var l=1-c,d=H(l,3),h=H(l,2),p=c*c,u=p*c,m=d*t+3*h*c*i+3*l*c*c*n+u*o,f=d*e+3*h*c*a+3*l*c*c*r+u*s,g=t+2*c*(i-t)+p*(n-2*i+t),v=e+2*c*(a-e)+p*(r-2*a+e),b=i+2*c*(n-i)+p*(o-2*n+i),I=a+2*c*(r-a)+p*(s-2*r+a),C=l*t+c*i,y=l*e+c*a,w=l*n+c*o,q=l*r+c*s,x=90-180*D.atan2(g-b,v-I)/G;return(g>b||I>v)&&(x+=180),{x:m,y:f,m:{x:g,y:v},n:{x:b,y:I},start:{x:C,y:y},end:{x:w,y:q},alpha:x}},i.bezierBBox=function(t,e,a,n,r,o,s,c){i.is(t,"array")||(t=[t,e,a,n,r,o,s,c]);var l=$e.apply(null,t);return{x:l.min.x,y:l.min.y,x2:l.max.x,y2:l.max.y,width:l.max.x-l.min.x,height:l.max.y-l.min.y}},i.isPointInsideBBox=function(t,e,i){return e>=t.x&&e<=t.x2&&i>=t.y&&i<=t.y2},i.isBBoxIntersect=function(t,e){var a=i.isPointInsideBBox;return a(e,t.x,t.y)||a(e,t.x2,t.y)||a(e,t.x,t.y2)||a(e,t.x2,t.y2)||a(t,e.x,e.y)||a(t,e.x2,e.y)||a(t,e.x,e.y2)||a(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)},i.pathIntersection=function(t,e){return u(t,e)},i.pathIntersectionNumber=function(t,e){return u(t,e,1)},i.isPointInsidePath=function(t,e,a){var n=i.pathBBox(t);return i.isPointInsideBBox(n,e,a)&&u(t,[["M",e,a],["H",n.x2+10]],1)%2==1},i._removedFactory=function(t){return function(){e("raphael.log",null,"Raphaël: you are calling to method “"+t+"” of removed object",t)}};var ke=i.pathBBox=function(t){var e=Qe(t);if(e.bbox)return a(e.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};t=Oe(t);for(var i,n=0,r=0,o=[],s=[],c=0,l=t.length;l>c;c++)if(i=t[c],"M"==i[0])n=i[1],r=i[2],o.push(n),s.push(r);else{var d=$e(n,r,i[1],i[2],i[3],i[4],i[5],i[6]);o=o[S](d.min.x,d.max.x),s=s[S](d.min.y,d.max.y),n=i[5],r=i[6]}var h=z[E](0,o),p=z[E](0,s),u=j[E](0,o),m=j[E](0,s),f=u-h,g=m-p,v={x:h,y:p,x2:u,y2:m,width:f,height:g,cx:h+f/2,cy:p+g/2};return e.bbox=a(v),v},Re=function(t){var e=a(t);return e.toString=i._path2string,e},Ee=i._pathToRelative=function(t){var e=Qe(t);if(e.rel)return Re(e.rel);i.is(t,N)&&i.is(t&&t[0],N)||(t=i.parsePathString(t));var a=[],n=0,r=0,o=0,s=0,c=0;"M"==t[0][0]&&(n=t[0][1],r=t[0][2],o=n,s=r,c++,a.push(["M",n,r]));for(var l=c,d=t.length;d>l;l++){var h=a[l]=[],p=t[l];if(p[0]!=F.call(p[0]))switch(h[0]=F.call(p[0]),h[0]){case"a":h[1]=p[1],h[2]=p[2],h[3]=p[3],h[4]=p[4],h[5]=p[5],h[6]=+(p[6]-n).toFixed(3),h[7]=+(p[7]-r).toFixed(3);break;case"v":h[1]=+(p[1]-r).toFixed(3);break;case"m":o=p[1],s=p[2];default:for(var u=1,m=p.length;m>u;u++)h[u]=+(p[u]-(u%2?n:r)).toFixed(3)}else{h=a[l]=[],"m"==p[0]&&(o=p[1]+n,s=p[2]+r);for(var f=0,g=p.length;g>f;f++)a[l][f]=p[f]}var v=a[l].length;switch(a[l][0]){case"z":n=o,r=s;break;case"h":n+=+a[l][v-1];break;case"v":r+=+a[l][v-1];break;default:n+=+a[l][v-2],r+=+a[l][v-1]}}return a.toString=i._path2string,e.rel=Re(a),a},Se=i._pathToAbsolute=function(t){var e=Qe(t);if(e.abs)return Re(e.abs);if(i.is(t,N)&&i.is(t&&t[0],N)||(t=i.parsePathString(t)),!t||!t.length)return[["M",0,0]];var a=[],n=0,r=0,o=0,c=0,l=0;"M"==t[0][0]&&(n=+t[0][1],r=+t[0][2],o=n,c=r,l++,a[0]=["M",n,r]);for(var d,h,p=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),u=l,m=t.length;m>u;u++){if(a.push(d=[]),h=t[u],h[0]!=ee.call(h[0]))switch(d[0]=ee.call(h[0]),d[0]){case"A":d[1]=h[1],d[2]=h[2],d[3]=h[3],d[4]=h[4],d[5]=h[5],d[6]=+(h[6]+n),d[7]=+(h[7]+r);break;case"V":d[1]=+h[1]+r;break;case"H":d[1]=+h[1]+n;break;case"R":for(var f=[n,r][S](h.slice(1)),g=2,v=f.length;v>g;g++)f[g]=+f[g]+n,f[++g]=+f[g]+r;a.pop(),a=a[S](s(f,p));break;case"M":o=+h[1]+n,c=+h[2]+r;default:for(g=1,v=h.length;v>g;g++)d[g]=+h[g]+(g%2?n:r)}else if("R"==h[0])f=[n,r][S](h.slice(1)),a.pop(),a=a[S](s(f,p)),d=["R"][S](h.slice(-2));else for(var b=0,I=h.length;I>b;b++)d[b]=h[b];switch(d[0]){case"Z":n=o,r=c;break;case"H":n=d[1];break;case"V":r=d[1];break;case"M":o=d[d.length-2],c=d[d.length-1];default:n=d[d.length-2],r=d[d.length-1]}}return a.toString=i._path2string,e.abs=Re(a),a},Me=function(t,e,i,a){return[t,e,i,a,i,a]},Ae=function(t,e,i,a,n,r){var o=1/3,s=2/3;return[o*t+s*i,o*e+s*a,o*n+s*i,o*r+s*a,n,r]},Te=function(t,e,i,a,n,o,s,c,l,d){var h,p=120*G/180,u=G/180*(+n||0),m=[],f=r(function(t,e,i){var a=t*D.cos(i)-e*D.sin(i),n=t*D.sin(i)+e*D.cos(i);return{x:a,y:n}});if(d)x=d[0],_=d[1],w=d[2],q=d[3];else{h=f(t,e,-u),t=h.x,e=h.y,h=f(c,l,-u),c=h.x,l=h.y;var g=(D.cos(G/180*n),D.sin(G/180*n),(t-c)/2),v=(e-l)/2,b=g*g/(i*i)+v*v/(a*a);b>1&&(b=D.sqrt(b),i=b*i,a=b*a);var I=i*i,C=a*a,y=(o==s?-1:1)*D.sqrt(L((I*C-I*v*v-C*g*g)/(I*v*v+C*g*g))),w=y*i*v/a+(t+c)/2,q=y*-a*g/i+(e+l)/2,x=D.asin(((e-q)/a).toFixed(9)),_=D.asin(((l-q)/a).toFixed(9));x=w>t?G-x:x,_=w>c?G-_:_,0>x&&(x=2*G+x),0>_&&(_=2*G+_),s&&x>_&&(x-=2*G),!s&&_>x&&(_-=2*G)}var Q=_-x;if(L(Q)>p){var k=_,R=c,E=l;_=x+p*(s&&_>x?1:-1),c=w+i*D.cos(_),l=q+a*D.sin(_),m=Te(c,l,i,a,n,0,s,R,E,[_,k,w,q])}Q=_-x;var M=D.cos(x),A=D.sin(x),T=D.cos(_),P=D.sin(_),O=D.tan(Q/4),B=4/3*i*O,F=4/3*a*O,j=[t,e],z=[t+B*A,e-F*M],H=[c+B*P,l-F*T],W=[c,l];if(z[0]=2*j[0]-z[0],z[1]=2*j[1]-z[1],d)return[z,H,W][S](m);m=[z,H,W][S](m).join()[$](",");for(var U=[],N=0,V=m.length;V>N;N++)U[N]=N%2?f(m[N-1],m[N],u).y:f(m[N],m[N+1],u).x;return U},Pe=function(t,e,i,a,n,r,o,s,c){var l=1-c;return{x:H(l,3)*t+3*H(l,2)*c*i+3*l*c*c*n+H(c,3)*o,y:H(l,3)*e+3*H(l,2)*c*a+3*l*c*c*r+H(c,3)*s}},$e=r(function(t,e,i,a,n,r,o,s){var c,l=n-2*i+t-(o-2*n+i),d=2*(i-t)-2*(n-i),h=t-i,p=(-d+D.sqrt(d*d-4*l*h))/2/l,u=(-d-D.sqrt(d*d-4*l*h))/2/l,m=[e,s],f=[t,o];return L(p)>"1e12"&&(p=.5),L(u)>"1e12"&&(u=.5),p>0&&1>p&&(c=Pe(t,e,i,a,n,r,o,s,p),f.push(c.x),m.push(c.y)),u>0&&1>u&&(c=Pe(t,e,i,a,n,r,o,s,u),f.push(c.x),m.push(c.y)),l=r-2*a+e-(s-2*r+a),d=2*(a-e)-2*(r-a),h=e-a,p=(-d+D.sqrt(d*d-4*l*h))/2/l,u=(-d-D.sqrt(d*d-4*l*h))/2/l,L(p)>"1e12"&&(p=.5),L(u)>"1e12"&&(u=.5),p>0&&1>p&&(c=Pe(t,e,i,a,n,r,o,s,p),f.push(c.x),m.push(c.y)),u>0&&1>u&&(c=Pe(t,e,i,a,n,r,o,s,u),f.push(c.x),m.push(c.y)),{min:{x:z[E](0,f),y:z[E](0,m)},max:{x:j[E](0,f),y:j[E](0,m)}}}),Oe=i._path2curve=r(function(t,e){var i=!e&&Qe(t);if(!e&&i.curve)return Re(i.curve);for(var a=Se(t),n=e&&Se(e),r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s=(function(t,e,i){var a,n;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][S](Te[E](0,[e.x,e.y][S](t.slice(1))));break;case"S":"C"==i||"S"==i?(a=2*e.x-e.bx,n=2*e.y-e.by):(a=e.x,n=e.y),t=["C",a,n][S](t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"][S](Ae(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][S](Ae(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][S](Me(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][S](Me(e.x,e.y,t[1],e.y));break;case"V":t=["C"][S](Me(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][S](Me(e.x,e.y,e.X,e.Y))}return t}),c=function(t,e){if(t[e].length>7){t[e].shift();for(var i=t[e];i.length;)t.splice(e++,0,["C"][S](i.splice(0,6)));t.splice(e,1),h=j(a.length,n&&n.length||0)}},l=function(t,e,i,r,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",r.x,r.y]),i.bx=0,i.by=0,i.x=t[o][1],i.y=t[o][2],h=j(a.length,n&&n.length||0))},d=0,h=j(a.length,n&&n.length||0);h>d;d++){a[d]=s(a[d],r),c(a,d),n&&(n[d]=s(n[d],o)),n&&c(n,d),l(a,n,r,o,d),l(n,a,o,r,d);var p=a[d],u=n&&n[d],m=p.length,f=n&&u.length;r.x=p[m-2],r.y=p[m-1],r.bx=K(p[m-4])||r.x,r.by=K(p[m-3])||r.y,o.bx=n&&(K(u[f-4])||o.x),o.by=n&&(K(u[f-3])||o.y),o.x=n&&u[f-2],o.y=n&&u[f-1]}return n||(i.curve=Re(a)),n?[a,n]:a},null,Re),Be=(i._parseDots=r(function(t){for(var e=[],a=0,n=t.length;n>a;a++){var r={},o=t[a].match(/^([^:]*):?([\d\.]*)/);if(r.color=i.getRGB(o[1]),r.color.error)return null;r.color=r.color.hex,o[2]&&(r.offset=o[2]+"%"),e.push(r)}for(a=1,n=e.length-1;n>a;a++)if(!e[a].offset){for(var s=K(e[a-1].offset||0),c=0,l=a+1;n>l;l++)if(e[l].offset){c=e[l].offset;break}c||(c=100,l=n),c=K(c);for(var d=(c-s)/(l-a+1);l>a;a++)s+=d,e[a].offset=s+"%"}return e}),i._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)}),Fe=(i._tofront=function(t,e){e.top!==t&&(Be(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},i._toback=function(t,e){e.bottom!==t&&(Be(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},i._insertafter=function(t,e,i){Be(t,i),e==i.top&&(i.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},i._insertbefore=function(t,e,i){Be(t,i),e==i.bottom&&(i.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},i.toMatrix=function(t,e){var i=ke(t),a={_:{transform:A},getBBox:function(){return i}};return De(a,e),a.matrix}),De=(i.transformPath=function(t,e){return ve(t,Fe(t,e))},i._extractTransform=function(t,e){if(null==e)return t._.transform;e=P(e).replace(/\.{3}|\u2026/g,t._.transform||A);var a=i.parseTransformString(e),n=0,r=0,o=0,s=1,c=1,l=t._,d=new m;if(l.transform=a||[],a)for(var h=0,p=a.length;p>h;h++){var u,f,g,v,b,I=a[h],C=I.length,y=P(I[0]).toLowerCase(),w=I[0]!=y,q=w?d.invert():0;"t"==y&&3==C?w?(u=q.x(0,0),f=q.y(0,0),g=q.x(I[1],I[2]),v=q.y(I[1],I[2]),d.translate(g-u,v-f)):d.translate(I[1],I[2]):"r"==y?2==C?(b=b||t.getBBox(1),d.rotate(I[1],b.x+b.width/2,b.y+b.height/2),n+=I[1]):4==C&&(w?(g=q.x(I[2],I[3]),v=q.y(I[2],I[3]),d.rotate(I[1],g,v)):d.rotate(I[1],I[2],I[3]),n+=I[1]):"s"==y?2==C||3==C?(b=b||t.getBBox(1),d.scale(I[1],I[C-1],b.x+b.width/2,b.y+b.height/2),s*=I[1],c*=I[C-1]):5==C&&(w?(g=q.x(I[3],I[4]),v=q.y(I[3],I[4]),d.scale(I[1],I[2],g,v)):d.scale(I[1],I[2],I[3],I[4]),s*=I[1],c*=I[2]):"m"==y&&7==C&&d.add(I[1],I[2],I[3],I[4],I[5],I[6]),l.dirtyT=1,t.matrix=d}t.matrix=d,l.sx=s,l.sy=c,l.deg=n,l.dx=r=d.e,l.dy=o=d.f,1==s&&1==c&&!n&&l.bbox?(l.bbox.x+=+r,l.bbox.y+=+o):l.dirtyT=1}),je=function(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}},ze=i._equaliseTransform=function(t,e){e=P(e).replace(/\.{3}|\u2026/g,t),t=i.parseTransformString(t)||[],e=i.parseTransformString(e)||[];for(var a,n,r,o,s=j(t.length,e.length),c=[],l=[],d=0;s>d;d++){if(r=t[d]||je(e[d]),o=e[d]||je(r),r[0]!=o[0]||"r"==r[0].toLowerCase()&&(r[2]!=o[2]||r[3]!=o[3])||"s"==r[0].toLowerCase()&&(r[3]!=o[3]||r[4]!=o[4]))return;for(c[d]=[],l[d]=[],a=0,n=j(r.length,o.length);n>a;a++)a in r&&(c[d][a]=r[a]),a in o&&(l[d][a]=o[a])}return{from:c,to:l}};i._getContainer=function(t,e,a,n){var r;return r=null!=n||i.is(t,"object")?t:Q.doc.getElementById(t),null!=r?r.tagName?null==e?{container:r,width:r.style.pixelWidth||r.offsetWidth,height:r.style.pixelHeight||r.offsetHeight}:{container:r,width:e,height:a}:{container:1,x:t,y:e,width:a,height:n}:void 0},i.pathToRelative=Ee,i._engine={},i.path2curve=Oe,i.matrix=function(t,e,i,a,n,r){return new m(t,e,i,a,n,r)},function(t){function e(t){return t[0]*t[0]+t[1]*t[1]}function a(t){var i=D.sqrt(e(t));t[0]&&(t[0]/=i),t[1]&&(t[1]/=i)}t.add=function(t,e,i,a,n,r){var o,s,c,l,d=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],p=[[t,i,n],[e,a,r],[0,0,1]];for(t&&t instanceof m&&(p=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),o=0;3>o;o++)for(s=0;3>s;s++){for(l=0,c=0;3>c;c++)l+=h[o][c]*p[c][s];d[o][s]=l}this.a=d[0][0],this.b=d[1][0],this.c=d[0][1],this.d=d[1][1],this.e=d[0][2],this.f=d[1][2]},t.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new m(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},t.clone=function(){return new m(this.a,this.b,this.c,this.d,this.e,this.f)},t.translate=function(t,e){this.add(1,0,0,1,t,e)},t.scale=function(t,e,i,a){null==e&&(e=t),(i||a)&&this.add(1,0,0,1,i,a),this.add(t,0,0,e,0,0),(i||a)&&this.add(1,0,0,1,-i,-a)},t.rotate=function(t,e,a){t=i.rad(t),e=e||0,a=a||0;var n=+D.cos(t).toFixed(9),r=+D.sin(t).toFixed(9);this.add(n,r,-r,n,e,a),this.add(1,0,0,1,-e,-a)},t.x=function(t,e){return t*this.a+e*this.c+this.e},t.y=function(t,e){return t*this.b+e*this.d+this.f},t.get=function(t){return+this[P.fromCharCode(97+t)].toFixed(4)},t.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},t.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},t.split=function(){var t={};t.dx=this.e,t.dy=this.f;var n=[[this.a,this.c],[this.b,this.d]];t.scalex=D.sqrt(e(n[0])),a(n[0]),t.shear=n[0][0]*n[1][0]+n[0][1]*n[1][1],n[1]=[n[1][0]-n[0][0]*t.shear,n[1][1]-n[0][1]*t.shear],t.scaley=D.sqrt(e(n[1])),a(n[1]),t.shear/=t.scaley;var r=-n[0][1],o=n[1][1];return 0>o?(t.rotate=i.deg(D.acos(o)),0>r&&(t.rotate=360-t.rotate)):t.rotate=i.deg(D.asin(r)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},t.toTransformString=function(t){var e=t||this[$]();return e.isSimple?(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[e.dx,e.dy]:A)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:A)+(e.rotate?"r"+[e.rotate,0,0]:A)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(m.prototype);var Le=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);y.safari="Apple Computer, Inc."==navigator.vendor&&(Le&&Le[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Le&&Le[1]<8?function(){var t=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){t.remove()})}:pe;for(var He=function(){this.returnValue=!1},Ge=function(){return this.originalEvent.preventDefault()},We=function(){this.cancelBubble=!0},Ue=function(){return this.originalEvent.stopPropagation()},Ne=function(t){var e=Q.doc.documentElement.scrollTop||Q.doc.body.scrollTop,i=Q.doc.documentElement.scrollLeft||Q.doc.body.scrollLeft;return{x:t.clientX+i,y:t.clientY+e}},Ve=function(){return Q.doc.addEventListener?function(t,e,i,a){var n=function(t){var e=Ne(t);return i.call(a,t,e.x,e.y)};if(t.addEventListener(e,n,!1),M&&B[e]){var r=function(e){for(var n=Ne(e),r=e,o=0,s=e.targetTouches&&e.targetTouches.length;s>o;o++)if(e.targetTouches[o].target==t){e=e.targetTouches[o],e.originalEvent=r,e.preventDefault=Ge,e.stopPropagation=Ue;break}return i.call(a,e,n.x,n.y)};t.addEventListener(B[e],r,!1)}return function(){return t.removeEventListener(e,n,!1),M&&B[e]&&t.removeEventListener(B[e],n,!1),!0}}:Q.doc.attachEvent?function(t,e,i,a){var n=function(t){t=t||Q.win.event;var e=Q.doc.documentElement.scrollTop||Q.doc.body.scrollTop,n=Q.doc.documentElement.scrollLeft||Q.doc.body.scrollLeft,r=t.clientX+n,o=t.clientY+e;return t.preventDefault=t.preventDefault||He,t.stopPropagation=t.stopPropagation||We,i.call(a,t,r,o)};t.attachEvent("on"+e,n);var r=function(){return t.detachEvent("on"+e,n),!0};return r}:void 0}(),Xe=[],Ye=function(t){for(var i,a=t.clientX,n=t.clientY,r=Q.doc.documentElement.scrollTop||Q.doc.body.scrollTop,o=Q.doc.documentElement.scrollLeft||Q.doc.body.scrollLeft,s=Xe.length;s--;){if(i=Xe[s],M&&t.touches){for(var c,l=t.touches.length;l--;)if(c=t.touches[l],c.identifier==i.el._drag.id){a=c.clientX,n=c.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();
break}}else t.preventDefault();var d,h=i.el.node,p=h.nextSibling,u=h.parentNode,m=h.style.display;Q.win.opera&&u.removeChild(h),h.style.display="none",d=i.el.paper.getElementByPoint(a,n),h.style.display=m,Q.win.opera&&(p?u.insertBefore(h,p):u.appendChild(h)),d&&e("raphael.drag.over."+i.el.id,i.el,d),a+=o,n+=r,e("raphael.drag.move."+i.el.id,i.move_scope||i.el,a-i.el._drag.x,n-i.el._drag.y,a,n,t)}},Je=function(t){i.unmousemove(Ye).unmouseup(Je);for(var a,n=Xe.length;n--;)a=Xe[n],a.el._drag={},e("raphael.drag.end."+a.el.id,a.end_scope||a.start_scope||a.move_scope||a.el,t);Xe=[]},Ze=i.el={},Ke=O.length;Ke--;)!function(t){i[t]=Ze[t]=function(e,a){return i.is(e,"function")&&(this.events=this.events||[],this.events.push({name:t,f:e,unbind:Ve(this.shape||this.node||Q.doc,t,e,a||this)})),this},i["un"+t]=Ze["un"+t]=function(e){for(var a=this.events||[],n=a.length;n--;)a[n].name!=t||!i.is(e,"undefined")&&a[n].f!=e||(a[n].unbind(),a.splice(n,1),!a.length&&delete this.events);return this}}(O[Ke]);Ze.data=function(t,a){var n=de[this.id]=de[this.id]||{};if(0==arguments.length)return n;if(1==arguments.length){if(i.is(t,"object")){for(var r in t)t[_](r)&&this.data(r,t[r]);return this}return e("raphael.data.get."+this.id,this,n[t],t),n[t]}return n[t]=a,e("raphael.data.set."+this.id,this,a,t),this},Ze.removeData=function(t){return null==t?de[this.id]={}:de[this.id]&&delete de[this.id][t],this},Ze.getData=function(){return a(de[this.id]||{})},Ze.hover=function(t,e,i,a){return this.mouseover(t,i).mouseout(e,a||i)},Ze.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var ti=[];Ze.drag=function(t,a,n,r,o,s){function c(c){(c.originalEvent||c).preventDefault();var l=c.clientX,d=c.clientY,h=Q.doc.documentElement.scrollTop||Q.doc.body.scrollTop,p=Q.doc.documentElement.scrollLeft||Q.doc.body.scrollLeft;if(this._drag.id=c.identifier,M&&c.touches)for(var u,m=c.touches.length;m--;)if(u=c.touches[m],this._drag.id=u.identifier,u.identifier==this._drag.id){l=u.clientX,d=u.clientY;break}this._drag.x=l+p,this._drag.y=d+h,!Xe.length&&i.mousemove(Ye).mouseup(Je),Xe.push({el:this,move_scope:r,start_scope:o,end_scope:s}),a&&e.on("raphael.drag.start."+this.id,a),t&&e.on("raphael.drag.move."+this.id,t),n&&e.on("raphael.drag.end."+this.id,n),e("raphael.drag.start."+this.id,o||r||this,c.clientX+p,c.clientY+h,c)}return this._drag={},ti.push({el:this,start:c}),this.mousedown(c),this},Ze.onDragOver=function(t){t?e.on("raphael.drag.over."+this.id,t):e.unbind("raphael.drag.over."+this.id)},Ze.undrag=function(){for(var t=ti.length;t--;)ti[t].el==this&&(this.unmousedown(ti[t].start),ti.splice(t,1),e.unbind("raphael.drag.*."+this.id));!ti.length&&i.unmousemove(Ye).unmouseup(Je),Xe=[]},y.circle=function(t,e,a){var n=i._engine.circle(this,t||0,e||0,a||0);return this.__set__&&this.__set__.push(n),n},y.rect=function(t,e,a,n,r){var o=i._engine.rect(this,t||0,e||0,a||0,n||0,r||0);return this.__set__&&this.__set__.push(o),o},y.ellipse=function(t,e,a,n){var r=i._engine.ellipse(this,t||0,e||0,a||0,n||0);return this.__set__&&this.__set__.push(r),r},y.path=function(t){t&&!i.is(t,U)&&!i.is(t[0],N)&&(t+=A);var e=i._engine.path(i.format[E](i,arguments),this);return this.__set__&&this.__set__.push(e),e},y.image=function(t,e,a,n,r){var o=i._engine.image(this,t||"about:blank",e||0,a||0,n||0,r||0);return this.__set__&&this.__set__.push(o),o},y.text=function(t,e,a){var n=i._engine.text(this,t||0,e||0,P(a));return this.__set__&&this.__set__.push(n),n},y.set=function(t){!i.is(t,"array")&&(t=Array.prototype.splice.call(arguments,0,arguments.length));var e=new pi(t);return this.__set__&&this.__set__.push(e),e.paper=this,e.type="set",e},y.setStart=function(t){this.__set__=t||this.set()},y.setFinish=function(){var t=this.__set__;return delete this.__set__,t},y.setSize=function(t,e){return i._engine.setSize.call(this,t,e)},y.setViewBox=function(t,e,a,n,r){return i._engine.setViewBox.call(this,t,e,a,n,r)},y.top=y.bottom=null,y.raphael=i;var ei=function(t){var e=t.getBoundingClientRect(),i=t.ownerDocument,a=i.body,n=i.documentElement,r=n.clientTop||a.clientTop||0,o=n.clientLeft||a.clientLeft||0,s=e.top+(Q.win.pageYOffset||n.scrollTop||a.scrollTop)-r,c=e.left+(Q.win.pageXOffset||n.scrollLeft||a.scrollLeft)-o;return{y:s,x:c}};y.getElementByPoint=function(t,e){var i=this,a=i.canvas,n=Q.doc.elementFromPoint(t,e);if(Q.win.opera&&"svg"==n.tagName){var r=ei(a),o=a.createSVGRect();o.x=t-r.x,o.y=e-r.y,o.width=o.height=1;var s=a.getIntersectionList(o,null);s.length&&(n=s[s.length-1])}if(!n)return null;for(;n.parentNode&&n!=a.parentNode&&!n.raphael;)n=n.parentNode;return n==i.canvas.parentNode&&(n=a),n=n&&n.raphael?i.getById(n.raphaelid):null},y.getElementsByBBox=function(t){var e=this.set();return this.forEach(function(a){i.isBBoxIntersect(a.getBBox(),t)&&e.push(a)}),e},y.getById=function(t){for(var e=this.bottom;e;){if(e.id==t)return e;e=e.next}return null},y.forEach=function(t,e){for(var i=this.bottom;i;){if(t.call(e,i)===!1)return this;i=i.next}return this},y.getElementsByPoint=function(t,e){var i=this.set();return this.forEach(function(a){a.isPointInside(t,e)&&i.push(a)}),i},Ze.isPointInside=function(t,e){var a=this.realPath=ge[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(a=i.transformPath(a,this.attr("transform"))),i.isPointInsidePath(a,t,e)},Ze.getBBox=function(t){if(this.removed)return{};var e=this._;return t?((e.dirty||!e.bboxwt)&&(this.realPath=ge[this.type](this),e.bboxwt=ke(this.realPath),e.bboxwt.toString=f,e.dirty=0),e.bboxwt):((e.dirty||e.dirtyT||!e.bbox)&&((e.dirty||!this.realPath)&&(e.bboxwt=0,this.realPath=ge[this.type](this)),e.bbox=ke(ve(this.realPath,this.matrix)),e.bbox.toString=f,e.dirty=e.dirtyT=0),e.bbox)},Ze.clone=function(){if(this.removed)return null;var t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},Ze.glow=function(t){if("text"==this.type)return null;t=t||{};var e={width:(t.width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:t.opacity||.5,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},i=e.width/2,a=this.paper,n=a.set(),r=this.realPath||ge[this.type](this);r=this.matrix?ve(r,this.matrix):r;for(var o=1;i+1>o;o++)n.push(a.path(r).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/i*o).toFixed(3),opacity:+(e.opacity/i).toFixed(3)}));return n.insertBefore(this).translate(e.offsetx,e.offsety)};var ii=function(t,e,a,n,r,o,s,c,h){return null==h?l(t,e,a,n,r,o,s,c):i.findDotsAtSegment(t,e,a,n,r,o,s,c,d(t,e,a,n,r,o,s,c,h))},ai=function(t,e){return function(a,n,r){a=Oe(a);for(var o,s,c,l,d,h="",p={},u=0,m=0,f=a.length;f>m;m++){if(c=a[m],"M"==c[0])o=+c[1],s=+c[2];else{if(l=ii(o,s,c[1],c[2],c[3],c[4],c[5],c[6]),u+l>n){if(e&&!p.start){if(d=ii(o,s,c[1],c[2],c[3],c[4],c[5],c[6],n-u),h+=["C"+d.start.x,d.start.y,d.m.x,d.m.y,d.x,d.y],r)return h;p.start=h,h=["M"+d.x,d.y+"C"+d.n.x,d.n.y,d.end.x,d.end.y,c[5],c[6]].join(),u+=l,o=+c[5],s=+c[6];continue}if(!t&&!e)return d=ii(o,s,c[1],c[2],c[3],c[4],c[5],c[6],n-u),{x:d.x,y:d.y,alpha:d.alpha}}u+=l,o=+c[5],s=+c[6]}h+=c.shift()+c}return p.end=h,d=t?u:e?p:i.findDotsAtSegment(o,s,c[0],c[1],c[2],c[3],c[4],c[5],1),d.alpha&&(d={x:d.x,y:d.y,alpha:d.alpha}),d}},ni=ai(1),ri=ai(),oi=ai(0,1);i.getTotalLength=ni,i.getPointAtLength=ri,i.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return oi(t,e).end;var a=oi(t,i,1);return e?oi(a,e).end:a},Ze.getTotalLength=function(){var t=this.getPath();if(t)return this.node.getTotalLength?this.node.getTotalLength():ni(t)},Ze.getPointAtLength=function(t){var e=this.getPath();if(e)return ri(e,t)},Ze.getPath=function(){var t,e=i._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return e&&(t=e(this)),t},Ze.getSubpath=function(t,e){var a=this.getPath();if(a)return i.getSubpath(a,t,e)};var si=i.easing_formulas={linear:function(t){return t},"<":function(t){return H(t,1.7)},">":function(t){return H(t,.48)},"<>":function(t){var e=.48-t/1.04,i=D.sqrt(.1734+e*e),a=i-e,n=H(L(a),1/3)*(0>a?-1:1),r=-i-e,o=H(L(r),1/3)*(0>r?-1:1),s=n+o+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:H(2,-10*t)*D.sin(2*(t-.075)*G/.3)+1},bounce:function(t){var e,i=7.5625,a=2.75;return 1/a>t?e=i*t*t:2/a>t?(t-=1.5/a,e=i*t*t+.75):2.5/a>t?(t-=2.25/a,e=i*t*t+.9375):(t-=2.625/a,e=i*t*t+.984375),e}};si.easeIn=si["ease-in"]=si["<"],si.easeOut=si["ease-out"]=si[">"],si.easeInOut=si["ease-in-out"]=si["<>"],si["back-in"]=si.backIn,si["back-out"]=si.backOut;var ci=[],li=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){setTimeout(t,16)},di=function(){for(var t=+new Date,a=0;a<ci.length;a++){var n=ci[a];if(!n.el.removed&&!n.paused){var r,o,s=t-n.start,c=n.ms,l=n.easing,d=n.from,h=n.diff,p=n.to,u=(n.t,n.el),m={},f={};if(n.initstatus?(s=(n.initstatus*n.anim.top-n.prev)/(n.percent-n.prev)*c,n.status=n.initstatus,delete n.initstatus,n.stop&&ci.splice(a--,1)):n.status=(n.prev+(n.percent-n.prev)*(s/c))/n.anim.top,!(0>s))if(c>s){var g=l(s/c);for(var v in d)if(d[_](v)){switch(ae[v]){case W:r=+d[v]+g*c*h[v];break;case"colour":r="rgb("+[hi(Z(d[v].r+g*c*h[v].r)),hi(Z(d[v].g+g*c*h[v].g)),hi(Z(d[v].b+g*c*h[v].b))].join(",")+")";break;case"path":r=[];for(var I=0,C=d[v].length;C>I;I++){r[I]=[d[v][I][0]];for(var y=1,w=d[v][I].length;w>y;y++)r[I][y]=+d[v][I][y]+g*c*h[v][I][y];r[I]=r[I].join(T)}r=r.join(T);break;case"transform":if(h[v].real)for(r=[],I=0,C=d[v].length;C>I;I++)for(r[I]=[d[v][I][0]],y=1,w=d[v][I].length;w>y;y++)r[I][y]=d[v][I][y]+g*c*h[v][I][y];else{var q=function(t){return+d[v][t]+g*c*h[v][t]};r=[["m",q(0),q(1),q(2),q(3),q(4),q(5)]]}break;case"csv":if("clip-rect"==v)for(r=[],I=4;I--;)r[I]=+d[v][I]+g*c*h[v][I];break;default:var x=[][S](d[v]);for(r=[],I=u.paper.customAttributes[v].length;I--;)r[I]=+x[I]+g*c*h[v][I]}m[v]=r}u.attr(m),function(t,i,a){setTimeout(function(){e("raphael.anim.frame."+t,i,a)})}(u.id,u,n.anim)}else{if(function(t,a,n){setTimeout(function(){e("raphael.anim.frame."+a.id,a,n),e("raphael.anim.finish."+a.id,a,n),i.is(t,"function")&&t.call(a)})}(n.callback,u,n.anim),u.attr(p),ci.splice(a--,1),n.repeat>1&&!n.next){for(o in p)p[_](o)&&(f[o]=n.totalOrigin[o]);n.el.attr(f),b(n.anim,n.el,n.anim.percents[0],null,n.totalOrigin,n.repeat-1)}n.next&&!n.stop&&b(n.anim,n.el,n.next,null,n.totalOrigin,n.repeat)}}}i.svg&&u&&u.paper&&u.paper.safari(),ci.length&&li(di)},hi=function(t){return t>255?255:0>t?0:t};Ze.animateWith=function(t,e,a,n,r,o){var s=this;if(s.removed)return o&&o.call(s),s;var c=a instanceof v?a:i.animation(a,n,r,o);b(c,s,c.percents[0],null,s.attr());for(var l=0,d=ci.length;d>l;l++)if(ci[l].anim==e&&ci[l].el==t){ci[d-1].start=ci[l].start;break}return s},Ze.onAnimation=function(t){return t?e.on("raphael.anim.frame."+this.id,t):e.unbind("raphael.anim.frame."+this.id),this},v.prototype.delay=function(t){var e=new v(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},v.prototype.repeat=function(t){var e=new v(this.anim,this.ms);return e.del=this.del,e.times=D.floor(j(t,0))||1,e},i.animation=function(t,e,a,n){if(t instanceof v)return t;(i.is(a,"function")||!a)&&(n=n||a||null,a=null),t=Object(t),e=+e||0;var r,o,s={};for(o in t)t[_](o)&&K(o)!=o&&K(o)+"%"!=o&&(r=!0,s[o]=t[o]);return r?(a&&(s.easing=a),n&&(s.callback=n),new v({100:s},e)):new v(t,e)},Ze.animate=function(t,e,a,n){var r=this;if(r.removed)return n&&n.call(r),r;var o=t instanceof v?t:i.animation(t,e,a,n);return b(o,r,o.percents[0],null,r.attr()),r},Ze.setTime=function(t,e){return t&&null!=e&&this.status(t,z(e,t.ms)/t.ms),this},Ze.status=function(t,e){var i,a,n=[],r=0;if(null!=e)return b(t,this,-1,z(e,1)),this;for(i=ci.length;i>r;r++)if(a=ci[r],a.el.id==this.id&&(!t||a.anim==t)){if(t)return a.status;n.push({anim:a.anim,status:a.status})}return t?0:n},Ze.pause=function(t){for(var i=0;i<ci.length;i++)ci[i].el.id!=this.id||t&&ci[i].anim!=t||e("raphael.anim.pause."+this.id,this,ci[i].anim)!==!1&&(ci[i].paused=!0);return this},Ze.resume=function(t){for(var i=0;i<ci.length;i++)if(ci[i].el.id==this.id&&(!t||ci[i].anim==t)){var a=ci[i];e("raphael.anim.resume."+this.id,this,a.anim)!==!1&&(delete a.paused,this.status(a.anim,a.status))}return this},Ze.stop=function(t){for(var i=0;i<ci.length;i++)ci[i].el.id!=this.id||t&&ci[i].anim!=t||e("raphael.anim.stop."+this.id,this,ci[i].anim)!==!1&&ci.splice(i--,1);return this},e.on("raphael.remove",I),e.on("raphael.clear",I),Ze.toString=function(){return"Raphaël’s object"};var pi=function(t){if(this.items=[],this.length=0,this.type="set",t)for(var e=0,i=t.length;i>e;e++)!t[e]||t[e].constructor!=Ze.constructor&&t[e].constructor!=pi||(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},ui=pi.prototype;ui.push=function(){for(var t,e,i=0,a=arguments.length;a>i;i++)t=arguments[i],!t||t.constructor!=Ze.constructor&&t.constructor!=pi||(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},ui.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},ui.forEach=function(t,e){for(var i=0,a=this.items.length;a>i;i++)if(t.call(e,this.items[i],i)===!1)return this;return this};for(var mi in Ze)Ze[_](mi)&&(ui[mi]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t][E](i,e)})}}(mi));return ui.attr=function(t,e){if(t&&i.is(t,N)&&i.is(t[0],"object"))for(var a=0,n=t.length;n>a;a++)this.items[a].attr(t[a]);else for(var r=0,o=this.items.length;o>r;r++)this.items[r].attr(t,e);return this},ui.clear=function(){for(;this.length;)this.pop()},ui.splice=function(t,e){t=0>t?j(this.length+t,0):t,e=j(0,z(this.length-t,e));var i,a=[],n=[],r=[];for(i=2;i<arguments.length;i++)r.push(arguments[i]);for(i=0;e>i;i++)n.push(this[t+i]);for(;i<this.length-t;i++)a.push(this[t+i]);var o=r.length;for(i=0;i<o+a.length;i++)this.items[t+i]=this[t+i]=o>i?r[i]:a[i-o];for(i=this.items.length=this.length-=e-o;this[i];)delete this[i++];return new pi(n)},ui.exclude=function(t){for(var e=0,i=this.length;i>e;e++)if(this[e]==t)return this.splice(e,1),!0},ui.animate=function(t,e,a,n){(i.is(a,"function")||!a)&&(n=a||null);var r,o,s=this.items.length,c=s,l=this;if(!s)return this;n&&(o=function(){!--s&&n.call(l)}),a=i.is(a,U)?a:o;var d=i.animation(t,e,a,o);for(r=this.items[--c].animate(d);c--;)this.items[c]&&!this.items[c].removed&&this.items[c].animateWith(r,d,d),this.items[c]&&!this.items[c].removed||s--;return this},ui.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},ui.getBBox=function(){for(var t=[],e=[],i=[],a=[],n=this.items.length;n--;)if(!this.items[n].removed){var r=this.items[n].getBBox();t.push(r.x),e.push(r.y),i.push(r.x+r.width),a.push(r.y+r.height)}return t=z[E](0,t),e=z[E](0,e),i=j[E](0,i),a=j[E](0,a),{x:t,y:e,x2:i,y2:a,width:i-t,height:a-e}},ui.clone=function(t){t=this.paper.set();for(var e=0,i=this.items.length;i>e;e++)t.push(this.items[e].clone());return t},ui.toString=function(){return"Raphaël‘s set"},ui.glow=function(t){var e=this.paper.set();return this.forEach(function(i){var a=i.glow(t);null!=a&&a.forEach(function(t){e.push(t)})}),e},ui.isPointInside=function(t,e){var i=!1;return this.forEach(function(a){return a.isPointInside(t,e)?(console.log("runned"),i=!0,!1):void 0}),i},i.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},i=t.face["font-family"];for(var a in t.face)t.face[_](a)&&(e.face[a]=t.face[a]);if(this.fonts[i]?this.fonts[i].push(e):this.fonts[i]=[e],!t.svg){e.face["units-per-em"]=te(t.face["units-per-em"],10);for(var n in t.glyphs)if(t.glyphs[_](n)){var r=t.glyphs[n];if(e.glyphs[n]={w:r.w,k:{},d:r.d&&"M"+r.d.replace(/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},r.k)for(var o in r.k)r[_](o)&&(e.glyphs[n].k[o]=r.k[o])}}return t},y.getFont=function(t,e,a,n){if(n=n||"normal",a=a||"normal",e=+e||{normal:400,bold:700,lighter:300,bolder:800}[e]||400,i.fonts){var r=i.fonts[t];if(!r){var o=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,A)+"(\\s|$)","i");for(var s in i.fonts)if(i.fonts[_](s)&&o.test(s)){r=i.fonts[s];break}}var c;if(r)for(var l=0,d=r.length;d>l&&(c=r[l],c.face["font-weight"]!=e||c.face["font-style"]!=a&&c.face["font-style"]||c.face["font-stretch"]!=n);l++);return c}},y.print=function(t,e,a,n,r,o,s,c){o=o||"middle",s=j(z(s||0,1),-1),c=j(z(c||1,3),1);var l,d=P(a)[$](A),h=0,p=0,u=A;if(i.is(n,"string")&&(n=this.getFont(n)),n){l=(r||16)/n.face["units-per-em"];for(var m=n.face.bbox[$](w),f=+m[0],g=m[3]-m[1],v=0,b=+m[1]+("baseline"==o?g+ +n.face.descent:g/2),I=0,C=d.length;C>I;I++){if("\n"==d[I])h=0,q=0,p=0,v+=g*c;else{var y=p&&n.glyphs[d[I-1]]||{},q=n.glyphs[d[I]];h+=p?(y.w||n.w)+(y.k&&y.k[d[I]]||0)+n.w*s:0,p=1}q&&q.d&&(u+=i.transformPath(q.d,["t",h*l,v*l,"s",l,l,f,b,"t",(t-f)/l,(e-b)/l]))}}return this.path(u).attr({fill:"#000",stroke:"none"})},y.add=function(t){if(i.is(t,"array"))for(var e,a=this.set(),n=0,r=t.length;r>n;n++)e=t[n]||{},q[_](e.type)&&a.push(this[e.type]().attr(e));return a},i.format=function(t,e){var a=i.is(e,N)?[0][S](e):arguments;return t&&i.is(t,U)&&a.length-1&&(t=t.replace(x,function(t,e){return null==a[++e]?A:a[e]})),t||A},i.fullfill=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(t,i,a){var n=a;return i.replace(e,function(t,e,i,a,r){e=e||a,n&&(e in n&&(n=n[e]),"function"==typeof n&&r&&(n=n()))}),n=(null==n||n==a?t:n)+""};return function(e,a){return String(e).replace(t,function(t,e){return i(t,e,a)})}}(),i.ninja=function(){return k.was?Q.win.Raphael=k.is:delete Raphael,i},i.st=ui,function(t,e,a){function n(){/in/.test(t.readyState)?setTimeout(n,9):i.eve("raphael.DOMload")}null==t.readyState&&t.addEventListener&&(t.addEventListener(e,a=function(){t.removeEventListener(e,a,!1),t.readyState="complete"},!1),t.readyState="loading"),n()}(document,"DOMContentLoaded"),e.on("raphael.DOMload",function(){C=!0}),function(){if(i.svg){var t="hasOwnProperty",e=String,a=parseFloat,n=parseInt,r=Math,o=r.max,s=r.abs,c=r.pow,l=/[, ]+/,d=i.eve,h="",p=" ",u="http://www.w3.org/1999/xlink",m={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},f={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var g=function(a,n){if(n){"string"==typeof a&&(a=g(a));for(var r in n)n[t](r)&&("xlink:"==r.substring(0,6)?a.setAttributeNS(u,r.substring(6),e(n[r])):a.setAttribute(r,e(n[r])))}else a=i._g.doc.createElementNS("http://www.w3.org/2000/svg",a),a.style&&(a.style.webkitTapHighlightColor="rgba(0,0,0,0)");return a},v=function(t,n){var l="linear",d=t.id+n,p=.5,u=.5,m=t.node,f=t.paper,v=m.style,b=i._g.doc.getElementById(d);if(!b){if(n=e(n).replace(i._radial_gradient,function(t,e,i){if(l="radial",e&&i){p=a(e),u=a(i);var n=2*(u>.5)-1;c(p-.5,2)+c(u-.5,2)>.25&&(u=r.sqrt(.25-c(p-.5,2))*n+.5)&&.5!=u&&(u=u.toFixed(5)-1e-5*n)}return h}),n=n.split(/\s*\-\s*/),"linear"==l){var I=n.shift();if(I=-a(I),isNaN(I))return null;var C=[0,0,r.cos(i.rad(I)),r.sin(i.rad(I))],y=1/(o(s(C[2]),s(C[3]))||1);C[2]*=y,C[3]*=y,C[2]<0&&(C[0]=-C[2],C[2]=0),C[3]<0&&(C[1]=-C[3],C[3]=0)}var w=i._parseDots(n);if(!w)return null;if(d=d.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&d!=t.gradient.id&&(f.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){b=g(l+"Gradient",{id:d}),t.gradient=b,g(b,"radial"==l?{fx:p,fy:u}:{x1:C[0],y1:C[1],x2:C[2],y2:C[3],gradientTransform:t.matrix.invert()}),f.defs.appendChild(b);for(var q=0,x=w.length;x>q;q++)b.appendChild(g("stop",{offset:w[q].offset?w[q].offset:q?"100%":"0%","stop-color":w[q].color||"#fff"}))}}return g(m,{fill:"url(#"+d+")",opacity:1,"fill-opacity":1}),v.fill=h,v.opacity=1,v.fillOpacity=1,1},b=function(t){var e=t.getBBox(1);g(t.pattern,{patternTransform:t.matrix.invert()+" translate("+e.x+","+e.y+")"})},I=function(a,n,r){if("path"==a.type){for(var o,s,c,l,d,p=e(n).toLowerCase().split("-"),u=a.paper,v=r?"end":"start",b=a.node,I=a.attrs,C=I["stroke-width"],y=p.length,w="classic",q=3,x=3,_=5;y--;)switch(p[y]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=p[y];break;case"wide":x=5;break;case"narrow":x=2;break;case"long":q=5;break;case"short":q=2}if("open"==w?(q+=2,x+=2,_+=2,c=1,l=r?4:1,d={fill:"none",stroke:I.stroke}):(l=c=q/2,d={fill:I.stroke,stroke:"none"}),a._.arrows?r?(a._.arrows.endPath&&f[a._.arrows.endPath]--,a._.arrows.endMarker&&f[a._.arrows.endMarker]--):(a._.arrows.startPath&&f[a._.arrows.startPath]--,a._.arrows.startMarker&&f[a._.arrows.startMarker]--):a._.arrows={},"none"!=w){var Q="raphael-marker-"+w,k="raphael-marker-"+v+w+q+x;i._g.doc.getElementById(Q)?f[Q]++:(u.defs.appendChild(g(g("path"),{"stroke-linecap":"round",d:m[w],id:Q})),f[Q]=1);var R,E=i._g.doc.getElementById(k);E?(f[k]++,R=E.getElementsByTagName("use")[0]):(E=g(g("marker"),{id:k,markerHeight:x,markerWidth:q,orient:"auto",refX:l,refY:x/2}),R=g(g("use"),{"xlink:href":"#"+Q,transform:(r?"rotate(180 "+q/2+" "+x/2+") ":h)+"scale("+q/_+","+x/_+")","stroke-width":(1/((q/_+x/_)/2)).toFixed(4)}),E.appendChild(R),u.defs.appendChild(E),f[k]=1),g(R,d);var S=c*("diamond"!=w&&"oval"!=w);r?(o=a._.arrows.startdx*C||0,s=i.getTotalLength(I.path)-S*C):(o=S*C,s=i.getTotalLength(I.path)-(a._.arrows.enddx*C||0)),d={},d["marker-"+v]="url(#"+k+")",(s||o)&&(d.d=i.getSubpath(I.path,o,s)),g(b,d),a._.arrows[v+"Path"]=Q,a._.arrows[v+"Marker"]=k,a._.arrows[v+"dx"]=S,a._.arrows[v+"Type"]=w,a._.arrows[v+"String"]=n}else r?(o=a._.arrows.startdx*C||0,s=i.getTotalLength(I.path)-o):(o=0,s=i.getTotalLength(I.path)-(a._.arrows.enddx*C||0)),a._.arrows[v+"Path"]&&g(b,{d:i.getSubpath(I.path,o,s)}),delete a._.arrows[v+"Path"],delete a._.arrows[v+"Marker"],delete a._.arrows[v+"dx"],delete a._.arrows[v+"Type"],delete a._.arrows[v+"String"];for(d in f)if(f[t](d)&&!f[d]){var M=i._g.doc.getElementById(d);M&&M.parentNode.removeChild(M)}}},C={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},y=function(t,i,a){if(i=C[e(i).toLowerCase()]){for(var n=t.attrs["stroke-width"]||"1",r={round:n,square:n,butt:0}[t.attrs["stroke-linecap"]||a["stroke-linecap"]]||0,o=[],s=i.length;s--;)o[s]=i[s]*n+(s%2?1:-1)*r;g(t.node,{"stroke-dasharray":o.join(",")})}},w=function(a,r){var c=a.node,d=a.attrs,p=c.style.visibility;c.style.visibility="hidden";for(var m in r)if(r[t](m)){if(!i._availableAttrs[t](m))continue;var f=r[m];switch(d[m]=f,m){case"blur":a.blur(f);break;case"href":case"title":var C=g("title"),w=i._g.doc.createTextNode(f);C.appendChild(w),c.appendChild(C);break;case"target":var q=c.parentNode;if("a"!=q.tagName.toLowerCase()){var C=g("a");q.insertBefore(C,c),C.appendChild(c),q=C}"target"==m?q.setAttributeNS(u,"show","blank"==f?"new":f):q.setAttributeNS(u,m,f);break;case"cursor":c.style.cursor=f;break;case"transform":a.transform(f);break;case"arrow-start":I(a,f);break;case"arrow-end":I(a,f,1);break;case"clip-rect":var _=e(f).split(l);if(4==_.length){a.clip&&a.clip.parentNode.parentNode.removeChild(a.clip.parentNode);var Q=g("clipPath"),k=g("rect");Q.id=i.createUUID(),g(k,{x:_[0],y:_[1],width:_[2],height:_[3]}),Q.appendChild(k),a.paper.defs.appendChild(Q),g(c,{"clip-path":"url(#"+Q.id+")"}),a.clip=k}if(!f){var R=c.getAttribute("clip-path");if(R){var E=i._g.doc.getElementById(R.replace(/(^url\(#|\)$)/g,h));E&&E.parentNode.removeChild(E),g(c,{"clip-path":h}),delete a.clip}}break;case"path":"path"==a.type&&(g(c,{d:f?d.path=i._pathToAbsolute(f):"M0,0"}),a._.dirty=1,a._.arrows&&("startString"in a._.arrows&&I(a,a._.arrows.startString),"endString"in a._.arrows&&I(a,a._.arrows.endString,1)));break;case"width":if(c.setAttribute(m,f),a._.dirty=1,!d.fx)break;m="x",f=d.x;case"x":d.fx&&(f=-d.x-(d.width||0));case"rx":if("rx"==m&&"rect"==a.type)break;case"cx":c.setAttribute(m,f),a.pattern&&b(a),a._.dirty=1;break;case"height":if(c.setAttribute(m,f),a._.dirty=1,!d.fy)break;m="y",f=d.y;case"y":d.fy&&(f=-d.y-(d.height||0));case"ry":if("ry"==m&&"rect"==a.type)break;case"cy":c.setAttribute(m,f),a.pattern&&b(a),a._.dirty=1;break;case"r":"rect"==a.type?g(c,{rx:f,ry:f}):c.setAttribute(m,f),a._.dirty=1;break;case"src":"image"==a.type&&c.setAttributeNS(u,"href",f);break;case"stroke-width":(1!=a._.sx||1!=a._.sy)&&(f/=o(s(a._.sx),s(a._.sy))||1),a.paper._vbSize&&(f*=a.paper._vbSize),c.setAttribute(m,f),d["stroke-dasharray"]&&y(a,d["stroke-dasharray"],r),a._.arrows&&("startString"in a._.arrows&&I(a,a._.arrows.startString),"endString"in a._.arrows&&I(a,a._.arrows.endString,1));break;case"stroke-dasharray":y(a,f,r);break;case"fill":var S=e(f).match(i._ISURL);if(S){Q=g("pattern");var M=g("image");Q.id=i.createUUID(),g(Q,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),g(M,{x:0,y:0,"xlink:href":S[1]}),Q.appendChild(M),function(t){i._preload(S[1],function(){var e=this.offsetWidth,i=this.offsetHeight;g(t,{width:e,height:i}),g(M,{width:e,height:i}),a.paper.safari()})}(Q),a.paper.defs.appendChild(Q),g(c,{fill:"url(#"+Q.id+")"}),a.pattern=Q,a.pattern&&b(a);break}var A=i.getRGB(f);if(A.error){if(("circle"==a.type||"ellipse"==a.type||"r"!=e(f).charAt())&&v(a,f)){if("opacity"in d||"fill-opacity"in d){var T=i._g.doc.getElementById(c.getAttribute("fill").replace(/^url\(#|\)$/g,h));if(T){var P=T.getElementsByTagName("stop");g(P[P.length-1],{"stop-opacity":("opacity"in d?d.opacity:1)*("fill-opacity"in d?d["fill-opacity"]:1)})}}d.gradient=f,d.fill="none";break}}else delete r.gradient,delete d.gradient,!i.is(d.opacity,"undefined")&&i.is(r.opacity,"undefined")&&g(c,{opacity:d.opacity}),!i.is(d["fill-opacity"],"undefined")&&i.is(r["fill-opacity"],"undefined")&&g(c,{"fill-opacity":d["fill-opacity"]});A[t]("opacity")&&g(c,{"fill-opacity":A.opacity>1?A.opacity/100:A.opacity});case"stroke":A=i.getRGB(f),c.setAttribute(m,A.hex),"stroke"==m&&A[t]("opacity")&&g(c,{"stroke-opacity":A.opacity>1?A.opacity/100:A.opacity}),"stroke"==m&&a._.arrows&&("startString"in a._.arrows&&I(a,a._.arrows.startString),"endString"in a._.arrows&&I(a,a._.arrows.endString,1));break;case"gradient":("circle"==a.type||"ellipse"==a.type||"r"!=e(f).charAt())&&v(a,f);break;case"opacity":d.gradient&&!d[t]("stroke-opacity")&&g(c,{"stroke-opacity":f>1?f/100:f});case"fill-opacity":if(d.gradient){T=i._g.doc.getElementById(c.getAttribute("fill").replace(/^url\(#|\)$/g,h)),T&&(P=T.getElementsByTagName("stop"),g(P[P.length-1],{"stop-opacity":f}));break}default:"font-size"==m&&(f=n(f,10)+"px");var $=m.replace(/(\-.)/g,function(t){return t.substring(1).toUpperCase()});c.style[$]=f,a._.dirty=1,c.setAttribute(m,f)}}x(a,r),c.style.visibility=p},q=1.2,x=function(a,r){if("text"==a.type&&(r[t]("text")||r[t]("font")||r[t]("font-size")||r[t]("x")||r[t]("y"))){var o=a.attrs,s=a.node,c=s.firstChild?n(i._g.doc.defaultView.getComputedStyle(s.firstChild,h).getPropertyValue("font-size"),10):10;if(r[t]("text")){for(o.text=r.text;s.firstChild;)s.removeChild(s.firstChild);for(var l,d=e(r.text).split("\n"),p=[],u=0,m=d.length;m>u;u++)l=g("tspan"),u&&g(l,{dy:c*q,x:o.x}),l.appendChild(i._g.doc.createTextNode(d[u])),s.appendChild(l),p[u]=l}else for(p=s.getElementsByTagName("tspan"),u=0,m=p.length;m>u;u++)u?g(p[u],{dy:c*q,x:o.x}):g(p[0],{dy:0});g(s,{x:o.x,y:o.y}),a._.dirty=1;var f=a._getBBox(),v=o.y-(f.y+f.height/2);v&&i.is(v,"finite")&&g(p[0],{dy:v})}},_=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=i._oid++,t.raphaelid=this.id,this.matrix=i.matrix(),this.realPath=null,this.paper=e,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},Q=i.el;_.prototype=Q,Q.constructor=_,i._engine.path=function(t,e){var i=g("path");e.canvas&&e.canvas.appendChild(i);var a=new _(i,e);return a.type="path",w(a,{fill:"none",stroke:"#000",path:t}),a},Q.rotate=function(t,i,n){if(this.removed)return this;if(t=e(t).split(l),t.length-1&&(i=a(t[1]),n=a(t[2])),t=a(t[0]),null==n&&(i=n),null==i||null==n){var r=this.getBBox(1);i=r.x+r.width/2,n=r.y+r.height/2}return this.transform(this._.transform.concat([["r",t,i,n]])),this},Q.scale=function(t,i,n,r){if(this.removed)return this;if(t=e(t).split(l),t.length-1&&(i=a(t[1]),n=a(t[2]),r=a(t[3])),t=a(t[0]),null==i&&(i=t),null==r&&(n=r),null==n||null==r)var o=this.getBBox(1);return n=null==n?o.x+o.width/2:n,r=null==r?o.y+o.height/2:r,this.transform(this._.transform.concat([["s",t,i,n,r]])),this},Q.translate=function(t,i){return this.removed?this:(t=e(t).split(l),t.length-1&&(i=a(t[1])),t=a(t[0])||0,i=+i||0,this.transform(this._.transform.concat([["t",t,i]])),this)},Q.transform=function(e){var a=this._;if(null==e)return a.transform;if(i._extractTransform(this,e),this.clip&&g(this.clip,{transform:this.matrix.invert()}),this.pattern&&b(this),this.node&&g(this.node,{transform:this.matrix}),1!=a.sx||1!=a.sy){var n=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":n})}return this},Q.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},Q.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},Q.remove=function(){if(!this.removed&&this.node.parentNode){var t=this.paper;t.__set__&&t.__set__.exclude(this),d.unbind("raphael.*.*."+this.id),this.gradient&&t.defs.removeChild(this.gradient),i._tear(this,t),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;this.removed=!0}},Q._getBBox=function(){if("none"==this.node.style.display){this.show();var t=!0}var e={};try{e=this.node.getBBox()}catch(i){}finally{e=e||{}}return t&&this.hide(),e},Q.attr=function(e,a){if(this.removed)return this;if(null==e){var n={};for(var r in this.attrs)this.attrs[t](r)&&(n[r]=this.attrs[r]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==a&&i.is(e,"string")){if("fill"==e&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==e)return this._.transform;for(var o=e.split(l),s={},c=0,h=o.length;h>c;c++)e=o[c],s[e]=e in this.attrs?this.attrs[e]:i.is(this.paper.customAttributes[e],"function")?this.paper.customAttributes[e].def:i._availableAttrs[e];return h-1?s:s[o[0]]}if(null==a&&i.is(e,"array")){for(s={},c=0,h=e.length;h>c;c++)s[e[c]]=this.attr(e[c]);return s}if(null!=a){var p={};p[e]=a}else null!=e&&i.is(e,"object")&&(p=e);for(var u in p)d("raphael.attr."+u+"."+this.id,this,p[u]);for(u in this.paper.customAttributes)if(this.paper.customAttributes[t](u)&&p[t](u)&&i.is(this.paper.customAttributes[u],"function")){var m=this.paper.customAttributes[u].apply(this,[].concat(p[u]));this.attrs[u]=p[u];for(var f in m)m[t](f)&&(p[f]=m[f])}return w(this,p),this},Q.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var t=this.paper;return t.top!=this&&i._tofront(this,t),this},Q.toBack=function(){if(this.removed)return this;var t=this.node.parentNode;"a"==t.tagName.toLowerCase()?t.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):t.firstChild!=this.node&&t.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper);this.paper;return this},Q.insertAfter=function(t){if(this.removed)return this;var e=t.node||t[t.length-1].node;return e.nextSibling?e.parentNode.insertBefore(this.node,e.nextSibling):e.parentNode.appendChild(this.node),i._insertafter(this,t,this.paper),this},Q.insertBefore=function(t){if(this.removed)return this;var e=t.node||t[0].node;return e.parentNode.insertBefore(this.node,e),i._insertbefore(this,t,this.paper),this},Q.blur=function(t){var e=this;
if(0!==+t){var a=g("filter"),n=g("feGaussianBlur");e.attrs.blur=t,a.id=i.createUUID(),g(n,{stdDeviation:+t||1.5}),a.appendChild(n),e.paper.defs.appendChild(a),e._blur=a,g(e.node,{filter:"url(#"+a.id+")"})}else e._blur&&(e._blur.parentNode.removeChild(e._blur),delete e._blur,delete e.attrs.blur),e.node.removeAttribute("filter");return e},i._engine.circle=function(t,e,i,a){var n=g("circle");t.canvas&&t.canvas.appendChild(n);var r=new _(n,t);return r.attrs={cx:e,cy:i,r:a,fill:"none",stroke:"#000"},r.type="circle",g(n,r.attrs),r},i._engine.rect=function(t,e,i,a,n,r){var o=g("rect");t.canvas&&t.canvas.appendChild(o);var s=new _(o,t);return s.attrs={x:e,y:i,width:a,height:n,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"},s.type="rect",g(o,s.attrs),s},i._engine.ellipse=function(t,e,i,a,n){var r=g("ellipse");t.canvas&&t.canvas.appendChild(r);var o=new _(r,t);return o.attrs={cx:e,cy:i,rx:a,ry:n,fill:"none",stroke:"#000"},o.type="ellipse",g(r,o.attrs),o},i._engine.image=function(t,e,i,a,n,r){var o=g("image");g(o,{x:i,y:a,width:n,height:r,preserveAspectRatio:"none"}),o.setAttributeNS(u,"href",e),t.canvas&&t.canvas.appendChild(o);var s=new _(o,t);return s.attrs={x:i,y:a,width:n,height:r,src:e},s.type="image",s},i._engine.text=function(t,e,a,n){var r=g("text");t.canvas&&t.canvas.appendChild(r);var o=new _(r,t);return o.attrs={x:e,y:a,"text-anchor":"middle",text:n,font:i._availableAttrs.font,stroke:"none",fill:"#000"},o.type="text",w(o,o.attrs),o},i._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},i._engine.create=function(){var t=i._getContainer.apply(0,arguments),e=t&&t.container,a=t.x,n=t.y,r=t.width,o=t.height;if(!e)throw new Error("SVG container not found.");var s,c=g("svg"),l="overflow:hidden;";return a=a||0,n=n||0,r=r||512,o=o||342,g(c,{height:o,version:1.1,width:r,xmlns:"http://www.w3.org/2000/svg"}),1==e?(c.style.cssText=l+"position:absolute;left:"+a+"px;top:"+n+"px",i._g.doc.body.appendChild(c),s=1):(c.style.cssText=l+"position:relative",e.firstChild?e.insertBefore(c,e.firstChild):e.appendChild(c)),e=new i._Paper,e.width=r,e.height=o,e.canvas=c,e.clear(),e._left=e._top=0,s&&(e.renderfix=function(){}),e.renderfix(),e},i._engine.setViewBox=function(t,e,i,a,n){d("raphael.setViewBox",this,this._viewBox,[t,e,i,a,n]);var r,s,c=o(i/this.width,a/this.height),l=this.top,h=n?"meet":"xMinYMin";for(null==t?(this._vbSize&&(c=1),delete this._vbSize,r="0 0 "+this.width+p+this.height):(this._vbSize=c,r=t+p+e+p+i+p+a),g(this.canvas,{viewBox:r,preserveAspectRatio:h});c&&l;)s="stroke-width"in l.attrs?l.attrs["stroke-width"]:1,l.attr({"stroke-width":s}),l._.dirty=1,l._.dirtyT=1,l=l.prev;return this._viewBox=[t,e,i,a,!!n],this},i.prototype.renderfix=function(){var t,e=this.canvas,i=e.style;try{t=e.getScreenCTM()||e.createSVGMatrix()}catch(a){t=e.createSVGMatrix()}var n=-t.e%1,r=-t.f%1;(n||r)&&(n&&(this._left=(this._left+n)%1,i.left=this._left+"px"),r&&(this._top=(this._top+r)%1,i.top=this._top+"px"))},i.prototype.clear=function(){i.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=g("desc")).appendChild(i._g.doc.createTextNode("Created with Raphaël "+i.version)),t.appendChild(this.desc),t.appendChild(this.defs=g("defs"))},i.prototype.remove=function(){d("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null};var k=i.st;for(var R in Q)Q[t](R)&&!k[t](R)&&(k[R]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t].apply(i,e)})}}(R))}}(),function(){if(i.vml){var t="hasOwnProperty",e=String,a=parseFloat,n=Math,r=n.round,o=n.max,s=n.min,c=n.abs,l="fill",d=/[, ]+/,h=i.eve,p=" progid:DXImageTransform.Microsoft",u=" ",m="",f={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,b=/-?[^,\s-]+/g,I="position:absolute;left:0;top:0;width:1px;height:1px",C=21600,y={path:1,rect:1,image:1},w={circle:1,ellipse:1},q=function(t){var a=/[ahqstv]/gi,n=i._pathToAbsolute;if(e(t).match(a)&&(n=i._path2curve),a=/[clmz]/g,n==i._pathToAbsolute&&!e(t).match(a)){var o=e(t).replace(g,function(t,e,i){var a=[],n="m"==e.toLowerCase(),o=f[e];return i.replace(b,function(t){n&&2==a.length&&(o+=a+f["m"==e?"l":"L"],a=[]),a.push(r(t*C))}),o+a});return o}var s,c,l=n(t);o=[];for(var d=0,h=l.length;h>d;d++){s=l[d],c=l[d][0].toLowerCase(),"z"==c&&(c="x");for(var p=1,v=s.length;v>p;p++)c+=r(s[p]*C)+(p!=v-1?",":m);o.push(c)}return o.join(u)},x=function(t,e,a){var n=i.matrix();return n.rotate(-t,.5,.5),{dx:n.x(e,a),dy:n.y(e,a)}},_=function(t,e,i,a,n,r){var o=t._,s=t.matrix,d=o.fillpos,h=t.node,p=h.style,m=1,f="",g=C/e,v=C/i;if(p.visibility="hidden",e&&i){if(h.coordsize=c(g)+u+c(v),p.rotation=r*(0>e*i?-1:1),r){var b=x(r,a,n);a=b.dx,n=b.dy}if(0>e&&(f+="x"),0>i&&(f+=" y")&&(m=-1),p.flip=f,h.coordorigin=a*-g+u+n*-v,d||o.fillsize){var I=h.getElementsByTagName(l);I=I&&I[0],h.removeChild(I),d&&(b=x(r,s.x(d[0],d[1]),s.y(d[0],d[1])),I.position=b.dx*m+u+b.dy*m),o.fillsize&&(I.size=o.fillsize[0]*c(e)+u+o.fillsize[1]*c(i)),h.appendChild(I)}p.visibility="visible"}};i.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var Q=function(t,i,a){for(var n=e(i).toLowerCase().split("-"),r=a?"end":"start",o=n.length,s="classic",c="medium",l="medium";o--;)switch(n[o]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":s=n[o];break;case"wide":case"narrow":l=n[o];break;case"long":case"short":c=n[o]}var d=t.node.getElementsByTagName("stroke")[0];d[r+"arrow"]=s,d[r+"arrowlength"]=c,d[r+"arrowwidth"]=l},k=function(n,c){n.attrs=n.attrs||{};var h=n.node,p=n.attrs,f=h.style,g=y[n.type]&&(c.x!=p.x||c.y!=p.y||c.width!=p.width||c.height!=p.height||c.cx!=p.cx||c.cy!=p.cy||c.rx!=p.rx||c.ry!=p.ry||c.r!=p.r),v=w[n.type]&&(p.cx!=c.cx||p.cy!=c.cy||p.r!=c.r||p.rx!=c.rx||p.ry!=c.ry),b=n;for(var I in c)c[t](I)&&(p[I]=c[I]);if(g&&(p.path=i._getPath[n.type](n),n._.dirty=1),c.href&&(h.href=c.href),c.title&&(h.title=c.title),c.target&&(h.target=c.target),c.cursor&&(f.cursor=c.cursor),"blur"in c&&n.blur(c.blur),(c.path&&"path"==n.type||g)&&(h.path=q(~e(p.path).toLowerCase().indexOf("r")?i._pathToAbsolute(p.path):p.path),"image"==n.type&&(n._.fillpos=[p.x,p.y],n._.fillsize=[p.width,p.height],_(n,1,1,0,0,0))),"transform"in c&&n.transform(c.transform),v){var x=+p.cx,k=+p.cy,E=+p.rx||+p.r||0,S=+p.ry||+p.r||0;h.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",r((x-E)*C),r((k-S)*C),r((x+E)*C),r((k+S)*C),r(x*C)),n._.dirty=1}if("clip-rect"in c){var A=e(c["clip-rect"]).split(d);if(4==A.length){A[2]=+A[2]+ +A[0],A[3]=+A[3]+ +A[1];var T=h.clipRect||i._g.doc.createElement("div"),P=T.style;P.clip=i.format("rect({1}px {2}px {3}px {0}px)",A),h.clipRect||(P.position="absolute",P.top=0,P.left=0,P.width=n.paper.width+"px",P.height=n.paper.height+"px",h.parentNode.insertBefore(T,h),T.appendChild(h),h.clipRect=T)}c["clip-rect"]||h.clipRect&&(h.clipRect.style.clip="auto")}if(n.textpath){var $=n.textpath.style;c.font&&($.font=c.font),c["font-family"]&&($.fontFamily='"'+c["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,m)+'"'),c["font-size"]&&($.fontSize=c["font-size"]),c["font-weight"]&&($.fontWeight=c["font-weight"]),c["font-style"]&&($.fontStyle=c["font-style"])}if("arrow-start"in c&&Q(b,c["arrow-start"]),"arrow-end"in c&&Q(b,c["arrow-end"],1),null!=c.opacity||null!=c["stroke-width"]||null!=c.fill||null!=c.src||null!=c.stroke||null!=c["stroke-width"]||null!=c["stroke-opacity"]||null!=c["fill-opacity"]||null!=c["stroke-dasharray"]||null!=c["stroke-miterlimit"]||null!=c["stroke-linejoin"]||null!=c["stroke-linecap"]){var O=h.getElementsByTagName(l),B=!1;if(O=O&&O[0],!O&&(B=O=M(l)),"image"==n.type&&c.src&&(O.src=c.src),c.fill&&(O.on=!0),(null==O.on||"none"==c.fill||null===c.fill)&&(O.on=!1),O.on&&c.fill){var F=e(c.fill).match(i._ISURL);if(F){O.parentNode==h&&h.removeChild(O),O.rotate=!0,O.src=F[1],O.type="tile";var D=n.getBBox(1);O.position=D.x+u+D.y,n._.fillpos=[D.x,D.y],i._preload(F[1],function(){n._.fillsize=[this.offsetWidth,this.offsetHeight]})}else O.color=i.getRGB(c.fill).hex,O.src=m,O.type="solid",i.getRGB(c.fill).error&&(b.type in{circle:1,ellipse:1}||"r"!=e(c.fill).charAt())&&R(b,c.fill,O)&&(p.fill="none",p.gradient=c.fill,O.rotate=!1)}if("fill-opacity"in c||"opacity"in c){var j=((+p["fill-opacity"]+1||2)-1)*((+p.opacity+1||2)-1)*((+i.getRGB(c.fill).o+1||2)-1);j=s(o(j,0),1),O.opacity=j,O.src&&(O.color="none")}h.appendChild(O);var z=h.getElementsByTagName("stroke")&&h.getElementsByTagName("stroke")[0],L=!1;!z&&(L=z=M("stroke")),(c.stroke&&"none"!=c.stroke||c["stroke-width"]||null!=c["stroke-opacity"]||c["stroke-dasharray"]||c["stroke-miterlimit"]||c["stroke-linejoin"]||c["stroke-linecap"])&&(z.on=!0),("none"==c.stroke||null===c.stroke||null==z.on||0==c.stroke||0==c["stroke-width"])&&(z.on=!1);var H=i.getRGB(c.stroke);z.on&&c.stroke&&(z.color=H.hex),j=((+p["stroke-opacity"]+1||2)-1)*((+p.opacity+1||2)-1)*((+H.o+1||2)-1);var G=.75*(a(c["stroke-width"])||1);if(j=s(o(j,0),1),null==c["stroke-width"]&&(G=p["stroke-width"]),c["stroke-width"]&&(z.weight=G),G&&1>G&&(j*=G)&&(z.weight=1),z.opacity=j,c["stroke-linejoin"]&&(z.joinstyle=c["stroke-linejoin"]||"miter"),z.miterlimit=c["stroke-miterlimit"]||8,c["stroke-linecap"]&&(z.endcap="butt"==c["stroke-linecap"]?"flat":"square"==c["stroke-linecap"]?"square":"round"),c["stroke-dasharray"]){var W={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};z.dashstyle=W[t](c["stroke-dasharray"])?W[c["stroke-dasharray"]]:m}L&&h.appendChild(z)}if("text"==b.type){b.paper.canvas.style.display=m;var U=b.paper.span,N=100,V=p.font&&p.font.match(/\d+(?:\.\d*)?(?=px)/);f=U.style,p.font&&(f.font=p.font),p["font-family"]&&(f.fontFamily=p["font-family"]),p["font-weight"]&&(f.fontWeight=p["font-weight"]),p["font-style"]&&(f.fontStyle=p["font-style"]),V=a(p["font-size"]||V&&V[0])||10,f.fontSize=V*N+"px",b.textpath.string&&(U.innerHTML=e(b.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var X=U.getBoundingClientRect();b.W=p.w=(X.right-X.left)/N,b.H=p.h=(X.bottom-X.top)/N,b.X=p.x,b.Y=p.y+b.H/2,("x"in c||"y"in c)&&(b.path.v=i.format("m{0},{1}l{2},{1}",r(p.x*C),r(p.y*C),r(p.x*C)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],J=0,Z=Y.length;Z>J;J++)if(Y[J]in c){b._.dirty=1;break}switch(p["text-anchor"]){case"start":b.textpath.style["v-text-align"]="left",b.bbx=b.W/2;break;case"end":b.textpath.style["v-text-align"]="right",b.bbx=-b.W/2;break;default:b.textpath.style["v-text-align"]="center",b.bbx=0}b.textpath.style["v-text-kern"]=!0}},R=function(t,r,o){t.attrs=t.attrs||{};var s=(t.attrs,Math.pow),c="linear",l=".5 .5";if(t.attrs.gradient=r,r=e(r).replace(i._radial_gradient,function(t,e,i){return c="radial",e&&i&&(e=a(e),i=a(i),s(e-.5,2)+s(i-.5,2)>.25&&(i=n.sqrt(.25-s(e-.5,2))*(2*(i>.5)-1)+.5),l=e+u+i),m}),r=r.split(/\s*\-\s*/),"linear"==c){var d=r.shift();if(d=-a(d),isNaN(d))return null}var h=i._parseDots(r);if(!h)return null;if(t=t.shape||t.node,h.length){t.removeChild(o),o.on=!0,o.method="none",o.color=h[0].color,o.color2=h[h.length-1].color;for(var p=[],f=0,g=h.length;g>f;f++)h[f].offset&&p.push(h[f].offset+u+h[f].color);o.colors=p.length?p.join():"0% "+o.color,"radial"==c?(o.type="gradientTitle",o.focus="100%",o.focussize="0 0",o.focusposition=l,o.angle=0):(o.type="gradient",o.angle=(270-d)%360),t.appendChild(o)}return 1},E=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=i._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=e,this.matrix=i.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},S=i.el;E.prototype=S,S.constructor=E,S.transform=function(t){if(null==t)return this._.transform;var a,n=this.paper._viewBoxShift,r=n?"s"+[n.scale,n.scale]+"-1-1t"+[n.dx,n.dy]:m;n&&(a=t=e(t).replace(/\.{3}|\u2026/g,this._.transform||m)),i._extractTransform(this,r+t);var o,s=this.matrix.clone(),c=this.skew,l=this.node,d=~e(this.attrs.fill).indexOf("-"),h=!e(this.attrs.fill).indexOf("url(");if(s.translate(1,1),h||d||"image"==this.type)if(c.matrix="1 0 0 1",c.offset="0 0",o=s.split(),d&&o.noRotation||!o.isSimple){l.style.filter=s.toFilter();var p=this.getBBox(),f=this.getBBox(1),g=p.x-f.x,v=p.y-f.y;l.coordorigin=g*-C+u+v*-C,_(this,1,1,g,v,0)}else l.style.filter=m,_(this,o.scalex,o.scaley,o.dx,o.dy,o.rotate);else l.style.filter=m,c.matrix=e(s),c.offset=s.offset();return a&&(this._.transform=a),this},S.rotate=function(t,i,n){if(this.removed)return this;if(null!=t){if(t=e(t).split(d),t.length-1&&(i=a(t[1]),n=a(t[2])),t=a(t[0]),null==n&&(i=n),null==i||null==n){var r=this.getBBox(1);i=r.x+r.width/2,n=r.y+r.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",t,i,n]])),this}},S.translate=function(t,i){return this.removed?this:(t=e(t).split(d),t.length-1&&(i=a(t[1])),t=a(t[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=t,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",t,i]])),this)},S.scale=function(t,i,n,r){if(this.removed)return this;if(t=e(t).split(d),t.length-1&&(i=a(t[1]),n=a(t[2]),r=a(t[3]),isNaN(n)&&(n=null),isNaN(r)&&(r=null)),t=a(t[0]),null==i&&(i=t),null==r&&(n=r),null==n||null==r)var o=this.getBBox(1);return n=null==n?o.x+o.width/2:n,r=null==r?o.y+o.height/2:r,this.transform(this._.transform.concat([["s",t,i,n,r]])),this._.dirtyT=1,this},S.hide=function(){return!this.removed&&(this.node.style.display="none"),this},S.show=function(){return!this.removed&&(this.node.style.display=m),this},S._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},S.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),i.eve.unbind("raphael.*.*."+this.id),i._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;this.removed=!0}},S.attr=function(e,a){if(this.removed)return this;if(null==e){var n={};for(var r in this.attrs)this.attrs[t](r)&&(n[r]=this.attrs[r]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==a&&i.is(e,"string")){if(e==l&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var o=e.split(d),s={},c=0,p=o.length;p>c;c++)e=o[c],s[e]=e in this.attrs?this.attrs[e]:i.is(this.paper.customAttributes[e],"function")?this.paper.customAttributes[e].def:i._availableAttrs[e];return p-1?s:s[o[0]]}if(this.attrs&&null==a&&i.is(e,"array")){for(s={},c=0,p=e.length;p>c;c++)s[e[c]]=this.attr(e[c]);return s}var u;null!=a&&(u={},u[e]=a),null==a&&i.is(e,"object")&&(u=e);for(var m in u)h("raphael.attr."+m+"."+this.id,this,u[m]);if(u){for(m in this.paper.customAttributes)if(this.paper.customAttributes[t](m)&&u[t](m)&&i.is(this.paper.customAttributes[m],"function")){var f=this.paper.customAttributes[m].apply(this,[].concat(u[m]));this.attrs[m]=u[m];for(var g in f)f[t](g)&&(u[g]=f[g])}u.text&&"text"==this.type&&(this.textpath.string=u.text),k(this,u)}return this},S.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this},S.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)},S.insertAfter=function(t){return this.removed?this:(t.constructor==i.st.constructor&&(t=t[t.length-1]),t.node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),i._insertafter(this,t,this.paper),this)},S.insertBefore=function(t){return this.removed?this:(t.constructor==i.st.constructor&&(t=t[0]),t.node.parentNode.insertBefore(this.node,t.node),i._insertbefore(this,t,this.paper),this)},S.blur=function(t){var e=this.node.runtimeStyle,a=e.filter;return a=a.replace(v,m),0!==+t?(this.attrs.blur=t,e.filter=a+u+p+".Blur(pixelradius="+(+t||1.5)+")",e.margin=i.format("-{0}px 0 0 -{0}px",r(+t||1.5))):(e.filter=a,e.margin=0,delete this.attrs.blur),this},i._engine.path=function(t,e){var i=M("shape");i.style.cssText=I,i.coordsize=C+u+C,i.coordorigin=e.coordorigin;var a=new E(i,e),n={fill:"none",stroke:"#000"};t&&(n.path=t),a.type="path",a.path=[],a.Path=m,k(a,n),e.canvas.appendChild(i);var r=M("skew");return r.on=!0,i.appendChild(r),a.skew=r,a.transform(m),a},i._engine.rect=function(t,e,a,n,r,o){var s=i._rectPath(e,a,n,r,o),c=t.path(s),l=c.attrs;return c.X=l.x=e,c.Y=l.y=a,c.W=l.width=n,c.H=l.height=r,l.r=o,l.path=s,c.type="rect",c},i._engine.ellipse=function(t,e,i,a,n){{var r=t.path();r.attrs}return r.X=e-a,r.Y=i-n,r.W=2*a,r.H=2*n,r.type="ellipse",k(r,{cx:e,cy:i,rx:a,ry:n}),r},i._engine.circle=function(t,e,i,a){{var n=t.path();n.attrs}return n.X=e-a,n.Y=i-a,n.W=n.H=2*a,n.type="circle",k(n,{cx:e,cy:i,r:a}),n},i._engine.image=function(t,e,a,n,r,o){var s=i._rectPath(a,n,r,o),c=t.path(s).attr({stroke:"none"}),d=c.attrs,h=c.node,p=h.getElementsByTagName(l)[0];return d.src=e,c.X=d.x=a,c.Y=d.y=n,c.W=d.width=r,c.H=d.height=o,d.path=s,c.type="image",p.parentNode==h&&h.removeChild(p),p.rotate=!0,p.src=e,p.type="tile",c._.fillpos=[a,n],c._.fillsize=[r,o],h.appendChild(p),_(c,1,1,0,0,0),c},i._engine.text=function(t,a,n,o){var s=M("shape"),c=M("path"),l=M("textpath");a=a||0,n=n||0,o=o||"",c.v=i.format("m{0},{1}l{2},{1}",r(a*C),r(n*C),r(a*C)+1),c.textpathok=!0,l.string=e(o),l.on=!0,s.style.cssText=I,s.coordsize=C+u+C,s.coordorigin="0 0";var d=new E(s,t),h={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:o};d.shape=s,d.path=c,d.textpath=l,d.type="text",d.attrs.text=e(o),d.attrs.x=a,d.attrs.y=n,d.attrs.w=1,d.attrs.h=1,k(d,h),s.appendChild(l),s.appendChild(c),t.canvas.appendChild(s);var p=M("skew");return p.on=!0,s.appendChild(p),d.skew=p,d.transform(m),d},i._engine.setSize=function(t,e){var a=this.canvas.style;return this.width=t,this.height=e,t==+t&&(t+="px"),e==+e&&(e+="px"),a.width=t,a.height=e,a.clip="rect(0 "+t+" "+e+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this},i._engine.setViewBox=function(t,e,a,n,r){i.eve("raphael.setViewBox",this,this._viewBox,[t,e,a,n,r]);var s,c,l=this.width,d=this.height,h=1/o(a/l,n/d);return r&&(s=d/n,c=l/a,l>a*s&&(t-=(l-a*s)/2/s),d>n*c&&(e-=(d-n*c)/2/c)),this._viewBox=[t,e,a,n,!!r],this._viewBoxShift={dx:-t,dy:-e,scale:h},this.forEach(function(t){t.transform("...")}),this};var M;i._engine.initWin=function(t){var e=t.document;e.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!e.namespaces.rvml&&e.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),M=function(t){return e.createElement("<rvml:"+t+' class="rvml">')}}catch(i){M=function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},i._engine.initWin(i._g.win),i._engine.create=function(){var t=i._getContainer.apply(0,arguments),e=t.container,a=t.height,n=t.width,r=t.x,o=t.y;if(!e)throw new Error("VML container not found.");var s=new i._Paper,c=s.canvas=i._g.doc.createElement("div"),l=c.style;return r=r||0,o=o||0,n=n||512,a=a||342,s.width=n,s.height=a,n==+n&&(n+="px"),a==+a&&(a+="px"),s.coordsize=1e3*C+u+1e3*C,s.coordorigin="0 0",s.span=i._g.doc.createElement("span"),s.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",c.appendChild(s.span),l.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",n,a),1==e?(i._g.doc.body.appendChild(c),l.left=r+"px",l.top=o+"px",l.position="absolute"):e.firstChild?e.insertBefore(c,e.firstChild):e.appendChild(c),s.renderfix=function(){},s},i.prototype.clear=function(){i.eve("raphael.clear",this),this.canvas.innerHTML=m,this.span=i._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},i.prototype.remove=function(){i.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;return!0};var A=i.st;for(var T in S)S[t](T)&&!A[t](T)&&(A[T]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t].apply(i,e)})}}(T))}}(),k.was?Q.win.Raphael=i:Raphael=i,i}),define("scale.raphael",["jquery","raphael"],function(t,e){var i=function(i,a,n){var r=i.style?i:document.getElementById(i);r.style.position||(r.style.position="relative"),r.style.width=a+"px",r.style.height=n+"px";var o;"VML"===e.type?(r.innerHTML="<rvml:group style='position : absolute; width: 1000px; height: 1000px; top: 0px; left: 0px' coordsize='1000,1000' class='rvml'></rvml:group>",o=t(".rvml",t(r))[0]):(r.innerHTML="<div class='svggroup'></div>",o=t(".svggroup",t(r))[0]);var s,c=new e(o,a,n);return"SVG"===e.type?c.canvas.setAttribute("viewBox","0 0 "+a+" "+n):s=r.getElementsByTagName("div")[0],c.changeSize=function(t,i,l,d){d=!d;var h=t/a,p=i/n,u=p>h?h:p,m=parseInt(n*u),f=parseInt(a*u);if("VML"===e.type){var g=document.getElementsByTagName("textpath");for(var v in g){var b=g[v];if(b.style){if(!b._fontSize){var I=b.style.font.split("px");b._fontSize=parseInt(I[0]),b._font=I[1]}b.style.font=b._fontSize*u+"px"+b._font}}var C;C=m>f?1e3*f/a:1e3*m/n,C=parseInt(C),o.style.width=C+"px",o.style.height=C+"px",d&&(o.style.left=parseInt((t-f)/2)+"px",o.style.top=parseInt((i-m)/2)+"px"),s.style.overflow="visible"}d&&(f=t,m=i),r.style.width=f+"px",r.style.height=m+"px",c.setSize(f,m),l&&(r.style.position="absolute",r.style.left=parseInt((t-f)/2)+"px",r.style.top=parseInt((i-m)/2)+"px")},c.scaleAll=function(t){c.changeSize(a*t,n*t)},c.changeSize(a,n),c.w=a,c.h=n,c};return i}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicAssociateInteraction clearfix '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===l?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json",function(){return{basic:{stroke:"#8D949E","stroke-width":2,"stroke-dasharray":"","stroke-linejoin":"round",fill:"#cccccc","fill-opacity":.5,cursor:"pointer"},hover:{stroke:"#3E7DA7",fill:"#0E5D91","fill-opacity":.3},selectable:{"stroke-dasharray":"-",stroke:"#3E7DA7",fill:"#cccccc","fill-opacity":.5},active:{stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91","fill-opacity":.5},error:{stroke:"#C74155","stroke-dasharray":"","fill-opacity":.5,fill:"#661728"},success:{stroke:"#C74155","stroke-dasharray":"",fill:"#0E914B","fill-opacity":.5},layer:{fill:"#ffffff",opacity:0,cursor:"pointer"},creator:{"fill-opacity":.5,stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91",cursor:"pointer"},"imageset-rect-stroke":{fill:"#ffffff",stroke:"#666666","stroke-width":1,"stroke-linejoin":"round",cursor:"pointer"},"imageset-rect-no-stroke":{fill:"#ffffff",stroke:"#ffffff","stroke-width":2,"stroke-linejoin":"round",cursor:"pointer"},"imageset-img":{cursor:"pointer"},"order-text":{fill:"#ffffff",stroke:"#000000","stroke-width":.7,"font-family":"sans-serif","font-weight":"bold","font-size":22,cursor:"pointer"},"score-text-default":{stroke:"#444444","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"score-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"small-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":16,cursor:"pointer"},"layer-pos-text":{stroke:"#333","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":14},target:{path:"m 18,8.4143672 -1.882582,0 C 15.801891,4.9747852 13.071059,2.2344961 9.63508,1.9026738 L 9.63508,0 8.2305176,0 l 0,1.9026387 C 4.7947148,2.2343027 2.0637246,4.9746621 1.7481973,8.4143672 l -1.7481973,0 0,1.4045625 1.754877,0 c 0.3460429,3.4066753 3.0632871,6.1119843 6.4756406,6.4413813 l 0,1.739689 1.4045624,0 0,-1.739725 c 3.412547,-0.329537 6.129633,-3.034793 6.475641,-6.4413453 l 1.889279,0 z m -8.36492,6.5188648 0,-4.064673 -1.4045624,0 0,4.063882 C 5.5511016,14.612555 3.4232695,12.494619 3.0864551,9.8189297 l 4.0449512,0 0,-1.4045625 -4.0546368,0 C 3.3788672,5.6984941 5.5228887,3.5393379 8.2305176,3.2161113 l 0,3.9153125 1.4045624,0 0,-3.9160859 c 2.711162,0.3203965 4.858576,2.4808887 5.160955,5.1990293 l -3.927441,0 0,1.4045625 3.917773,0 C 14.449289,12.496957 12.318363,14.616158 9.63508,14.933232 z",fill:"#0E914B",width:1,"stroke-width":0,cursor:"pointer"},"target-hover":{fill:"#3E7DA7","fill-opacity":1},"target-success":{fill:"#0E914B","fill-opacity":1},assoc:{"stroke-width":2,"stroke-linecap":"round",cursor:"pointer"},"assoc-layer":{"stroke-width":12,cursor:"pointer","stroke-opacity":0},"assoc-bullet":{fill:"#000000"},close:{path:"m 8.9997236,18.000001 c -4.9703918,0 -8.99972284217367,-4.02901 -8.99972284217367,-9 C 7.5782633e-7,4.029011 4.0293108,9.8531742e-7 8.9997236,9.8531742e-7 13.970691,9.8531742e-7 18.000001,4.029011 18.000001,9.000001 c 0,4.97099 -4.02931,9 -9.0002774,9 z m 0.0045,-16.37151 c -4.06191,0 -7.35492,3.29635 -7.35492,7.36251 0,4.06562 3.292989,7.36255 7.35492,7.36255 4.0630384,0 7.3554334,-3.29693 7.3554334,-7.36255 0,-4.06614 -3.292969,-7.36251 -7.3554334,-7.36251 v 0 z m 3.1314894,9.31167 -1.953823,-1.94014 1.953843,-1.94018 c 0.08964,-0.089 0.134622,-0.19099 0.135073,-0.30584 4.31e-4,-0.11488 -0.04383,-0.21712 -0.132838,-0.30681 l -0.54267,-0.54685 c -0.08898,-0.0897 -0.190903,-0.13473 -0.305719,-0.13514 -0.114837,-4.4e-4 -0.217064,0.0439 -0.306703,0.1329 l -1.9623724,1.94865 -1.962395,-1.94865 c -0.08964,-0.089 -0.191845,-0.13336 -0.306702,-0.1329 -0.114837,4.3e-4 -0.216736,0.0455 -0.305719,0.13514 l -0.54265,0.54685 c -0.08902,0.0897 -0.133269,0.19193 -0.132838,0.30681 4.3e-4,0.11485 0.04543,0.21681 0.135073,0.30584 l 1.953823,1.94018 -1.953782,1.94014 c -0.0896,0.089 -0.134684,0.19094 -0.135114,0.3058 -4.31e-4,0.11486 0.04386,0.21716 0.132838,0.30681 l 0.542671,0.54687 c 0.08896,0.0897 0.190923,0.13467 0.305718,0.13516 0.114857,3.9e-4 0.217105,-0.0439 0.306724,-0.13288 l 1.962332,-1.94863 1.9623324,1.94863 c 0.08962,0.089 0.191886,0.13323 0.306744,0.13288 0.114836,-4.5e-4 0.216736,-0.0455 0.305698,-0.13516 l 0.542691,-0.54687 c 0.089,-0.0897 0.133227,-0.19193 0.132838,-0.30681 -3.9e-4,-0.1149 -0.0455,-0.21683 -0.135073,-0.3058 z",fill:"#0E5D91",width:1,opacity:0,"stroke-width":0,cursor:"pointer"},"close-bg":{fill:"#ffffff",stroke:"none",cursor:"pointer",opacity:0},"touch-circle":{fill:"none",stroke:"#3E7DA7","stroke-width":2}}}),define("taoQtiItem/qtiCommonRenderer/helpers/Graphic",["jquery","lodash","raphael","scale.raphael","json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json"],function(t,e,i,a,n){var r={"default":"rect",poly:"path"},o={rect:4,ellipse:4,circle:3,poly:6,"default":0},s={rect:function(t){return[t[0],t[1],t[2]-t[0],t[3]-t[1]]},"default":function(t){return[0,0,t.width,t.height]},poly:function(t){var e,i=t.length;for(t[0]!==t[i-2]&&t[1]!==t[i-1]&&(t.push(t[0]),t.push(t[1])),t[0]="M"+t[0],e=1;i>e;e++)e%2===0&&(t[e]="L"+t[e]);return[t.join(" ")]}},c={rect:function(t){return[t.x,t.y,t.x+t.width,t.y+t.height]},circle:function(t){return[t.cx,t.cy,t.r]},ellipse:function(t){return[t.cx,t.cy,t.rx,t.ry]},"default":function(t){return this.rect(t)},path:function(t){var i,a=[];if(e.isArray(t.path))for(i=1;i<t.path.length;i++)3===t.path[i].length&&(a.push(t.path[i][1]),a.push(t.path[i][2]));return a}},l={_style:n,setStyle:function(t,e){t&&n[e]&&t.attr(n[e])},responsivePaper:function(n,r,o){function s(t,e){t&&t.stopPropagation();var i=1,a=h.outerWidth()-h.width()+(d.outerWidth()-d.width())+1,n=p.width(),r=d.innerWidth();(r>0||e>0)&&(!e&&d.children(".image-sidebar").length&&(a+=d.children(".image-sidebar").outerWidth(!0)),r>e&&n>e?r=e-a:r>n?r=n-a:r-=a,d.hasClass("responsive")?(i=r/m,c.changeSize(r,f*i,!1,!1),c.scaleAll(i)):c.changeSize(r,f,!1,!1),"function"==typeof o.resize&&o.resize(r,i),d.trigger("resized.qti-widget"))}var c,l,d=o.container||t("#"+n).parent(),h=t(".image-editor",d),p=d.closest(".qti-itemBody"),u="SVG"===i.type?a:i,m=o.width||d.innerWidth(),f=o.height||d.innerHeight(),g=e.throttle(s,10);return c=u.call(null,n,m,f),l=c.image(o.img,0,0,m,f),o.imgId&&(l.id=o.imgId),t(l.node).attr("externalResourcesRequired","true").on("load",function(){s()}),"SVG"===i.type?(s(),t(window).on("resize.qti-widget."+r,g),t(document).on("customcssloaded.styleeditor",function(){e.delay(g,200)}),d.on("resize.qti-widget."+r,function(t,e){g(t,e)})):(c.canvas.setAttribute("viewBox","0 0 "+m+" "+f),d.find(".main-image-box").width(m),"function"==typeof o.resize&&o.resize(m,1)),c},createElement:function(t,e,i,a){var o,s=this,c=r[e]?t[r[e]]:t[e],l=a.qtiCoords!==!1?s.raphaelCoords(t,e,i):i;if("function"!=typeof c)throw new Error("Unable to find method "+e+" on paper");return o=c.apply(t,l),o&&(a.id&&(o.id=a.id),a.title&&o.attr("title",a.title),o.attr(n[a.style||"basic"]).toFront(),a.hover!==!1&&o.hover(function(){o.flashing||s.updateElementState(this,"hover")},function(){o.flashing||s.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")}),a.touchEffect!==!1&&o.touchstart(function(){s.createTouchCircle(t,o.getBBox())})),o},createTarget:function(t,i){var a=this;i=i||{};var r,o=i.point||{x:0,y:0},s=18,c=t.w&&t.width?t.width/t.w:1,l=1!==c?Math.floor(18/c)+1:s,d=l/2,h=o.x>=d?o.x-d:0,p=o.y>=d?o.y-d:0,u="undefined"==typeof i.hover?!0:!!i.hover,m=t.path(n.target.path).transform("T"+h+","+p+"s"+l/s).attr(n.target).attr("title",e("Click again to remove"));if(i.id)m.id=i.id;else{var f=0;t.forEach(function(t){t.data("target")&&f++}),m.id="target-"+f}r=m.getBBox();var g=t.rect(r.x,r.y,r.width,r.height).attr(n.layer).click(function(){var t=m.id,a=this.data("point");e.isFunction(i.select)&&i.select(m,a,this),e.isFunction(i.remove)&&(this.remove(),m.remove(),i.remove(t,a))});return u&&g.hover(function(){m.flashing||a.setStyle(m,"target-hover")},function(){m.flashing||a.setStyle(m,"target-success")}),g.id="layer-"+m.id,g.data("point",o),m.data("target",o),e.isFunction(i.create)&&i.create(m),m},raphaelCoords:function(t,i,a){var n;if(e.isString(a)&&(a=e.map(a.split(","),function(t){return parseInt(t,10)})),!e.isArray(a)||a.length<o[i])throw new Error("Invalid coords "+JSON.stringify(a)+"  for type "+i);switch(i){case"rect":n=s.rect(a);break;case"default":n=s["default"].call(null,t);break;case"poly":n=s.poly(a);break;default:n=a}return n},qtiCoords:function(t){var i=c[t.type],a="";
return e.isFunction(i)&&(a=e.map(i.call(c,t.attr()),function(t){return e.parseInt(t)}).join(",")),a},createTouchCircle:function(t,i){var a=i.width>i.height?i.width:i.height,r=t.circle(i.x+i.width/2,i.y+i.height/2,a);r.attr(n["touch-circle"]),e.defer(function(){r.animate({r:a+5,opacity:.7},300,function(){r.remove()})})},createText:function(t,e){var i,a,r=e.top||0,o=e.left||0,s=e.content||"",c=e.style||"small-text",l=e.title||"",d=1;t.width&&t.w&&(d=t.width/t.w);var h=t.text(o,r,s).toFront();return e.id&&(h.id=e.id),e.hide&&h.hide(),h.attr(n[c]),"undefined"!=typeof d&&1!==d&&(i=parseInt(h.attr("font-size"),10),a=Math.floor(i/d)+1,h.attr("font-size",a)),l&&this.updateTitle(h,l),h},createShapeText:function(t,i,a){var n=this,r=i.getBBox(),o=this.createText(t,e.merge({left:r.x+r.width/2,top:r.y+r.height/2},a));return a.shapeClick&&o.click(function(){n.trigger(i,"click")}),o},createBorderedImage:function(t,e){var a=e.padding>=0?e.padding:6,r=a/2,o=e.left,s=e.top,c=e.width+a,l=e.height+a,d=e.left+r,h=e.top+r,p=e.width,u=e.height,m=t.set(),f=t.rect(o,s,c,l).attr(e.border?n["imageset-rect-stroke"]:n["imageset-rect-no-stroke"]),g=t.image(e.url,d,h,p,u).attr(n["imageset-img"]);return e.shadow&&m.push(f.glow({width:2,offsetx:1,offsety:1})),m.push(f,g),m.move=function(t,e,a){var n=i.animation({x:t,y:e},a||400),o=f.animate(n);return g.animateWith(o,n,{x:t+r,y:e+r},a||400),m},m},updateElementState:function(t,e,i){t&&t.animate&&(t.animate(n[e],200,"linear",function(){t.attr(n[e])}),i&&this.updateTitle(t,i))},updateTitle:function(t,i){t&&t.node&&(e.forEach(t.node.children,function(e){"title"===e.nodeName.toLowerCase()&&t.node.removeChild(e)}),t.attr("title",i))},highlightError:function(t,i){var a=this;t&&(t.flashing=!0,a.updateElementState(t,"error"),e.delay(function(){a.updateElementState(t,i||"basic"),t.flashing=!1},800))},trigger:function(t,i){var a=e.where(t.events,{name:i});a.length&&a[0]&&"function"==typeof a[0].f&&a[0].f.apply(t,Array.prototype.slice.call(arguments,2))},getPoint:function(t,e,i,a){var n,r,o,s=this.clickPoint(i,t);return e.w&&e.w!==e.width&&(a?(o=e.w/e.width,s.x=Math.round(s.x*o),s.y=Math.round(s.y*o)):e.width>e.w?(n=(e.width-e.w)/2,s.x=Math.round(s.x-n)):(o=e.w/e.width,s.x=Math.round(s.x*o),r=(e.height-e.height*(2-o))/2,s.y=Math.round(s.y*o-r))),s},position:function(t,e){var i=parseInt(e.w||e.width,10),a=parseInt(t.width(),10),n=parseInt(e.w||e.width,10),r=parseInt(t.height(),10);return{left:(a-i)/2,top:(r-n)/2}},clickPoint:function(t,e){var i,a,n=t.offset();return e.pageX||e.pageY?(i=e.pageX-n.left,a=e.pageY-n.top):(e.clientX||e.clientY)&&(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-n.left,a=e.clientY+document.body.scrollTop+document.documentElement.scrollTop-n.top),{x:i,y:a}}};return l}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",["jquery","lodash","i18n","raphael","scale.raphael","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,a,n,r,o,s,c){var l=function(i){{var a=c.getContainer(i),n=i.object.attributes,r=this.getOption("baseUrl")||"";t(".main-image-box",a)}i._vsets=[],i.paper=o.responsivePaper("graphic-paper-"+i.serial,i.serial,{width:n.width,height:n.height,img:r+n.data,imgId:"bg-image-"+i.serial,container:a}),e.forEach(i.getChoices(),e.partial(d,i)),h(i),c.minMaxChoiceInstructions(i,{min:i.attr("minAssociations"),max:i.attr("maxAssociations"),getResponse:v,onError:function(t){t&&t.target&&o.highlightError(t.target)}})},d=function(t,a){{var n=a.attr("shape"),r=a.attr("coords"),s=t.attr("maxAssociations");o.createElement(t.paper,n,r,{id:a.serial,title:i("Select this area to start an association")}).data("max",a.attr("matchMax")).data("matching",0).removeData("assocs").click(function(){var n,r,l=this;return s>0&&v(t).length>=s?(f(t),void c.validateInstructions(t,{choice:a,target:this})):(this.selectable?(n=p(t),n&&(n.data("matching",n.data("matching")+1),this.data("matching",this.data("matching")+1),r=n.data("assocs")||[],r.push(a.id()),n.data("assocs",r),u(t,n,this,function(){n.data("matching",n.data("matching")-1),l.data("matching",l.data("matching")-1),n.data("assocs",e.remove(n.data("assocs")||[],a.id())),c.triggerResponseChangeEvent(t),c.validateInstructions(t,{choice:a,target:l})})),f(t)):this.active?(o.updateElementState(this,"basic",i("Select another area to complete the association")),this.active=!1,f(t)):g(this)&&(o.updateElementState(this,"active",i("Select this area to start an association")),this.active=!0,m(t,this)),c.triggerResponseChangeEvent(t),void c.validateInstructions(t,{choice:a,target:this}))})}},h=function(t){var e=c.getContainer(t),i=t.paper.getById("bg-image-"+t.serial);i&&i.click(function(){f(t),e.trigger("unselect.graphicassociate")})},p=function(t){var i;return e.forEach(t.getChoices(),function(e){var a=t.paper.getById(e.serial);return a&&a.active===!0?(i=a,!1):void 0}),i},u=function(t,i,a,n){function r(){q.toFront().animate({opacity:.8},300).click(l),x.toFront().animate({opacity:1},300).click(l)}function s(){q&&q.type&&(q.animate({opacity:0},300,function(){q.toBack()}).unclick(),x.animate({opacity:0},300,function(){x.toBack()}).unclick())}function l(){e.invoke(h,"remove"),t._vsets=e.without(t._vsets,h),"function"==typeof n&&n()}var d=c.getContainer(t),h=[],p=i.getBBox(),u=p.x+p.width/2,m=p.y+p.height/2,f=a.getBBox(),g=f.x+f.width/2,v=f.y+f.height/2,b=t.paper.circle(u,m,3).attr(o._style["assoc-bullet"]),I=t.paper.circle(g,v,3).attr(o._style["assoc-bullet"]),C=t.paper.path("M"+u+","+m+"L"+u+","+m).attr(o._style.assoc).animate({path:"M"+u+","+m+"L"+g+","+v},300),y=t.paper.path("M"+u+","+m+"L"+g+","+v).attr(o._style["assoc-layer"]),w=y.getPointAtLength(y.getTotalLength()/2),q=t.paper.circle(w.x,w.y,9).attr(o._style["close-bg"]).toBack(),x=t.paper.path(o._style.close.path).attr(o._style.close).transform("T"+(w.x-9)+","+(w.y-9)).attr("title",e("Click again to remove")).toBack();i.toFront(),a.toFront(),h=[b,C,I,y,q,x],t._vsets.push(h),e.invoke(h,"data","assoc-path",!0),y.click(function(){0===x.attrs.opacity?r():s()}),d.on("unselect.graphicassociate",function(){s()})},m=function(t,i){var a=i.data("assocs")||[];e.forEach(t.getChoices(),function(n){var r;e.contains(a,n.id())||(r=t.paper.getById(n.serial),!r.active&&r.id!==i.id&&g(r,i)&&(r.selectable=!0,o.updateElementState(r,"selectable")))})},f=function(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&(i.selectable=!1,i.active=!1,o.updateElementState(i,"basic"))})},g=function(t){var e,i,a=!1;return t&&(i=t.data("max")||0,e=t.data("matching")||0,a=0===i||i>e),a},v=function(t){var i=[];return e.forEach(t.getChoices(),function(a){var n=t.paper.getById(a.serial),r=n.data("assocs");n&&r&&(i=i.concat(e.map(r,function(t){return[a.id(),t]})))}),i},b=function(t,i){var a;if(i&&t.paper){try{a=s.unserialize(i,t)}catch(n){}if(e.isArray(a)){var r=e.transform(t.getChoices(),function(e,i){e[i.id()]=t.paper.getById(i.serial)});e.forEach(a,function(t){var i,a;e.isArray(t)&&2===t.length&&(i=r[t[0]],a=r[t[1]],i&&a&&(o.trigger(i,"click"),o.trigger(a,"click")))})}}},I=function(t){var i=[];e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&i.data({max:e.attr("matchMax"),matching:0,assocs:[]})}),t.paper.forEach(function(t){t.data("assoc-path")&&i.push(t)}),e.invoke(i,"remove")},C=function(t){var e=(v(t),s.serialize(v(t),t));return e},y=function(e){var i;e.paper&&(i=c.getContainer(e),t(window).off("resize.qti-widget."+e.serial),i.off("resize.qti-widget."+e.serial),e.paper.clear(),c.removeInstructions(e),i.off(".graphicassociate"),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"),t("ul",i).empty())};return{qtiClass:"graphicAssociateInteraction",template:r,render:l,getContainer:c.getContainer,setResponse:b,getResponse:C,resetResponse:I,destroy:y}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===h?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function o(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h="function",p=this.escapeExpression,u=this,m=i.blockHelperMissing;return d+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicGapMatchInteraction '+p((s=e&&e.attributes,s=null==s||s===!1?s:s["class"],typeof s===h?s.apply(e):s))+' clearfix" data-serial="',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===h?c.call(e,{hash:{},data:n}):c),d+=p(s)+'">\n    ',s=i["if"].call(e,e&&e.prompt,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===h?c.call(e,{hash:{},data:n}):c),d+=p(s)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing solid horizontal source">\n            ',l={hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n},(c=i.gapImgs)?s=c.call(e,l):(c=e&&e.gapImgs,s=typeof c===h?c.call(e,l):c),i.gapImgs||(s=m.call(e,s,{hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n})),(s||0===s)&&(d+=s),d+="\n        </ul>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,a,n,r,o){var s=function(i){var a=o.getContainer(i),r=t("ul.source",a),s=(t(".main-image-box",a),i.object.attributes),h=this.getOption("baseUrl")||"";i.gapFillers=[],i.paper=n.responsivePaper("graphic-paper-"+i.serial,i.serial,{width:s.width,height:s.height,img:h+s.data,imgId:"bg-image-"+i.serial,container:a,resize:function(e,i){r.css("max-width",e+"px"),1!==i&&r.find("img").each(function(){var e=t(this);e.width(e.attr("width")*i),e.height(e.attr("height")*i)})}}),e.forEach(i.getChoices(),e.partial(c,i)),l(i,r),d(i)},c=function(t,e){n.createElement(t.paper,e.attr("shape"),e.attr("coords"),{id:e.serial,title:i("Select an image first"),hover:!1}).data("max",e.attr("matchMax")).data("matching",[]).click(function(){m(this)&&this.selectable===!0&&h(t,this)})},l=function(e,i){i.children("li").click(function(a){a.preventDefault();var n=t(this);n.hasClass("disabled")||(n.hasClass("active")?(n.removeClass("active"),u(e)):(i.children("li").removeClass("active"),n.addClass("active"),p(e)))})},d=function(e){var i=o.getContainer(e),a=t("ul > li",i),n=e.paper.getById("bg-image-"+e.serial);n&&n.click(function(){u(e),a.removeClass("active")})},h=function(i,a,r){var s,c,l,d,h,p,m,f,g;"undefined"==typeof r&&(r=!0);var v=o.getContainer(i),b=t("ul",v),I=b.find(".active:first"),C=t(".main-image-box",v),y=C.offset();I.length&&(d=I.data("identifier"),f=a.data("matching")||[],f.push(d),a.data("matching",f),g=f.length,s=I.find("img"),u(i),b.children().removeClass("active"),c=s.clone(),p=t(a.node).offset(),m=I.offset(),c.css({position:"absolute",display:"block","z-index":1e4,opacity:.8,top:m.top-y.top,left:m.left-y.left}),c.appendTo(C),c.animate({top:p.top-y.top,left:p.left-y.left},400,function(){c.remove(),h=a.getBBox(),l=n.createBorderedImage(i.paper,{url:s.attr("src"),left:h.x+3*(g-1),top:h.y+3*(g-1),width:parseInt(s.attr("width"),10),height:parseInt(s.attr("height"),10),padding:0,border:!1,shadow:!0}).data("identifier",d).toFront().unclick().click(function(t){t.preventDefault(),t.stopPropagation(),b.find(".active").length>0?n.trigger(a,"click"):(a.data("matching",e.without(a.data("matching")||[],this.data("identifier"))),i.gapFillers=e.without(i.gapFillers,l),l.remove(),o.triggerResponseChangeEvent(i))}),i.gapFillers.push(l),o.triggerResponseChangeEvent(i)}))},p=function(t){var a=i("Select the area to add an image");e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);m(i)&&(i.selectable=!0,n.updateElementState(i,"selectable",a))}),e.forEach(t.gapFillers,function(t){t.forEach(function(t){n.updateTitle(t,a)})})},u=function(t){e.forEach(t.getChoices(),function(e){var a=t.paper.getById(e.serial);a&&(a.selectable=!1,n.updateElementState(a,"basic",i("Select an image first")))}),e.forEach(t.gapFillers,function(t){t.forEach(function(t){n.updateTitle(t,i("Remove"))})})},m=function(t){var e,i,a=!1;return t&&(i=t.data("max")||0,e=t.data("matching")||[],a=0===i||i>e.length),a},f=function(t){var i=[];return e.forEach(t.getChoices(),function(a){var n=t.paper.getById(a.serial);n&&e.isArray(n.data("matching"))&&e.forEach(n.data("matching"),function(t){i.push([a.id(),t])})}),i},g=function(i,a){var n,s=o.getContainer(i);if(a&&i.paper){try{n=r.unserialize(a,i)}catch(c){}e.isArray(n)&&e.forEach(i.getChoices(),function(a){var r=i.paper.getById(a.serial);r&&e.forEach(n,function(n){var o=e.indexOf(n,a.id());o>-1&&2===n.length&&(t("[data-identifier="+n[0===o?1:0]+"]",s).addClass("active"),h(i,r,!1))})})}},v=function(t){o.getContainer(t);u(t),e.forEach(t.gapFillers,function(t){n.trigger(t.items[0],"click")})},b=function(t){var e=(f(t),r.serialize(f(t),t));return e},I=function(e){var i;e.paper&&(i=o.getContainer(e),t(window).off("resize.qti-widget."+e.serial),i.off("resize.qti-widget."+e.serial),e.paper.clear(),o.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"),t("ul",i).empty())};return{qtiClass:"graphicGapMatchInteraction",template:a,render:s,getContainer:o.getContainer,setResponse:g,getResponse:b,resetResponse:v,destroy:I}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicOrderInteraction clearfix '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===l?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing solid horizontal ordinals"></ul>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",["jquery","lodash","i18n","raphael","scale.raphael","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,a,n,r,o,s,c){var l=function(i){var a=c.getContainer(i),n=t("ul",a),r=i.object.attributes,s=this.getOption("baseUrl")||"";i.paper=o.responsivePaper("graphic-paper-"+i.serial,i.serial,{width:r.width,height:r.height,img:s+r.data,imgId:"bg-image-"+i.serial,container:a}),h(i,n),e.forEach(i.getChoices(),e.partial(d,i,n)),c.minMaxChoiceInstructions(i,{min:i.attr("minChoices"),max:i.attr("maxChoices"),getResponse:v,onError:function(t){o.highlightError(t.target)}})},d=function(t,e,a){o.createElement(t.paper,a.attr("shape"),a.attr("coords"),{id:a.serial,title:i("Select this area")}).click(function(){this.active?u(t.paper,this,e):p(t.paper,this,e),c.triggerResponseChangeEvent(t),c.validateInstructions(t,{choice:a})})},h=function(i,a){var n,r=e.size(i.getChoices()),o=i.attr("minChoices"),s=i.attr("maxChoices");s>0&&r>s?r=s:o>0&&r>o&&(r=o),e.times(r,function(e){var i=e+1,n=t('<li class="selectable" data-number="'+i+'">'+i+"</li>");0===e&&n.addClass("active"),a.append(n)}),m(i.paper,r,a),n=a.children("li"),n.click(function(e){e.preventDefault();var i=t(this);i.hasClass("active")||i.hasClass("disabled")||(n.removeClass("active"),i.addClass("active"))})},p=function(t,e,i){var a=i.find(".active:first");a.length&&a.data("number")>0&&(e.data("number",a.data("number")),e.active=!0,f(t,e),o.updateElementState(e,"active"),a.toggleClass("active disabled").siblings(":not(.disabled)").first().toggleClass("active"))},u=function(t,e,i){var a=e.data("number");e.active=!1,g(t,e),e.removeData("number"),o.updateElementState(e,"basic"),i.children().removeClass("active").filter("[data-number="+a+"]").removeClass("disabled").addClass("active")},m=function(t,a){var n=[];return e.times(a,function(a){var r=a+1,s=o.createText(t,{id:"text-"+r,content:r,title:i("Remove"),style:"order-text",hide:!0});s.click(function(){t.forEach(function(t){if(t.data("number")===r&&t.events){var i=e.where(t.events,{name:"click"});i.length&&i[0]&&"function"==typeof i[0].f&&i[0].f.call(t)}})}),n.push(s)}),n},f=function(t,e){var i,a=e.getBBox(),n=t.getById("text-"+e.data("number"));n&&(i="T"+(a.x+a.width/2)+","+(a.y+a.height/2),n.transform(i).show().toFront())},g=function(t,e){var i=t.getById("text-"+e.data("number"));i&&i.hide()},v=function(t){var i=[];return e.forEach(t.getChoices(),function(e){var a=t.paper.getById(e.serial);a&&a.data("number")&&i.push({index:a.data("number"),id:e.id()})}),e(i).sortBy("index").map("id").value()},b=function(i,a){var n,r=c.getContainer(i),o=t("ul",r);if(a&&i.paper){try{n=s.unserialize(a,i)}catch(l){}e.isArray(n)&&e.forEach(n,function(t,a){var n,r=a+1,s=e(i.getChoices()).where({attributes:{identifier:t}}).first();s&&(n=i.paper.getById(s.serial),n&&(o.children("[data-number="+r+"]").addClass("active"),p(i.paper,n,o)))})}},I=function(i){var a=c.getContainer(i),n=t("ul",a);e.forEach(i.getChoices(),function(t){var e=i.paper.getById(t.serial);e&&u(i.paper,e,n)}),n.children("li").removeClass("active disabled").first().addClass("active")},C=function(t){return s.serialize(v(t),t)},y=function(e){var i;e.paper&&(i=c.getContainer(e),t(window).off("resize.qti-widget."+e.serial),i.off("resize.qti-widget."+e.serial),e.paper.clear(),c.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"),t("ul",i).empty())};return{qtiClass:"graphicOrderInteraction",template:r,render:l,getContainer:c.getContainer,setResponse:b,getResponse:C,resetResponse:I,destroy:y}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-hotspotInteraction clearfix '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===l?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",["jquery","lodash","i18n","raphael","scale.raphael","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,a,n,r,o,s,c){var l=function(t){var a=c.getContainer(t),n=t.object.attributes,r=this.getOption("baseUrl")||"";t.paper=o.responsivePaper("graphic-paper-"+t.serial,t.serial,{width:n.width,height:n.height,img:r+n.data,container:a}),e.forEach(t.getChoices(),e.partial(d,t)),c.minMaxChoiceInstructions(t,{min:t.attr("minChoices"),max:t.attr("maxChoices"),getResponse:h,onError:function(e){e.target.active&&(e.target.active=!1,o.updateElementState(this,"basic",i("Select this area")),o.highlightError(e.target),c.triggerResponseChangeEvent(t),a.trigger("inactiveChoice.qti-widget",[e.choice,e.target]))}})},d=function(t,e){{var a=c.getContainer(t);o.createElement(t.paper,e.attr("shape"),e.attr("coords"),{id:e.serial,title:i("Select this area")}).click(function(){this.active?(o.updateElementState(this,"basic",i("Select this area")),this.active=!1,a.trigger("inactiveChoice.qti-widget",[e,this])):(o.updateElementState(this,"active",i("Click again to remove")),this.active=!0,a.trigger("activeChoice.qti-widget",[e,this])),c.triggerResponseChangeEvent(t),c.validateInstructions(t,{choice:e,target:this})})}},h=function(t){return e(t.getChoices()).map(function(e){var i=t.paper.getById(e.serial);return i&&i.active===!0?e.id():!1}).filter(e.isString).value()},p=function(t,a){var n;if(a&&t.paper){try{n=s.unserialize(a,t)}catch(r){}e.isArray(n)&&e.forEach(t.getChoices(),function(a){var r;e.contains(n,a.attributes.identifier)&&(r=t.paper.getById(a.serial),r&&(r.active=!0,o.updateElementState(r,"active",i("Click again to remove")),c.validateInstructions(t,{choice:a,target:r})))})}},u=function(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&(i.active=!1,o.updateElementState(i,"basic"))}),c.resetInstructions(t)},m=function(t){var e=(h(t),s.serialize(h(t),t));return e},f=function(e){var i;e.paper&&(i=c.getContainer(e),t(window).off("resize.qti-widget."+e.serial),i.off("resize.qti-widget."+e.serial),e.paper.clear(),c.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"))};return{qtiClass:"hotspotInteraction",template:r,render:l,getContainer:c.getContainer,setResponse:p,getResponse:m,resetResponse:u,destroy:f}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div id="'+d((o=e&&e.attributes,o=null==o||o===!1?o:o.identifier,typeof o===l?o.apply(e):o))+'" class="qti-interaction qti-blockInteraction qti-hottextInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" data-qti-class="hottextInteraction">\n  ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n  <div class="instruction-container"></div>\n  <div class="qti-flow-container">',(s=i.body)?o=s.call(e,{hash:{},data:n}):(s=e&&e.body,o=typeof s===l?s.call(e,{hash:{},data:n}):s),(o||0===o)&&(c+=o),c+="</div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n"],function(t,e,i,a,n){var r=function(i){var n=function(e,i){var n=e.find("input");if(n.prop("checked")||n.hasClass("disabled"))n.prop("checked",!1);else{var r=parseInt(i.attr("maxChoices")),o=t.values(l(i)).length;(r>o||0===r)&&n.prop("checked",!0)}a.triggerResponseChangeEvent(i),a.validateInstructions(i,{choice:e})};a.getContainer(i).find(".hottext").on("click",function(t){t.preventDefault(),n(e(this),i)})},o=function(t){r(t),a.minMaxChoiceInstructions(t,{min:t.attr("minChoices"),max:t.attr("maxChoices"),getResponse:l,onError:function(t){var e,i,a;t.choice&&t.choice.length&&(i=t.choice.addClass("error"),e=i.find("input"),a=i.find(" > label > span").addClass("error cross"),setTimeout(function(){e.prop("checked",!1),i.removeClass("error"),a.removeClass("error cross")},350))}})},s=function(t){a.getContainer(t).find("input").prop("checked",!1)},c=function(e,i){var r=a.getContainer(e);try{t.each(n.unserialize(i,e),function(t){r.find("input[value="+t+"]").prop("checked",!0)}),a.validateInstructions(e)}catch(o){throw new Error("wrong response format in argument : "+o)}},l=function(t){var i=[];return a.getContainer(t).find("input:checked").each(function(){i.push(e(this).val())}),i},d=function(t){return n.serialize(l(t),t)},h=function(t){var e=a.getContainer(t);s(t),e.find(".hottext").off("click")};return{qtiClass:"hottextInteraction",template:i,render:o,getContainer:a.getContainer,setResponse:c,getResponse:d,resetResponse:s,destroy:h}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e;return e=typeof t===d?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d="function",h=this.escapeExpression,p=this,u=i.blockHelperMissing;return l+='<select class="qti-interaction qti-inlineInteraction qti-inlineChoiceInteraction" \n        data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===d?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" \n        data-qti-class="inlineChoiceInteraction" \n        data-has-search="false">\n    <option></option>\n    <option value="empty"></option>\n    ',c={hash:{},inverse:p.noop,fn:p.program(1,r,n),data:n},(s=i.choices)?o=s.call(e,c):(s=e&&e.choices,o=typeof s===d?s.call(e,c):s),i.choices||(o=u.call(e,o,{hash:{},inverse:p.noop,fn:p.program(1,r,n),data:n})),(o||0===o)&&(l+=o),l+="\n</select>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","select2","tooltipster"],function(t,e,i,a,n){var r="empty",o={allowEmpty:!0,placeholderText:n("select a choice")},s=function(e,a){var s=t.clone(o),l=!!e.attr("required");t.extend(s,a);var d=i.getContainer(e);s.allowEmpty&&!l?d.find("option[value="+r+"]").text("--- "+n("leave empty")+" ---"):d.find("option[value="+r+"]").remove(),d.select2({width:"resolve",placeholder:s.placeholderText,minimumResultsForSearch:-1});var h=d.select2("container");c(e),d.on("change",function(){l&&""!==d.val()&&h.tooltipster("hide"),i.triggerResponseChangeEvent(e)}),l&&d.on("select2-open",function(){h.tooltipster("hide")}).on("select2-close",function(){""===d.val()&&h.tooltipster("show")})},c=function(t){var e=!!t.attr("required"),i=t.getContainer(),a=i.select2("container");e&&(a.tooltipster({theme:"tao-warning-tooltip",content:n("A choice must be selected"),delay:250,trigger:"custom"}),""===i.val()&&a.tooltipster("show"))},l=function(t){d(t,r)},d=function(t,e){i.getContainer(t).val(e).select2("val",e).change()},h=function(t,e){d(t,a.unserialize(e,t)[0])},p=function(t){var e=i.getContainer(t).val();return e&&e!==r?[e]:[]},u=function(t){return a.serialize(p(t),t)};return{qtiClass:"inlineChoiceInteraction",template:e,render:s,getContainer:i.getContainer,setResponse:h,getResponse:u,resetResponse:l}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===u?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function o(t){var e;return e=typeof t===u?t.apply(t):t,e||0===e?e:""}function s(t,e,a){var n,r="";return r+="\n      <tr>\n        ",n=typeof t===u?t.apply(t):t,(n||0===n)&&(r+=n),r+="\n        ",n=i.each.call(t,a&&a.matchSet1,{hash:{},inverse:m.noop,fn:m.program(6,c,e),data:e}),(n||0===n)&&(r+=n),r+="\n      </tr>\n      "}function c(){return'\n        <td>\n          <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n          </label>\n        </td>\n        '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,d,h,p="",u="function",m=this,f=this.escapeExpression,g=i.blockHelperMissing;return p+='<div class="qti-interaction qti-blockInteraction qti-matchInteraction" data-serial="',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===u?d.call(e,{hash:{},data:n}):d),p+=f(l)+'" data-qti-class="matchInteraction">\n  ',l=i["if"].call(e,e&&e.prompt,{hash:{},inverse:m.noop,fn:m.program(1,r,n),data:n}),(l||0===l)&&(p+=l),p+='\n  <div class="instruction-container"></div>\n  <div class="match-interaction-area">\n    <table class="matrix">\n      <thead>\n      <tr>\n        <th> </th>\n        ',h={hash:{},inverse:m.noop,fn:m.program(3,o,n),data:n},(d=i.matchSet1)?l=d.call(e,h):(d=e&&e.matchSet1,l=typeof d===u?d.call(e,h):d),i.matchSet1||(l=g.call(e,l,{hash:{},inverse:m.noop,fn:m.program(3,o,n),data:n})),(l||0===l)&&(p+=l),p+="\n      </tr>\n      </thead>\n      <tbody>\n      ",h={hash:{},inverse:m.noop,fn:m.programWithDepth(5,s,n,e),data:n},(d=i.matchSet2)?l=d.call(e,h):(d=e&&e.matchSet2,l=typeof d===u?d.call(e,h):d),i.matchSet2||(l=g.call(e,l,{hash:{},inverse:m.noop,fn:m.programWithDepth(5,s,n,e),data:n})),(l||0===l)&&(p+=l),p+='\n      </tbody>\n    </table>\n  </div>\n  <div class="notification-container"></div>\n</div>'})}),function(t,e){function i(t,e,i){var a=h[e.type]||{};return null==t?i||!e.def?null:e.def:(t=a.floor?~~t:parseFloat(t),isNaN(t)?e.def:a.mod?(t+a.mod)%a.mod:0>t?0:a.max<t?a.max:t)}function a(e){var i=l(),a=i._rgba=[];return e=e.toLowerCase(),m(c,function(t,n){var r,o=n.re.exec(e),s=o&&n.parse(o),c=n.space||"rgba";return s?(r=i[c](s),i[d[c].cache]=r[d[c].cache],a=i._rgba=r._rgba,!1):void 0}),a.length?("0,0,0,0"===a.join()&&t.extend(a,r.transparent),i):r[e]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(2/3-i)*6:t}var r,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",s=/^([\-+])=\s*(\d+\.?\d*)/,c=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,a,n){return new t.Color.fn.parse(e,i,a,n)},d={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},h={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},p=l.support={},u=t("<p>")[0],m=t.each;
u.style.cssText="background-color:rgba(1,1,1,.5)",p.rgba=u.style.backgroundColor.indexOf("rgba")>-1,m(d,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,o,s,c){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(o),o=e);var h=this,p=t.type(n),u=this._rgba=[];return o!==e&&(n=[n,o,s,c],p="array"),"string"===p?this.parse(a(n)||r._default):"array"===p?(m(d.rgba.props,function(t,e){u[e.idx]=i(n[e.idx],e)}),this):"object"===p?(n instanceof l?m(d,function(t,e){n[e.cache]&&(h[e.cache]=n[e.cache].slice())}):m(d,function(e,a){var r=a.cache;m(a.props,function(t,e){if(!h[r]&&a.to){if("alpha"===t||null==n[t])return;h[r]=a.to(h._rgba)}h[r][e.idx]=i(n[t],e,!0)}),h[r]&&t.inArray(null,h[r].slice(0,3))<0&&(h[r][3]=1,a.from&&(h._rgba=a.from(h[r])))}),this):void 0},is:function(t){var e=l(t),i=!0,a=this;return m(d,function(t,n){var r,o=e[n.cache];return o&&(r=a[n.cache]||n.to&&n.to(a._rgba)||[],m(n.props,function(t,e){return null!=o[e.idx]?i=o[e.idx]===r[e.idx]:void 0})),i}),i},_space:function(){var t=[],e=this;return m(d,function(i,a){e[a.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var a=l(t),n=a._space(),r=d[n],o=0===this.alpha()?l("transparent"):this,s=o[r.cache]||r.to(o._rgba),c=s.slice();return a=a[r.cache],m(r.props,function(t,n){var r=n.idx,o=s[r],l=a[r],d=h[n.type]||{};null!==l&&(null===o?c[r]=l:(d.mod&&(l-o>d.mod/2?o+=d.mod:o-l>d.mod/2&&(o-=d.mod)),c[r]=i((l-o)*e+o,n)))}),this[n](c)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),a=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-a)*n[e]+a*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),a=i.pop();return e&&i.push(~~(255*a)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,d.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,a=t[0]/255,n=t[1]/255,r=t[2]/255,o=t[3],s=Math.max(a,n,r),c=Math.min(a,n,r),l=s-c,d=s+c,h=.5*d;return e=c===s?0:a===s?60*(n-r)/l+360:n===s?60*(r-a)/l+120:60*(a-n)/l+240,i=0===l?0:.5>=h?l/d:l/(2-d),[Math.round(e)%360,i,h,null==o?1:o]},d.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],a=t[2],r=t[3],o=.5>=a?a*(1+i):a+i-a*i,s=2*a-o;return[Math.round(255*n(s,o,e+1/3)),Math.round(255*n(s,o,e)),Math.round(255*n(s,o,e-1/3)),r]},m(d,function(a,n){var r=n.props,o=n.cache,c=n.to,d=n.from;l.fn[a]=function(a){if(c&&!this[o]&&(this[o]=c(this._rgba)),a===e)return this[o].slice();var n,s=t.type(a),h="array"===s||"object"===s?a:arguments,p=this[o].slice();return m(r,function(t,e){var a=h["object"===s?t:e.idx];null==a&&(a=p[e.idx]),p[e.idx]=i(a,e)}),d?(n=l(d(p)),n[o]=p,n):l(p)},m(r,function(e,i){l.fn[e]||(l.fn[e]=function(n){var r,o=t.type(n),c="alpha"===e?this._hsla?"hsla":"rgba":a,l=this[c](),d=l[i.idx];return"undefined"===o?d:("function"===o&&(n=n.call(this,d),o=t.type(n)),null==n&&i.empty?this:("string"===o&&(r=s.exec(n),r&&(n=d+parseFloat(r[2])*("+"===r[1]?1:-1))),l[i.idx]=n,this[c](l)))})})}),l.hook=function(e){var i=e.split(" ");m(i,function(e,i){t.cssHooks[i]={set:function(e,n){var r,o,s="";if("transparent"!==n&&("string"!==t.type(n)||(r=a(n)))){if(n=l(r||n),!p.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?e.parentNode:e;(""===s||"transparent"===s)&&o&&o.style;)try{s=t.css(o,"backgroundColor"),o=o.parentNode}catch(c){}n=n.blend(s&&"transparent"!==s?s:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(c){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(o),t.cssHooks.borderColor={expand:function(t){var e={};return m(["Top","Right","Bottom","Left"],function(i,a){e["border"+a+"Color"]=t}),e}},r=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),define("lib/jquery.color",function(){}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","lib/jquery.color"],function(t,e,i,a,n,r){var o=!1,s=function(t){var e=a.getContainer(t);C(t),e.on("click.commonRenderer","input[type=checkbox]",function(e){m(t,e)}),a.validateInstructions(t)},c=function(i,n){n=h(n),"undefined"!=typeof n.list&&"undefined"!=typeof n.list.directedPair&&t(n.list.directedPair).forEach(function(t){var i=e("th[data-identifier="+t[0]+"]").index()-1,a=e("th[data-identifier="+t[1]+"]").parent().index();e(".matrix > tbody tr").eq(a).find("input[type=checkbox]").eq(i).attr("checked",!0)}),a.validateInstructions(i)},l=function(t){var e=n.serialize(p(t),t);return e},d=function(t){a.getContainer(t).find("input[type=checkbox]:checked").each(function(){e(this).prop("checked",!1)}),a.validateInstructions(t)},h=function(t){if("undefined"==typeof t.list){if("undefined"==typeof t.base)throw"The given response is not compliant with PCI JSON representation.";if(null==t.base)return{list:{directedPair:[]}};if("undefined"==typeof t.base.directedPair)throw"The matchInteraction only accepts directedPair values as responses.";return{list:{directedPair:[t.base.directedPair]}}}if("undefined"==typeof t.list.directedPair)throw"The matchInteraction only accept directedPair values as responses.";return t},p=function(t){var e=a.getContainer(t),i=[];return e.find("input[type=checkbox]:checked").each(function(){i.push(u(this))}),i},u=function(t){var i=e(t),a=i.closest("tr").index(),n=i.closest("td").index(),r=e(".matrix > thead th").eq(n).data("identifier"),o=e(".matrix > tbody th").eq(a).data("identifier");return[r,o]},m=function(e,i){var n=p(e),r=(e.attr("minAssociations"),e.attr("maxAssociations"));0===r&&(r=v(e)),t.size(n)>r?(i.preventDefault(),a.validateInstructions(e)):(choice=f(e,i.target))!==!1?(i.preventDefault(),a.validateInstructions(e,choice)):(a.triggerResponseChangeEvent(e,{}),a.validateInstructions(e))},f=function(e,i){var a=u(i),n=!1;return t(a).forEach(function(t){var i=b(e,t),a=(i.attributes.matchMin,i.attributes.matchMax),r=g(e,i);a>0&&r>a&&(n=i)}),n},g=function(e,i){var a=p(e),n=0;return t(a).forEach(function(t){(t[0]==i.attributes.identifier||t[1]==i.attributes.identifier)&&n++}),n},v=function(t){var e=a.getContainer(t);return e.find("input[type=checkbox]").length},b=function(t,e){var i=I(t);return i[e]},I=function(e){var i={};return t(e.choices).forEach(function(e){t(e).forEach(function(t){i[t.attributes.identifier]=t})}),i},C=function(e){var i=e.attr("minAssociations"),n=e.attr("maxAssociations"),s=v(e),c=function(){var c=function(t,e){o===!1&&(o=!0,t.update({level:"warning",message:r("Maximum number of choices reached."),timeout:2e3,stop:function(){t.update({level:"success",message:e}),o=!1}}))},l=function(t,e,i,n,s){var c=a.getContainer(t);if(o===!1){o=!0;var l=c.find('.qti-simpleAssociableChoice[data-identifier="'+e.attributes.identifier+'"]'),d=l.css("background-color"),h=l.css("color");i.update({level:"warning",message:r("The highlighted choice cannot be associated more than %d time(s).").replace("%d",e.attributes.matchMax),timeout:3e3,start:function(){l.animate({backgroundColor:"#fff",color:"#ba122b"},250,function(){l.animate({backgroundColor:"#ba122b",color:"#fff"},250)})},stop:function(){l.animate({backgroundColor:d,color:h},500),i.update({level:s,message:n}),o=!1}})}};if(0==i&&n>0){var d=r("You must select 0 to %d choices.").replace("%d",n);a.appendInstruction(e,d,function(i){var a=t.size(p(e)),r="undefined"!=typeof i;1==r&&i.attributes.matchMax>0&&g(e,i)>i.attributes.matchMax?l(e,i,this,d,this.getLevel()):n>=a?this.setLevel("success"):a>n?c(this,d):this.reset()})}else if(0==i&&0==n){var d=r("You must select 0 to %d choices.").replace("%d",s);a.appendInstruction(e,d,function(t){var i="undefined"!=typeof t;1==i&&t.attributes.matchMax>0&&g(e,t)>t.attributes.matchMax?l(e,t,this,d,this.getLevel()):this.setLevel("success")})}else if(i>0&&0==n){var d=r("You must select %1$d to %2$d choices.");d=d.replace("%1$d",i),d=d.replace("%2$d",s),a.appendInstruction(e,d,function(a){var n=t.size(p(e)),r="undefined"!=typeof a;1==r&&a.attributes.matchMax>0&&g(e,a)>a.attributes.matchMax?l(e,a,this,d,this.getLevel()):i>n?this.setLevel("info"):n>s?c(this,d):this.setLevel("success")})}else if(i>0&&n>0){if(i!=n){var d=r("You must select %1$d to %2$d choices.");d=d.replace("%1$d",i),d=d.replace("%2$d",n)}else{var d=r("You must select exactly %d choice(s).");d=d.replace("%d",i)}a.appendInstruction(e,d,function(a){var r=t.size(p(e)),o="undefined"!=typeof a;1==o&&a.attributes.matchMax>0&&g(e,a)>a.attributes.matchMax?l(e,a,this,d,this.getLevel()):i>r?this.setLevel("info"):r>n?c(this,d):r>=i&&n>=r&&this.setLevel("success")})}};c()},y=function(t){a.getContainer(t).off(".commonRenderer"),d(t),a.removeInstructions(t)};return{qtiClass:"matchInteraction",template:i,render:s,getContainer:a.getContainer,setResponse:c,getResponse:l,resetResponse:d,destroy:y,inferValue:u}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-mediaInteraction '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===l?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n    <div class="instruction-container"></div>\n    <div class="media-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper","mediaElement"],function(t,e,i,a,n,r,o){var s=function(t){var e="";return""!==t&&(-1!==t.indexOf("youtube")?e="video/youtube":0===t.indexOf("video")?e="video":0===t.indexOf("audio")&&(e="audio")),e},c={type:"video/mp4",video:{width:480,height:270},audio:{width:400,height:30}},l=function(i){var a,n,l=r.getContainer(i),h=i.object,p=this.getOption("baseUrl")||"",u=s(h.attr("type")||c.type),m=l.hasClass("pause"),f=parseInt(i.attr("maxPlays"),10)||0,g=!1,v=!1,b=m?["playpause","progress","current","duration","volume"]:["playpause","current","duration","volume"],I=function(){!i.mediaElement&&a&&a.length&&new o(a,n)},C=function(){var t=parseInt(l.data("timesPlayed"),10);return 0===f||f>t};0===e.size(h.attributes)&&(h.attr("type",c.type),h.attr("width",l.innerWidth()),h.attr("height",c.video.height),h.attr("data","")),n={defaultVideoWidth:c.video.width,defaultVideoHeight:c.video.height,videoWidth:h.attr("width"),videoHeight:h.attr("height"),audioWidth:h.attr("width")||c.audio.width,audioHeight:h.attr("height")||c.audio.height,features:b,startVolume:1,loop:!!i.attr("loop"),enableAutosize:!0,alwaysShowControls:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,enableKeyboard:!1,pauseOtherPlayers:!1,success:function(a,o){var s=!0,c=t(o).closest(".mejs-container"),d=t(".mejs-layers",c),p=t(".mejs-playpause-button",c),f=t(".mejs-overlay-play",c),b=t(".mejs-controls",c),I=b.outerHeight();i.mediaElement=a,"video/youtube"===u&&e.defer(function(){t("iframe.me-plugin",l).css("min-height",h.attr("height"))}),l.data("timesPlayed")||l.data("timesPlayed",0),i.attr("autostart")&&C()&&("video/youtube"!==u&&(a.load(),a.play()),a.addEventListener("canplay",function(){s&&a.play()},!1)),a.addEventListener("play",function(){s=!1,g===!0?g=!1:m||(f.detach(),p.detach(),("video/youtube"===u||"flash"===a.pluginType)&&t('<div class="overlay"></div>').width(n.videoWidth).height(n.videoHeight-I).appendTo(d))},!1),a.addEventListener("ended",function(){l.data("timesPlayed",l.data("timesPlayed")+1),r.triggerResponseChangeEvent(i),C()&&!m?(b.prepend(p),d.append(f),t(".overlay",d).remove()):C()||(f.detach(),p.detach(),("video/youtube"===u||"flash"===a.pluginType)&&t('<div class="overlay"></div>').width(n.videoWidth).height(n.videoHeight-I).appendTo(d),i.attr("loop")&&(i.mediaElement.pluginApi?t(o).remove():i.mediaElement.setSrc("")))},!1),p.on("click.qti-element",function(t){v=!0,m||(t.preventDefault(),t.stopPropagation())}),a.addEventListener("pause",function(){v&&(g=!0,v=!1)}),l.trigger("playerready")},error:function(e){t(e).closest("div.mejs-container").find(".me-cannotplay").remove()}},a=t(d(h,u,p)).appendTo(t(".media-container",l)),a.on("contextmenu",function(t){t.preventDefault()}).on("click.qit-element",function(t){return v=!0,m?void 0:(t.preventDefault(),t.stopPropagation(),!1)}),l.on("responseSet",function(){I()}),e.defer(function(){I()})},d=function(t,i,a){var n,r,o,s=function(t){return e.reduce(t,function(t,e,i){return t+=i+'="'+e+'" '},"")};return t&&(r=t.attr("data")?t.attr("data").replace(/^\//,""):"",o={width:t.attr("width")+"px",height:t.attr("height")+"px",preload:"none"},/^http(s)?:\/\//.test(r)||(r=a+r,o.type=t.attr("type")),"video/youtube"===i?n="<video "+s(o)+'>  <source type="video/youtube" src="'+r+'" /> </video>':(o.src=r,n="<"+i+" "+s(o)+"></"+i+">")),n},h=function(e){var i=r.getContainer(e);e.mediaElement&&(e.mediaElement.pluginApi||e.mediaElement.setSrc(""),e.mediaElement=void 0),t(".instruction-container",i).empty(),t(".media-container",i).empty(),i.removeData("timesPlayed")},p=function(t){return[r.getContainer(t).data("timesPlayed")]},u=function(t,e){if(e)try{var i;i=n.unserialize(e,t),r.getContainer(t).data("timesPlayed",i[0])}catch(a){}},m=function(t){r.getContainer(t).data("timesPlayed",0)},f=function(t){return n.serialize(p(t),t)};return{qtiClass:"mediaInteraction",template:a,render:l,getContainer:r.getContainer,setResponse:u,getResponse:f,resetResponse:m,destroy:h}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return"qti-horizontal"}function o(){return"qti-vertical"}function s(){return"horizontal"}function c(){return"vertical"}function l(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===I?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function d(t){var e;return e=typeof t===I?t.apply(t):t,e||0===e?e:""}function h(){return"icon-down"}function p(){return"icon-right"}function u(){return"icon-up"}function m(){return"icon-left"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var f,g,v,b="",I="function",C=this,y=this.escapeExpression,w=i.blockHelperMissing;return b+='<div class="qti-interaction qti-blockInteraction qti-orderInteraction ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.program(3,o,n),fn:C.program(1,r,n),data:n}),(f||0===f)&&(b+=f),b+='" \n     data-serial="',(g=i.serial)?f=g.call(e,{hash:{},data:n}):(g=e&&e.serial,f=typeof g===I?g.call(e,{hash:{},data:n}):g),b+=y(f)+'" \n     data-qti-class="orderInteraction" \n     data-orientation="',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.program(7,c,n),fn:C.program(5,s,n),data:n}),(f||0===f)&&(b+=f),b+='">\n    ',f=i["if"].call(e,e&&e.prompt,{hash:{},inverse:C.noop,fn:C.program(9,l,n),data:n}),(f||0===f)&&(b+=f),b+='\n    <div class="instruction-container"></div>\n    <div class="order-interaction-area">\n        <ul class="choice-area square source solid block-listing ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.noop,fn:C.program(5,s,n),data:n}),(f||0===f)&&(b+=f),b+='">\n            ',v={hash:{},inverse:C.noop,fn:C.program(11,d,n),data:n},(g=i.choices)?f=g.call(e,v):(g=e&&e.choices,f=typeof g===I?g.call(e,v):g),i.choices||(f=w.call(e,f,{hash:{},inverse:C.noop,fn:C.program(11,d,n),data:n})),(f||0===f)&&(b+=f),b+='\n        </ul>\n        <div class="arrow-bar middle">\n            <span class="icon-add-to-selection ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.program(15,p,n),fn:C.program(13,h,n),data:n}),(f||0===f)&&(b+=f),b+='"></span>\n            <span class="icon-remove-from-selection ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.program(19,m,n),fn:C.program(17,u,n),data:n}),(f||0===f)&&(b+=f),b+=' inactive"></span>\n        </div>\n        <ul class="result-area decimal target solid block-listing ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.noop,fn:C.program(5,s,n),data:n}),(f||0===f)&&(b+=f),b+='">\n        </ul>\n        <div class="arrow-bar">\n            <span class="icon-move-before ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.program(17,u,n),fn:C.program(19,m,n),data:n}),(f||0===f)&&(b+=f),b+=' inactive"></span>\n            <span class="icon-move-after ',f=i["if"].call(e,e&&e.horizontal,{hash:{},inverse:C.program(13,h,n),fn:C.program(15,p,n),data:n}),(f||0===f)&&(b+=f),b+=' inactive"></span>\n        </div>\n    </div>\n    <div class="notification-container"></div>\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","jqueryui"],function(t,e,i,a,n,r){var o=function(t){var i=a.getContainer(t),n=i.find(".choice-area"),r=i.find(".result-area"),o=i.find(".icon-add-to-selection"),l=i.find(".icon-remove-from-selection"),d=i.find(".icon-move-before"),h=i.find(".icon-move-after"),p=null,u=function(){o.addClass("inactive"),l.removeClass("inactive").addClass("active"),d.removeClass("inactive").addClass("active"),h.removeClass("inactive").addClass("active")},m=function(){o.removeClass("inactive"),l.removeClass("active").addClass("inactive"),d.removeClass("active").addClass("inactive"),h.removeClass("active").addClass("inactive")},f=function(t){p&&p.removeClass("active"),p=t,p.addClass("active"),u()},g=function(){p&&(p.removeClass("active"),p=null),m()};i.on("mousedown.commonRenderer",function(){g()}),n.on("mousedown.commonRenderer",">li:not(.deactivated)",function(i){i.stopPropagation(),g(),o.addClass("triggered"),setTimeout(function(){o.removeClass("triggered")},150),r.append(e(this)),a.triggerResponseChangeEvent(t),a.validateInstructions(t)}),r.on("mousedown.commonRenderer",">li",function(t){t.stopPropagation();var i=e(this);i.hasClass("active")?g():f(e(this))}),l.on("mousedown.commonRenderer",function(e){e.stopPropagation(),p&&(n.append(p),a.triggerResponseChangeEvent(t),a.validateInstructions(t)),g()}),d.on("mousedown.commonRenderer",function(e){e.stopPropagation();var i=p.prev();i.length&&(i.before(p),a.triggerResponseChangeEvent(t))}),h.on("mousedown.commonRenderer",function(e){e.stopPropagation();var i=p.next();i.length&&(i.after(p),a.triggerResponseChangeEvent(t))}),c(t),e(document).on("attributeChange.qti-widget.commonRenderer",function(e,i){i.element.getSerial()===t.getSerial()&&("maxChoices"===i.key||"minChoices"===i.key)&&(a.removeInstructions(t),c(t),a.validateInstructions(t))}),s(i)},s=function(t){var e=t.find(".order-interaction-area");e.height(e.height())},c=function(i){var n=a.getContainer(i).find(".choice-area"),o=a.getContainer(i).find(".result-area"),s=parseInt(i.attr("minChoices")),c=parseInt(i.attr("maxChoices"));if(s&&a.appendInstruction(i,r("You must use at least "+s+" choices"),function(){o.find(">li").length>=s?this.setLevel("success"):this.reset()}),c&&c<t.size(i.getChoices())){var l=a.appendInstruction(i,r("You can use maximum "+c+" choices"),function(){o.find(">li").length>=c?(n.find(">li").addClass("deactivated"),this.setMessage(r("Maximum choices reached"))):(n.find(">li").removeClass("deactivated"),this.reset())});n.on("mousedown.commonRenderer",">li.deactivated",function(){var t=e(this);t.addClass("brd-error"),l.setLevel("warning",2e3),setTimeout(function(){t.removeClass("brd-error")},150)})}},l=function(i){var n=t.keys(i.getChoices()),r=a.getContainer(i).find(".choice-area").append(a.getContainer(i).find(".result-area>li")),o=r.children(".qti-choice");o.detach().sort(function(i,a){return t.indexOf(n,e(i).data("serial"))>t.indexOf(n,e(a).data("serial"))}),r.prepend(o)},d=function(e,i){var r=a.getContainer(e).find(".choice-area"),o=a.getContainer(e).find(".result-area");if(null===i||t.isEmpty(i))l(e);else try{t.each(n.unserialize(i,e),function(t){o.append(r.find("[data-identifier="+t+"]"))})}catch(s){throw new Error("wrong response format in argument : "+s)}a.validateInstructions(e)},h=function(t){var i=[];return a.getContainer(t).find(".result-area>li").each(function(){i.push(e(this).data("identifier"))}),i},p=function(t){return n.serialize(h(t),t)},u=function(e,i){return t.merge(i||{},{horizontal:"horizontal"===e.attr("orientation")})},m=function(t){var i=a.getContainer(t);i.find(".qti-choice.active").mousedown();var n=[".choice-area",".result-area",".icon-add-to-selection",".icon-remove-from-selection",".icon-move-before",".icon-move-after"];i.find(n.join(",")).andSelf().off(".commonRenderer"),e(document).off(".commonRenderer"),i.find(".order-interaction-area").removeAttr("style"),l(t),a.removeInstructions(t)};return{qtiClass:"orderInteraction",getData:u,template:i,render:o,getContainer:a.getContainer,setResponse:d,getResponse:p,destroy:m}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="qti-prompt-container" data-html-editable-container>\n    <p class="qti-prompt" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-html-editable>',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</p>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/prompt","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e){return{qtiClass:"prompt",template:t,getContainer:e.getContainer}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-selectPointInteraction clearfix '+d((o=e&&e.attributes,o=null==o||o===!1?o:o["class"],typeof o===l?o.apply(e):o))+'" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/Helper"],function(t,e,i,a,n,r,o){var s=function(t){var e=o.getContainer(t),i=t.object.attributes,a=this.getOption("baseUrl")||"";t.paper=n.responsivePaper("graphic-paper-"+t.serial,t.serial,{width:i.width,height:i.height,img:a+i.data,imgId:"bg-image-"+t.serial,container:e}),c(t),o.minMaxChoiceInstructions(t,{min:t.attr("minChoices"),max:t.attr("maxChoices"),choiceCount:!1,getResponse:l,onError:function(t){t&&n.highlightError(t.target,"success")}})},c=function(t){function e(e){d&&e&&n.createTouchCircle(t.paper,e.getBBox()),o.triggerResponseChangeEvent(t),o.validateInstructions(t,{target:e})}var i=t.attr("maxChoices"),a=o.getContainer(t),r=a.find(".main-image-box"),s=a.hasClass("responsive"),c=t.paper.getById("bg-image-"+t.serial),d=!1;c.touchstart(function(){d=!0,c.untouchstart()}),c.click(function(a){if(i>0&&l(t).length>=i)return void o.validateInstructions(t);var c=n.getPoint(a,t.paper,r,s);n.createTarget(t.paper,{point:c,create:e,remove:function(){e()}})})},l=function(t){var e=[];return t.paper.forEach(function(t){var i=t.data("point");"object"==typeof i&&i.x&&i.y&&e.push([Math.round(i.x),Math.round(i.y)])}),e},d=function(t,i){var a;if(i&&t.paper){try{a=r.unserialize(i,t)}catch(o){}e.isArray(a)&&e(a).flatten().map(function(t,e){return e%2===0?{x:t,y:a[e+1]}:void 0}).filter(e.isObject).forEach(function(e){n.createTarget(t.paper,{point:e})})}},h=function(t){t.paper.forEach(function(t){var e=t.data("point");"object"==typeof e&&n.trigger(t,"click")})},p=function(t){var e=(l(t),r.serialize(l(t),t));return e},u=function(e){var i;e.paper&&(i=o.getContainer(e),t(window).off("resize.qti-widget."+e.serial),i.off("resize.qti-widget."+e.serial),e.paper.clear(),o.removeInstructions(e),t(".main-image-box",i).empty().removeAttr("style"),t(".image-editor",i).removeAttr("style"))};return{qtiClass:"selectPointInteraction",template:a,render:s,getContainer:o.getContainer,setResponse:d,getResponse:p,resetResponse:h,destroy:u}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-sliderInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" data-qti-class="sliderInteraction" >\r\n    ',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\r\n    <div class="instruction-container"></div>\r\n</div>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",["lodash","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","nouislider"],function(t,e,i,a,n){var r=function(t){t.sliderCurrentValue.find(".qti-slider-cur-value").text(t.value),t.sliderValue.val(t.value)},o=function(t){var i=t.getAttributes(),n=t.getContainer(),o=e("<div />").attr({id:i.identifier+"-qti-slider","class":"qti-slider"}),s=e("<div />").attr({"class":"qti-slider-values"}),c=e("<div />").attr({id:i.identifier+"-qti-slider-cur-value","class":"qti-slider-cur-value"}),l=e("<input />").attr({type:"hidden",id:i.identifier+"-qti-slider-value"}),d="horizontal",h="undefined"!=typeof i.reverse&&i.reverse?!0:!1,p=parseInt(i.lowerBound),u=parseInt(i.upperBound),m="undefined"!=typeof i.step&&i.step?parseInt(i.step):1,f=(u-p)/m;c.append('<span class="qti-slider-cur-value-text">Current value: </span>').append('<span class="qti-slider-cur-value"></span>'),s.append('<span class="slider-min">'+(h?u:p)+"</span>").append('<span class="slider-max">'+(h?p:u)+"</span>"),t.getContainer().append(o).append(s).append(c).append(l),"undefined"!=typeof i.orientation&&e.inArray(i.orientation,["horizontal","vertical"])>-1&&(d=i.orientation);var g=0;if("horizontal"===d)n.addClass("qti-slider-horizontal");else{var v=300;g=20*f,g>v&&(g=v),n.addClass("qti-slider-vertical"),o.height(g+"px"),s.height(g+"px")}if("undefined"!=typeof i.stepLabel&&i.stepLabel){var b=parseInt(f/2),I=100/f*b,C=h?u-b*m:p+b*m;s.find(".slider-min").after("horizontal"===d?'<span class="slider-middle" style="left:'+I+'%">'+C+"</span>":'<span class="slider-middle" style="top:'+I+'%">'+C+"</span>")}o.noUiSlider({start:h?u:p,range:{min:p,max:u},step:m,orientation:d}).on("slide",function(){var i=parseInt(e(this).val());t.attr("reverse")&&(i=u+p-i),i=Math.round(1e3*i)/1e3,r({value:i,sliderValue:l,sliderCurrentValue:c}),a.triggerResponseChangeEvent(t)}),r({value:p,sliderValue:l,sliderCurrentValue:c})},s=function(t){var i=t.getAttributes(),a=e("#"+i.identifier+"-qti-slider"),n=e("#"+i.identifier+"-qti-slider-value"),o=e("#"+i.identifier+"-qti-slider-cur-value"),s=parseInt(i.lowerBound),c=parseInt(i.upperBound),l="undefined"!=typeof i.reverse&&i.reverse?!0:!1,d=l?c:s;r({value:s,sliderValue:n,sliderCurrentValue:o}),a.val(d)},c=function(t,i){var a,o=t.getAttributes(),s=e("#"+o.identifier+"-qti-slider-value"),c=e("#"+o.identifier+"-qti-slider-cur-value"),l=e("#"+o.identifier+"-qti-slider"),d=parseInt(o.lowerBound),h=parseInt(o.upperBound);a=n.unserialize(i,t)[0],r({value:a,sliderValue:s,sliderCurrentValue:c}),l.val(t.attr("reverse")?h+d-a:a)},l=function(t){var i,a=t.getAttributes(),n=t.getResponseDeclaration().attr("baseType"),r=parseInt(a.lowerBound),o=e("#"+a.identifier+"-qti-slider-value");return"integer"===n?i=parseInt(o.val()):"float"===n&&(i=parseFloat(o.val())),isNaN(i)?r:i},d=function(t){return n.serialize([l(t)],t)},h=function(t){var e=t.getContainer();e.empty()};return{qtiClass:"sliderInteraction",template:i,render:o,getContainer:a.getContainer,setResponse:c,getResponse:d,resetResponse:s,destroy:h}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<input class="qti-interaction qti-inlineInteraction qti-textEntryInteraction" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-qti-class="textEntryInteraction" type="text">'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n","polyfill/placeholders","tooltipster"],function(t,e,i,a,n){var r=function(t,e){var i=new RegExp("^"+e+"$"),a="pattern"in document.createElement("input");t.attr("pattern",e),t.on("keyup",function(){t.removeClass("field-error"),i.test(t.val())?t.tooltipster("hide"):((!a||navigator.userAgent.match(/Safari/i))&&t.addClass("field-error"),t.tooltipster("show"))})},o=function(t){var e=t.getAttributes(),i=t.getContainer();e.expectedLength&&i.css("width",parseInt(e.expectedLength)+"em"),e.patternMask&&(i.tooltipster({theme:"tao-error-tooltip",content:n("Invalid pattern"),delay:350,trigger:"custom"}),r(i,e.patternMask)),e.placeholderText&&i.attr("placeholder",e.placeholderText)
},s=function(t){t.getContainer().val("")},c=function(t,e){var i;try{i=a.unserialize(e,t)}catch(n){}i&&i.length&&t.getContainer().val(i[0])},l=function(t){var e,i={base:{}},a=t.getContainer(),n=t.getAttributes(),r=t.getResponseDeclaration().attr("baseType"),o=n.base||10;return n.placeholderText&&a.val()===n.placeholderText?e="":"integer"===r?e=parseInt(a.val(),o):"float"===r?e=parseFloat(a.val()):"string"===r&&(e=a.val()),i.base[r]=isNaN(e)&&"number"==typeof e?"":e,i};return{qtiClass:"textEntryInteraction",template:e,render:o,getContainer:i.getContainer,setResponse:c,getResponse:l,resetResponse:s}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n	',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n	<div class="instruction-container"></div>\n    <div class="file-upload fixed-grid-row">\n        <div class="progressbar"></div>\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n        <input type="file">\n    </div>\n</div> '})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","jquery","jqueryui","i18n","context","filereader"],function(t,e,i,a,n,r,o){var s={base:null},c=r("Browse your computer and select the appropriate file."),l=r("The selected file is ready to be sent."),d=function(t,e){i.removeInstructions(t),i.appendInstruction(t,c);var a=i.getContainer(t),n=e.name,r=(e.size,e.type);a.find(".file-name").empty().append(n);var o=new FileReader;o.onload=function(e){i.removeInstructions(t),i.appendInstruction(t,l,function(){this.setLevel("success")}),i.validateInstructions(t),a.find(".progressbar").progressbar({value:100});var o=e.target.result,c=o.indexOf(",");base64Raw=o.substring(c+1),r=r,s={base:{file:{data:base64Raw,mime:r,name:n}}}},o.onloadstart=function(){i.removeInstructions(t),a.find(".progressbar").progressbar({value:0})},o.onprogress=function(t){var e=Math.ceil(Math.round(t.loaded)/Math.round(t.total)*100);a.find(".progressbar").progressbar({value:e})},o.readAsDataURL(e)},h=function(t){$container=i.getContainer(t),$container.find(".file-name").text(r("No file selected")),$container.find(".btn-info").text(r("Browse..."))},p=function(t){$container=i.getContainer(t),h(t),i.appendInstruction(t,c);var e=function(e){var i=e.target.files[0];"undefined"!=typeof i&&d(t,i)};$input=$container.find("input"),window.File&&window.FileReader&&window.FileList?$input.bind("change",e):$input.fileReader({id:"fileReaderSWFObject",filereader:o.taobase_www+"js/lib/polyfill/filereader.swf",callback:function(){$input.bind("change",e)}}),$input.bind("mousedown",function(t){return t.preventDefault(),a(this).blur(),!1})},u=function(t){$container=i.getContainer(t),h(t)},m=function(t,e){if($container=i.getContainer(t),null!=e.base){var a="undefined"!=typeof e.base.file.name?e.base.file.name:"previously-uploaded-file";$container.find(".file-name").empty().text(a)}s=e},f=function(){return s};return{qtiClass:"uploadInteraction",template:e,render:p,getContainer:i.getContainer,setResponse:m,getResponse:f,resetResponse:u,resetGui:h}}),define("taoQtiItem/qtiCreator/editor/MathEditor",["lodash","jquery","mathJax"],function(t,e,i){var a=function(t){if(t=t||{},this.mathML=t.mathML||"",this.tex=t.tex||"",this.display=t.display||"inline",this.processing=!1,this.$target=t.target||e(),!(t.buffer&&t.buffer instanceof e&&t.buffer.length))throw'missing required element in config "buffer"';this.$buffer=t.buffer};a.prototype.setMathML=function(t){return this.mathML=r(t),this},a.prototype.setTex=function(t){return this.tex=t,this};var n=function(i,a){var n={target:null,callback:null};if(t.each(a,function(i){t.isFunction(i)?n.callback=i:i instanceof e&&(n.target=i)}),!n.target){if(!i.$target)throw"no target defined for rendering";n.target=i.$target}return n};a.prototype.renderFromMathML=function(){var t=n(this,arguments);if("undefined"!=typeof i){if(this.processing)return;var e=i.Hub.queue,a=s(this.mathML,"block"===this.display);this.$buffer.html(a);var r=this;e.Push(["Typeset",i.Hub,this.$buffer[0]],function(){r.processing=!1,t.target.html(r.$buffer.html()),r.$buffer.empty()}),t.callback&&e.Push(t.callback)}},a.prototype.renderFromTex=function(){var t=n(this,arguments);if("undefined"!=typeof i){var e=this,a=i.Hub.queue;e.$buffer.html("block"===this.display?"\\[\\displaystyle{"+e.tex+"}\\]":"\\(\\displaystyle{"+e.tex+"}\\)"),a.Push(["Typeset",i.Hub,e.$buffer[0]],function(){t.target.html(e.$buffer.html());var i=o(e.$buffer);e.$buffer.empty(),e.texToMathML(i,function(t){e.setMathML(r(t))})}),t.callback&&a.Push(t.callback)}};var r=function(t){return t=t.replace(/<(\/)?math[^>]*>/g,""),t=t.replace(/^\s*[\r\n]/gm,""),t=t.replace(/\s*[\r\n]$/gm,"")},o=function(t){if(t instanceof e&&t.length){var i=t.find("script");if(i.length&&i[0].MathJax&&i[0].MathJax.elementJax)return i[0].MathJax.elementJax}},s=function(t,e){if(!t.match(/<math[^>]*>/)){var i=e?' display="block"':"";t="<math"+i+">"+t}return t.match(/<\/math[^>]*>/)||(t+="</math>"),t};return a.prototype.texToMathML=function(t,e){var a=this,n="";try{n=t.root.toMathML("")}catch(r){if(!r.restart)throw r;return i.Callback.After(function(){a.texToMathML(t,e)},r.restart)}i.Callback(e)(n)},a}),define("taoQtiItem/qtiCreator/editor/ckEditor/ckConfigurator",["lodash","ckeditor","taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler","mathJax"],function(t,e,i,a){var n=t.cloneDeep(CKEDITOR.config),r=function(){var e={TaoMediaManager:{insertAfter:"SpecialChar"}},r={TaoQtiImage:{insertAfter:"SpecialChar"}};a&&(r.TaoQtiMaths={insertAfter:"SpecialChar"});var o={inline:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],flow:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar"]},{name:"links",items:["Link"]}],block:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"links",items:["Link"]},"/",{name:"styles",items:["Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}]},s={disableAutoInline:!0,entities:!1,entities_processNumerical:!0,autoParagraph:!1,extraPlugins:"confighelper",floatSpaceDockedOffsetY:0,forcePasteAsPlainText:!0,skin:"tao",language:"en",removePlugins:"",linkShowAdvancedTab:!1,justifyClasses:["txt-lft","txt-ctr","txt-rgt","txt-jty"],linkShowTargetTab:!1,specialChars:["!","&quot;","#","$","%","&amp;","'","(",")","*","+","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";",["&lt;","Less than"],["&le;","Less than or equal to"],"&asymp;","=","&ne;",["&ge;","Greater than or equal to"],["&gt;","Greater than"],"?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","&euro;","&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;","&sbquo;","&#8219;","&bdquo;","&hellip;","&trade;","&#9658;","&bull;","&rarr;","&rArr;","&hArr;","&diams;","&asymp;"]},c=function(e,i){var a,n,r,o,s,c,l,d,h,p,u=e.toolbar.length,m={};for(e.extraPlugins=function(e,i){for(var a=e.length,n=i.split(",");a--;)e[a]=e[a].toLowerCase();return n=t.compact(t.union(n,e)),n.join(",")}(t.keys(i),e.extraPlugins),p=0;u>p;p++)t.isString(e.toolbar[p])&&(m[p]=e.toolbar[p],e.toolbar[p]={items:[]});for(o in i){for(r=function(t){for(var e=t.length;e--;)if(0===t[e].indexOf("insert")||"replace"===t[e])return t[e];throw"Missing key insertBefore | insertAfter | replace in positionedPlugins"}(t.keys(i[o])),l=i[o][r].toLowerCase(),c=i[o].separator||!1,s=-1;u--;){for(n=e.toolbar[u].items.length,a=0;n>a;a++)if(e.toolbar[u].items[a].toLowerCase()===l){s=a;break}if(s>-1){d=~~("replace"===r),"insertAfter"===r&&s++,c&&(e.toolbar[u].items.splice(s,d,"-"),s++),e.toolbar[u].items.splice(s,d,o);break}}u=e.toolbar.length}for(h in m)e.toolbar[h]=m[h]},l=function(a,l,d){if("reset"===l)return n;d=d||{},d.resourcemgr=d.resourcemgr||{};var h,p,u=t.clone(o,!0),m="html";0===l.indexOf("qti")&&(l=l.slice(3).toLowerCase(),s.allowedContent=!0,s.autoParagraph=!1,m="qti"),d.toolbar&&(u[l]=t.clone(d.toolbar),delete d.toolbar);for(h in u)u.hasOwnProperty(h)&&(s["toolbar_"+h]=u[h]);return"undefined"!=typeof u[l]&&(s.toolbar=u[l]),"undefined"!=typeof d.positionedPlugins&&(d.positionedPlugins={}),!1!==d.positionedPlugins&&(e="qti"===m?t.assign(r,t.clone(d.positionedPlugins)):t.assign(e,t.clone(d.positionedPlugins)),delete d.positionedPlugins,c(s,e)),p=t.assign({},t.cloneDeep(n),s,d),a.on("focus",function(){i.setMode(m),CKEDITOR.dtd=i.getDtd()}),a.on("instanceReady",function(t){$(t.editor.element.$).removeAttr("title")}),CKEDITOR.on("dialogDefinition",function(t){if("link"===t.data.name){for(var e,i=t.data.definition.getContents("info").get("linkType").items,a=i.length;a--;)"anchor"===i[a][1]||(e=a);i.splice(e+1,1)}}),p};return{getConfig:l}}();return r}),define("taoQtiItem/qtiCreator/editor/ckEditor/ckProtector",["jquery","i18n"],function(t,e){var i=function(){var i=".widget-box",a=function(t){var e=t[0],i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(i){var a=new i(function(e){e.forEach(function(){t.trigger("contentchange.protector")})});a.observe(e,{subtree:!0,characterData:!0})}else e.addEventListener("DOMCharacterDataModified",function(){t.trigger("contentchange.protector")},!1)},n=function(){return i},r=function(n,r){r&&(i=r),n.find(i).each(function(){var i,r=t(this),o=r.outerWidth(),s=r.outerHeight(),c=t('<button class="cke-cover-up">'),l=function(e){return t('[data-serial="'+e+'"]').each(function(){var e=t(this);return e.parent().hasClass("cke-qti-wrapper")?!1:void 0}),r.length?r:t()},d=function(t){var e=l(t.prop("serial")).parent(".cke-qti-wrapper"),i=e.offset();t.css({left:i.left,top:i.top})};return r.parent(".cke-qti-wrapper").length?!1:(r.find("*").each(function(){this.innerHTML||(this.innerHTML="&#8203;")}),r.wrap(t('<span class="cke-qti-wrapper" />')),i=r.parent(),c.css({width:o,height:s}),t("body").append(c),i.css({width:o,height:s}),i.attr("contenteditable",!1),i.prop("cover",c),c.prop("serial",r.data("serial")),d(c),c.attr("title",e("Click to display interaction widget")),c.on("click",function(){var e=l(t(this).prop("serial"));t(document).trigger("removeprotection.ckprotector",{context:n,widget:e})}),a(n),void n.on("contentchange.protector",function(){d(c)}))})},o=function(e){e.each(function(){var e=t(this),i=e.parent(".cke-qti-wrapper");i.length&&(i.prop("cover").remove(),e.unwrap())})};return{protect:r,unprotect:o,getSelector:n}}();return i}),define("taoQtiItem/qtiCreator/editor/gridEditor/config",[],function(){return{min:{interaction:2,text:1,rubricBlock:12},throttle:{resize:100}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/helper",[],function(){var t={getColUnits:function(t){var e=t.attr("class");if(!e)throw new Error("the element has no css class");var i=e.match(/col-([\d]+)/);if(i&&i.length)return parseInt(i.pop());throw"the element has no col-* class"},setUnitsFromClass:function(e){var i=t.getColUnits(e);return e.attr("data-units",i),i}};return t}),define("taoQtiItem/qtiCreator/helper/qtiElements",["jquery","lodash"],function(t,e){var i={};return i.classes={itemBody:{parents:["bodyElement"],contains:["block"],"abstract":!0},atomicBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["inline"],"abstract":!0},atomicInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],"abstract":!0},simpleBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["block"],"abstract":!0},simpleInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],"abstract":!0},flowStatic:{parents:["flow"],"abstract":!0},blockStatic:{parents:["block"],"abstract":!0},inlineStatic:{parents:["inline"],"abstract":!0},flow:{parents:["objectFlow"],"abstract":!0},tableCell:{parents:["bodyElement"],contains:["flow"],"abstract":!0},caption:{parents:["bodyElement"],contains:["inline"],xhtml:!0},col:{parents:["bodyElement"],xhtml:!0},colgroup:{parents:["bodyElement"],contains:["col"],xhtml:!0},div:{parents:["blockStatic","bodyElement","flowStatic"],contains:["flow"],xhtml:!0},dl:{parents:["blockStatic","bodyElement","flowStatic"],contains:["dlElement"],xhtml:!0},dt:{parents:["dlElement"],contains:["inline"],xhtml:!0},dd:{parents:["dlElement"],contains:["flow"],xhtml:!0},hr:{parents:["blockStatic","bodyElement","flowStatic"],xhtml:!0},math:{parents:["blockStatic","flowStatic","inlineStatic"],xhtml:!0},li:{parents:["bodyElement"],contains:["flow"],xhtml:!0},ol:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},ul:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},object:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["objectFlow"],xhtml:!0},param:{parents:["objectFlow"],xhtml:!0},table:{parents:["blockStatic","bodyElement","flowStatic"],contains:["caption","col","colgroup","thead","tfoot","tbody"],xhtml:!0},tbody:{parents:["bodyElement"],contains:["tr"],xhtml:!0},tfoot:{parents:["bodyElement"],contains:["tr"],xhtml:!0},thead:{parents:["bodyElement"],contains:["tr"],xhtml:!0},td:{parents:["tableCell"],xhtml:!0},th:{parents:["tableCell"],xhtml:!0},tr:{parents:["bodyElement"],contains:["tableCell"],xhtml:!0},a:{parents:["simpleInline"],xhtml:!0},abbr:{parents:["simpleInline"],xhtml:!0},acronym:{parents:["simpleInline"],xhtml:!0},b:{parents:["simpleInline"],xhtml:!0},big:{parents:["simpleInline"],xhtml:!0},cite:{parents:["simpleInline"],xhtml:!0},code:{parents:["simpleInline"],xhtml:!0},dfn:{parents:["simpleInline"],xhtml:!0},em:{parents:["simpleInline"],xhtml:!0},i:{parents:["simpleInline"],xhtml:!0},kbd:{parents:["simpleInline"],xhtml:!0},q:{parents:["simpleInline"],xhtml:!0},samp:{parents:["simpleInline"],xhtml:!0},small:{parents:["simpleInline"],xhtml:!0},span:{parents:["simpleInline"],xhtml:!0},strong:{parents:["simpleInline"],xhtml:!0},sub:{parents:["simpleInline"],xhtml:!0},sup:{parents:["simpleInline"],xhtml:!0},tt:{parents:["simpleInline"],xhtml:!0},"var":{parents:["simpleInline"],xhtml:!0},blockquote:{parents:["simpleBlock"],xhtml:!0},address:{parents:["atomicBlock"],xhtml:!0},h1:{parents:["atomicBlock"],xhtml:!0},h2:{parents:["atomicBlock"],xhtml:!0},h3:{parents:["atomicBlock"],xhtml:!0},h4:{parents:["atomicBlock"],xhtml:!0},h5:{parents:["atomicBlock"],xhtml:!0},h6:{parents:["atomicBlock"],xhtml:!0},p:{parents:["atomicBlock"],xhtml:!0},pre:{parents:["atomicBlock"],xhtml:!0},img:{parents:["atomicInline"],xhtml:!0,attributes:["src","alt","longdesc","height","width"]},br:{parents:["atomicInline"],xhtml:!0},infoControl:{parents:["blockStatic","bodyElement","flowStatic"],qti:!0},textRun:{parents:["inlineStatic","flowstatic"],qti:!0},feedbackInline:{parents:["simpleInline","feedbackElement"],qti:!0},feedbackBlock:{parents:["simpleBlock"],qti:!0},rubricBlock:{parents:["simpleBlock"],qti:!0},blockInteraction:{parents:["block","flow","interaction"],qti:!0},inlineInteraction:{parents:["inline","flow","interaction"],qti:!0},gap:{parents:["inlineStatic"],qti:!0},hottext:{parents:["flowstatic","inlineStatic"],contains:["inlineStatic"],qti:!0},printedVariable:{parents:["bodyElement","flowStatic","inlineStatic","textOrVariable"],qti:!0},prompt:{parents:["bodyElement"],contains:["inlineStatic"],qti:!0},templateElement:{parents:["bodyElement"],qti:!0},templateBlock:{parents:["blockStatic","flowStatic","templateElement"],contains:["blockStatic"],qti:!0},templateInline:{parents:["inlineStatic","flowStatic","templateElement"],contains:["inlineStatic"],qti:!0},choiceInteraction:{parents:["blockInteraction"],qti:!0},associateInteraction:{parents:["blockInteraction"],qti:!0},orderInteraction:{parents:["blockInteraction"],qti:!0},matchInteraction:{parents:["blockInteraction"],qti:!0},hottextInteraction:{parents:["blockInteraction"],qti:!0},gapMatchInteraction:{parents:["blockInteraction"],qti:!0},mediaInteraction:{parents:["blockInteraction"],qti:!0},sliderInteraction:{parents:["blockInteraction"],qti:!0},uploadInteraction:{parents:["blockInteraction"],qti:!0},drawingInteraction:{parents:["blockInteraction"],qti:!0},graphicInteraction:{parents:["blockInteraction"],qti:!0},hotspotInteraction:{parents:["graphicInteraction"],qti:!0},graphicAssociateInteraction:{parents:["graphicInteraction"],qti:!0},graphicOrderInteraction:{parents:["graphicInteraction"],qti:!0},graphicGapMatchInteraction:{parents:["graphicInteraction"],qti:!0},selectPointInteraction:{parents:["graphicInteraction"],qti:!0},textEntryInteraction:{parents:["stringInteraction","inlineInteraction"],qti:!0},extendedTextInteraction:{parents:["stringInteraction","blockInteraction"],qti:!0},inlineChoiceInteraction:{parents:["inlineInteraction"],qti:!0},_container:{parents:["block"],qti:!0}},i.cache={containable:{},children:{},parents:{}},i.getAllowedContainersElements=function(e,a){var n=i.getAllowedContainers(e),r="";for(var o in n)n[o].qti||(r+=n[o]+", ");return r&&(r=r.substring(0,r.length-2)),t(r,a?a:t(document)).filter(":not([data-qti-type])")},i.getAllowedContainers=function(t){if(i.cache.containable[t])var a=i.cache.containable[t];else{var a=[],n=i.getParentClasses(t,!0);for(var r in i.classes){var o=i.classes[r];if(o.contains){var s=e.intersection(o.contains,n);s.length&&(o.abstract||a.push(r),a=e.union(a,i.getChildClasses(r,!0)))}}i.cache.containable[t]=a}return a},i.getAllowedContents=function(t,a,n){var r=[];n=n||{};var o=i.classes[t];if(o&&o.contains)for(var s in o.contains){var c=o.contains[s];if(!n[c]){n[c]=!0,r.push(c);var l=i.getChildClasses(c,!0);for(var s in l){var d=l[s];n[d]||(n[d]=!0,r.push(d),a&&(r=e.union(r,i.getAllowedContents(d,!0,n))))}a&&(r=e.union(r,i.getAllowedContents(c,!0,n)))}}var h=i.getParentClasses(t,!0);for(var s in h)r=e.union(r,i.getAllowedContents(h[s],a,n));return e.uniq(r,!1)},i.isAllowedClass=function(t,a){var n=i.getAllowedContents(t);return e.indexOf(n,a)>=0},i.getParentClasses=function(t,a){if(a&&i.cache.parents[t])var n=i.cache.parents[t];else{var n=[];if(i.classes[t]&&(n=i.classes[t].parents,a)){for(var r in n)n=e.union(n,i.getParentClasses(n[r],a));n=e.uniq(n,!1)}i.cache.parents[t]=n}return n},i.getChildClasses=function(t,a,n){var r=n?n:"all";if(a&&i.cache.children[t]&&i.cache.children[t][r])var o=i.cache.children[t][r];else{var o=[];for(var s in i.classes){var c=i.classes[s];e.indexOf(c.parents,t)>=0&&(n?c[n]&&o.push(s):o.push(s),a&&(o=e.union(o,i.getChildClasses(s,a,n))))}i.cache.children[t]||(i.cache.children[t]={}),i.cache.children[t][r]=o}return o},i.isBlock=function(t){return i.is(t,"block")},i.isInline=function(t){return i.is(t,"inline")},i.is=function(t,a){if(t===a)return!0;var n=i.getParentClasses(t,!0);return e.indexOf(n,a)>=0},i.getAvailableAuthoringElements=function(){return{choiceInteraction:{title:__("Choice Interaction"),icon:"choice","short":__("Choice"),qtiClass:"choiceInteraction",tags:["Common Interaction","mcq"]},orderInteraction:{title:__("Order Interaction"),icon:"order","short":__("Order"),qtiClass:"orderInteraction",tags:["Common Interaction","ordering"]},associateInteraction:{title:__("Associate Interaction"),icon:"associate","short":__("Associate"),qtiClass:"associateInteraction",tags:["Common Interaction","association"]},matchInteraction:{title:__("Match Interaction"),icon:"match","short":__("Match"),qtiClass:"matchInteraction",tags:["Common Interaction","association"]},hottextInteraction:{title:__("Hottext Interaction"),icon:"hottext","short":__("Hottext"),qtiClass:"hottextInteraction",tags:["Common Interaction","text"]},gapMatchInteraction:{title:__("Gap Match Interaction"),icon:"gap-match","short":__("Gap Match"),qtiClass:"gapMatchInteraction",tags:["Common Interaction","text","association"]},sliderInteraction:{title:__("Slider Interaction"),icon:"slider","short":__("Slider"),qtiClass:"sliderInteraction",tags:["Common Interaction","special"]},extendedTextInteraction:{title:__("Extended Text Interaction"),icon:"extended-text","short":__("Extended Text"),qtiClass:"extendedTextInteraction",tags:["Common Interaction","text"]},uploadInteraction:{title:__("File Upload Interaction"),icon:"upload","short":__("File Upload"),qtiClass:"uploadInteraction",tags:["Common Interaction","special"]},mediaInteraction:{title:__("Media Interaction"),icon:"media","short":__("Media"),qtiClass:"mediaInteraction",tags:["Common Interaction","media"]},_container:{title:__("Text Block Interaction"),icon:"font","short":__("Block"),qtiClass:"_container",tags:["Inline Interactions","text"]},inlineChoiceInteraction:{title:__("Inline Choice Interaction"),icon:"inline-choice","short":__("Inline Choice"),qtiClass:"inlineChoiceInteraction",tags:["Inline Interactions","inline-interactions","mcq"]},textEntryInteraction:{title:__("Text Entry Interaction"),icon:"text-entry","short":__("Text Entry"),qtiClass:"textEntryInteraction",tags:["Inline Interactions","inline-interactions","text"]},hotspotInteraction:{title:__("Hotspot Interaction"),icon:"hotspot","short":__("Hotspot"),qtiClass:"hotspotInteraction",tags:["Graphic Interactions","mcq"]},graphicOrderInteraction:{title:__("Graphic Order Interaction"),icon:"graphic-order","short":__("Graphic Order"),qtiClass:"graphicOrderInteraction",tags:["Graphic Interactions","ordering"]},graphicAssociateInteraction:{title:__("Graphic Associate Interaction"),icon:"graphic-associate","short":__("Graphic Associate"),qtiClass:"graphicAssociateInteraction",tags:["Graphic Interactions","association"]},graphicGapMatchInteraction:{title:__("Choice Interaction"),icon:"graphic-gap","short":__("Graphic Gap"),qtiClass:"graphicGapMatchInteraction",tags:["Graphic Interactions","association"]},selectPointInteraction:{title:__("Select Point Interaction"),icon:"select-point","short":__("Select Point"),qtiClass:"selectPointInteraction",tags:["Graphic Interactions"]}}},i}),define("taoQtiItem/qtiCreator/editor/gridEditor/resizable",["lodash","jquery","taoQtiItem/qtiCreator/editor/gridEditor/config","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/helper/qtiElements","jqueryui"],function(t,e,i,a,n){var r=function(t){var e=t.height()-parseFloat(t.children('[class^="col-"], [class*=" col-"]').css("margin-bottom"));t.find(".grid-edit-resizable-zone").height(e)},o=function(r){var l=parseFloat(r.find('[class^="col-"]:last, [class*=" col-"]:last').css("margin-left")),d=20;r.find('[class^="col-"], [class*=" col-"]').each(function(){var h=e(this);if(h.parent().hasClass("fixed-grid-row"))return!0;if(h.children(".grid-edit-resizable-zone").length)return!0;var p=h.next(),u=h.parent(".grid-row"),m=h.offset(),f=12,g=n.is(h.data("qti-class"),"interaction")?i.min.interaction:i.min.text,v=n.is(p.data("qti-class"),"interaction")?i.min.interaction:i.min.text,b=u.width()/f,I=u.height()-parseFloat(h.css("margin-bottom")),C=e("<div>",{"class":"grid-edit-resizable-zone grid-edit-resizable-zone-active"}).css({top:0,right:-(l+(d-l)/2),width:d,height:I}),y=e("<span>",{"class":"grid-edit-resizable-handle"});C.append(y),h.append(C);var w=function(){var t=u.height()-parseFloat(h.css("margin-bottom"));h.find(".grid-edit-resizable-outline").height(t),C.height(t)};C.draggable({containment:p.length?[m.left+g*b-2*l+10,m.top,m.left+h.outerWidth()+l+p.outerWidth()-v*b-d/2-10,m.top+h.height()]:[m.left+g*b-l-d/2-10,m.top,u.offset().left+u.outerWidth()-l-d/2-12,m.top+h.height()],axis:"x",cursor:"col-resize",start:function(){h.trigger("resizestart.gridEdit");var t=e("<div>",{"class":"grid-edit-resizable-outline"});p.length?t.width(parseFloat(h.outerWidth())+l+parseFloat(p.outerWidth())):t.css({width:"100%","border-right-width":0}),e(this).data("overlay",t),h.append(t),y.addClass("grid-edit-resizable-active"),r.find(".grid-edit-resizable-zone-active").removeClass("grid-edit-resizable-zone-active"),w()},drag:t.throttle(function(){var t=e(this).offset().left+d/2-m.left,i=a.getColUnits(h),n=p.length?a.getColUnits(p):0;p.length||h.find(".grid-edit-resizable-outline").width(y.offset().left-m.left),(i-1)*b>t+0*l?(i--,c(h,i),p.length&&(n++,c(p,n)),w(),h.trigger("resize.gridEdit")):t+l+20>(i+1)*b&&(i++,c(h,i),p.length&&(n--,c(p,n)),w(),h.trigger("resize.gridEdit"))},i.throttle.resize),stop:function(){h.find(".grid-edit-resizable-outline").remove(),s(r),o(r),h.trigger("resizestop.gridEdit")}}).css("position","absolute")}),r.off(".gridEdit.resizable").on("dragoverstart.gridEdit.resizable",function(){s(r)}).on("dragoverstop.gridEdit.resizable",function(){o(r)}).on("contentChange.gridEdit.resizable",".grid-row",function(){s(r),o(r)})},s=function(t){t.find(".grid-edit-resizable-zone").remove()},c=function(t,i){if(!t.attr("class").match(/col-([\d]+)/))throw e.error("the element is not a grid column");var a=t.attr("data-units"),n=t.parent(".grid-row"),r=n.attr("data-units");n.attr("data-units",r-a+i),t.attr("data-units",i),t.removeClass("col-"+a).addClass("col-"+i)};return{create:function(t){o(t),e(window).off("resize.qtiEdit.resizable").on("resize.qtiEdit.resizable",function(){s(t),o(t)})},destroy:function(t,i){s(t),i||e(window).off("resize.qtiEdit.resizable")},syncHandleHeight:function(t){t.hasClass("grid-row")?r(t):t.find(".grid-row").each(function(){r(e(this))})}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/content",["jquery","lodash","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function(t,e,i){var a={};return a.getContent=function(i,n){var r=e.defaults({inner:!0},n),o=r.inner?t(i).clone():t("<div>",{"class":"col-fictive content-helper-wrapper"}).append(t(i).clone());return a.destroyGridWidgets(o,!0),a.serializeElements(o),o.html()},a.getChangeCallback=function(i){return e.throttle(function(e){var n=t("<div>").html(e),r=a.getContent(n);i.body(r)},800)},a.getChangeCallbackForBlockStatic=function(i){return e.throttle(function(e){var n=t("<div>").html(e);n.contents().each(function(){return 3===this.nodeType&&this.nodeValue.trim()?(n.wrapInner("<p>"),n=t("<div>").html(n.html()),!1):void 0}),i.body(a.getContent(n))},800)},a.serializeElements=function(e){var i=[];return e.find(".widget-box:not(.widget-box *)").each(function(){var e=t(this);if(e.data("serial")){var a=e.data("serial");e.replaceWith("{{"+a+"}}"),i.push(a)}else{if(!e.data("new")||!e.data("qti-class"))throw"unknown qti-widget type";var n=e.data("qti-class");e.replaceWith("{{"+n+":new}}")}}),i},a.destroyGridWidgets=function(t,e){t.removeData("qti-grid-options"),t.find('.grid-row, [class*=" col-"], [class^="col-"]').removeAttr("style").removeAttr("data-active").removeAttr("data-units"),t.children(".ui-draggable-dragging").remove(),i.destroy(t,e)},a}),define("taoQtiItem/qtiCreator/widgets/helpers/content",["jquery","lodash","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,a,n){var r={};return r.createElements=function(r,o,s,c){var l=t("<div>").html(s);a.createElements(r,n.getContent(l),function(t){i.get().load(function(){for(var i in t){var a,n,r=t[i],s=o.find(".widget-box[data-new][data-qti-class="+r.qtiClass+"]");r.setRenderer(this),r.render(s),n=r.postRender(),a=n.$original,a.trigger("contentChange.gridEdit"),e.isFunction(c)&&c(n)}},this.getUsedClasses())})},r.changeInnerWidgetState=function(i,a){var n=[];e.each(["img","math","object"],function(t){n.push("[data-html-editable] .widget-"+t)}),i.$container.find(n.join(",")).each(function(){var e=t(this).data("widget");e&&e.changeState(a)})},r}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+="\n        "+p((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"You have deleted an element",n):h.call(t,"__","You have deleted an element",n)))+".\n    "}function o(t,e){var a,n,r,o="";return o+="\n        "+p((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"You have deleted",r):h.call(t,"__","You have deleted",r)))+" ",(n=i.count)?a=n.call(t,{hash:{},data:e}):(n=t&&t.count,a=typeof n===u?n.call(t,{hash:{},data:e}):n),o+=p(a)+" "+p((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"elements",r):h.call(t,"__","elements",r)))+".\n    "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h=i.helperMissing,p=this.escapeExpression,u="function",m=this;return d+='<div class="feedback-info popup" data-for="',(c=i.serial)?s=c.call(e,{hash:{},data:n}):(c=e&&e.serial,s=typeof c===u?c.call(e,{hash:{},data:n}):c),d+=p(s)+'">\n    <span class="icon-info"></span>\n    ',c=i.equal||e&&e.equal,l={hash:{},inverse:m.program(3,o,n),fn:m.program(1,r,n),data:n},s=c?c.call(e,e&&e.count,1,l):h.call(e,"equal",e&&e.count,1,l),(s||0===s)&&(d+=s),d+='\n    <a class="undo" href="#">'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"undo",l):h.call(e,"__","undo",l)))+'</a>\n    <span title="'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Remove Message",l):h.call(e,"__","Remove Message",l)))+'" class="icon-close close-trigger"></span>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/deletingState",["lodash","jquery","tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox"],function(t,e,i){var a=1e4,n=function(t){var i=setTimeout(function(){r(t,1e3)},a);e("body").on("mousedown.deleting keydown.deleting",function(i){i.target===t[0]||e.contains(t[0],i.target)||r(t,400)}),t.find("a.undo").on("click",function(e){e.preventDefault(),t.trigger("undo.deleting"),clearTimeout(i),t.remove()}),t.find(".close-trigger").on("click",function(e){e.preventDefault(),r(t,0)})},r=function(t,i){t.trigger("confirm.deleting"),t.fadeOut(i,function(){e(this).remove()})},o={createInfoBox:function(a){var o=e(i({serial:"widgets",count:a.length}));return e("body").append(o),o.css({display:"block",position:"fixed",top:"50px",left:"50%","margin-left":"-200px",width:"400px",zIndex:999999}),n(o),t.each(a,function(t){t.on("beforeStateInit",function(){r(o,400)})}),o}};return o}),define("taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor",["lodash","i18n","jquery","ckeditor","ckConfigurator","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/deletingState"],function(t,e,i,a,n,r,o,s){a.disableAutoInline=!0;
var c={placeholder:e("some text ..."),shieldInnerContent:!0},l=function(e,r,s){var l,d;if(s=t.defaults(s,c),!e instanceof i||!e.length)throw"invalid jquery element for $editable";if(!r instanceof i||!r.length)throw"invalid jquery element for $editableContainer";l=r.find('[data-role="cke-launcher"]'),e.attr("placeholder",s.placeholder),d=r.hasClass("widget-blockInteraction")||r.hasClass("widget-textBlock")||r.hasClass("widget-rubricBlock")?"qtiBlock":r.hasClass("qti-prompt-container")||r.hasClass("widget-hottext")?"qtiInline":"qtiFlow";var p={autoParagraph:!1,floatSpaceDockedOffsetY:10,taoQtiItem:{insert:function(){s.data&&s.data.container&&s.data.widget&&o.createElements(s.data.container,e,g(this.getData()),function(t){f(s.data.widget,t)})}},floatSpace:{debug:!0,initialHide:!0,centerElement:function(){return r.find('[data-role="cke-launcher"]')[0]},on:{ready:function(t){var e=i(this).find(".cke_nose"),a=e.parent(),n=i(this).find(".cke_toolbox");a.is(".cke")&&n.append(e),t.hide(),l.on("click",function(){l.hasClass("active")?(l.removeClass("active"),t.hide()):(l.addClass("active"),t.show())})},changeMode:function(t,e){var a=this,n=i(a),r=n.find(".cke_nose"),o=function(t){var e=new i.Deferred,a=0,n=setInterval(function(){var i=t.getAttribute("style");(a>5||i.indexOf("left")>-1||i.indexOf("right")>-1)&&(e.resolve(),clearInterval(n)),a++},1e3);return e.promise()};t!==e&&r.removeClass("float-space-"+t).addClass("float-space-"+e),i.when(o(a)).done(function(){a.style.left&&!a.style.right?r.removeClass("float-space-right").addClass("float-space-left"):r.removeClass("float-space-left").addClass("float-space-right")})}}},on:{instanceReady:function(a){var n={},r=a.editor,o=function(i){u(e,n,i),t.isFunction(s.change)&&s.change.call(i,g(i.getData()))};i("#cke_"+a.editor.name).find(".cke_combo_button").each(function(){var t=this;t.click(),setTimeout(function(){t.click()},500)}),e.data("editor",r),e.on("change",function(){o(r)}),r.on("change",function(){o(r)}),s.data&&s.data.container&&(e.data("qti-container",s.data.container),n=h(s.data.container,e,{restoreState:!0}),s.shieldInnerContent&&m(e,s.data.widget)),v(r),e.trigger("editorready",[r]),i(".qti-item").trigger("toolbarchange")},focus:function(){r.find('[data-role="cke-launcher"]').hide(),l.show(),t.isFunction(s.focus)&&s.focus.call(this,g(this.getData())),i(".qti-item").trigger("toolbarchange")},blur:function(){i(".qti-item").trigger("toolbarchange")},configLoaded:function(t){t.editor.config=n.getConfig(t.editor,d,p)},afterPaste:function(){}}};return a.inline(e[0],p)},d=function(t,e){var i;return i=t.data(e)?t:t.find("[data-"+e+"=true]")},h=function(e,i,a){a=a||{};var n={};return t.each(t.values(e.elements),function(t){var e=t.data("widget"),r=e.getCurrentState().name;n[t.serial]=e.rebuild({context:i,ready:function(t){a.restoreState&&t.changeState(r)}})}),i.trigger("widgetCreated",[n,e]),n},p=function(t,e){return t.find(".widget-box[data-serial="+e+"]")},u=function(e,i,a){var n=[];if(t.each(i,function(t){if(!t.element.data("removed")){var i=p(e,t.serial);i.length||n.push(t)}}),n.length){var r=s.createInfoBox(n);r.on("confirm.deleting",function(){t.each(n,function(t){t.element.remove(),t.destroy()})}).on("undo.deleting",function(){a.undoManager.undo()})}},m=function(t,e){t.find(".widget-box").each(function(){var t=i(this),a=t.data("widget"),n=i("<button>",{"class":"html-editable-shield"});t.attr("contenteditable",!1),t.append(n),n.on("click",function(t){t.stopPropagation(),f(e,a)})})},f=function(e,i){if(e&&e.element&&e.element.qtiClass){var a=function(){e.$container.off("widgetCreated").one("widgetCreated",function(e,a){var n=a[i.serial];n&&t.delay(function(){n.changeState(r.isA(i.element,"interaction")?"question":"active")},100)})};r.isA(e.element,"_container")?(a(),e.changeState("sleep")):r.isA(e.element,"choice")?(a(),e.changeState("question")):i.changeState(r.isA(i.element,"choice")?"choice":"active")}else i.changeState("active")},g=function(t){return t},v=function(t){t.focus();var e=t.createRange();e.moveToElementEditablePosition(t.editable(),!0),t.getSelection().selectRanges([e])},b={hasEditor:function(t){var e=!1;return d(t,"html-editable").each(function(){return e=!!i(this).data("editor")}),e},buildEditor:function(t,e){d(t,"html-editable-container").each(function(){var t,a=i(this),n=a.find("[data-html-editable]");n.attr("contenteditable",!0),t=l(n,a,e)})},destroyEditor:function(t){d(t,"html-editable-container").each(function(){var t=i(this),e=t.find("[data-html-editable]");if(t.find('[data-role="cke-launcher"]').off().removeClass("active").hide(),e.removeAttr("contenteditable"),e.data("editor")){var a=e.data("editor");a.focusManager.blur(!0),a.destroy(),e.removeData("editor"),e.data("qti-container")&&h(e.data("qti-container"),e)}})},getData:function(t){var e=t.data("editor");if(e)return g(e.getData());throw"no editor attached to the DOM element"},focus:function(t){d(t,"html-editable").each(function(){var t=i(this).data("editor");t&&v(t)})}};return b}),define("taoQtiItem/qtiCreator/editor/gridEditor/arrow",["lodash"],function(t){var e="arrowenter.gridEdit.gridDragDrop",i=function(i,r){var o={insertZoneWidth:20,marginWidth:0};r=t.extend(o,r);var s=$("<div>",{"class":"grid-edit-insert-box"}).css({top:0,width:r.insertZoneWidth,right:-(r.marginWidth+(r.insertZoneWidth-r.marginWidth)/2),height:i.parent(".grid-row").height()-parseFloat(i.css("margin-bottom"))}).append($("<div>",{"class":"grid-edit-insert-square"})).append($("<div>",{"class":"grid-edit-insert-triangle"})).append($("<div>",{"class":"grid-edit-insert-line"})).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){i.trigger(e,["right"]),a(i)}),c=s.clone().css({left:-(r.marginWidth+5),right:"auto"}).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){i.trigger(e,["left"]),a(i)});i.append(s).append(c),n(s,function(){i.trigger(e,["right"]),a(i)}),n(c,function(){i.trigger(e,["left"]),a(i)})},a=function(t){t.find(".grid-edit-insert-box").remove()},n=function(t,e){var i=null;t.on("mouseenter",function(t){var a=t.pageY-$(this).offset().top-parseInt($(this).find(".grid-edit-insert-triangle").outerHeight())-parseInt($(this).find(".grid-edit-insert-square").outerHeight()),n=$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square"),r=0;i=setInterval(function(){var t=4.905*Math.pow(r,2)/100;n.css("top",t),t>a&&(clearInterval(i),e()),r++},10)}).on("mouseleave",function(){$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square").css("top",0),clearInterval(i)})};return{create:i}}),define("taoQtiItem/qtiCreator/helper/gridUnits",["lodash"],function(t){function e(e,i,a){a=a||12;var n=0,r=0,o={},s={},c=[],l=[];for(var d in e)o[d]=t.clone(e[d]),n+=e[d].units,r++;var h=n/r;if(o[r+1]={elt:"middle",units:h,min:i},n+Math.round(h)>a){var p=0;for(var d in o){var u=o[d],m=u.units*a/(a+h);l[d]=Math.round(m%1*100),u.refactoredUnits=Math.round(m),u.min&&u.refactoredUnits<u.min&&(u.refactoredUnits=u.min,c[d]=!0),p+=u.refactoredUnits}if(p>a)for(var d;r+1>d;d++){var u=o[d];if(u.decimal>50&&u.refactoredUnits-1>u.min&&(u.refactoredUnits--,p--),p===a)break}var f=o[r+1].refactoredUnits,g=p>a?a:f;delete o[r+1],s={last:g,middle:f,cols:o,refactoredTotalUnits:p}}else{var v=a-n;s={last:v,middle:v,cols:{}}}return s}function i(e,i){i=i||12;var a=0,n=[],r=0,o=[],s=[],c=[];if(t.each(e,function(t){n.push(t),a+=t.units}),a>i)throw"the total number of units exceed the maximum of "+i;return t.each(n,function(t){var e=t.units*i/a,n=Math.round(e);r+=n,t.refactoredUnits=n,n>e?s.push(t):o.push(t)}),s=t.sortBy(s,"refactoredUnits"),o=t.sortBy(o,"refactoredUnits"),r>i?t.eachRight(s,function(t){return t.refactoredUnits--,r--,r===i?!1:void 0}):i>r&&t.each(o,function(t){return t.refactoredUnits++,r++,r===i?!1:void 0}),t.each(o,function(t){c.push(t)}),t.each(s,function(t){c.push(t)}),n}return{distribute:function(t,i,a){return e(t,i,a)},redistribute:function(t,e){return i(t,e)}}}),define("taoQtiItem/qtiCreator/editor/targetFinder",["jquery","lodash","taoQtiItem/qtiCreator/editor/ckEditor/dtdHandler","taoQtiItem/qtiCreator/helper/qtiElements"],function(t,e,i,a){"use strict";var n={itemBody:".widget-textBlock > [data-html-editable]",prompt:".qti-prompt[data-html-editable]",choice:".qti-choice [data-html-editable]"},r=function(t,e,i){var r=function(){var t,e={};for(t in i)i.hasOwnProperty(t)&&i[t]instanceof Function&&(e[t]=i[t]);return e}(),o=function(r,o){var s,c,l=t();if(o=o||document.body,o=t(o),a.is(r,"inlineInteraction"))c=o.find(n.itemBody),s="object";else switch(c=o.find(e.values(n).join(",")),c=o.find(n.itemBody),r){case"math":s="object";break;case"object.audio":case"object.video":s="object";break;default:s=r}var d=i.getParentsOf(s),h=d.join(",");return c.each(function(){var e=t(this),i=e.closest(".widget-box");e.is(h)&&(l=l.add(e)),l=l.add(e.find(h).not(function(){var e=t(this).closest(".widget-box");return e.length&&e[0]!==i[0]}))}),l};return e.extend(r,{getTargetsFor:o})}(jQuery,e,i);return r}),define("taoQtiItem/qtiCreator/editor/gridEditor/droppable",["jquery","lodash","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/arrow","taoQtiItem/qtiCreator/editor/targetFinder"],function(t,e,i,a,n,r,o){var s={};s.createDroppableBlocks=function(a,o,s){s=s||{};var c="string"==typeof s.min?s.min:0,l=s.initialPosition instanceof t?s.initialPosition:null,d=s.namespace?"."+s.namespace:"",f=s.data||{},g=t("<div>",{id:"qti-block-element-placeholder","class":"qti-droppable-block-hover"}),v=parseFloat(o.find('[class^="col-"]:last, [class*=" col-"]:last').css("margin-left")),b=0===o.children(".grid-row").length;o.addClass("dropping"),b?o.append(p().append(u().addClass("col-12"))):o.find(".grid-row").each(function(){var e=t(this),a=[],n=0,r=e.children(":not(.new-col)").each(function(){t(this).before(u().attr("data-index",t(this).index()/2)),n=Math.max(t(this).height(),n),a.push({elt:t(this),units:parseInt(t(this).attr("data-units"))})});r.last().after(u().attr("data-index","last")),r.height(n),e.data("distributed-units",i.distribute(a,c,12)),e.before(p().append(u()))}).last().after(p().append(u()));var I=function(t){t.length&&(g.data("dropped",!0).show().parent().removeClass("col-12").parent().removeData("active"),t.append(g))},C=function(){g.parent().parent().removeData("active"),g.removeData("dropped").hide(),o.append(g)},y=function(i,a){if("left"===a||"right"===a){m(o);var n=i.parent().attr("data-active",!0);n.children(":not(.new-col)").each(function(){t(this).attr("data-original-class",t(this).attr("class"))});var r=n.data("distributed-units"),s="left"===a?i.prev():i.next();if(I(s),r.refactoredTotalUnits>12){var c=s.is(":last-child")&&r.last?r.last:r.middle;s.attr("class","new-col col-"+c);var l=0,d=s.data("index"),h=function(t,e){t.next().attr("data-active",!0).append(e)};if("last"===d)h(n,s);else for(var p in r.cols){p==d&&(l+c>12&&h(n,s),l+=c);var u=r.cols[p];l+u.refactoredUnits>12&&h(n,u.elt),u.elt.attr("class","col-"+u.refactoredUnits),l+=u.refactoredUnits}}else s.is(":last-child")&&r.last?s.attr("class","new-col col-"+r.last):s.attr("class","new-col col-"+r.middle),e.each(r.cols,function(t){t.elt.attr("class","col-"+t.refactoredUnits)});var f=w(i);g.css("height","100%").parent().height(f)}},w=function(e,i){var a=0;void 0===i&&(i=!0),g.css("height","auto").parent().removeAttr("style");var n=e.siblings('[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)').andSelf();return n.removeAttr("style"),n.each(function(){a=Math.max(t(this).height(),a)}),n.height(a),i||e.removeAttr("style"),a};if(C(),l&&l.length){var q=l.prevAll('[class^="col-"], [class*=" col-"]').first(),x=l.nextAll('[class^="col-"], [class*=" col-"]').first();q.length?y(q,"right"):x.length&&y(x,"left")}o.on("mouseover.gridEdit.gridDragDrop",function(){var t=g.parent(".new-col");m(o),w(t,!1);var e=o.find(".new-col:last").css("background","1px solid red");I(e),e.addClass("col-12")}).on("mouseover.gridEdit.gridDragDrop",".grid-row",function(t){t.stopPropagation()}).on("mouseenter.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',function(){var e=t(this),i=g.parent(".new-col");C(),m(o),w(i,!1),w(e),r.create(e,{marginWidth:v})}).on("arrowenter.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',function(e,i){y(t(this),i)}).on("mousemove.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',e.throttle(function(e){var i=t(this),a=i.height(),n=e.pageY-i.offset().top,r=a/2>n?i.parent().prev():i.parent().next();if(!r.find("#qti-block-element-placeholder").length){var o=r.attr("data-active",!0).children(".new-col").addClass("col-12");o.length?I(o):console.log("insert form col failure ",i,r)}},100)).on("mouseleave.gridEdit.gridDragDrop",'[class^="col-"], [class*=" col-"]',function(e){e.stopPropagation(),t(this).find(".grid-edit-insert-box").remove()}).on("mouseleave.gridEdit.gridDragDrop",function(){g.hide(),C(),m(o)}),o.one("dragoverstop.gridEdit",function(){o.off(".gridEdit.gridDragDrop");var e=g.parent(".new-col"),i=!!e.length;i&&(g.removeAttr("id").removeClass("qti-droppable-block-hover"),e.data("qti-class",a).removeClass("new-col").removeAttr("data-index"),n.setUnitsFromClass(e),e.parent(".grid-row-new").removeClass("grid-row-new"),o.find(".grid-row[data-active=true]").each(function(){var e=t(this);e.removeClass("grid-row-new"),e.children(":not(.new-col)").removeAttr("data-original-class").each(function(){n.setUnitsFromClass(t(this))})})),h(o),i&&g.data("dropped")&&o.trigger("dropped.gridEdit"+d,[a,g,f])})};var c=null,l=function(t){c&&clearInterval(c);var e=1e3;setInterval(function(){t.animate({opacity:.1},.5*e,function(){t.animate({opacity:.9},.5*e)})},e)};s.createDroppableInlines=function(e,i,a){var n=a.namespace?"."+a.namespace:"",r=a.data||{},s=o.getTargetsFor(e,i),c=!1;s.addClass("drop-target"),s.contents().each(function(){3!==this.nodeType||this.nodeValue.match(/^\s+$/)||t(this).replaceWith(t.map(this.nodeValue.split(/(\S+)/),function(e){return e.match(/^\s*$/)?document.createTextNode(e):t("<span>",{text:e,"class":"qti-word-wrap"}).get()}))});var h=t("<span>",{id:"qti-inline-element-placeholder","data-inline":!0});h.append(t("<span>",{"class":"cursor-h"})).append(t("<span>",{"class":"cursor-v"})),l(h);var p=function(){h.detach(),c=!1};p(i);var u=function(){return c=!0,h};i.on("mousemove.gridEdit.gridDragDrop","span.qti-word-wrap",function(e){var i=t(this).width(),a=t(this).offset(),n=e.pageX-a.left;i/2>n?t(this).before(u()):t(this).after(u())}).on("mouseover.gridEdit.gridDragDrop",function(e){e.stopPropagation();var a=t(e.target);a.hasClass("drop-target")&&!a.find(h).length?a.append(u()):a[0]===h[0]||a.hasClass("qti-word-wrap")||a.children(".qti-word-wrap").length||p(i)}),i.one("dragoverstop.gridEdit",function(){c&&h.removeAttr("id").removeAttr("class"),d(i),c?i.trigger("dropped.gridEdit"+n,[e,h,r]):(h.remove(),h=null)})},s.destroyDroppables=function(t){d(t),h(t)};var d=function(e){e.off(".gridEdit.gridDragDrop"),e.find("span.qti-word-wrap").replaceWith(function(){return t(this).text()}),e.find(".drop-target").removeClass("drop-target")},h=function(t){t.removeClass("dropping").off(".gridEdit.gridDragDrop"),t.find('[class^="col-"], [class*=" col-"]').removeAttr("style"),m(t);var e=["#qti-block-element-placeholder",".new-col",".grid-row-new",".grid-edit-insert-box"];t.find(e.join(",")).remove()},p=function(){return t("<div>",{"class":"grid-row grid-row-new","data-units":0})},u=function(){return t("<div>",{"class":"new-col"})},m=function(e){e.find(".grid-row").each(function(){var e=t(this);if(e.children(".new-col").attr("class","new-col").removeAttr("style"),e.hasClass("grid-row-new")){var i=e.children();i.length>1&&(e.prev().append(i),e.append(i.first()))}e.children(":not(.new-col)").each(function(){var e=t(this),i=e.attr("data-original-class");i&&e.attr("class",i).removeAttr("data-original-class")}),e.removeAttr("data-active")})};return s}),define("taoQtiItem/qtiCreator/editor/gridEditor/draggable",["jquery","lodash","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/droppable","jqueryui"],function(t,e,i,a){var n={helper:function(){return t(this).clone()}},r=function(t,i,a){var r=e.defaults(a,n);o(t,i,{helper:r.helper,namespace:"insertable"})},o=function(n,r,o){var s=e.defaults(o,{distance:1,helper:"original"});n.draggable({distance:parseInt(s.distance),helper:s.helper,appendTo:t(document.body),opacity:1,scroll:!1,cursor:"crosshair",cursorAt:{left:-5,bottom:-5},create:function(){t(this).addClass("grid-draggable")},start:function(e,n){r.trigger("beforedragoverstart.gridEdit"),"function"==typeof s.start&&s.start.call(this,e,n),t(this).removeClass("grid-draggable-active");var o=t(this).data("qti-class");if(i.isInline(o))a.createDroppableInlines(o,r,s);else{if(!i.isBlock(o))throw"undefined qti class";a.createDroppableBlocks(o,r,s)}r.trigger("dragoverstart.gridEdit")},stop:function(e,i){t("body").css("cursor","auto"),i.helper.remove(),"function"==typeof s.stop&&s.stop.call(this,e,i),r.trigger("dragoverstop.gridEdit")}}),n.on("mousedown.gridDraggable.gridEdit",function(){t(this).addClass("grid-draggable-active")}).on("mouseup.gridDraggable.gridEdit",function(){t(this).removeClass("grid-draggable-active")})},s=function(e,i){var a=e.parent('[class^="col-"], [class*=" col-"]');o(e,i,{distance:5,initialPosition:e.parent(),namespace:"movable",start:function(){e.hide(),a.data({"initial-position":!0,"initial-class":a.attr("class")}).attr("class","new-col")},helper:function(){return t(this).clone().addClass("grid-draggable-helper").css({height:t(this).height(),width:t(this).width()})},stop:function(){e.data("grid-element-dropped")||a.attr("class",a.data("initial-class")),e.data("grid-element-dropped",!1),e.show()},data:{widget:e.data("widget")}})},c=function(t){t.draggable("destroy"),t.removeClass("grid-draggable"),t.off(".gridDraggable")};return{createInsertable:function(t,e,i){r(t,e,i)},createMovable:function(t,e,i){s(t,e,i)},destroy:c}}),define("taoQtiItem/qtiCreator/editor/jquery.gridEditor",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/gridEditor/draggable","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function(t,e,i,a,n){function r(t){return"object"==typeof t.data("qti-grid-options")}function o(i,a){i.data("qti-grid-options",a),i.find(".grid-row").each(function(){var i=0;t(this).children('[class*=" col-"], [class^="col-"]').each(function(){i+=e.setUnitsFromClass(t(this))})})}function s(t){i.destroyGridWidgets(t)}function c(t){return i.getContent(t)}t.fn.gridEditor=function(e){var i={},a="",n=[],s=void 0;return"object"==typeof e?i=t.extend({},t.fn.gridEditor.defaults,e):void 0===e?i=t.extend({},t.fn.gridEditor.defaults):"string"==typeof e&&"function"==typeof l[e]&&(a=e,n=Array.prototype.slice.call(arguments,1)),this.each(function(){var e=t(this);a?r(e)?s=l[a].apply(t(this),n):t.error("call of method of gridEditor while it has not been initialized"):r(e)||"object"!=typeof i||o(e,i)}),void 0===s?this:s},t.fn.gridEditor.defaults={elementClass:"itemBody"};var l={addInsertables:function(e,i){var n=t(this);e.each(function(){a.createInsertable(t(this),n,i)})},createMovables:function(e){var i=t(this);e.each(function(){a.createMovable(t(this),i)})},destroy:function(){s(t(this))},getContent:function(){return c(t(this))},setContent:function(e){e&&setContent(t(this),e)},resizable:function(){n.create(t(this))}}}),define("taoQtiItem/qtiCreator/editor/widgetToolbar",["jquery","i18n"],function(t,e){"use strict";var i=[[{title:"Question","class":"question-trigger",status:"off",fn:function(){var t=arguments[1],e=arguments[2],i=e.find(".answer-trigger a"),a=t.find('[data-edit="answer"]'),n=t.find('[data-edit="question"]');i.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),n.show(),a.hide(),t.data("mode","question")}},{title:"Answer","class":"answer-trigger",fn:function(){var e=arguments[1],i=arguments[2],a=i.find(".question-trigger a"),n=e.find('[data-edit="answer"]'),r=e.find('[data-edit="question"]');a.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),n.show(),r.hide(),e.data("mode","answer"),e.find("[contenteditable]").attr("contenteditable",!1),t(document).trigger("widgetBlur")}}],"spacer",[{icon:"bin",title:"Delete",fn:function(){var i=arguments[1],a=arguments[2],n=t("<span>",{text:e("You have deleted an element.")+" "}),r=t("<a>",{text:e("Undo"),href:"#"}),o=t("<span>",{"class":"icon-info"}),s=t("<span>",{title:"Remove Message","class":"icon-close close-trigger"}),c=t("<div>",{"class":"feedback-info"}).hide();s.on("click",function(){c.fadeOut(function(){c.remove(),i.remove(),a.remove()})}),r.on("click",function(t){t.preventDefault(),c.remove(),i.removeClass("deleted").fadeIn()}),c.append(o),c.append(n),c.append(r),c.append(s),i.before(c),a.hide(),i.hide().addClass("deleted"),c.fadeIn(function(){setTimeout(function(){s.trigger("click")},6500)})}}]],a=function(e){switch(e){case"/":e="break";break;case"-":e="separator";break;case" ":e="spacer"}return t("<span>",{"class":"tlb-"+e})},n=function(e,i,n){var o,s,c=t("<div>",{"class":"tlb-bar"}),l=!e[0].icon,d=e.length;if(c.append(a("start")),l)for(s=0;d>s;s++)"string"===t.type(e[s])?c.append(a(e[s])):(e[s].target=i,e[s].toolbar=n,c.append(r(e[s],l)));else for(o=t("<div>",{"class":"tlb-group"}),c.append(o),s=0;d>s;s++)"string"===t.type(e[s])?o.append(a(e[s])):(e[s].target=i,e[s].toolbar=n,o.append(r(e[s],l)));return c.append(a("end")),c},r=function(i,a){var n,r,o,s,c,l=i.status||"off",d=i.fn||function(){},h=i.target||t(),p=i.toolbar||t();return delete i.status,delete i.fn,delete i.target,delete i.toolbar,a?(c=e(i.title),delete i.title,i["class"]=i["class"]?i["class"]+" tlb-text-button-box":"tlb-text-button-box",o=t("<span>",i),n=t("<a>",{"class":"tlb-text-button-"+l}),r=t("<span>",{"class":"tlb-text",text:c}),o.append(n),n.append(r)):(s="icon-"+i.icon.replace("icon-",""),delete i.icon,i["class"]=i["class"]?i["class"]+" tlb-button-"+l:"tlb-button-"+l,o=t("<a>",i),r=t("<span>",{"class":s}),o.append(r)),o.on("click.toolbar",function(t){return o.hasClass("tlb-text-button-disabled")||o.hasClass("tlb-button-disabled")?!1:(a?o.find("a").toggleClass("tlb-text-button-off").toggleClass("tlb-text-button-on"):o.toggleClass("tlb-button-off").toggleClass("tlb-button-on"),void d.apply(this,[t,h,p]))}),o},o=function(e,a){return t.isArray(e)&&!e.length&&(e=!1),e?a&&(e=t.extend(i,e)):e=i,e},s=function(e,i,r){var o,s=t("<div>",{"class":"tlb"}),c=t("<div>",{"class":"tlb-top"}),l=t("<div>",{"class":"tlb-box"}),d=e.length;for(c.append(l),s.append(c),o=0;d>o;o++)l.append("string"===t.type(e[o])?a(e[o]):n(e[o],i,r));return s.data("edit","toolbar"),s};return function(){var e=function(e,i){var a,n,r,c={offsetTop:-2,title:"",extendDefaultConfig:!1,target:t()},l=t(i.target),d=l.prop("tlb")||t("<div>",{"class":"tlb-wrapper"});return l.prop("tlb")||(e=o(e,i.extendDefaultConfig),i=t.extend(c,i||{}),a=s(e,l,d),i.title&&(n=t("<span>",{text:i.title,"class":"tlb-title",title:i.title}),d.append(n)),d.append(a),l.prop("tlb",d),l.append(d),d.css("position","absolute"),d.css("display","none"),d.css("width","100%"),r=c.offsetTop-d.height(),d.css("top",r)),d.fadeIn(),d};return{attach:e}}()}),define("tpl!taoQtiItem/qtiCreator/tpl/container",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='<div data-html-editable="true">',(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===d?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="</div>"}function o(t,e){var a,n,r="";return(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===d?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="function",h=this,p=i.helperMissing;return c=i.equal||e&&e.equal,l={hash:{},inverse:h.program(3,o,n),fn:h.program(1,r,n),data:n},s=c?c.call(e,e&&e.contentModel,"blockStatic",l):p.call(e,"equal",e&&e.contentModel,"blockStatic",l),s||0===s?s:""})}),define("taoQtiItem/qtiCreator/renderers/Container",["tpl!taoQtiItem/qtiCreator/tpl/container"],function(t){return{qtiClass:"_container",template:t}}),define("taoQtiItem/qtiCreator/widgets/Widget",["lodash","jquery","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/invalidator"],function(t,e,i,a){var n=function(t,e){var i=new t.registeredStates[e](t);t.stateStack.push(i),i.init()},r=function(t){var e=t.stateStack.pop();e&&e.exit()},o={init:function(e,a,n,r){if(!(e instanceof i))throw new Error("element is not a QTI Element");return r=r||{},this.element=e,this.serial=e.getSerial(),this.$original=a,this.$form=n,this.stateStack=[],this.registeredStates={},this.buildContainer(),this.$container.data("widget",this),this.$original.data("widget",this),this.element.data("widget",this),this.offEvents(),t.each(this.getRequiredOptions(),function(t){if(!r[t])throw new Error("missing required option for image creator : "+t)}),this.options=r,this.initCreator(r),this.changeState(r.state?r.state:"sleep"),t.isFunction(r.ready)&&r.ready.call(this,this),this},getRequiredOptions:function(){return[]},buildContainer:function(){throw new Error("method buildContainer must be implemented")},build:function(t,e,i,a){return this.clone().init(t,e,i,a)},clone:function(){return t.clone(this)},initCreator:function(){},getCurrentState:function(){return t.last(this.stateStack)},changeState:function(e){var i,a,o=this,s=this.getCurrentState();if(!this.registeredStates[e])throw new Error("unknown target state : "+e);if(i=new this.registeredStates[e],s){if(s.name===i.name)return this;if(t.indexOf(i.superState,s.name)>=0)for(var c=t.indexOf(i.superState,s.name)-1;c>=0;c--)a=i.superState[c],n(this,a);else{if(t.indexOf(s.superState,i.name)>=0){for(var c=0;c<=t.indexOf(s.superState,i.name);c++)r(o);return this}r(o);var l=t.difference(s.superState,i.superState);t.each(l,function(){r(o)});var d=t.difference(i.superState,s.superState);t.eachRight(d,function(t){n(o,t)})}}else t.eachRight(i.superState,function(t){n(o,t)});return n(this,e),this},registerState:function(t,e){if(!t||!e)throw new Error("missing required arguments in state registration");this.registeredStates[t]=e},registerStates:function(e){var i=this;t.forIn(e,function(t,e){i.registerState(e,t)})},afterStateInit:function(t,i){var a="afterStateInit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(a,t)},beforeStateInit:function(t,i){var a="beforeStateInit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(a,t)},afterStateExit:function(t,i){var a="afterStateExit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(a,t)},beforeStateExit:function(t,i){var a="beforeStateExit.qti-widget."+this.serial+(i?"."+i:"");e(document).on(a,t)},offEvents:function(t){var i=".qti-widget."+this.serial+(t?"."+t:"");e(document).off(i)},destroy:function(){this.changeState("sleep"),this.$container.find("[data-edit]").remove(),e("[data-widget-component="+this.serial+"]").remove(),this.offEvents()},rebuild:function(e){e=e||{};var i=this.element,a={};t.isFunction(e.ready)&&(a.ready=e.ready);var n=null;n=e.context&&e.context.length?e.context.find(".widget-box[data-serial="+i.serial+"]"):this.$container,this.destroy();var r=i.getRenderer();if(r&&r.isRenderer){if("creatorRenderer"===r.name)return i.render(n),i.postRender(a);throw new Error("The renderer is no longer the creatorRenderer")}throw new Error("No renderer found to rebuild the widget")},on:function(i,a,n){var r=this,o=i.replace(/\s+/g," ").split(" "),s=e(document);return t.each(o,function(t){var e=[t,"qti-widget",r.serial];n||e.push(r.getCurrentState().name),s.on(e.join("."),function(t,e){a.call(r,e)})}),this},isValid:function(t,e,i){var n=this.element;return void 0===t?a.isValid(n):void(e?a.valid(n,t):a.invalid(n,t,i,this.getCurrentState().name))}};return o}),define("taoQtiItem/qtiCreator/widgets/static/Widget",["jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/editor/widgetToolbar"],function(t,e){var i=e.clone();return i.initCreator=function(){e.initCreator.call(this),this.createToolbar()},i.buildContainer=function(){var e=t("<div>",{"data-serial":this.element.serial,"class":"widget-box"});this.$original.wrap(e),this.$container=this.$original.parent()},i.createToolbar=function(){return this},i.createOkButton=function(){var e=this;this.$container.append(t("<button>",{"class":"btn-info small",type:"button",text:"OK","data-edit":"active"}).css({margin:"5px 10px",display:"none"}).on("click.qti-widget",function(t){t.stopPropagation(),e.changeState("sleep")}))},i}),define("taoQtiItem/qtiCreator/widgets/states/factory",["lodash"],function(t){var e=function(e){return t.isFunction(e)?e.prototype.name&&e.prototype.superState?t.isFunction(e.prototype.init)&&t.isFunction(e.prototype.exit)?!0:!1:!1:!1},i=function(t,e,i,a){var n=function(t){this.widget=t};return n.prototype.name=t,n.prototype.superState=e||[],i&&a&&(n.prototype.init=function(){var e=this.widget.$container;e.data("edit")===t&&e.show();var a=e.find('[data-edit="'+t+'"]').filter(function(){var t=$(this).closest(".widget-box");return t.length&&t[0]===e[0]?!0:!1});a.show(),this.widget.$container.addClass("edit-"+t),$(document).trigger("beforeStateInit.qti-widget",[this.widget.element,this]),i.call(this),$(document).trigger("afterStateInit.qti-widget",[this.widget.element,this])},n.init=i,n.prototype.exit=function(){this.widget.$container.data("edit")===t&&this.widget.$container.hide(),this.widget.$container.find('[data-edit="'+t+'"]').hide(),this.widget.$container.removeClass("edit-"+t),$(document).trigger("beforeStateExit.qti-widget",[this.widget.element,this]),$(document).off([".qti-widget",t,this.widget.serial].join(".")),a.call(this),$(document).trigger("afterStateExit.qti-widget",[this.widget.element,this])},n.exit=a),n};return{create:function(){var a,n,r,o,s;if(t.isString(arguments[0]))if(n=arguments[0],t.isArray(arguments[1])){if(r=arguments[1],!t.isFunction(arguments[2])||!t.isFunction(arguments[3]))throw new Error("the third and fourth arguments are expected to be functions: init() & exit()");o=arguments[2],s=arguments[3],a=i(n,r,o,s)}else{if(r=[],!t.isFunction(arguments[1])||!t.isFunction(arguments[2]))throw new Error("the second and third arguments are expected to be functions: init() & exit()");o=arguments[1],s=arguments[2],a=i(n,r,o,s)}else{if(!e(arguments[0]))throw new Error("invalid first argument : expected the state name (string) or a State (function)");if(n=arguments[0].prototype.name,r=arguments[0].prototype.superState,!t.isFunction(arguments[1])||!t.isFunction(arguments[2]))throw new Error("the second and third arguments are expected to be functions: init() & exit()");o=arguments[1],s=arguments[2],a=i(n,r,o,s)}return a},extend:function(a,n,r){var o,s,c=null;if(!e(a))throw new Error("invalid state to be cloned");return t.isFunction(n)&&(o=function(){a.init.call(this),n.call(this)}),t.isFunction(r)&&(s=function(){r.call(this),a.exit.call(this)}),c=i(a.prototype.name,a.prototype.superState,o,s),t.forIn(a.prototype,function(e,i){if(t.isFunction(e)){if(o&&"init"===i||s&&"exit"===i)return!0;c.prototype[i]=e,c[i]=e}}),c},createBundle:function(){var i={},a=[],n=[];return arguments.length>=2?(i=t.clone(arguments[0]),a=arguments[1],n=arguments[2]||n):a=arguments[0],t.each(a,function(t){e(t)&&(i[t.prototype.name]=t)}),t.each(n,function(t){delete i[t]}),i},throwMissingRequiredImplementationError:function(t){throw new Error("Missing required implementation of the function "+t+"()")}}}),define("taoQtiItem/qtiCreator/widgets/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("sleep",function(){var t=this.widget,e=this.widget.$container;e.on("mouseenter.sleep",function(){e.addClass("hover"),e.parent().trigger("mouseleave")}).on("mouseleave.sleep",function(){e.removeClass("hover"),e.parent().trigger("mouseenter")
}),t.isValid()||t.changeState("invalid")},function(){this.widget.$container.removeClass("hover").off(".sleep")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){var i=t.extend(e,function(){var t=this.widget;t.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),t.changeState("active")})},function(){var t=this.widget;t.$container.off(".sleep")});return i}),define("taoQtiItem/qtiCreator/widgets/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/content"],function(t,e,i){return e.create("active",function(){var e=this.widget,i=e.$container[0],a=this.widget.element.getRelatedItem();t("#item-editor-panel").on("click.active",function(a){i===a.target||t.contains(i,a.target)||e.changeState("sleep")}).on("styleedit.active",function(){e.changeState("sleep")}),a&&a.data("widget").$container.on("resizestart.gridEdit.active beforedragoverstart.gridEdit.active",function(){e.changeState("sleep")})},function(){i.changeInnerWidgetState(this.widget,"sleep"),this.widget.$container.off(".active"),t("#item-editor-panel").off(".active");var e=this.widget.element.getRelatedItem();e&&e.data("widget").$container.off(".active")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function(t,e){return t.extend(e,function(){var t=this.widget,e=t.$container;t.beforeStateInit(function(e,i,a){var n=i.getSerial();if("active"===a.name&&n!==t.serial||"choice"===a.name)if("rubricBlock"===t.element.qtiClass){var r=t.element.getComposingElements();r[i.serial]||t.changeState("sleep")}else t.changeState("sleep")},"otherActive"),e.on("mouseenter.active",function(t){t.stopPropagation(),e.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(t){t.stopPropagation(),e.parent().trigger("mouseenter.sleep")}).on("click.active",function(t){t.stopPropagation()})},function(){this.widget.$container.off(".active"),$("#item-editor-panel").off(".active"),this.widget.offEvents("otherActive")})}),define("taoQtiItem/qtiCreator/widgets/states/Inactive",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("inactive",function(){},function(){})}),define("taoQtiItem/qtiCreator/widgets/states/Deleting",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/deletingState","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content","lodash"],function(t,e,i,a,n,r){var o=t.create("deleting",function(){var t=this.widget.element;this.refactoredUnits=[],this.updateBody=!1,this.$elementToRemove=this.getElementToRemove(),this.hideWidget(),this.showMessage(t),t.data("deleting",!0),this.item=t.getRelatedItem(),this.$item=this.item.data("widget").$container.find(".qti-itemBody"),this.updateBody&&this.$item.trigger("resize.qti-widget")},function(){this.showWidget(),this.widget.element.data("deleting",!1),$("body").off(".deleting"),this.updateBody&&this.$item.trigger("resize.qti-widget")});o.prototype.getElementToRemove=function(){var t=this.widget.$container;if(t.hasClass("qti-choice")){if("TH"!==t.prop("tagName"))return t;if("THEAD"===t.parent().parent().prop("tagName")){var e=t.closest("table.matrix").children("tbody"),i=e.children("tr").find("td:last");return t.add(i)}if("TBODY"===t.parent().parent().prop("tagName"))return t.parent()}if(t.hasClass("widget-inline"))return t.add(this.widget.$original);var a=t.parent(),n=a.parent(".grid-row");return n.length?(this.updateBody=!0,1===n.children().length?n:a):t.hasClass("grid-row")?(this.updateBody=!0,t):void 0},o.prototype.hideWidget=function(){var t=this.$elementToRemove;t.length&&(t.hide(),s(t)&&(this.refactoredUnits=c(t)))};var s=function(t){var e=t.attr("class");return e&&/col-([\d]+)/.test(e)},c=function(t){var e=t.data("units"),n=t.siblings(),o=[];return n.each(function(){var t=$(this),i=t.data("units");o.push({elt:t,units:i}),e+=i}),o=i.redistribute(o),r.each(o,function(t){t.elt.removeClass("col-"+t.units).addClass("col-"+t.refactoredUnits),a.setUnitsFromClass(t.elt)}),t.data("redistributedUnits",o),o};return o.prototype.showWidget=function(){var t=this.$elementToRemove;t.length&&$.contains(document,t[0])&&(t.show(),s(t)&&r.each(this.refactoredUnits,function(t){t.elt.removeClass("col-"+t.refactoredUnits).addClass("col-"+t.units),a.setUnitsFromClass(t.elt)}))},o.prototype.showMessage=function(){var t=this,i=this.widget,a=e.createInfoBox([i]);a.on("confirm.deleting",function(){t.deleteElement()}).on("undo.deleting",function(){try{i.changeState("question")}catch(t){i.changeState("active")}}),this.messageBox=a},o.prototype.deleteElement=function(){this.refactoredUnits=[],this.$elementToRemove.remove(),this.widget.destroy(),this.widget.element.remove(),this.updateBody&&this.item.body(n.getContent(this.$item))},o}),define("taoQtiItem/qtiCreator/widgets/static/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Deleting"],function(t){return t.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/img",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    <label for="src">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n    <input type="text" name="src" value="',(o=i.src)?r=o.call(e,{hash:{},data:n}):(o=e&&e.src,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n    <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n</div>\n\n<div class="panel">\n    <label for="alt">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Label",s):l.call(e,"__","Label",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The text to be displayed if the image is not available.",s):l.call(e,"__","The text to be displayed if the image is not available.",s)))+'</div>\n    <input type="text" name="alt" value="',(o=i.alt)?r=o.call(e,{hash:{},data:n}):(o=e&&e.alt,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty" placeholder="e.g. House with a garden"/>\n</div>\n\n\n<div data-role="advanced" style="display:none">\n    \n    <hr/>\n    \n<!--    <div class="panel">\n        <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Size and position",s):l.call(e,"__","Size and position",s)))+'</h3>\n\n        <p class="img-resizer-slider"></p>\n\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="align">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Alignment",s):l.call(e,"__","Alignment",s)))+'</label>\n        <select name="align" class="select2" data-has-search="false">\n            <option value="default">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"default",s):l.call(e,"__","default",s)))+'</option>\n            <option value="left">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"left",s):l.call(e,"__","left",s)))+'</option>\n            <option value="right">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"right",s):l.call(e,"__","right",s)))+"</option>\n        </select>\n    </div>-->\n    \n    <h3>"+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Size and position",s):l.call(e,"__","Size and position",s)))+'</h3>\n    <div class="panel img-resizer"></div>\n    \n</div>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/validators",["core/validator/validators","lodash","i18n","taoQtiItem/qtiItem/core/Element"],function(t,e,i,a){var n=/^[_a-zA-Z]{1}[a-zA-Z0-9\-._]{0,31}$/i,r=[{name:"qtiIdentifier",message:i("invalid identifier"),validate:function(t,e){"function"==typeof e&&e(n.test(t))}},{name:"availableIdentifier",message:i("this identifier is already in use"),validate:function(t,e,i){if(!i.serial)throw'missing required option "serial"';var n=a.getElementBySerial(i.serial);if(n&&"function"==typeof e){var r=n.getRelatedItem().getUsedIdentifiers(),o=!r[t]||r[t].serial===n.serial;e(o)}}}];return e.each(r,function(e){t.register(e.name,e)}),t}),define("taoQtiItem/qtiCreator/widgets/helpers/formElement",["jquery","lodash","i18n","taoQtiItem/qtiItem/core/Element","util/dom","ui/incrementer","ui/tooltipster","ui/selecter","ui/inplacer","ui/groupvalidator","taoQtiItem/qtiCreator/widgets/helpers/validators","polyfill/placeholders"],function(t,e,i,a,n,r,o,s){var c={initWidget:function(t){r(t),o(t),s(t)},setChangeCallbacks:function(i,a,n,r){n=n||{},r=e.defaults(r||{},{validateOnInit:!1});var o=function(t,i,r){var o=n[t];e.isFunction(o)&&o.call(r[0],a,i,t)},s={simple:function(){var e=t(this),i=e.attr("name");e.is(":checkbox")?o(i,e.prop("checked"),e):o(i,e.val(),e)},withValidation:function(e,i,n){if("group"===e.namespace){var s=t(n),c=s.attr("name"),l=a.data("widget");return void(r.invalidate?(o(c,s.val(),s),l.isValid(c,i)):i&&o(c,s.val(),s))}}};i.off(".databinding"),i.on("change.databinding keyup.databinding",":checkbox, :radio, select, :text:not([data-validate])",s.simple),i.on("keyup.databinding input.databinding propertychange.databinding","textarea",s.simple),i.on("validated.group.databinding",s.withValidation),e.defer(function(){i.groupValidator({validateOnInit:r.validateOnInit,events:["change","blur",{type:"keyup",length:0}],callback:d})})},initTitle:function(e,a){var n=e.hasClass("qti-title")?e:e.find(".qti-title");n.inplacer({target:t("#qti-title")}).attr("title",i("Edit modal feedback title")).on("change",function(){a.attr("title",t(this).text())})},getAttributeChangeCallback:function(t){return function(e,i,a){t||""!==i?e.attr(a,i):e.removeAttr(a)}},getMinMaxAttributeCallbacks:function(t,e,i,a){var n=t.find("input[name="+i+"]"),r={};return r[e]=function(t,e,i){var a={min:0};if(0===parseInt(e))t.removeAttr(i);else{e=parseInt(e),t.attr(i,e),a.min=e;var r=parseInt(n.val());e>r&&n.val(e)}n.incrementer("options",a).keyup()},r[i]=function(t,e,i){e=parseInt(e)||0,t.is("interaction")&&l(t,e,a),e||!t.is("orderInteraction")&&!t.is("graphicOrderInteraction")?t.attr(i,e):t.removeAttr(i)},r}},l=function(t,i,n){if(!a.isA(t,"interaction"))throw new Error("the first argument must be an interaction, the current element is "+t.qtiClass);n=void 0===n?!0:!!n;var r=t.getResponseDeclaration();if(n&&r.attr("cardinality",1===i?"single":"multiple"),i){var o=[];e.each(r.getCorrect(),function(t){return o.length<i?void o.push(t):!1}),r.setCorrect(o)}},d=function(i,a){var r,o=t(this);n.contains(o)&&(h(o),o.tooltipster("hide"),i||(r=e.where(a,{type:"failure"})[0],r&&r.data.message&&(o.tooltipster("content",r.data.message),t("#mediaManager").children(".opened").length||o.tooltipster("show"))))},h=function(t){t.hasClass("tooltipstered")||t.tooltipster({theme:"tao-error-tooltip",content:"",delay:350,trigger:"custom"})};return c}),define("taoQtiItem/qtiCreator/helper/dummyElement",["jquery","lodash"],function(t,e){var i=function(){var i={maths:{icon:"maths",css:{width:40,height:22}},image:{icon:"image",css:{width:50,height:35}},video:{icon:"video",css:{width:200,height:150}},media:{icon:"media",css:{width:150,height:100}}},a=function(a){var n,r,o,s,c,l={element:"span","class":"dummy-element",css:{width:80,height:22}};return a&&(t.isPlainObject(a)?(a.class&&(l.class+=" "+a.class,delete a.class),l=t.extend(!0,{},l,a)):i[a]&&(l=t.extend({},l,i[a]))),o=l.icon?t("<span>",{"class":"icon-"+l.icon.replace("icon-","")}):!1,n="<"+l.element+">",s=e.cloneDeep(l.css),s["font-size"]=s.height&&!s["font-size"]?.8*s.height:14,s.height>30&&(s["padding-top"]=(s.height-s["font-size"])/2*.9),s.height&&s.height>100&&(s["background-size"]="auto"),c=e.cloneDeep(l),delete c.icon,delete c.element,delete c.css,r=t(n,c).css(s),o&&r.append(o),r};return{get:a}}();return i}),define("taoQtiItem/qtiCreator/widgets/static/helpers/inline",["lodash","taoQtiItem/qtiCreator/helper/dummyElement","core/validator/validators"],function(t,e,i){var a={math:"maths",img:"image",object:"media"};return inlineHelper={checkFileExists:function(t,e,a){var n=t.element;i.validators.fileExists.validate(n.attr(e),function(i){i||(n.attr(e,""),inlineHelper.togglePlaceholder(t))},{baseUrl:a||""})},togglePlaceholder:function(i,n){var r=t.defaults(n||{},{container:i.$original,type:i.element.qtiClass}),o=r.container,s=o.siblings(".dummy-element");if(i.element.isEmpty()){o.hide();var c=a[r.type]||r.type;s.length||(s=e.get(c),o.after(s)),s.show()}else o.show(),s.hide();i.$container.trigger("contentChange.qti-widget")},positionFloat:function(t,e){var i=t.$container,a=t.element;switch(i.removeClass("rgt lft"),a.removeClass("rgt"),a.removeClass("lft"),e){case"right":i.addClass("rgt"),a.addClass("rgt");break;case"left":i.addClass("lft"),a.addClass("lft")}}}}),define("util/image",[],function(){return{getSize:function(t,e,i){var a,n=document.createElement("img");"function"==typeof e&&(i=e,e=2),n.onload=function(){a&&(clearTimeout(a),i({width:n.naturalWidth||n.width,height:n.naturalHeight||n.height}))},n.onerror=function(){a&&(clearTimeout(a),i(null))},a=setTimeout(function(){i(null)},1e3*e),n.src=t}}}),define("tpl!ui/mediasizer/mediasizer",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=this,h=i.helperMissing,p=this.escapeExpression;return l+='<div class="media-sizer media-sizer-synced">\n\n    <label>\n        <input type="checkbox" ',o=i["if"].call(e,e&&e.responsive,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+=' class="media-mode-switch"/>\n        <span class="icon-checkbox"></span>\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Responsive mode",c):h.call(e,"__","Responsive mode",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n\n    <div class="tooltip-content">'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The image resizes along with its container, e.g. 50% means half of the container size not half of the picture size.",c):h.call(e,"__","The image resizes along with its container, e.g. 50% means half of the container size not half of the picture size.",c)))+'</div>\n\n\n    <div class="media-sizer-percent">\n        <label for="">'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Size",c):h.call(e,"__","Size",c)))+'</label>\n                <span class="item-editor-unit-input-box">\n                    <input type="text" name="width" value="" data-validate="$numeric"\n                           data-validate-option="$allowEmpty;"/>\n                </span>\n\n        <div class="media-sizer-slider-box">\n            <div class="media-sizer-slider"></div>\n        </div>\n    </div>\n\n    <div class="media-sizer-pixel">\n        <label for="">'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Width",c):h.call(e,"__","Width",c)))+'</label>\n                <span class="item-editor-unit-input-box">\n                    <input type="text" name="width" value="" data-validate="$numeric"\n                           data-validate-option="$allowEmpty;"/>\n                </span>\n\n        <label for="">'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Height",c):h.call(e,"__","Height",c)))+'</label>\n                <span class="item-editor-unit-input-box">\n                    <input type="text" name="height" value="" data-validate="$numeric"\n                           data-validate-option="$allowEmpty;"/>\n                </span>\n\n        <div class="media-sizer-link">\n            <span class="icon-link"></span>\n        </div>\n\n        <div class="media-sizer-slider-box">\n            <div class="media-sizer-slider"></div>\n            <div class="media-sizer-cover"></div>\n        </div>\n    </div>\n</div>'})}),define("ui/mediasizer",["jquery","core/pluginifier","tpl!ui/mediasizer/mediasizer","nouislider","tooltipster"],function(t,e,i){function a(t,e){void 0===e&&(e=0);var i=Math.pow(10,e);return Math.round(t*i)/i}var n="mediasizer",r="ui."+n,o={disableClass:"disabled",applyToMedium:!0,denyCustomRatio:!0,responsive:!0},s=["img"],c={_getSizeProps:function(t){var e=t.data(r),i=e.target,a=i[0],n=a.naturalWidth||e.naturalWidth||a.width||a.style.width,o=a.naturalHeight||e.naturalHeight||a.height||a.style.height,s=e.parentSelector?i.parents(e.parentSelector).innerWidth():i.parent().parent().innerWidth();return{px:{natural:{width:n,height:o},current:{width:a.width,height:a.height}},"%":{natural:{width:100,height:null},current:{width:100*a.width/s,height:null}},ratio:{natural:n/o,current:a.width/a.height},containerWidth:s,sliders:{"%":{min:0,max:100,start:100*a.width/s},px:{min:0,max:Math.max(s,n),start:a.width}},currentUnit:"%"}},_initSyncBtn:function(t){var e=t.data(r),i=t.find(".media-sizer"),a=this;t.find(".media-sizer-link").on("click",function(){i.toggleClass("media-sizer-synced"),e.syncDimensions=i.hasClass("media-sizer-synced"),e.syncDimensions&&a._sync(t,e.$fields.px.width,"blur")})},_initBlocks:function(e){var i=e.data(r),a={},o=e.find(".media-mode-switch"),s=this,c=function(){o.is(":checked")?(a.px.hide(),a["%"].show(),i.sizeProps.currentUnit="%",i.$fields&&i.$fields["%"].width.val()>i.sizeProps.sliders["%"].max&&(i.$fields["%"].width.val(i.sizeProps.sliders["%"].max),s._sync(e,i.$fields["%"].width,"blur"))):(a["%"].hide(),a.px.show(),i.sizeProps.currentUnit="px")};return _(["px","%"]).forEach(function(i){a[i]=e.find(".media-sizer-"+("px"===i?"pixel":"percent")),a[i].prop("unit",i),a[i].find("input").data("unit",i).after(t("<span>",{"class":"unit-indicator",text:i}))}),o.on("click",function(){c(),e.trigger("responsiveswitch."+n,[o.is(":checked")]),e.trigger("sizechange."+n,s._getValues(e))}),c(),a},_initSliders:function(e){var i=e.data(r),n={};return _(i.$blocks).forOwn(function(e,r){n[r]=e.find(".media-sizer-slider"),n[r].prop("unit",r),n[r].noUiSlider({start:i.sizeProps.sliders[r].start,range:{min:0,max:i.sizeProps.sliders[r].max}}).on("slide",function(){var e=t(this),n=e.prop("unit");i.$fields[n].width.val(a(e.val())).trigger("sliderchange")})}),n},_sync:function(t,e,i){i="sliderchange"===i?"sliderEvent":"fieldEvent";var o,s,c,l,d,h,p=t.data(r),u=e.prop("unit"),m=e.prop("dimension"),f=parseFloat(e.val());if(!isNaN(f)){if(p.sizeProps.px.current.width>0&&p.sizeProps.px.current.height>0&&(p.sizeProps.ratio.current=p.sizeProps.px.current.width/p.sizeProps.px.current.height),s=p.denyCustomRatio?p.sizeProps.ratio.natural:p.sizeProps.ratio.current,"height"===m&&"px"===u){if(p.sizeProps.px.current.height=f,!p.syncDimensions)return p.sizeProps["%"].current.height=null,p.applyToMedium&&(h=this._getValues(t),p.target.attr("width",h.width),p.target.attr("height",h.height)),void t.trigger("sizechange."+n,this._getValues(t));p.sizeProps.px.current.width=f*s,p.sizeProps.ratio.current=p.sizeProps.px.current.width/p.sizeProps.px.current.height,p.$fields.px.width.val(a(p.sizeProps.px.current.width)),f=parseFloat(p.$fields.px.width.val())}"px"===u?(c="%",l=100*f/p.sizeProps.containerWidth):(c="px",l=f*p.sizeProps.containerWidth/100),p.sizeProps[u].current.width=f,p.sizeProps[c].current.width=l,p.syncDimensions&&(o=f/s,d=l/s,p.sizeProps[u].current.height=o,p.$fields[u].height.val(a(o)),p.sizeProps[c].current.height=d,p.$fields[c].height.val(a(d))),"sliderEvent"!==i&&p.$sliders[u].val(f),p.$sliders[c].val(l),p.$fields[c].width.val(a(l)),p.sizeProps["%"].current.height=null,p.applyToMedium&&(h=this._getValues(t),p.target.attr("width",h.width),p.target.attr("height",h.height)),t.trigger("sizechange."+n,this._getValues(t))}},_initFields:function(e){var i,n=e.data(r),o=["width","height"],s={},c=this;return _(n.$blocks).forOwn(function(r,l){s[l]={},n.$blocks[l].find("input").each(function(){_(o).forEach(function(r){i=n.$blocks[l].find('[name="'+r+'"]'),s[l][r]=i.length?i:t("<input>"),s[l][r].prop({unit:l,dimension:r}),s[l][r].val(a(n.sizeProps[l].current[r])),s[l][r].data({min:0,max:n.sizeProps.sliders[l].max}),s[l][r].on("keydown",function(e){var i=t(this),a=e.keyCode,n=function(){var t=[8,37,39,46];return-1===i.val().indexOf(".")&&(t.push(190),t.push(110)),t}();return _.contains(n,a)||a>=48&&57>=a||a>=96&&105>=a}),s[l][r].on("keyup blur sliderchange",function(i){var a=t(this),n=a.val().replace(/,/g,".");a.val(n),n>a.data("max")?a.val(a.data("max")):n<a.data("min")&&a.val(a.data("min")),c._sync(e,t(this),i.type)})})})}),s},_getValues:function(t){var e=t.data(r),i={};return _.forOwn(e.sizeProps[e.sizeProps.currentUnit].current,function(t,n){t=_.isNull(t)?"":a(t).toString(),"%"===e.sizeProps.currentUnit&&""!==t&&(t+=e.sizeProps.currentUnit),i[n]=t}),i},init:function(e){e=t.extend(!0,{},o,e);var a=c;return this.each(function(){var o=t(this),c=e.target,l=c[0].nodeName.toLowerCase();if(!_.contains(s,l))throw new Error("MediaSizer::init() Unsupported element type "+l);o.data(r)||(o.html(i({responsive:void 0!==e.responsive?!!e.responsive:!0})),o.data(r,e),e.sizeProps=a._getSizeProps(o),e.originalSizeProps=_.cloneDeep(e.sizeProps),e.syncDimensions=o.find(".media-sizer").hasClass("media-sizer-synced"),e.$blocks=a._initBlocks(o),e.$fields=a._initFields(o),e.$sliders=a._initSliders(o),a._initSyncBtn(o),o.trigger("create."+n))})},destroy:function(){this.each(function(){{var e=t(this);e.data(r)}e.trigger("destroy."+n)})}};e.register(n,c)}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Active",["jquery","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/img","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","taoQtiItem/qtiItem/helper/util","lodash","util/image","ui/mediasizer","ui/resourcemgr","nouislider"],function(t,e,i,a,n,r,o,s,c,l){var d=i.extend(a,function(){this.initForm()},function(){this.widget.$form.empty()}),h=function(t){return t.replace(/\.[^.]+$/,"").replace(/^(.*)\//,"").replace(/\W/," ").substr(0,255)};d.prototype.initForm=function(){var t=this.widget,e=t.$original,i=t.$form,a=t.element,l=t.options.baseUrl,d=!0;i.html(n({baseUrl:l||"",src:a.attr("src"),alt:a.attr("alt"),height:a.attr("height"),width:a.attr("width"),responsive:d})),m(t),u(t),p(t),f(t),r.initWidget(i),r.setChangeCallbacks(i,a,{src:c.throttle(function(i,a){i.attr("src",a),e.attr("src",s.fullpath(a,l)),e.trigger("contentChange.qti-widget").change(),o.togglePlaceholder(t),m(t),u(t)},1e3),alt:function(t,e){t.attr("alt",e)},longdesc:r.getAttributeChangeCallback(),align:function(e,i){o.positionFloat(t,i)}})};var p=function(t){var e="default";t.element.hasClass("rgt")?e="right":t.element.hasClass("lft")&&(e="left"),o.positionFloat(t,e),t.$form.find("select[name=align]").val(e)},u=function(t){var e=t.element,i=t.$form.find("input[name=src]"),a=t.$form.find(".img-resizer"),n=t.$container;i.val()&&(void 0===e.data("responsive")&&(e.attr("width")&&!/[0-9]+%/.test(e.attr("width"))?e.data("responsive",!1):e.data("responsive",!0)),e.data("responsive")&&(n.css("width",e.attr("width")),n.css("height","")),a.mediasizer({responsive:void 0!==e.data("responsive")?!!e.data("responsive"):!0,target:t.$original,applyToMedium:!1}),a.off(".mediasizer").on("responsiveswitch.mediasizer",function(t,i){e.data("responsive",i)}).on("sizechange.mediasizer",function(i,a){c(["width","height"]).each(function(i){""===a[i]||void 0===a[i]||null===a[i]?(e.removeAttr(i),n.css(i,"")):(e.attr(i,a[i]),n.css(i,a[i])),t.$container.trigger("contentChange.qti-widget")})}))},m=function(t){var e=t.$form,i=t.element.attr("src");i?e.find("[data-role=advanced]").show():e.find("[data-role=advanced]").hide()},f=function(i){var a=i.$form,n=i.options,r=i.element,o=i.$container,s=a.find('[data-role="upload-trigger"]'),d=a.find("input[name=src]"),p=a.find("input[name=alt]"),u=function(){s.resourcemgr({title:e('Please select an image file from the resource manager. You can add files from your computer with the button "Add file(s)".'),appendContainer:n.mediaManager.appendContainer,root:"/",browseUrl:n.mediaManager.browseUrl,uploadUrl:n.mediaManager.uploadUrl,deleteUrl:n.mediaManager.deleteUrl,downloadUrl:n.mediaManager.downloadUrl,params:{uri:n.uri,lang:n.lang,filters:"image/jpeg,image/png,image/gif"},pathParam:"path",select:function(e,i){var a,s;i&&i.length&&(a=i[0].file,l.getSize(n.baseUrl+a,function(e){if(e&&e.width>=0){var i=parseInt(e.width,10),n=o.parents().innerWidth();i>=.95*n?r.attr("width","100%"):(i=parseInt(100*i/n),r.attr("width",i+"%")),r.removeAttr("height")}""===t.trim(p.val())&&(s=h(a),r.attr("alt",s),p.val(s).trigger("change")),c.defer(function(){d.val(a).trigger("change")})}))},open:function(){d.hasClass("tooltipstered")&&d.blur().tooltipster("hide")},close:function(){d.blur()}})};s.on("click",u),d.val()||u()};return d}),define("taoQtiItem/qtiCreator/widgets/static/img/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/img/states/Sleep","taoQtiItem/qtiCreator/widgets/static/img/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/helpers/widget",["jquery","lodash"],function(t,e){var i={buildInlineContainer:function(e){var i="";e.element.hasClass("lft")?i=" lft":e.element.hasClass("rgt")&&(i=" rgt");var a=t("<span>",{"data-serial":e.element.serial,"class":"widget-box widget-inline widget-"+e.element.qtiClass+i,"data-qti-class":e.element.qtiClass,contenteditable:"false"});e.$container=e.$original.wrap(a).parent();var n=e.$container[0].nextSibling;n&&(n.nodeValue=" "+n.nodeValue)},buildBlockContainer:function(e){var i=t("<div>",{"data-serial":e.element.serial,"class":"widget-box widget-block widget-"+e.element.qtiClass,"data-qti-class":e.element.qtiClass});e.$container=e.$original.wrap(i).parent()},createToolbar:function(i,a){if(!e.isFunction(a))throw"the toolbarTpl must be a handlebars function";var n=t(a({serial:i.serial,state:"active"}));i.$container.append(n),n.find('[data-role="delete"]').on("click.widget-box",function(t){t.stopPropagation(),i.changeState("deleting")})}};return i}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/media",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    <span class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </span>\n</span>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/img/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/img/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline","taoQtiItem/qtiItem/helper/util"],function(t,e,i,a,n,r,o){var s=e.clone();return s.initCreator=function(a){var n=this,s=n.element,c=a.baseUrl;this.registerStates(i),e.initCreator.call(this),r.togglePlaceholder(this),r.checkFileExists(this,"src",a.baseUrl),t("#item-editor-scope").on("filedelete.resourcemgr."+this.element.serial,function(t,e){o.fullpath(s.attr("src"),c)===o.fullpath(e,c)&&(s.attr("src",""),r.togglePlaceholder(n))})},s.destroy=function(){t("#item-editor-scope").off("."+this.element.serial)},s.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},s.buildContainer=function(){return a.buildInlineContainer(this),this.$container.css({width:this.element.attr("width"),height:this.element.attr("height")}),this.$original[0].setAttribute("width","100%"),this.$original[0].setAttribute("height","100%"),this},s.createToolbar=function(){return a.createToolbar(this,n),this},s}),define("taoQtiItem/qtiCreator/renderers/Img",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Img","taoQtiItem/qtiCreator/widgets/static/img/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/item",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=i.helperMissing,h=this.escapeExpression,p="function",u=this;return l+='<div class="panel">\n    <label for="">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Identifier",c):d.call(e,"__","Identifier",c)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",c):d.call(e,"__","The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",c)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(s=i.identifier)?o=s.call(e,{hash:{},data:n}):(s=e&&e.identifier,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" \n           placeholder="e.g. my-item_123456" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+');">\n    \n</div>\n\n<div class="panel">\n    <label>\n        <input name="timeDependent" type="checkbox" ',o=i["if"].call(e,e&&e.timeDependent,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Time dependent",c):d.call(e,"__","Time dependent",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Define whether the item should be time dependent on delivery.",c):d.call(e,"__","Define whether the item should be time dependent on delivery.",c)))+"\n    </span>\n</div>\n"
})}),define("taoQtiItem/qtiCreator/widgets/item/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/item","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(t,e,i,a){var n=t.create(e,function(){this.initForm()},function(){});return n.prototype.initForm=function(){var t=this.widget,e=t.element,n=t.$form;n.html(i({serial:e.getSerial(),identifier:e.id(),timeDependent:!!e.attr("timeDependent")})),a.initWidget(n),a.setChangeCallbacks(n,e,{identifier:a.getAttributeChangeCallback(),timeDependent:a.getAttributeChangeCallback()})},n}),define("taoQtiItem/qtiCreator/widgets/item/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/item/states/Active"],function(t){return t.createBundle(arguments)}),define("taoQtiItem/qtiXmlRenderer/renderers/config",[],function(){return{name:"xmlRenderer",locations:{_container:"taoQtiItem/qtiXmlRenderer/renderers/Container",assessmentItem:"taoQtiItem/qtiXmlRenderer/renderers/Item",stylesheet:"taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",responseDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",outcomeDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",responseProcessing:"taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",math:"taoQtiItem/qtiXmlRenderer/renderers/Math",img:"taoQtiItem/qtiXmlRenderer/renderers/Img",object:"taoQtiItem/qtiXmlRenderer/renderers/Object",modalFeedback:"taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",rubricBlock:"taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",associateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",selectPointInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",prompt:"taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",associableHotspot:"taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",gap:"taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",gapImg:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",gapText:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",hotspotChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",hottext:"taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",inlineChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice"}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiXmlRenderer/renderers/config"],function(t,e){return t.build(e.locations,e.name)}),define("taoQtiItem/qtiCreator/helper/xmlRenderer",["taoQtiItem/qtiXmlRenderer/renderers/Renderer"],function(t){var e=new t({shuffleChoices:!1}).load(),i=function(t){var i="";try{i=t.render(e)}catch(a){}return i};return{render:i}}),define("taoQtiItem/qtiCreator/helper/devTools",["lodash","jquery","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/model/helper/event"],function(t,e,i,a){var n={};n.listenStateChange=function(){e(document).on("afterStateInit.qti-widget",function(t,e,i){console.log("->state : "+i.name+" : "+e.serial)}),e(document).on("afterStateExit.qti-widget",function(t,e,i){console.log("<-state : "+i.name+" : "+e.serial)})},n.getStates=function(e){var i={},a=e.getComposingElements();return t.each(a,function(t){var e=t.data("widget");e&&(i[t.getSerial()]=e.getCurrentState().name)}),i},n.liveXmlPreview=function(n,r){e(document).on(a.getList().join(" "),t.throttle(function(){var t=i.render(n);o(t,r)},200))};var r=function(t){return vkbeautify.xml(t,"	")},o=function(t,i){var a=e(),n=r(t);n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),i.hasClass("language-markup")?a=i:(a=i.find("code.language-markup"),a.length||(a=e("<code>",{"class":"language-markup"}),i.addClass("line-numbers").html(a))),a.length&&(a.html(n),Prism.highlightElement(a[0]))};return n}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/text",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c=i.helperMissing,l=this.escapeExpression;return s+='<div class="panel">\n    <em>'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"no configuration property needed",o):c.call(e,"__","no configuration property needed",o)))+"</em>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/text"],function(t,e,i,a,n,r){var o=e.extend(i,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return o.prototype.buildEditor=function(){var t=this.widget,e=t.$container,i=t.element;e.attr("data-html-editable-container",!0),a.hasEditor(e)||a.buildEditor(e,{change:n.getChangeCallback(i),blur:function(){t.changeState("sleep")},data:{widget:t,container:i}})},o.prototype.destroyEditor=function(){a.destroyEditor(this.widget.$container)},o.prototype.initForm=function(){this.widget.$form.html(r())},o}),define("taoQtiItem/qtiCreator/widgets/static/text/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/text/states/Sleep","taoQtiItem/qtiCreator/widgets/static/text/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    <div class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/text/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/text/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function(t,e,i){var a=t.clone();return a.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},a.buildContainer=function(){var t=$("<div>",{"data-serial":this.element.serial,"data-qti-class":"_container","class":"widget-box widget-block widget-textBlock"}).append($("<div>",{"data-html-editable":!0}));this.$original.wrapInner(t),this.$container=this.$original.children(".widget-box")},a.createToolbar=function(){var t=this,e=$(i({serial:this.serial,state:"active"}));return this.$container.append(e),e.find('[data-role="delete"]').on("click.widget-box",function(e){e.stopPropagation(),t.changeState("deleting")}),this},a}),define("taoQtiItem/qtiCreator/widgets/item/Widget",["lodash","i18n","jquery","helpers","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/item/states/states","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/helper/devTools","taoQtiItem/qtiCreator/widgets/static/text/Widget","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","taoQtiItem/qtiCreator/editor/jquery.gridEditor"],function(t,e,i,a,n,r,o,s,c,l,d,h,p,u,m){var f=n.clone();f.initCreator=function(t){if(this.registerStates(r),n.initCreator.call(this),!t||!t.uri)throw new Error("missing required config parameter uri in item widget initialization");this.renderer=t.renderer,this.itemUri=t.uri,this.initUiComponents(),this.initTextWidgets(function(){this.initGridEditor(),this.debug({state:!1,xml:!1})})},f.buildContainer=function(){this.$container=this.$original},f.save=function(){return i.ajax({url:a._url("saveItem","QtiCreator","taoQtiItem")+"?uri="+encodeURIComponent(this.itemUri),type:"POST",contentType:"text/xml",dataType:"json",data:d.render(this.element)})},f.initUiComponents=function(){var a=this,n=a.element,r=i("#save-trigger");r.on("click",function(t){var n=i(this);return n.hasClass("disabled")?void t.preventDefault():(n.addClass("active"),void i.when(u.save(),a.save()).done(function(){var t={message:e("Your item has been saved"),type:"success"},i=arguments.length;for(n.removeClass("active");i--;)if("success"!==arguments[i][1].toLowerCase()){t={message:e("Failed to save item"),type:"error"};break}v(t)}))}),a.on("metaChange",function(e){if(e.element.getSerial()===n.getSerial()&&"invalid"===e.key){var i=n.data("invalid");t.size(i)?r.addClass("disabled"):r.removeClass("disabled")}},!0)},f.initGridEditor=function(){var t=this,e=this.element,a=this.$container.find(".qti-itemBody"),n=i("#item-editor-panel");a.gridEditor(),a.gridEditor("resizable"),a.gridEditor("addInsertables",i(".tool-list > [data-qti-class]:not(.disabled)"),{helper:function(){return i(this).find("span").clone().addClass("dragging")}}),a.on("beforedragoverstart.gridEdit",function(){n.addClass("dragging"),a.removeClass("hoverable").addClass("inserting")}).on("dragoverstop.gridEdit",function(){n.removeClass("dragging"),a.addClass("hoverable").removeClass("inserting")}).on("dropped.gridEdit.insertable",function(e,i,a){a.removeAttr("id"),"rubricBlock"===i&&(a=a.parent(".col-12").parent(".grid-row")),a.addClass("widget-box"),a.attr({"data-new":!0,"data-qti-class":i});var n=a.parent().closest(".widget-box, .qti-item"),r=a.closest("[data-html-editable], .qti-itemBody"),d=n.data("widget"),h=d.element,p=o.isA(h,"_container")?h:h.getBody();if(!h||!r.length)throw new Error("cannot create new element");c.createElements(p,l.getContent(r),function(e){s.get().load(function(){for(var i in e){var n,r,s=e[i],c=a.parent();s.setRenderer(this),o.isA(s,"_container")?(c.empty(),c.html(s.render()),r=t.initTextWidget(s,c),n=r.$container):(s.render(a),r=s.postRender(),n=o.isA(s,"blockInteraction")?r.$container:r.$original),n.trigger("contentChange.gridEdit"),n.trigger("resize.gridEdit"),r.changeState(o.isA(s,"interaction")?"question":"active")}},this.getUsedClasses())})}).on("resizestop.gridEdit",function(){e.body(a.gridEditor("getContent"))})},f.initTextWidgets=function(e){var a=this,n=this.element,r=this.$container,o=1,s=[];e=e||t.noop,r.find(".qti-itemBody > .grid-row").each(function(){var t=i(this);t.hasClass("widget-box")||t.children().each(function(){var t=i(this),e=!1;t.contents().each(function(){return 3===this.nodeType&&this.nodeValue&&this.nodeValue.trim()?(e=!0,!1):void 0});var a=t.children();(a.length>1||!a.hasClass("widget-blockInteraction"))&&(e=!0),e&&(t.attr("data-text-block-id","text-block-"+o),o++)})});var d=r.clone();d.find(".qti-itemBody > .grid-row > [data-text-block-id]").each(function(){var t=i(this),e=t.data("text-block-id"),a=t.clone(),n=l.serializeElements(a),o=a.html();t.removeAttr("data-text-block-id").html("{{_container:new}}"),s.push({body:o,elements:n,$original:r.find('[data-text-block-id="'+e+'"]').removeAttr("data-text-block-id")})}),l.serializeElements(d);var h=d.find(".qti-itemBody").html(),p=n.getBody();s.length?c.createElements(p,h,function(i){if(t.size(i)!==s.length)throw"numbers of subcontainers mismatch";t.each(i,function(t){var e=s.shift(),i=g(p,e.elements);t.setElements(i,e.body),a.initTextWidget(t,e.$original)}),t.defer(function(){e.call(a)})}):e.call(a)};var g=function(e,i){var a={};return t.each(i,function(t){a[t]=e.elements[t],delete e.elements[t]}),a};f.initTextWidget=function(t,e){return p.build(t,e,this.renderer.getOption("textOptionForm"),{})},f.debug=function(t){if(t=t||{},t.state&&h.listenStateChange(),t.xml){var e=i("<code>",{"class":"language-markup"}),a=i("<pre>",{"class":"line-numbers"}).append(e);i("#item-editor-wrapper").append(a),h.liveXmlPreview(this.element,e)}};var v=function(t){var e=i(m(t)),a=e.find(".close-trigger");return i("body").append(e),a.on("click",function(){e.fadeOut(function(){i(this).remove()})}),setTimeout(function(){a.trigger("click")},2e3),e};return f}),define("tpl!taoQtiItem/qtiCreator/tpl/item",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="tao-scope qti-item item-editor-item clearfix" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-identifier="'+l((r=e&&e.attributes,r=null==r||r===!1?r:r.identifier,typeof r===c?r.apply(e):r))+'">\n    <div id="modalFeedbacks"></div>\n    <div class="qti-itemBody item-editor-drop-area hoverable">',(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===c?o.call(e,{hash:{},data:n}):o),(r||0===r)&&(s+=r),s+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/renderers/Item",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Item","taoQtiItem/qtiCreator/widgets/item/Widget","tpl!taoQtiItem/qtiCreator/tpl/item"],function(t,e,i,a){var n=t.clone(e),r=function(t){return t.children().each(function(){var t=$(this);t.hasClass("grid-row")||t.wrap('<div class="grid-row"><div class="col-12"></div></div>')}),t};return n.template=a,n.render=function(t,a){var n=e.getContainer(t);return r(n.find(".qti-itemBody")),a=a||{},a.state="active",a.renderer=this,i.build(t,n,this.getOption("itemOptionForm"),a)},n}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/math",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+='\n\n<div class="panel">\n    <label for="display" class="has-icon">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Display",r):l.call(t,"__","Display",r)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"How the math expression should be displayed.",r):l.call(t,"__","How the math expression should be displayed.",r)))+'</div>\n\n    <select name="display" class="select2" data-has-search="false">\n        <option value="inline">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"inline",r):l.call(t,"__","inline",r)))+'</option>\n        <option value="block">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"block",r):l.call(t,"__","block",r)))+'</option>\n    </select>\n</div>\n\n<div class="panel">\n    <label for="editMode" class="has-icon">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Editing Mode",r):l.call(t,"__","Editing Mode",r)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"How the math expression should be edited",r):l.call(t,"__","How the math expression should be edited",r)))+'.</div>\n\n    <select name="editMode" class="select2" data-has-search="false">\n        <option value="latex">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"LaTex",r):l.call(t,"__","LaTex",r)))+'</option>\n        <option value="mathml">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"MathML",r):l.call(t,"__","MathML",r)))+'</option>\n    </select>\n\n</div>\n\n<div class="panel" data-role="latex" style="display:none;">\n    <label for="sidebar-latex-field" class="has-icon">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Latex",r):l.call(t,"__","Latex",r)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",r):l.call(t,"__","Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",r)))+'</div>\n\n    <input id="sidebar-latex-field" type="text" name="latex" value="',(n=i.latex)?a=n.call(t,{hash:{},data:e}):(n=t&&t.latex,a=typeof n===h?n.call(t,{hash:{},data:e}):n),o+=d(a)+'" placeholder="e.g. e^{i \\pi} = -1"/>\n    <a href="#latex" class="math-editor-trigger">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Display larger editor",r):l.call(t,"__","Display larger editor",r)))+'</a>\n</div>\n\n<div class="panel sidebar-popup-container-box" data-role="mathml" style="display:none;">\n    <label for="sidebar-mathml-field" class="has-icon">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"MathML",r):l.call(t,"__","MathML",r)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Edit math expression using MathML",r):l.call(t,"__","Edit math expression using MathML",r)))+'</div>\n\n    <textarea id="sidebar-mathml-field" name="mathml">',(n=i.mathml)?a=n.call(t,{hash:{},data:e}):(n=t&&t.mathml,a=typeof n===h?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(o+=a),o+='</textarea>\n\n    <div class="math-buffer" style="visibility:hidden;"></div>\n    <a href="#mathml" class="math-editor-trigger">'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Display larger editor",r):l.call(t,"__","Display larger editor",r)))+'</a>\n</div>\n\n<div class="sidebar-popup-container-box">    \n\n    <div id="math-editor-container" class="sidebar-popup">\n        <h3 id="math-editor-title"></h3>\n        <span class="icon-grip-h dragger"></span>\n        <textarea id="math-editor-textarea" data-target="mathml"></textarea>\n        <input id="math-editor-input" data-target="latex"/>\n        <a class="closer" href="#" title="'+d((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Close",r):l.call(t,"__","Close",r)))+'"></a>\n    </div>\n    <div class="math-buffer" style="visibility:hidden;"></div>\n</div>\n'}function o(t,e){var a,n,r="";return r+='\n<div class="panel">\n    '+d((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"MathJax is not installed.",n):l.call(t,"__","MathJax is not installed.",n)))+"\n</div>\n"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c="",l=i.helperMissing,d=this.escapeExpression,h="function",p=this;return s=i["if"].call(e,e&&e.mathjax,{hash:{},inverse:p.program(3,o,n),fn:p.program(1,r,n),data:n}),(s||0===s)&&(c+=s),c+="\n"})}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/MathEditor","tpl!taoQtiItem/qtiCreator/tpl/forms/static/math","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","lodash","i18n","mathJax"],function(t,e,i,a,n,r,o,s,c){var l=300,d=t.extend(e,function(){this.initForm()},function(){this.widget.$form.empty()});d.prototype.initForm=function(){var t=this.widget,e=t.$form,i=t.element,r=i.mathML||"",o=i.getAnnotation("latex")||"",s=i.attr("display")||"inline",l="latex";!o.trim()&&r.trim()&&(l="mathml"),e.html(a({mathjax:!!c,editMode:l,latex:o,mathml:r})),c&&(e.find("select[name=display]").val(s),e.find("select[name=editMode]").val(l),e.children('.panel[data-role="'+l+'"]').show(),h(e,l),n.initWidget(e),this.initFormChangeListener())},d.prototype.initFormChangeListener=function(){var t=this.widget,e=t.$container,a=t.$form,s=t.element,c=s.mathML,d=s.getAnnotation("latex"),p=s.attr("display")||"inline",u={mathml:a.find("textarea[name=mathml]"),latex:a.find("input[name=latex]")},m=a.find(".math-editor-trigger"),f=a.find("#math-editor-container"),g={mathml:f.find('textarea[data-target="mathml"]'),latex:f.find('input[data-target="latex"]')},v=f.find("h3"),b=f.find(".closer"),I=f.find(".dragger"),C=a.find("select[name=editMode]");m.on("click",function(t){t.preventDefault(),f.hide();var e=this.hash.substring(1),i=u[e],a=g[e];v.text(i.parent().find("label").text()),a.val(i.val()),i.prop("disabled",!0),C.prop("disabled",!0),f.data("target",e),f.removeClass("mathml latex").addClass(e),f.removeAttr("style"),f.show(),m.hide()}),o(g).forEach(function(t,e){t.on("keyup",function(){u[e].val(g[e].val()),u[e].trigger("keyup")}),t.attr("placeholder",u[e].attr("placeholder"))}),b.on("click",function(){var t=f.data("target");u[t].val(g[f.data("target")].val()),u[t].prop("disabled",!1),C.prop("disabled",!1),f.hide(),m.show()}),f.draggable({handle:I});var y=new i({tex:d,mathML:c,display:p,buffer:a.find(".math-buffer"),target:t.$original});n.setChangeCallbacks(a,s,{display:function(e,i){"block"===i?e.attr("display","block"):e.removeAttr("display"),t.rebuild({ready:function(t){t.changeState("active")}})},editMode:function(t,e){h(a,e)},latex:o.throttle(function(i,a){y.setTex(a).renderFromTex(function(){i.setAnnotation("latex",a),u.mathml.html(y.mathML),i.setMathML(y.mathML),r.togglePlaceholder(t),e.change()})},l),mathml:o.throttle(function(i,a){y.setMathML(a).renderFromMathML(function(){i.setMathML(a),u.latex.val(""),i.removeAnnotation("latex"),r.togglePlaceholder(t),e.change()})},l)})};var h=function(t,e){var i={mathml:t.children('.panel[data-role="mathml"]'),latex:t.children('.panel[data-role="latex"]')},a={mathml:t.find("textarea[name=mathml]"),latex:t.find("input[name=latex]")},n=t.find("select[name=editMode]");i.mathml.hide(),i.latex.hide(),"latex"===e?i.latex.show():"mathml"===e&&(i.mathml.show(),a.latex.val()&&(a.mathml.hasClass("tooltipstered")||p(a.mathml),a.mathml.tooltipster("show"),n.off("change.editMode").one("change.editMode",function(){a.mathml.tooltipster("hide")})))},p=function(t){var e=$("<span>").html(s("Currently conversion from MathML to LaTeX is not available. Editing MathML here will have the LaTex code discarded."));t.tooltipster({theme:"tao-warning-tooltip",content:e,delay:200,trigger:"custom"}),t.on("focus.mathwarning",function(){t.tooltipster("hide")}),setTimeout(function(){t.tooltipster("hide")},3e3)};return d}),define("taoQtiItem/qtiCreator/widgets/static/math/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/math/states/Sleep","taoQtiItem/qtiCreator/widgets/static/math/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/math/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/math/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(t,e,i,a,n){var r=t.clone();return r.initCreator=function(){this.registerStates(e),t.initCreator.call(this),n.togglePlaceholder(this)},r.buildContainer=function(){return"block"===this.element.attr("display")?i.buildBlockContainer(this):i.buildInlineContainer(this),this},r.createToolbar=function(){return i.createToolbar(this,a),this},r}),define("taoQtiItem/qtiCreator/renderers/Math",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Math","taoQtiItem/qtiCreator/widgets/static/math/Widget","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return e.render(t),i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){return t.create(e,function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    <label for="" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Identifier",s):l.call(e,"__","Identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,'The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):l.call(e,"__",'The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" \n           placeholder="e.g. modal-feedback_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+');">\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","taoQtiItem/qtiCommonRenderer/helpers/sizeFinder","tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback","taoQtiItem/qtiCreator/widgets/helpers/formElement","jquery","ui/modal"],function(t,e,i,a,n,r,o){var s=function(){var t,e={sidebar:"#item-editor-item-widget-bar",cke:".cke",ckeBase:".cke_inner",ckeNose:".cke_nose",ckeToolbar:".cke_toolbar"},i=!1,a={};return{raise:function(i){var n,r;i=parseInt(i,10);for(t in e)n=o(e[t]),r=parseInt(n.css("z-index"),10),isNaN(r)&&(r=100),a[t]={element:n,index:r},n.css("z-index",a[t].index+i)},reset:function(){if(i)for(t in a)a[t].element.css("z-index",a[t].index)}}}(),c=function(t){var e=new o.Deferred,i=0,a=function(){var n=t.data("editor");i>20||(n?e.resolve():setTimeout(a,200))};return a(),e.promise()},l=t.extend(e,function(){var t=this.widget,e=this.widget.$container,n=e.find("[data-html-editable]");a.measure(e,function(a){e.modal({startClosed:!0,width:Math.max(Math.min(a.width,i.maxWidth),i.minWidth)}),e.modal("open"),e.css("height","auto"),o.when(c(n)).then(function(){s.raise(e.css("z-index"))}),e.on("closed.modal",function(){t.changeState("sleep")})}),this.widget.offEvents("otherActive"),this.initForm(),this.widget.$form.show()},function(){var t=this.widget.$container;t.off("opened.modal").off(".active"),t.modal("close"),s.reset(),t.find(".tlb-button.active[data-role=cke-launcher]").click(),this.widget.$form.empty().hide()});return l.prototype.initForm=function(){var t=this.widget;t.$form.html(n({serial:t.element.getSerial(),identifier:t.element.id()})),r.initWidget(t.$form),r.setChangeCallbacks(t.$form,t.element,{identifier:function(t,e){t.id(e)}})},l}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-role="cke-launcher-tlb">\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c=i.helperMissing,l=this.escapeExpression;return s+='<button class="btn-info small widget-ok" data-edit="active">'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"done",o):c.call(e,"__","done",o)))+"</button>"})}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,a,n,r,o){var s=t.clone();return s.initCreator=function(){t.initCreator.call(this),this.registerStates(e),this.buildEditor(),this.createOkButton()},s.buildContainer=function(){this.$container=this.$original.addClass("widget-box")},s.createToolbar=function(){return this.$container.find(".modal-body").append(i({serial:this.serial,state:"active"})),this
},s.buildEditor=function(){var t=this,e=t.$container.find(".modal-body"),i=t.element,a=i.getBody();e.attr("data-html-editable-container",!0),r.hasEditor(e)||r.buildEditor(e,{change:o.getChangeCallback(a),data:{container:a,widget:t}}),n.initTitle(this.$original.find(".qti-title"),i)},s.createOkButton=function(){var t=this;this.$container.append($(a()).on("click.qti-widget",function(e){e.stopPropagation(),t.changeState("sleep")}))},s}),define("taoQtiItem/qtiCreator/renderers/ModalFeedback",["lodash","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){a=a||{};var n=i.build(t,e.getContainer(t),this.getOption("modalFeedbackOptionForm"),a);return n},a}),define("taoQtiItem/qtiCreator/widgets/static/object/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/object",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    <label for="src">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the media.",s):l.call(e,"__","The file path to the media.",s)))+'</div>\n    <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n    <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select media",s):l.call(e,"__","Select media",s)))+'</button>\n</div>\n\n<div data-role="advanced" style="display:none">\n    <div class="panel">\n        <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Size and position",s):l.call(e,"__","Size and position",s)))+'</h3>\n\n        <!--not available yet-->\n        <!--    <label>\n        <input name="responsive" type="checkbox" />\n        <span class="icon-checkbox"></span>\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Adapt to item size",s):l.call(e,"__","Adapt to item size",s)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        Recommended.\n        Define whether the image size should automatically adapt to item size.\n        If this option is active, the image width and height will be a percentage of its text container.\n    </span>-->\n\n        <p class="img-resizer-slider"></p>\n\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height (optional)",s):l.call(e,"__","Height (optional)",s)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width (optional)",s):l.call(e,"__","Width (optional)",s)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="align">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Alignment (optional)",s):l.call(e,"__","Alignment (optional)",s)))+'</label>\n        <select name="align" class="select2" data-has-search="false">\n            <option value="default">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"default",s):l.call(e,"__","default",s)))+'</option>\n            <option value="left">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"left",s):l.call(e,"__","left",s)))+'</option>\n            <option value="right">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"right",s):l.call(e,"__","right",s)))+"</option>\n        </select>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/static/object/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/object","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","lodash","util/image","helpers","ui/resourcemgr","nouislider"],function(t,e,i,a,n,r,o){var s=t.extend(e,function(){this.widget.changeState("sleep")},function(){this.widget.$form.empty()}),c=function(t,e){var i=r.debounce(function(t,e,i){t.attr(i,e)},1e3);return r.throttle(function(a,n,r){n?(t[e](n),i(a,n,r)):(t[e]("auto"),a.removeAttr(e)),t.trigger("contentChange.qti-widget")},100)};s.prototype.initForm=function(){var t=this.widget,e=t.$original,r=t.$form,o=t.element,s=t.options.baseUrl,u=!0;r.html(i({baseUrl:s||"",data:o.attr("data"),height:o.attr("height"),width:o.attr("width"),responsive:u})),h(t),d(t),l(t),p(t),a.initWidget(r),a.setChangeCallbacks(r,o,{data:function(i,a){i.attr("data",a),a.match(/^http/i)||(a=s+"/"+a),e.attr("data",a),n.togglePlaceholder(t),d(t),h(t)},alt:a.getAttributeChangeCallback(),longdesc:a.getAttributeChangeCallback(),align:function(e,i){n.positionFloat(t,i)},height:c(e,"height"),width:c(e,"width")})};var l=function(t){var e="default";t.element.hasClass("rgt")?e="right":t.element.hasClass("lft")&&(e="left"),n.positionFloat(t,e),t.$form.find("select[name=align]").val(e)},d=function(t){var e=t.$container,i=t.$form,a=i.find(".media-resizer-slider"),n=t.element,o=e.find("media"),s=i.find("[name=height]"),c=i.find("[name=width]"),l={h:n.attr("height")||o.height(),w:n.attr("width")||o.width()};a.noUiSlider({range:{min:10,max:200},start:100},a.hasClass("noUi-target")),a.off("slide").on("slide",r.throttle(function(t,e){var i=e/100,a=parseInt(i*l.w),n=parseInt(i*l.h);c.val(a).change(),s.val(n).change()},100))},h=function(t){var e=t.$form,i=t.element.attr("data");i?e.find("[data-role=advanced]").show():e.find("[data-role=advanced]").hide()},p=function(t){var e=t.$form,i=t.options,a=e.find('[data-role="upload-trigger"]'),n=e.find("input[name=data]"),r=e.find("input[name=width]"),s=e.find("input[name=height]");a.on("click",function(){a.resourcemgr({appendContainer:i.mediaManager.appendContainer,root:"/",browseUrl:i.mediaManager.browseUrl,uploadUrl:i.mediaManager.uploadUrl,deleteUrl:i.mediaManager.deleteUrl,downloadUrl:i.mediaManager.downloadUrl,params:{uri:i.uri,lang:i.lang,filters:"audio/ogg,audio/mpeg,video/mpeg,video/mp4,video/ogg,video/ogv,video/webm"},pathParam:"path",select:function(t,e){var a,c=e.length;for(a=0;c>a;a++){o.getSize(i.baseUrl+e[a].file,function(t){t&&t.width>=0&&(r.val(t.width).trigger("change"),s.val(t.height).trigger("change")),n.val(e[a].file).trigger("change")});break}}})})};return s}),define("taoQtiItem/qtiCreator/widgets/static/object/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/object/states/Sleep","taoQtiItem/qtiCreator/widgets/static/object/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="overlay">\n    <span class="message">',(o=i.message)?r=o.call(e,{hash:{},data:n}):(o=e&&e.message,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+"</span>\n</span>"})}),define("taoQtiItem/qtiCreator/widgets/static/object/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/object/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay","i18n"],function(t,e,i,a,n,r,o){var s=t.clone();return s.initCreator=function(){this.registerStates(e),t.initCreator.call(this),n.togglePlaceholder(this),this.notAvailable()},s.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},s.buildContainer=function(){return i.buildBlockContainer(this),this},s.createToolbar=function(){return i.createToolbar(this,a),this},s.notAvailable=function(){this.$container.append(r({message:o("Editing this element is not supported currently.")})),this.$container.attr("contenteditable",!1),this.$container.css({cursor:"default"}),this.$container.on("click, mousedown",function(t){t.stopPropagation()})},s}),define("taoQtiItem/qtiCreator/renderers/Object",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Object","taoQtiItem/qtiCreator/widgets/static/object/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return e.render(t),a=a||{},a.baseUrl=this.getOption("baseUrl"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(t,e){var i=t.extend(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<!--currently only visible to the candidate-->\n<div class="panel">\n    <label for="view">Visible by</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",s):l.call(e,"__","A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",s)))+'\n    </div>\n    <select name="view" class="select2" data-has-search="false">\n        <option value="author">author</option>\n        <option value="candidate">candidate</option>\n        <option value="proctor">proctor</option>\n        <option value="scorer">scorer</option>\n        <option value="testConstructor">test constructor</option>\n        <option value="tutor">tutor</option>\n    </select>\n</div>\n\n<div class="panel">\n    <label for="use">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Description",s):l.call(e,"__","Description",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",s):l.call(e,"__","The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",s)))+'</div>\n    <input type="text" name="use" value="',(o=i.use)?r=o.call(e,{hash:{},data:n}):(o=e&&e.use,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" />\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(t,e,i,a,n,r){var o=t.extend(e,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return o.prototype.buildEditor=function(){var t=this.widget,e=t.$container,n=t.element.getBody();e.attr("data-html-editable-container",!0),i.hasEditor(e)||i.buildEditor(e,{change:a.getChangeCallback(n),data:{widget:t,container:n}})},o.prototype.destroyEditor=function(){i.destroyEditor(this.widget.$container)},o.prototype.initForm=function(){var t=this.widget,e=t.$form,i=t.element;e.html(n({view:i.attr("view"),use:i.attr("use")})),r.initWidget(e),r.setChangeCallbacks(e,i,{view:r.getAttributeChangeCallback(),use:r.getAttributeChangeCallback()})},o}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function(t,e,i){var a=t.clone();return a.buildContainer=function(){this.$container=this.$original.addClass("widget-box widget-rubricBlock")},a.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},a.createToolbar=function(){var t=$(i({serial:this.serial,state:"active"})),e=this;return this.$container.find(".qti-rubricBlock-body").append(t),t.find('[data-role="delete"]').on("click.widget-box",function(t){t.stopPropagation(),e.changeState("deleting")}),this},a}),define("taoQtiItem/qtiCreator/renderers/RubricBlock",["lodash","taoQtiItem/qtiCommonRenderer/renderers/RubricBlock","taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("bodyElementOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/choices/Widget",["taoQtiItem/qtiCreator/widgets/Widget"],function(t){var e=t.clone();return e.buildContainer=function(){this.$container=this.$original},e.initCreator=function(){if(t.initCreator.call(this),this.interaction=this.element.getInteraction(),!this.interaction)throw new Error("cannot find related interaction");this.listenToInteractionStates()},e.listenToInteractionStates=function(){var t=this;this.beforeStateInit(function(e,i,a){if(i.is("interaction")&&i.getSerial()===t.interaction.getSerial()&&a.name!==t.getCurrentState().name)switch(a.name){case"answer":case"sleep":case"question":t.changeState(a.name);break;case"delete":t.changeState("sleep")}}),this.beforeStateExit(function(e,i,a){i.is("interaction")&&i.getSerial()===t.interaction.getSerial()&&"choice"===a.name&&t.changeState("question")})},e}),define("taoQtiItem/qtiCreator/widgets/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("answer",["active"],function(){throw new Error('state "answer" prototype init method must be implemented')},function(){throw new Error('state "answer" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("choice",["question","active"],function(){throw new Error('state "choice" prototype init method must be implemented')},function(){throw new Error('state "choice" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("correct",["answer","active"],function(){throw new Error('state "correct" prototype init method must be implemented')},function(){throw new Error('state "correct" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("map",["answer","active"],function(){throw new Error('state "map" prototype init method must be implemented')},function(){throw new Error('state "map" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("question",["active"],function(){throw new Error('state "question" prototype init method must be implemented')},function(){throw new Error('state "question" prototype exit method must be implemented')})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/invalidInfoBox",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<div class="feedback-error popup" data-widget-component="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'">\n    <span class="icon-error"></span>\n    ',o=i.__||e&&e.__,s={hash:{},data:n},r=o?o.call(e,"There is an incomplete element in your item : please click on it to complete it.",s):h.call(e,"__","There is an incomplete element in your item : please click on it to complete it.",s),(r||0===r)&&(c+=r),c+="\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/states/Invalid",["taoQtiItem/qtiCreator/widgets/states/factory","tpl!taoQtiItem/qtiCreator/tpl/notifications/invalidInfoBox"],function(t,e){return t.create("invalid",["sleep"],function(){this.widget.$container.addClass("invalid"),this.$messageBox=$(e({serial:this.widget.serial})),$("body").append(this.$messageBox)},function(){this.widget.$container.removeClass("invalid"),this.$messageBox.remove()})}),define("taoQtiItem/qtiCreator/widgets/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/states/Deleting","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/states/Question","taoQtiItem/qtiCreator/widgets/states/Sleep","taoQtiItem/qtiCreator/widgets/states/Invalid"],function(t){return t.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/choices/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){var t="";return t}function o(){return"display:none;"}function s(){return"icon-pin"}function c(){return"icon-shuffle"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,d,h="",p="function",u=this.escapeExpression,m=this;return h+='<div class="mini-tlb" data-edit="question" data-for="',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'">\n    <div class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="shuffle-pin" title="Shuffle/Pin" style="',l=i["if"].call(e,e&&e.interactionShuffle,{hash:{},inverse:m.program(3,o,n),fn:m.program(1,r,n),data:n}),(l||0===l)&&(h+=l),h+='">\n        <span class="',l=i["if"].call(e,e&&e.fixed,{hash:{},inverse:m.program(7,c,n),fn:m.program(5,s,n),data:n}),(l||0===l)&&(h+=l),h+='"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/choices/helpers/formElement",[],function(){var t={initShufflePinToggle:function(t){var e=t.$container,i=t.element,a=i.getInteraction(),n=e.find('[data-role="shuffle-pin"]');n.on("mousedown",function(t){t.stopPropagation();var e=$(this).children();0===e.length&&(e=$(this)),e.hasClass("icon-shuffle")?(e.removeClass("icon-shuffle").addClass("icon-pin"),i.attr("fixed",!0)):(e.removeClass("icon-pin").addClass("icon-shuffle"),i.attr("fixed",!1))});var r=function(t){t?n.show():n.hide(),$(".qti-item").trigger("toolbarchange",{callee:"formElementHelper"})};r(a.attr("shuffle")),t.on("attributeChange",function(t){t.element.serial===a.serial&&"shuffle"===t.key&&r(t.value)})},initDelete:function(t){var e=t.$container;e.find('[data-role="delete"]:not([data-html-editable] *)').on("mousedown",function(e){e.stopPropagation(),t.changeState("deleting")})}};return t}),define("taoQtiItem/qtiCreator/widgets/choices/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function(t,e,i,a){var n=t.create(e,function(){var t=this.widget;t.$container.on("click.question",function(){t.changeState("choice")}).on("mouseenter.question",function(){$(this).addClass("hover")}).on("mouseleave.question",function(){$(this).removeClass("hover")}),this.createToolbar().show()},function(){this.removeToolbar(),this.widget.$container.off(".question")});return n.prototype.createToolbar=function(){var t,e=this.widget,n=e.$container,r=e.element,o=n.find(".mini-tlb").not("[data-html-editable] *");return o.length||(t=r.getInteraction(),o=$(i({choiceSerial:r.getSerial(),interactionSerial:t.getSerial(),fixed:r.attr("fixed"),interactionShuffle:t.attr("shuffle")})),n.append(o),a.initShufflePinToggle(e),a.initDelete(e)),o},n.prototype.removeToolbar=function(){this.widget.$container.find(".mini-tlb[data-edit=question]").remove()},n}),define("taoQtiItem/qtiCreator/widgets/choices/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/choices/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/choices/states/Sleep","taoQtiItem/qtiCreator/widgets/choices/states/Active","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/states/Answer"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiItem/core/Element"],function(t,e,i){var a=t.create(e,function(){var t=this.widget;t.beforeStateInit(function(e,a,n){i.isA(a,"choice")&&t.interaction.getChoice(a.serial)?"choice"===n.name&&a.serial!==t.serial?t.changeState("question"):"active"===n.name&&t.changeState("question"):(a.is("img")||a.is("math")||a.is("object"))&&"active"===n.name&&t.changeState("question")},"otherActive"),this.initForm(),this.widget.$form.show()},function(){this.widget.$form.empty().hide(),this.widget.offEvents("otherActive")});return a.prototype.initForm=function(){t.throwMissingRequiredImplementationError("initForm")},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gap",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=i.helperMissing,h=this.escapeExpression,p="function",u=this;return l+='<div class="panel">\n    <label for="" class="has-icon">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Identifier",c):d.call(e,"__","Identifier",c)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',c):d.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',c)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(s=i.identifier)?o=s.call(e,{hash:{},data:n}):(s=e&&e.identifier,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+');">\n</div>\n\n<div class="panel">\n    <label>\n        <input name="required" type="checkbox" ',o=i["if"].call(e,e&&e.required,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"required",c):d.call(e,"__","required",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",c):d.call(e,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",c)))+"\n    </span>\n</div>\n\n<h3>"+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Shape position",c):d.call(e,"__","Shape position",c)))+'</h3>\n\n<div class="panel">\n    <label for="x">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Left",c):d.call(e,"__","Left",c)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",c):d.call(e,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",c)))+'</div>\n    <input name="x" value="',(s=i.x)?o=s.call(e,{hash:{},data:n}):(s=e&&e.x,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="y">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Top",c):d.call(e,"__","Top",c)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",c):d.call(e,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",c)))+'</div>\n    <input name="y" value="',(s=i.y)?o=s.call(e,{hash:{},data:n}):(s=e&&e.y,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="width">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Width",c):d.call(e,"__","Width",c)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",c):d.call(e,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",c)))+'</div>\n    <input name="width" value="',(s=i.width)?o=s.call(e,{hash:{},data:n}):(s=e&&e.width,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="height">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Height",c):d.call(e,"__","Height",c)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",c):d.call(e,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",c)))+'</div>\n    <input name="height" value="',(s=i.height)?o=s.call(e,{hash:{},data:n}):(s=e&&e.height,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" type="text" readonly />\n</div>\n\n'})}),define("taoQtiItem/qtiCreator/widgets/helpers/identifier",["lodash"],function(t){var e=function(e,i,a){var n=i.replace(/([.-])/g,"\\$1"),r=new RegExp("\\b("+n+")\\b");for(var o in e.correctResponse)e.correctResponse[o]=e.correctResponse[o].replace(r,a);var s={};t.forIn(e.mapEntries,function(t,e){e=e.replace(r,a),s[e]=t}),e.mapEntries=s},i=t.throttle(function(t,i,a){var n=t.id();if(n!==i){e(a,n,i),t.id(i);var r=o("interactionFromChoice",t,function(){return t.getInteraction()});try{t.getContainer(null,t.qtiClass+"."+r.qtiClass).attr("data-identifier",t.id())}catch(s){}}},500),a=[],n=function(t,e,i){a[t]||(a[t]={}),a[t][e.getSerial()]=i},r=function(t,e){var i=e.getSerial();return i&&a[t]&&a[t][i]?a[t][i]:null},o=function(t,e,i){var a=r(t,e);return a||(a=i.call(e),n(t,e,a)),a};return{updateChoiceIdentifier:function(t,e){var a=o("responseFromChoice",t,function(){var e=o("interactionFromChoice",t,function(){return t.getInteraction()});return e.getResponseDeclaration()});i(t,e,a)},updateResponseIdentifier:function(){throw"to be implemented"}}}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gap","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiItem/core/Element"],function(t,e,i,a,n,r){var o=t.extend(e,function(){var t=this.widget;
t.beforeStateInit(function(e,i,a){r.isA(i,"gap")&&t.interaction.getBody().getElement(i.serial)&&("choice"===a.name&&i.serial!==t.serial?t.changeState("question"):"active"===a.name&&t.changeState("question"))},"otherActive")},function(){this.widget.offEvents("otherActive")});return o.prototype.initForm=function(){var t=this.widget.$form,e=this.widget.element;t.html(i({serial:e.getSerial(),identifier:e.id(),required:!!e.attr("required")})),a.initWidget(t),a.setChangeCallbacks(t,e,{identifier:n.updateChoiceIdentifier,required:a.getAttributeChangeCallback()})},o}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    <span class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function(t,e,i,a){var n=t.extend(e);return n.prototype.createToolbar=function(){var t=this.widget,e=t.$container,n=t.element,r=e.find(".mini-tlb").not("[data-html-editable] *");return r.length||(r=$(i({serial:n.getSerial(),state:"question"})),e.append(r),a.initDelete(t)),r},n}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/gap/states/Choice","taoQtiItem/qtiCreator/widgets/choices/gap/states/Question"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/gap/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/gap/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},i.buildContainer=function(){this.$container=this.$original.addClass("widget-box"),this.$container.attr("contenteditable",!1)},i}),define("taoQtiItem/qtiCreator/renderers/choices/Gap",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/Gap","taoQtiItem/qtiCreator/widgets/choices/gap/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Identifier",s):l.call(e,"__","Identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):l.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+');">\n</div>\n\n<div class="panel">\n    <h3 class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of uses",s):l.call(e,"__","Allowed number of uses",s)))+'\n    </h3>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",s):l.call(e,"__","The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",s)))+'\n    </span>\n\n    <!--not supported yet-->\n    <div style="display:none;">\n        <label for="matchMin" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Min",s):l.call(e,"__","Min",s)))+'</label>\n        <input name="matchMin" value="',(o=i.matchMin)?r=o.call(e,{hash:{},data:n}):(o=e&&e.matchMin,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n    </div>\n\n    <div>\n        <label for="matchMax" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Max",s):l.call(e,"__","Max",s)))+'</label>\n        <input name="matchMax" value="',(o=i.matchMax)?r=o.call(e,{hash:{},data:n}):(o=e&&e.matchMax,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,a,n,r,o){var s=t.extend(e,function(){this.buildEditor()},function(){this.destroyEditor()});return s.prototype.initForm=function(){var t=this.widget,e=t.$form,r=t.element;e.html(i({serial:r.getSerial(),identifier:r.id(),matchMin:r.attr("matchMin"),matchMax:r.attr("matchMax")})),a.initWidget(e);var o=a.getMinMaxAttributeCallbacks(this.widget.$form,"matchMin","matchMax");o.identifier=n.updateChoiceIdentifier,a.setChangeCallbacks(e,r,o)},s.prototype.buildEditor=function(){var t=this.widget,e=t.element.getBody(),i=t.$container;i.attr("data-html-editable-container",!0),r.hasEditor(i)||r.buildEditor(i,{change:o.getChangeCallback(e),data:{container:e,widget:t}})},s.prototype.destroyEditor=function(){r.destroyEditor(this.widget.$container)},s}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice","taoQtiItem/qtiItem/core/Element","lodash"],function(t,e,i,a,n){var r=t.extend(e,function(){var t=this.widget;t.beforeStateInit(function(e,i,n){a.isA(i,"choice")&&t.interaction.getBody().getElement(i.serial)&&"choice"===n.name&&i.serial!==t.serial&&t.changeState("question")},"otherActive"),this.buildEditor()},function(){this.destroyEditor(),this.widget.offEvents("otherActive")});r.prototype.initForm=function(){i.prototype.initForm.call(this)},r.prototype.buildEditor=function(){var t,e=this.widget,i=e.$container,a=i.find(".mini-tlb");a.detach(),i.wrapInner($("<div>",{"class":"inner-wrapper"})),i.append(a),t=i.find(".inner-wrapper"),t.attr("contentEditable",!0),o(t),t.on("keyup.qti-widget",n.throttle(function(){e.element.val($(this).text())},200)).on("keypress.qti-widget",function(t){13===t.which&&(t.preventDefault(),$(this).blur(),e.changeState("question"))})},r.prototype.destroyEditor=function(){var t=this.widget.$container;t.find("td").removeAttr("contentEditable"),t.children("td:first").off("keyup.qti-widget")};var o=function(t){var e,i,a=t[0];a.focus(),void 0!==window.getSelection&&void 0!==document.createRange?(e=document.createRange(),e.selectNodeContents(a),e.collapse(!1),i=window.getSelection(),i.removeAllRanges(),i.addRange(e)):void 0!==document.body.createTextRange&&(e=document.body.createTextRange(),e.moveToElementText(a),e.collapse(!1),e.select())};return r}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/gapText/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/gapText/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},i}),define("taoQtiItem/qtiCreator/renderers/choices/GapText",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","taoQtiItem/qtiCreator/widgets/choices/gapText/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    <label for="" class="has-icon">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Identifier",s):l.call(e,"__","Identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):l.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+');">\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(t,e,i,a,n,r,o){var s=t.extend(e,function(){this.buildEditor()},function(){this.destroyEditor()});return s.prototype.initForm=function(){var t=this.widget;t.$form.html(i({serial:t.element.getSerial(),identifier:t.element.id()})),a.initWidget(t.$form),a.setChangeCallbacks(t.$form,t.element,{identifier:n.updateChoiceIdentifier})},s.prototype.buildEditor=function(){var t=this.widget,e=t.element.getBody(),i=t.$container;i.attr("data-html-editable-container",!0),r.hasEditor(i)||r.buildEditor(i,{change:o.getChangeCallback(e),data:{container:e,widget:t}})},s.prototype.destroyEditor=function(){r.destroyEditor(this.widget.$container)},s}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(t,e,i){var a=t.extend(e);return a.prototype.initForm=function(){i.prototype.initForm.call(this)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    <span class="tlb-button" title="Restore" data-role="restore">\n        <span class="icon-undo"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function(t,e,i){var a=t.extend(e);return a.prototype.createToolbar=function(){var t=this.widget,e=t.$container,a=t.element,n=e.find(".mini-tlb").not("[data-html-editable] *");return n.length||(n=$(i({serial:a.getSerial(),state:"question"})),e.append(n),n.find("[data-role=restore]").on("mousedown.question",function(){e.replaceWith(a.body()),t.destroy(),a.remove()})),n},a}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/hottext/states/Choice","taoQtiItem/qtiCreator/widgets/choices/hottext/states/Question"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/hottext/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},i.buildContainer=function(){this.$container=this.$original.addClass("widget-box"),this.$container.attr("contenteditable",!1),this.$original.find(".hottext-checkmark > input").prop("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/choices/Hottext",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext","taoQtiItem/qtiCreator/widgets/choices/hottext/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/renderers/choices/InlineChoice",function(){}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function(t,e,i,a){var n=t.extend(e,function(){},function(){});return n.prototype.createToolbar=function(){var t,e=this.widget,n=e.$container,r=e.element,o=n.find(".mini-tlb").not("[data-html-editable] *");return o.length||(t=r.getInteraction(),o=$(i({choiceSerial:r.getSerial(),interactionSerial:t.getSerial(),fixed:r.attr("fixed"),interactionShuffle:t.attr("shuffle")})),n.children(".inner-wrapper").append(o),a.initShufflePinToggle(e),a.initDelete(e)),o},n}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this),this.$container.wrapInner($("<div>",{"class":"inner-wrapper"})),this.$container.closest("table.matrix").find("input[type=checkbox]:enabled").prop("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e);var i=this.$container.find(".real-label");i.children("input").attr("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("choiceOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="common-tlb" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    <span class="tlb-button" title="move" data-role="move">\n        <span class="icon-grip"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/movable",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/draggable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip"],function(t,e,i){var a={create:function(a){var n,r=a.element.getRelatedItem(),o=a.$container,s=t(i({serial:a.serial}));o.append(s),s.on("mouseenter.qti-widget",function(){n&&n.length||(n=r.data("widget").$container),e.createMovable(o,n)}).on("mouseleave.qti-widget",function(){e.destroy(o)})}};return a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\n        <div class="state-switcher">\n            <span class="selected" data-state="question">'+h((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"Question",n):d.call(t,"__","Question",n)))+'</span>\n            <span class="separator"> | </span>\n            <span class="link" data-state="answer">'+h((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"Response",n):d.call(t,"__","Response",n)))+"</span>\n        </div>\n        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=i.helperMissing,h=this.escapeExpression,p="function",u=this;return l+='<div class="tlb-wrapper" style="" data-edit="active" data-for="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'">\n    <span class="tlb-title" title="',(s=i.title)?o=s.call(e,{hash:{},data:n}):(s=e&&e.title,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'">',(s=i.title)?o=s.call(e,{hash:{},data:n}):(s=e&&e.title,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'</span>\n    <div class="tlb">\n        <div class="rgt tlb-button" data-role="delete" title="'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"delete",c):d.call(e,"__","delete",c)))+'">\n            <span class="icon-bin"></span>\n        </div>\n        ',o=i["if"].call(e,e&&e.switcher,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+="\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/Widget",["jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/helpers/movable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton"],function(t,e,i,a,n){var r=e.clone();return r.init=function(t,i,a,n,r){return e.init.call(this,t,i,a,r),this.$responseForm=n,this},r.build=function(t,e,i,a,n){return this.clone().init(t,e,i,a,n)},r.initCreator=function(){e.initCreator.call(this),this.createToolbar(),this.createOkButton(),this.listenToChoiceStates()},r.buildContainer=function(){var e=t("<div>",{"data-serial":this.element.serial,"class":"widget-box widget-blockInteraction clearfix","data-qti-class":this.element.qtiClass}),i=this.$original.wrap(e);return this.$container=i.parent(),this},r.createToolbar=function(){var e,i=this,n=function(t){return t=t.replace(/[A-Z]/g,function(t){return" "+t.toUpperCase()}),t.charAt(0).toUpperCase()+t.substr(1)};return e=t(a({title:n(this.element.qtiClass),serial:this.element.serial,switcher:!!this.registeredStates.answer})),this.$container.append(e),e.hide(),e.find('[data-role="delete"]').click(function(t){t.stopPropagation(),i.changeState("deleting")}),this.registeredStates.answer&&(e.on("click",".link",function(){var e=t(this),a=e.data("state");e.siblings(".selected").removeClass("selected").addClass("link"),e.removeClass("link").addClass("selected"),i.changeState(a)}),this.beforeStateInit(function(t,a,n){if(a.getSerial()===i.serial){var r=e.find('.link[data-state="'+n.name+'"]');r.length&&(r.siblings(".selected").removeClass("selected").addClass("link"),r.removeClass("link").addClass("selected"))}})),this},r.createOkButton=function(){var e=this,i=t(n()).on("click.qti-widget",function(t){t.stopPropagation(),e.changeState("sleep")});this.$container.append(i)},r.listenToChoiceStates=function(){var t=this;this.afterStateInit(function(e,i,a){var n=t.getCurrentState();if(i.is("choice")&&t.element.getChoice(i.getSerial())&&n&&a.name!==n.name)switch(a.name){case"choice":t.changeState(a.name)}})},r}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(t,e){var i=t.extend(e,function(){var t=this.widget;t.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),t.changeState("question")})},function(){var t=this.widget;t.$container.off(".sleep")});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","lodash"],function(t,e,i){var a=function(t,e){var a=!1,n=[];return i.each(t.feedbackRules,function(t){t.feedbackThen&&"modalFeedback"===t.feedbackThen.qtiClass&&n.push(t.feedbackThen),t.feedbackElse&&"modalFeedback"===t.feedbackElse.qtiClass&&n.push(t.feedbackElse)}),i.each(n,function(t){var i=t.getBody().getElement(e);return i?(a=!0,!1):void 0}),a},n=t.extend(e,function(){var t=this.widget,e=t.$container,i=t.element,n=i.getResponseDeclaration();t.$container.attr("contenteditable",!1),t.beforeStateInit(function(e,r,o){var s=r.getSerial();if("modalFeedback"===r.qtiClass)return!1;if("active"===o.name&&s!==t.serial){var c=i.getComposingElements(),l=a(n,s);c[s]||l||t.changeState("sleep")}},"otherActive"),e.on("mouseenter.active",function(t){t.stopPropagation(),e.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(t){t.stopPropagation(),e.parent().trigger("mouseenter.sleep")}).on("click.active",function(t){t.stopPropagation()})},function(){this.widget.offEvents("otherActive")});return n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<li class="add-option" data-edit="question" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-role="add-option">\n    <span class="icon-add"></span>\n    ',(o=i.text)?r=o.call(e,{hash:{},data:n}):(o=e&&e.text,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+"\n</li>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice","i18n"],function(t,e,i,a){var n=t.create(e,function(){this.initForm(),this.widget.$form.show(),this.addNewChoiceButton(this.widget)},function(){this.widget.$form.empty().hide()});return n.prototype.addNewChoiceButton=function(){var t=this.widget,e=t.$container.find(".choice-area"),n=t.element;e.length&&!e.children(".add-option").length&&(e.append(i({serial:this.serial,text:a("Add choice")})),e.children(".add-option").show().on("click.qti-widget",function(t){t.stopPropagation();var e=n.createChoice(),i=$("<li>"),a=e.qtiClass+"."+n.qtiClass,r={interaction:{serial:n.serial,attributes:n.attributes}};$(this).before(i),e.render(r,i,a),e.postRender({ready:function(t){t.changeState("choice")}},a)}))},n.prototype.initForm=function(){t.throwMissingRequiredImplementationError("initForm")},n}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/helpers/content"],function(t,e,i){var a=t.create(e,function(){var t=this.widget;t.$container.on("click.choice",function(e){$(e.target).closest(".qti-choice").length||t.changeState("question")}),i.changeInnerWidgetState(this.widget,"sleep")},function(){this.widget.$container.off(".choice")});return a}),define("taoQtiItem/qtiItem/helper/response",["lodash"],function(t){var e={MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct",MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response",MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point"};return{isUsingTemplate:function(i,a){return!t.isString(a)||a!==i.template&&e[a]!==i.template?!1:!0},isValidTemplateName:function(t){return!!this.getTemplateUriFromName(t)},getTemplateUriFromName:function(t){return e[t]?e[t]:""},getTemplateNameFromUri:function(i){var a="";return t.forIn(e,function(t,e){return t===i?(a=e,!1):void 0}),a}}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var i,a="";return a+='\n        <option value="'+m((i=null==e||e===!1?e:e.key,typeof i===u?i.apply(t):i))+'">'+m(typeof t===u?t.apply(t):t)+"</option>\n        "}function o(t,e){var a,n,r,o="";return o+='\n<hr/>\n\n<div class="panel" data-editx="map">\n    <h3>'+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Score range",r):f.call(t,"__","Score range",r)))+'\n    </h3>\n    <div>\n        <label for="lowerBound" class="spinner">Min</label>\n        <input name="lowerBound" value="',(n=i.lowerBound)?a=n.call(t,{hash:{},data:e}):(n=t&&t.lowerBound,a=typeof n===u?n.call(t,{hash:{},data:e}):n),o+=m(a)+'" class="score" type="text" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Minimal  score for this interaction.",r):f.call(t,"__","Minimal  score for this interaction.",r)))+'</span>\n    </div>\n    <div>\n        <label for="upperBound" class="spinner">Max</label>\n        <input name="upperBound" value="',(n=i.upperBound)?a=n.call(t,{hash:{},data:e}):(n=t&&t.upperBound,a=typeof n===u?n.call(t,{hash:{},data:e}):n),o+=m(a)+'" class="score" type="text" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Maximal score for this interaction.",r):f.call(t,"__","Maximal score for this interaction.",r)))+'</span>\n    </div>\n</div>\n\n<div class="panel" data-editx="map">\n    <label for="defaultValue" class="spinner">'+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Mapping default",r):f.call(t,"__","Mapping default",r)))+'</label>\n    <input name="defaultValue" value="',(n=i.defaultValue)?a=n.call(t,{hash:{},data:e}):(n=t&&t.defaultValue,a=typeof n===u?n.call(t,{hash:{},data:e}):n),o+=m(a)+'" class="score" type="text" data-validate="$notEmpty; $numeric;" data-validate-option="$lazy; $event(type=keyup)" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"The default value from the target set to be used when no explicit mapping for a source value is given.",r):f.call(t,"__","The default value from the target set to be used when no explicit mapping for a source value is given.",r)))+'</span>\n</div>\n\n<div class="panel" data-editx="map">\n    <label>\n        <input name="defineCorrect" type="checkbox" data-role="defineCorrect"',a=i["if"].call(t,t&&t.defineCorrect,{hash:{},inverse:g.noop,fn:g.program(4,s,e),data:e}),(a||0===a)&&(o+=a),o+=' />\n        <span class="icon-checkbox"></span>\n        '+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Define correct response",r):f.call(t,"__","Define correct response",r)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+m((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Define the correct response.",r):f.call(t,"__","Define the correct response.",r)))+"</span>\n</div>\n"
}function s(){return' checked="checked"'}function c(){return'\n<hr/>\n\n<div class="panel feedbackRule-panel"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,d,h,p="",u="function",m=this.escapeExpression,f=i.helperMissing,g=this;return p+='<div class="panel">\n    <label for="" class="has-icon">'+m((d=i.__||e&&e.__,h={hash:{},data:n},d?d.call(e,"Response identifier",h):f.call(e,"__","Response identifier",h)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+m((d=i.__||e&&e.__,h={hash:{},data:n},d?d.call(e,'The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',h):f.call(e,"__",'The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',h)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(d=i.identifier)?l=d.call(e,{hash:{},data:n}):(d=e&&e.identifier,l=typeof d===u?d.call(e,{hash:{},data:n}):d),p+=m(l)+'" \n           placeholder="RESPONSE" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===u?d.call(e,{hash:{},data:n}):d),p+=m(l)+');">\n</div>\n\n<div class="panel">\n    <label for="" class="has-icon">'+m((d=i.__||e&&e.__,h={hash:{},data:n},d?d.call(e,"Response processing",h):f.call(e,"__","Response processing",h)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+m((d=i.__||e&&e.__,h={hash:{},data:n},d?d.call(e,"Select the way the response of your interaction should be processed",h):f.call(e,"__","Select the way the response of your interaction should be processed",h)))+'</div>\n\n    <select name="template" class="select2" data-has-search="false">\n        ',l=i.each.call(e,e&&e.templates,{hash:{},inverse:g.noop,fn:g.program(1,r,n),data:n}),(l||0===l)&&(p+=l),p+="\n    </select>\n</div>\n\n",l=i["if"].call(e,e&&e.editMapping,{hash:{},inverse:g.noop,fn:g.program(3,o,n),data:n}),(l||0===l)&&(p+=l),p+="\n\n",l=i["if"].call(e,e&&e.editFeedbacks,{hash:{},inverse:g.noop,fn:g.program(6,c,n),data:n}),(l||0===l)&&(p+=l),p+="\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement",["lodash","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/core/Element","tooltipster"],function(t,e,i){var a={required:"this is required",invalid:"the score format is not numeric"},n={init:function(t){e.initWidget(t.$form)},syncMaxChoices:function(e,a,n,r){a=a||"minChoices",n=n||"maxChoices",r=r||t.size;var o=e.$form.find("input[name="+a+"]"),s=e.$form.find("input[name="+n+"]"),c=function(){var t={max:r(e.element.getChoices())};o.incrementer("options",t).keyup(),s.incrementer("options",t).keyup()};e.on("choiceCreated",function(t){t.interaction.serial===e.element.serial&&c()}).on("deleted",function(t){t.parent.serial===e.element.serial&&i.isA(t.element,"choice")&&c()})},setScore:function(e,i){i=t.defaults(i||{},{required:!1,empty:function(){},set:function(){},key:function(){return $(this).attr("name")},tooltipContent:a}),e.hasClass("tooltipstered")||e.tooltipster({theme:"tao-error-tooltip",content:i.tooltipContent.invalid,delay:350,trigger:"custom"});var n=e.val(),r=parseFloat(n),o=i.key.call(e[0]);""===n?i.required?(e.tooltipster("content",i.tooltipContent.required),e.tooltipster("show")):(e.tooltipster("hide"),i.empty(o)):isNaN(r)?(e.tooltipster("content",i.tooltipContent.invalid),e.tooltipster("show")):(e.tooltipster("hide"),i.set(o,r))}};return n}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e,a){var n,r,s,c="";return c+='\n            <option value="',(r=i.name)?n=r.call(t,{hash:{},data:e}):(r=t&&t.name,n=typeof r===m?r.call(t,{hash:{},data:e}):r),c+=f(n)+'" ',r=i.equal||t&&t.equal,s={hash:{},inverse:g.noop,fn:g.program(2,o,e),data:e},n=r?r.call(t,t&&t.name,a&&a.condition,s):v.call(t,"equal",t&&t.name,a&&a.condition,s),(n||0===n)&&(c+=n),c+=">",(r=i.label)?n=r.call(t,{hash:{},data:e}):(r=t&&t.label,n=typeof r===m?r.call(t,{hash:{},data:e}):r),c+=f(n)+"</option>\n            "}function o(){return'selected="selected"'}function s(){return'style="display:none"'}function c(t,e){var a,n,r="";return r+='\n    <a title="'+f((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"Add else feedback",n):v.call(t,"__","Add else feedback",n)))+'" href="#" class="adder feedbackRule-add-else">else</a>\n    '}function l(t,e){var a,n,r="";return r+='\n     <div class="feedbackRule-then-else">\n            <span class="feedbackRule-desc i">else</span>\n            <button class="btn-info small" type="button" data-feedback="else">'+f((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"Feedback",n):v.call(t,"__","Feedback",n)))+'</button>\n            <span class="feedbackRule-button-delete icon-bin" title="'+f((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"Delete else statement",n):v.call(t,"__","Delete else statement",n)))+'" data-role="else"></span>\n        </div>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var d,h,p,u="",m="function",f=this.escapeExpression,g=this,v=i.helperMissing;return u+='<div class="feedbackRule-container" data-serial="',(h=i.serial)?d=h.call(e,{hash:{},data:n}):(h=e&&e.serial,d=typeof h===m?h.call(e,{hash:{},data:n}):h),u+=f(d)+'">\n    <div class="feedbackRule-rule-if">\n        <span class="feedbackRule-desc i">if</span>\n        <select class="feedbackRule-condition select2" data-has-search="false">\n            ',d=i.each.call(e,e&&e.availableConditions,{hash:{},inverse:g.noop,fn:g.programWithDepth(1,r,n,e),data:n}),(d||0===d)&&(u+=d),u+='\n        </select>\n        <input class="feedbackRule-compared-value score" type="text" value="',(h=i.comparedValue)?d=h.call(e,{hash:{},data:n}):(h=e&&e.comparedValue,d=typeof h===m?h.call(e,{hash:{},data:n}):h),u+=f(d)+'" ',d=i["if"].call(e,e&&e.hideScore,{hash:{},inverse:g.noop,fn:g.program(4,s,n),data:n}),(d||0===d)&&(u+=d),u+='/>\n    </div>\n    <div class="feedbackRule-then-else">\n        <span class="feedbackRule-desc i">then</span>\n        <button class="btn-info small" type="button" data-feedback="then">'+f((h=i.__||e&&e.__,p={hash:{},data:n},h?h.call(e,"Feedback",p):v.call(e,"__","Feedback",p)))+"</button>\n    </div>\n    ",d=i["if"].call(e,e&&e.addElse,{hash:{},inverse:g.noop,fn:g.program(6,c,n),data:n}),(d||0===d)&&(u+=d),u+="\n    ",d=i["if"].call(e,e&&e.feedbackElse,{hash:{},inverse:g.noop,fn:g.program(8,l,n),data:n}),(d||0===d)&&(u+=d),u+='\n    <span class="feedbackRule-button-delete icon-bin" title="'+f((h=i.__||e&&e.__,p={hash:{},data:n},h?h.call(e,"Delete this modal feedback",p):v.call(e,"__","Delete this modal feedback",p)))+'" data-role="rule"></span>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c=i.helperMissing,l=this.escapeExpression;return s+='<h3 class="has-icon">'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"Modal Feedbacks",o):c.call(e,"__","Modal Feedbacks",o)))+'</h3>\n<span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n<span class="tooltip-content">'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"Modal feedback is shown to the candidate directly following response processing.",o):c.call(e,"__","Modal feedback is shown to the candidate directly following response processing.",o)))+'</span>\n<div class="feedbackRules">\n    <p><i>'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"None defined yet.",o):c.call(e,"__","None defined yet.",o)))+'</i></p>\n</div>\n<a href="#" class="adder feedbackRule-add">'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"Add a modal feedback",o):c.call(e,"__","Add a modal feedback",o)))+"</a>"})}),define("taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule",["lodash","jquery","i18n","ui/selecter","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel"],function(t,e,i,a,n,r,o){var s=[{name:"correct",label:i("correct")},{name:"incorrect",label:i("incorrect")},{name:"lt",label:"<"},{name:"lte",label:"<="},{name:"equal",label:"="},{name:"gte",label:">="},{name:"gt",label:">"}],c=function(t){var i,n,o=t.feedbackElse,n=!o;o&&(i=o.serial);var c=r({availableConditions:s,serial:t.serial,condition:t.condition,comparedValue:t.comparedValue,feedbackThen:t.feedbackThen.serial,feedbackElse:i,addElse:n,hideScore:"correct"===t.condition||"incorrect"===t.condition}),l=e(c);return a(l),l},l=function(t,i){var a=t.find(".feedbackRules");t.on("click",".feedbackRule-add",function(t){t.preventDefault();var e=i.createFeedbackRule(),n=a.children(".feedbackRule-container:last");n.length?n.after(c(e)):a.html(c(e))}).on("click",".feedbackRule-add-else",function(t){t.preventDefault();{var a=e(this).parents(".feedbackRule-container"),n=a.data("serial"),r=i.getFeedbackRule(n);i.createFeedbackElse(r)}a.replaceWith(c(r))}).on("click",".feedbackRule-button-delete",function(){var t=e(this),a=t.parents(".feedbackRule-container"),n=a.data("serial"),r=i.getFeedbackRule(n);switch(t.data("role")){case"rule":i.deleteFeedbackRule(r),a.remove();break;case"else":i.deleteFeedbackElse(r),a.replaceWith(c(r))}}).on("change",".feedbackRule-condition",function(){var t=e(this),a=t.val(),r=t.siblings(".feedbackRule-compared-value"),o=i.getFeedbackRule(e(this).parents(".feedbackRule-container").data("serial"));("correct"===o.condition||"incorrect"===o.condition)&&r.val("0"),"correct"===a||"incorrect"===a?r.hide():r.show(),n.setScore(r,{required:!0,set:function(t,e){i.setCondition(o,a,e)}})}).on("keyup",".feedbackRule-compared-value",function(){var t=i.getFeedbackRule(e(this).parents(".feedbackRule-container").data("serial"));n.setScore(e(this),{required:!0,set:function(e,a){i.setCondition(t,t.condition,a)}})}).on("click","[data-feedback]",function(){var t,a,n=e(this),r=i.getFeedbackRule(n.parents(".feedbackRule-container").data("serial"));switch(n.data("feedback")){case"then":t=r.feedbackThen;break;case"else":t=r.feedbackElse}t&&(a=h(t),a.changeState("active"))})},d={},h=function(t){var i=e("#modalFeedbacks");return d[t.serial]||(i.append(t.render()),d[t.serial]=t.postRender()),d[t.serial]};return{initFeedbacksPanel:function(e,i){e.html(o());var a=e.find(".feedbackRules"),n=i.getFeedbackRules();n&&t.size(n)&&(a.empty(),t.each(n,function(t){a.append(c(t))})),l(e,i)},renderFeedbackRule:c}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState",["jquery","lodash","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm","taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule"],function(t,e,i,a,n,r){var o={mappingAttr:function(t,e,i){""===e?t.removeMappingAttribute(i):t.setMappingAttribute(i,e)}},s={forward:function(t){var e=t.element.getResponseDeclaration();t.changeState(i.isUsingTemplate(e,"MATCH_CORRECT")?"correct":i.isUsingTemplate(e,"MAP_RESPONSE")||i.isUsingTemplate(e,"MAP_RESPONSE_POINT")?"map":"custom")},defineCorrect:function(t,a){var n=!1,r=i.getTemplateNameFromUri(t.template),o=t.getCorrect();return void 0===a?"MAP_RESPONSE"===r||"MAP_RESPONSE_POINT"===r?void 0!==t.data("defineCorrect")?n=!!t.data("defineCorrect"):(n=o&&e.size(o),t.data("defineCorrect",n)):"MATCH_CORRECT"===r&&(n=!0):(a||(t.correctResponse=[]),t.data("defineCorrect",a)),n},initResponseForm:function(l){var d=l.element,h=d.getRelatedItem(),p=h.responseProcessing,u=d.getResponseDeclaration(),m=i.getTemplateNameFromUri(u.template),f=e.indexOf(["MAP_RESPONSE","MAP_RESPONSE_POINT"],m)>=0,g=s.defineCorrect(u);if(!m){if("custom"!==p.processingType)throw"invalid response template";m="CUSTOM"}l.$responseForm.html(n({identifier:u.id(),serial:u.getSerial(),defineCorrect:g,editMapping:f,editFeedbacks:"CUSTOM"!==m,template:m,templates:c(d),defaultValue:u.getMappingAttribute("defaultValue"),lowerBound:u.getMappingAttribute("lowerBound"),upperBound:u.getMappingAttribute("upperBound")})),l.$responseForm.find("select[name=template]").val(m);var v=function(t){var e=l.$container.find("[data-edit=correct]");t?e.show():e.hide()};f&&v(g),a.setChangeCallbacks(l.$responseForm,u,{identifier:function(t,e){t.id(e),d.attr("responseIdentifier",e)},defaultValue:o.mappingAttr,lowerBound:o.mappingAttr,upperBound:o.mappingAttr,template:function(t,e){p.setProcessingType("templateDriven"),t.setTemplate(e),s.forward(l),s.initResponseForm(l)},defineCorrect:function(t,e){v(e),s.defineCorrect(t,!!e)}}),r.initFeedbacksPanel(t(".feedbackRule-panel",l.$responseForm),u),a.initWidget(l.$responseForm)},isCorrectDefined:function(t){var i=t.element.getResponseDeclaration();return!!e.size(i.getCorrect())}},c=function(t){var e={CUSTOM:"custom",MATCH_CORRECT:"match correct",MAP_RESPONSE:"map response",MAP_RESPONSE_POINT:"map response"},i=t.getRelatedItem().responseProcessing;switch(t.qtiClass){case"orderInteraction":case"graphicOrderInteraction":case"extendedTextInteraction":delete e.MAP_RESPONSE,delete e.MAP_RESPONSE_POINT;break;case"selectPointInteraction":case"extendedTextInteraction":delete e.MATCH_CORRECT,delete e.MAP_RESPONSE;break;case"sliderInteraction":delete e.MAP_RESPONSE_POINT,delete e.MAP_RESPONSE;break;default:delete e.MAP_RESPONSE_POINT}return"templateDriven"===i.processingType&&delete e.CUSTOM,e};return s}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/content"],function(t,e,i,a){var n=t.create(e,function(){this.widget.$container.addClass("runtime"),this.initResponseForm(),this.widget.$responseForm.show(),a.changeInnerWidgetState(this.widget,"inactive")},function(){this.widget.$container.removeClass("runtime"),this.widget.$responseForm.empty().hide(),a.changeInnerWidgetState(this.widget,"sleep")});return n.prototype.initResponseForm=function(){var t=this.widget;i.initResponseForm(t),t.on("responseTemplateChange",function(){i.forward(t)})},n}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct"],function(t,e){var i=t.create(e,function(){},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.create(e,function(){var t=this.widget.$container.find('[data-edit="correct"]');i.isCorrectDefined(this.widget)?t.show():t.hide()},function(){this.widget.$container.find('[data-edit="correct"]').hide()});return a}),define("taoQtiItem/qtiCreator/widgets/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory"],function(t){return t.create("custom",["answer","active"],function(){throw new Error('state "custom" prototype init method must be implemented')},function(){throw new Error('state "custom" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Custom","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay","i18n"],function(t,e,i,a){var n=t.create(e,function(){this.widget.$container.append(i({message:a("Custom Response Processing Mode")}));this.widget.$container.find("[data-edit=map], [data-edit=correct]").hide()},function(){this.widget.$container.children(".overlay").remove()});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/states/Active","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/states/Map","taoQtiItem/qtiCreator/widgets/interactions/states/Custom"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","i18n"],function(t,e,i,a,n,r){var o=t.extend(e,function(){this.buildPromptEditor()},function(){this.destroyPromptEditor()});return o.prototype.buildPromptEditor=function(){var t=this.widget,e=t.$container.find(".qti-prompt-container"),o=e.find(".qti-prompt"),s=t.element.prompt.getBody();if(e.attr("data-html-editable-container",!0),o.attr("data-html-editable",!0),!i.hasEditor(e)){var c=$(n({serial:t.serial,state:"question"}));e.append(c),c.show(),i.buildEditor(e,{placeholder:r("define prompt"),change:a.getChangeCallback(s),data:{container:s,widget:t}})}},o.prototype.destroyPromptEditor=function(){var t=this.widget.$container.find(".qti-prompt-container");t.find(".mini-tlb").remove(),i.destroyEditor(t)},o}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=this,h=i.helperMissing,p=this.escapeExpression,u="function";return l+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Shuffle choices",c):h.call(e,"__","Shuffle choices",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",c):h.call(e,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",c)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <h3>'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Number of associations",c):h.call(e,"__","Number of associations",c)))+'</h3>\n\n    <div>\n        <label for="minAssociations" class="spinner">Min</label>\n        <input name="minAssociations" value="',(s=i.minAssociations)?o=s.call(e,{hash:{},data:n}):(s=e&&e.minAssociations,o=typeof s===u?s.call(e,{hash:{},data:n}):s),l+=p(o)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",c):h.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",c)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxAssociations" class="spinner">Max</label>\n        <input name="maxAssociations" value="',(s=i.maxAssociations)?o=s.call(e,{hash:{},data:n}):(s=e&&e.maxAssociations,o=typeof s===u?s.call(e,{hash:{},data:n}):s),l+=p(o)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The maximum number of choices that the candidate is allowed to select to form a valid response.",c):h.call(e,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",c)))+"\n        </span>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/helper",["taoQtiItem/qtiCreator/helper/adaptSize","lodash"],function(t,e){return{adaptSize:function(i){e.defer(function(){t.height(i.$container.find(".add-option, .result-area .target, .choice-area .qti-choice"))})}}}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/helper"],function(t,e,i,a,n){var r=t.extend(e);return r.prototype.initForm=function(){var t=this.widget,e=t.$form,r=t.element;e.html(a({shuffle:!!r.attr("shuffle"),minAssociations:parseInt(r.attr("minAssociations")),maxAssociations:parseInt(r.attr("maxAssociations"))})),i.initWidget(e);var o=i.getMinMaxAttributeCallbacks(this.widget.$form,"minAssociations","maxAssociations");o.shuffle=i.getAttributeChangeCallback(),i.setChangeCallbacks(e,r,o),n.adaptSize(t),t.on("choiceCreated",function(){n.adaptSize(t)})},r}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/helper"],function(t,e,i){var a=t.extend(e,function(){var t=this.widget;t.on("containerBodyChange contentChange choiceCreated",function(){i.adaptSize(t)})},function(){});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){i.forward(this.widget)},function(){});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/helper","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,a,n){var r={create:function(a,r){var o=a.element;t.destroy(o),r?(i.appendInstruction(a.element,n("Please define association pairs and their scores below.")),o.responseMappingMode=!0):i.appendInstruction(a.element,n("Please define the correct association pairs below.")),t.render(o),e.adaptSize(a)},setResponse:function(i,a){var n=i.getResponseDeclaration();t.setResponse(i,r.formatResponse(a,n.attr("cardinality"))),e.adaptSize(i.data("widget"))},destroy:function(i){var a=i.element;t.destroy(a),delete a.responseMappingMode,t.renderEmptyPairs(a),e.adaptSize(i)},getResponseSummary:function(t){var e=[],i=a.values(t.getCorrect()),n=t.getMapEntries();return a.each(i,function(t){var i=t.split(" ").sort(),a=i.join(" ");e[a]={pair:i,correct:!0,score:void 0}}),a.forIn(n,function(t,i){var a=i.split(" ").sort(),n=a.join(" ");e[n]?e[n].score=t:e[n]={pair:a,correct:!1,score:t}}),e},formatResponse:function(t,e){var i;return i="single"===e?{base:{pair:[]}}:{list:{pair:[]}},a.each(t,function(t){var a=t.split(" ");"single"===e?i.base.pair=a:i.list.pair.push(a)}),i},unformatResponse:function(t){var e=[];return t.list&&t.list.pair?a.each(t.list.pair,function(t){e.push(t.join(" "))}):t.base&&t.base.pair&&e.push(t.base.pair.join(" ")),e}};return r}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash"],function(t,e,i,a){var n=t.create(e,function(){var t=this.widget.element,e=t.getResponseDeclaration();i.create(this.widget,!1),i.setResponse(t,a.values(e.getCorrect())),this.widget.$container.on("responseChange.qti-widget",function(t,a){e.setCorrect(i.unformatResponse(a.response))})},function(){this.widget.$container.off("responseChange.qti-widget"),i.destroy(this.widget)});return n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="mini-tlb" data-edit="answer" data-for="',(s=i.choiceSerial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.choiceSerial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n    <label class="tlb-button right" title="This answer is correct" data-edit="correct">\n        <input \n            type="checkbox" \n            data-role="correct"\n            name="correct_',(s=i.interactionSerial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.interactionSerial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'[]" \n            value="',(s=i.choiceIdentifier)?o=s.call(e,{hash:{},data:n}):(s=e&&e.choiceIdentifier,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" \n            ',o=i["if"].call(e,e&&e.correct,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='/>\n        <span class="icon-checkbox"></span>\n    </label>\n    <label class="tlb-button right" title="Score of this answer" data-edit="map">\n        <input value="',(s=i.score)?o=s.call(e,{hash:{},data:n}):(s=e&&e.score,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" type="text" data-role="score" data-for="',(s=i.choiceIdentifier)?o=s.call(e,{hash:{},data:n}):(s=e&&e.choiceIdentifier,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" name="score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n    </label>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash","tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer"],function(t,e,i,a,n){var r=t.create(e,function(){var t=this.widget,e=t.element,n=e.getResponseDeclaration();i.create(t,!0),this.bindResponseChangeListener(),i.setResponse(e,a.keys(i.getResponseSummary(n)))},function(){this.widget.$container.off("responseChange.qti-widget"),i.destroy(this.widget),this.widget.$container.find(".mini-tlb").remove()});return r.prototype.bindResponseChangeListener=function(){var t=this.widget,e=t.element,a=e.getResponseDeclaration(),r=0,o=function(){var e=[];$('input[name="correct_'+t.serial+'[]"]:checked').each(function(){e.push($(this).data("pairIdentifier"))}),a.setCorrect(e)};t.$container.on("responseChange.qti-widget",function(t,s,c){if("added"===c.type){var l=[],d=[],h=c.$pair.children(".filled");if(2===h.length){d=i.getResponseSummary(a),h.each(function(){var t=$(this).data("serial"),i=e.getChoice(t);l.push(i.id())}),l.sort();var p=l.join(" "),u=c.$pair.children(".mini-tlb");u.length||(c.$pair.append(n({interactionSerial:e.getSerial(),choiceSerial:"n/a",choiceIdentifier:"n/a"})),u=c.$pair.children(".mini-tlb")),u.show(),u.data("pairIdentifier",p);var m=u.find("[data-role=correct]").data("pairIdentifier",p);d[p]&&d[p].correct?m.prop("checked",!0):m.prop("checked",!1);var f=u.find("[data-role=score]").data("pairIdentifier",p);f.val(d[p]&&d[p].score?d[p].score:r)}}else u=c.$pair.children(".mini-tlb"),u.hide(),a.removeMapEntry(u.data("pairIdentifier")),u.removeData("pairIdentifier"),u.find("[data-role=correct]").prop("checked",!1).removeData("pairIdentifier"),u.find("[data-role=score]").val(r).removeData("pairIdentifier"),o()}),t.$container.find(".result-area").on("change","[data-role=correct]",o).on("keyup","[data-role=score]",function(){var t=$(this);a.setMapEntry(t.data("pairIdentifier"),t.val())})},r}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/helper"],function(t,e,i){var a=t.clone();return a.initCreator=function(){this.registerStates(e),t.initCreator.call(this),i.adaptSize(this)},a}),define("taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return e.renderEmptyPairs(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=this,h=i.helperMissing,p=this.escapeExpression,u="function";return l+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Shuffle choices",c):h.call(e,"__","Shuffle choices",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',c):h.call(e,"__",'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',c)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <h3>'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Allowed number of choices",c):h.call(e,"__","Allowed number of choices",c)))+'</h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(s=i.minChoices)?o=s.call(e,{hash:{},data:n}):(s=e&&e.minChoices,o=typeof s===u?s.call(e,{hash:{},data:n}):s),l+=p(o)+'" data-increment="1" data-min="0" data-max="',(s=i.choicesCount)?o=s.call(e,{hash:{},data:n}):(s=e&&e.choicesCount,o=typeof s===u?s.call(e,{hash:{},data:n}):s),l+=p(o)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",c):h.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",c)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(s=i.maxChoices)?o=s.call(e,{hash:{},data:n}):(s=e&&e.maxChoices,o=typeof s===u?s.call(e,{hash:{},data:n}):s),l+=p(o)+'" data-increment="1" data-min="0" data-max="',(s=i.choicesCount)?o=s.call(e,{hash:{},data:n}):(s=e&&e.choicesCount,o=typeof s===u?s.call(e,{hash:{},data:n}):s),l+=p(o)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The maximum number of choices that the candidate is allowed to select to form a valid response.",c):h.call(e,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",c)))+"\n        </span>\n    </div>\n</div>\n"
})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice","lodash"],function(t,e,i,a,n,r){var o=t.extend(e);return o.prototype.initForm=function(t){var e=this.widget,o=e.$form,s=e.element;o.html(n({shuffle:!!s.attr("shuffle"),maxChoices:parseInt(s.attr("maxChoices")),minChoices:parseInt(s.attr("minChoices")),choicesCount:r.size(e.element.getChoices())})),i.initWidget(o);var c=i.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices",t);c.shuffle=i.getAttributeChangeCallback(),i.setChangeCallbacks(o,s,c),a.syncMaxChoices(e),e.on("attributeChange",function(t){var i=e.$container.find(".real-label > span");t.element.serial===s.serial&&"maxChoices"===t.key&&(1===parseInt(t.value)?i.removeClass("icon-checkbox").addClass("icon-radio"):i.removeClass("icon-radio").addClass("icon-checkbox"))})},o}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){i.forward(this.widget)},function(){});return a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<div class="mini-tlb" data-edit="answer" data-for="',(o=i.choiceSerial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choiceSerial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n    <label class="tlb-button right" title="Score of this answer" data-edit="map">\n        <input value="',(o=i.score)?r=o.call(e,{hash:{},data:n}):(o=e&&e.score,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" \n       title="Score of this answer" \n       type="text" \n       data-for="',(o=i.choiceIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choiceIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" \n       name="score" \n       class="score" \n       placeholder = "',(o=i.placeholder)?r=o.call(e,{hash:{},data:n}):(o=e&&e.placeholder,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'"\n       data-validate="$numeric" \n       data-validate-option="$allowEmpty; $event(type=keyup)" />\n    </label>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'style="display:block;"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l=this,d="function",h=this.escapeExpression;return c+='<div class="mini-tlb-label" data-edit="answer" ',o=i["if"].call(e,e&&e.show,{hash:{},inverse:l.noop,fn:l.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='>\n    <label class="right">',(s=i.label)?o=s.call(e,{hash:{},data:n}):(s=e&&e.label,o=typeof s===d?s.call(e,{hash:{},data:n}):s),c+=h(o)+"</label>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label","lodash","i18n","polyfill/placeholders"],function(t,e,i,a,n,r,o,s,c){var l=function(t){1===t.element.attr("maxChoices")?t.$container.find(".real-label > :checkbox").replaceWith(function(){var t=$(this);return $("<input>",{type:"radio",value:t.attr("value"),name:t.attr("name")})}):t.$container.find(".real-label > :radio").replaceWith(function(){var t=$(this);return $("<input>",{type:"checkbox",value:t.attr("value"),name:t.attr("name")})})},d={create:function(i,a){var n=i.element;t.destroy(n),l(i),a?(e.appendInstruction(i.element,c("Please define the correct response and the score below.")),n.data("responseMappingMode",!0),d.createScoreWidgets(i),d.createCorrectWidgets(i)):(e.appendInstruction(i.element,c("Please define the correct response below.")),d.createCorrectWidgets(i)),t.render(n)},setResponse:function(e,a){t.setResponse(e,i.serialize(s.values(a),e))},destroy:function(e){var i=e.element;t.destroy(i),i.removeData("responseMappingMode"),e.$container.off("responseChange.qti-widget"),e.$container.find(".real-label > input").attr("disabled","disabled"),e.$container.find(".mini-tlb-label[data-edit=answer], .mini-tlb[data-edit=answer]").remove()},createScoreWidgets:function(t){var e=t.$container,i=t.element,n=i.getResponseDeclaration(),s=n.getMapEntries(),l=n.getMappingAttribute("defaultValue"),d=$(o({label:c("score"),show:!0})).css({right:3,left:"auto"});e.find(".qti-choice:first .pseudo-label-box").append(d),e.find(".qti-choice").each(function(){var t,e=$(this),a=e.data("identifier"),n=e.data("serial");t=$(r({serial:i.getSerial(),choiceSerial:n,choiceIdentifier:a,score:s[a]?s[a]:"",placeholder:l})),e.find(".pseudo-label-box").append(t),t.show().on("click",function(t){t.stopPropagation(),t.preventDefault()})});var h=e.find(".score");t.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&h.attr("placeholder",t.value)}),a.setChangeCallbacks(e,n,{score:function(t,e){var i=$(this).data("for");""===e?t.removeMapEntry(i):t.setMapEntry(i,e,!0)}})},createCorrectWidgets:function(t){var e=t.$container,a=t.element,r=a.getResponseDeclaration(),s=e.find(".real-label > input");e.find(".qti-choice:first .pseudo-label-box").append(o({label:c("correct"),show:!1})),e.on("responseChange.qti-widget",function(t,e){r.setCorrect(i.unserialize(e.response,a))});var l=function(t){t?s.removeAttr("disabled"):s.attr("disabled","disabled").prop("checked",!1)};l(n.defineCorrect(r)),t.on("metaChange",function(t){t.element.serial===r.serial&&"defineCorrect"===t.key&&l(t.value)})},formatResponse:function(t){return i.serialize(s.values(t))},unformatResponse:function(t){return i.unserialize(t)}};return d}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(t,e,i,a){var n=t.create(e,function(){var t=this.widget,e=t.element,n=e.getResponseDeclaration();i.create(t),i.setResponse(e,a.values(n.getCorrect()))},function(){i.destroy(this.widget)});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(t,e,i,a){var n=t.create(e,function(){var t=this.widget,e=t.element,n=e.getResponseDeclaration();i.create(t,!0),i.setResponse(e,a.values(n.getCorrect()))},function(){i.destroy(this.widget)});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/model/pciCreatorContext",["lodash"],function(t){var e={},i={register:function(t){e[t.getTypeIdentifier()]=t},getPci:function(i){return e[i]?t.cloneDeep(e[i]):void 0}};return i}),define("taoQtiItem/qtiCreator/helper/pciCreator",["taoQtiItem/qtiCreator/model/pciCreatorContext"],function(t){var e={registerPciModel:function(){},getPciInstance:function(e){var i,a=e.data("pci")||void 0;if(!a){if(i=e.typeIdentifier,a=t.getPci(i),!a)throw"no custom interaction hook found for the type "+i;e.data("pci",a),a._taoCustomInteractionCreator=e}return a}};return e}),define("taoQtiItem/qtiCreator/renderers/interactions/CustomInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/CustomInteraction.amd","taoQtiItem/qtiCreator/helper/pciCreator"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){var n=i.getPciInstance(t).getWidget();return n.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\n    		<option value="'+p((a=null==e||e===!1?e:e.key,typeof a===h?a.apply(t):a))+'" ',a=i["if"].call(t,t&&t.selected,{hash:{},inverse:u.noop,fn:u.program(2,o,e),data:e}),(a||0===a)&&(r+=a),r+=">",(n=i.label)?a=n.call(t,{hash:{},data:e}):(n=t&&t.label,a=typeof n===h?n.call(t,{hash:{},data:e}):n),r+=p(a)+"</option>\n    	"}function o(){return'selected="selected"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h="function",p=this.escapeExpression,u=this,m=i.helperMissing;return d+='<div class="panel">\n    <label for="format" class="spinner">'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Format",l):m.call(e,"__","Format",l)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Used to control the format of the text entered by the candidate.",l):m.call(e,"__","Used to control the format of the text entered by the candidate.",l)))+'</span>\n    <select name="format" class="select2" data-has-search="false">\n    	',s=i.each.call(e,e&&e.formats,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+="\n    </select>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText"],function(t,e,i,a,n,r,o,s){var c=function(){this.widget.$container.find("input, textarea").attr("disabled","disabled")},l=function(){this.widget.$container.find("input, textarea").removeAttr("disabled")},d=a.extend(n,c,l);return d.prototype.initForm=function(){var a=this.widget,n=a.$form,c=a.element,l=c.attr("format"),d={plain:{label:i("Plain text"),selected:!1},preformatted:{label:i("Pre-formatted text"),selected:!1},xhtml:{label:i("XHTML"),selected:!1}};d[l]&&(d[l].selected=!0),n.html(s({formats:d})),r.initWidget(n);var h={};h.format=function(i,a){var n=i.getResponseDeclaration(),r=e.values(n.getCorrect()),s=i.attr("format");i.attr("format",a),o.updateFormat(i,s),"xhtml"===s&&"undefined"!=typeof r[0]&&n.setCorrect(t("<p>"+r[0]+"</p>").text())},r.setChangeCallbacks(n,c,h)},d}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e){var i=t.extend(e,function(){this.widget.changeState("correct")},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,a,n,r){var o=t.create(e,function(){s(this.widget)},function(){c(this.widget)}),s=function(t){var e=t.element,o=e.getResponseDeclaration(),s=n.values(o.getCorrect());i.enable(e),i.setText(e,s[0]),a.appendInstruction(e,r("Please type the correct response below.")),t.$container.on("responseChange.qti-widget",function(){o.setCorrect([i.getResponse(e).base.string])})},c=function(t){var e=t.element;i.clearText(e),a.removeInstructions(t.element),t.$container.off("responseChange.qti-widget")};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return e.render(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/helpers/textWrapper",["jquery"],function(t){function e(){var t;return window.getSelection?t=window.getSelection():document.selection&&(t=document.selection.createRange()),t}function i(t,e){if(1===e.commonAncestorContainer.nodeType)for(var i=e.cloneContents().childNodes,a=0;a<i.length;a++)if(i[a].className&&i[a].className.indexOf("qti-choice")>-1)return!0;return!1}function a(t){var a=e();if(a.rangeCount){var n=a.getRangeAt(0).cloneRange();if(n.startOffset!==n.endOffset&&n.toString().trim()&&!i(a,n))return n.surroundContents(t),a.removeAllRanges(),a.addRange(n),!0}return!1}function n(e){e.trigger("beforeunwrap"),e.find("#selection-wrapper").replaceWith(function(){return t(this).html()}),e.trigger("unwrapped")}var r={create:function(e){r.destroy(e),e.on("mouseup.textwrapper",function(i){var n=t(i.target);if(!n.hasClass("html-editable-shield")&&!n.hasClass("widget-box")){var r=t("<span>",{id:"selection-wrapper","class":"inline-text-wrapper"});if(a(r[0])){var o=r.text().trim();e.trigger("wrapped",[r,o])}}}).on("mousedown.textwrapper",function(){n(e)})},destroy:function(t){n(t),t.off(".textwrapper")}};return r}),define("taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/textWrapper","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger"],function(t,e,i,a,n,r,o){var s=t.extend(e,function(){this.buildEditor()},function(){this.destroyTextWrapper(),this.destroyEditor()});return s.prototype.buildEditor=function(){var t=this,e=this.widget,n=e.element.getBody(),r=e.$container,s=r.find(".qti-flow-container");if(s.attr("data-html-editable-container",!0),!i.hasEditor(s)){var c=$(o({serial:e.serial,state:"question"}));s.append(c),c.show(),t.initTextWrapper(),r.find(".gapmatch-content").html("..."),i.buildEditor(s,{shieldInnerContent:!1,change:a.getChangeCallbackForBlockStatic(n),data:{container:n,widget:e}}),r.find(".gapmatch-content").empty()}},s.prototype.destroyEditor=function(){var t=this.widget.$container,e=t.find(".qti-flow-container");t.find(".gapmatch-content").html("..."),i.destroyEditor(e),t.find(".gapmatch-content").empty(),e.find(".mini-tlb[data-role=cke-launcher-tlb]").remove()},s.prototype.initTextWrapper=function(){var t=this.widget,e=t.element,a=t.$container.find(".qti-flow-container [data-html-editable]"),o=this.getGapModel(),s=$(o.toolbarTpl()).show();s.on("mousedown",function(c){c.stopPropagation();var l=s.parent(),d=l.text().trim();s.detach(),l.removeAttr("id").addClass("widget-box").attr("data-new",!0).attr("data-qti-class",o.qtiClass),r.destroy(a),n.createElements(e.getBody(),a,i.getData(a),function(e){e.changeState("question"),r.create(a),o.afterCreate(t,e,d)})}).on("mouseup",function(t){t.stopPropagation()}),a.on("editorready.wrapper",function(){r.create($(this))}).on("wrapped.wrapper",function(t,e){e.append(s)}).on("beforeunwrap.wrapper",function(){s.detach()})},s.prototype.destroyTextWrapper=function(){var t=this.widget.$container.find(".qti-flow-container [data-html-editable]");r.destroy(t),t.off(".wrapper")},s.prototype.getGapModel=function(){this.throwMissingRequiredImplementationError("getModel")},s}),define("taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/gapMatch",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=this,h=i.helperMissing,p=this.escapeExpression;return l+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Shuffle choices",c):h.call(e,"__","Shuffle choices",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',c):h.call(e,"__",'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',c)))+"\n    </span>\n</div>"})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap-create",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<span class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-role="create-gap-tlb">\n    <span class="rgt tlb-button" title="'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Create gap",s):h.call(e,"__","Create gap",s)))+'" data-role="create-gap">\n        <span class="icon-magicwand"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/gapMatch","tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap-create","lodash"],function(t,e,i,a,n,r){var o=t.extend(e,function(){this.syncCardinality(),this.preventSingleChoiceDeletion()},function(){this.widget.offEvents("question")});return o.prototype.syncCardinality=function(){var t=this.widget.element,e=t.getResponseDeclaration(),i=function(i){var a,n=i.element||i.choice;"gap"===n.qtiClass&&(a=1===r.size(t.getGaps())?"single":"multiple",e.attr("cardinality",a))};this.widget.on("elementCreated",i).on("deleted",i)},o.prototype.initForm=function(){var t=this.widget,e=t.$form,n=t.element;e.html(a({shuffle:!!n.attr("shuffle")})),i.initWidget(e),i.setChangeCallbacks(e,n,{shuffle:i.getAttributeChangeCallback()})},o.prototype.getGapModel=function(){return{toolbarTpl:n,qtiClass:"gap",afterCreate:function(t,e,i){var a=t.element.createChoice(i);t.$container.find(".choice-area .add-option").before(a.render()),a.postRender().changeState("question"),e.changeState("choice")}}},o.prototype.preventSingleChoiceDeletion=function(){var t=this.widget.element,e=this.widget.$container,i=function(){var i=0,a=e.find(".choice-area .qti-choice [data-role=delete]");r.each(t.getChoices(),function(t){t.data("deleting")||i++}),1>=i?a.hide():a.show()};i(),this.widget.on("deleted",i).on("choiceCreated",i),this.widget.afterStateInit(function(t,e,a){"deleting"===a.name&&e.is("gapText")&&i()},"question"),this.widget.afterStateExit(function(t,e,a){"deleting"===a.name&&e.is("gapText")&&i()},"question")},o}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){i.forward(this.widget)},function(){});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o){var s=i.create(a,function(){var i=this.widget,a=i.element,s=a.getResponseDeclaration(),c=t.values(s.getCorrect());n.destroy(a),r.appendInstruction(a,e("Please fill the gap with the correct choices.")),n.render.call(a.getRenderer(),a),n.setResponse(a,o.serialize(t.invoke(c,String.prototype.split," "),a)),i.$container.on("responseChange.qti-widget",function(e,i){var a="single"===s.attr("cardinality")?"base":"list";i.response&&i.response[a]&&s.setCorrect("base"===a?i.response.base.directedPair.join(" "):t.map(i.response.list.directedPair,function(t){return t.join(" ")}))})},function(){var t=this.widget,e=this.widget.element;t.$container.off("responseChange.qti-widget"),n.destroy(e),r.removeInstructions(e)});return s}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreMappingForm",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\n                    <option value="',(n=i.id)?a=n.call(t,{hash:{},data:e}):(n=t&&t.id,a=typeof n===p?n.call(t,{hash:{},data:e}):n),r+=u(a)+'">',(n=i.value)?a=n.call(t,{hash:{},data:e}):(n=t&&t.value,a=typeof n===p?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="</option> \n                    "}function o(){return'style="display:block"'}function s(t){var e,i="";return i+="\n            ",e=typeof t===p?t.apply(t):t,(e||0===e)&&(i+=e),i+="\n        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d,h="",p="function",u=this.escapeExpression,m=i.helperMissing,f=this;return h+='    <div class="form-container">\n        <h1>',(l=i.title)?c=l.call(e,{hash:{},data:n}):(l=e&&e.title,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'</h1>\n\n        <hr />\n        <div class="panel grid-row">\n            <h2>'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Add new pairs",d):m.call(e,"__","Add new pairs",d)))+':</h2>\n        </div> \n        <div class="panel grid-row">\n            <div class="col-4">\n                <select class="select2 new-pair-left" data-placeholder="'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Select a ",d):m.call(e,"__","Select a ",d))),(l=i.leftTitle)?c=l.call(e,{hash:{},data:n}):(l=e&&e.leftTitle,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'">\n                    <option></option>\n                    ',c=i.each.call(e,e&&e.pairLeft,{hash:{},inverse:f.noop,fn:f.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+='\n                </select>\n             </div>\n             <div class="col-4">\n                <select class="select2 new-pair-right"  data-placeholder="'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Select a ",d):m.call(e,"__","Select a ",d))),(l=i.rightTitle)?c=l.call(e,{hash:{},data:n}):(l=e&&e.rightTitle,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'">\n                    <option></option>\n                    ',c=i.each.call(e,e&&e.pairRight,{hash:{},inverse:f.noop,fn:f.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+='\n                </select>\n             </div>\n             <div class="col-1">\n                &nbsp;\n            </div>\n             <div class="col-2">\n                <button class="pair-adder btn-info small"><span class="icon-add"></span>'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Add",d):m.call(e,"__","Add",d)))+'</button>\n            </div> \n        </div>\n        <hr />\n        <div class="panel grid-row heading">\n             <div class="col-4">',(l=i.leftTitle)?c=l.call(e,{hash:{},data:n}):(l=e&&e.leftTitle,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'</div>\n             <div class="col-3">',(l=i.rightTitle)?c=l.call(e,{hash:{},data:n}):(l=e&&e.rightTitle,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=u(c)+'</div>\n            \n            <div class="col-2" data-edit="correct" ',c=i["if"].call(e,e&&e.defineCorrect,{hash:{},inverse:f.noop,fn:f.program(3,o,n),data:n}),(c||0===c)&&(h+=c),h+=">\n                <span>"+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Correct",d):m.call(e,"__","Correct",d)))+'</span>\n                <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n                <span class="tooltip-content">'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Is this pair the correct response?",d):m.call(e,"__","Is this pair the correct response?",d)))+'</span>\n            </div>\n\n            <div class="col-2">\n                <span>'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Score",d):m.call(e,"__","Score",d)))+'</span>\n                <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n                <span class="tooltip-content">'+u((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Set the score for this response",d):m.call(e,"__","Set the score for this response",d)))+'</span>\n            </div>\n            <div class="col-1"></div>\n        </div>\n\n        <div class="panel pairs">\n        ',c=i.each.call(e,e&&e.pairs,{hash:{},inverse:f.noop,fn:f.program(5,s,n),data:n}),(c||0===c)&&(h+=c),h+='\n        </div>\n\n        <hr />\n\n        <span class="arrow"></span>\n        <span class="arrow-cover"></span>\n    </div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreForm",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'style="display:block"'}function o(){return' checked="checked"'}function s(){return'data-default="true"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d,h="",p="function",u=this,m=this.escapeExpression,f=i.helperMissing;return h+='<div class="grid-row">\n    <div class="col-4">\n       ',(l=i.left)?c=l.call(e,{hash:{},data:n}):(l=e&&e.left,c=typeof l===p?l.call(e,{hash:{},data:n}):l),(c||0===c)&&(h+=c),h+='\n    </div>\n    <div class="col-3">\n       ',(l=i.right)?c=l.call(e,{hash:{},data:n}):(l=e&&e.right,c=typeof l===p?l.call(e,{hash:{},data:n}):l),(c||0===c)&&(h+=c),h+='\n    </div>\n    \n    <div class="col-2" data-edit="correct" ',c=i["if"].call(e,e&&e.defineCorrect,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+='>\n        <label>\n            <input name="',(l=i.id)?c=l.call(e,{hash:{},data:n}):(l=e&&e.id,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=m(c)+'-correct" type="checkbox" ',c=i["if"].call(e,e&&e.correct,{hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n}),(c||0===c)&&(h+=c),h+=' />\n            <span class="icon-checkbox"></span>\n        </label>\n    </div>\n\n    <div class="col-2">\n        <input type="text" \n               value="',(l=i.score)?c=l.call(e,{hash:{},data:n}):(l=e&&e.score,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=m(c)+'" \n               name="',(l=i.id)?c=l.call(e,{hash:{},data:n}):(l=e&&e.id,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=m(c)+'-score" \n               class="score" \n               ',c=i["if"].call(e,e&&e.defaultScore,{hash:{},inverse:u.noop,fn:u.program(5,s,n),data:n}),(c||0===c)&&(h+=c),h+='  \n               data-validate="$numeric" \n               data-validate-option="$allowEmpty; $event(type=keyup)" \n        />\n    </div>\n    <div class="col-1">\n        <a href="#" class="pair-deleter" id="',(l=i.id)?c=l.call(e,{hash:{},data:n}):(l=e&&e.id,c=typeof l===p?l.call(e,{hash:{},data:n}):l),h+=m(c)+'-delete" title="'+m((l=i.__||e&&e.__,d={hash:{},data:n},l?l.call(e,"Remove pair",d):f.call(e,"__","Remove pair",d)))+'"><span class="icon-bin"></span></a>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Helper","tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreMappingForm","tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreForm","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/tooltipster","ui/selecter"],function(t,e,i,a,n,r,o,s,c,l){function d(e){var i=t('<div class="mapping-editor arrow-top-left"></div>'),a=e.innerWidth(),n=e.innerHeight();return t(".mapping-editor",e).remove(),i.css({top:n-30,width:a-100}).appendTo(e),i}var h={html:"::",qti:" "};return function(a,p){function u(i){var a=(t(".panel-new-pair",i),t(".pair-adder",i)),n=t(".new-pair-left",i),r=t(".new-pair-right",i),o=t(".select2 > option",i);n.on("change",function(){var t=n.select2("val"),i=r.select2("val");o.removeProp("disabled"),e(q).where({leftId:t}).forEach(function(t){r.find('option[value="'+t.rightId+'"]').prop("disabled",!0)}),e(q).where({rightId:i}).forEach(function(t){n.find('option[value="'+t.leftId+'"]').prop("disabled",!0)
}),"pair"===p.type&&e(q).where({rightId:t}).forEach(function(t){r.find('option[value="'+t.leftId+'"]').prop("disabled",!0)})}),r.on("change",function(){var t=r.select2("val"),i=n.select2("val");o.removeProp("disabled"),e(q).where({rightId:t}).forEach(function(t){n.find('option[value="'+t.leftId+'"]').prop("disabled",!0)}),e(q).where({leftId:i}).forEach(function(t){r.find('option[value="'+t.rightId+'"]').prop("disabled",!0)}),"pair"===p.type&&e(q).where({leftId:t}).forEach(function(t){n.find('option[value="'+t.rightId+'"]').prop("disabled",!0)})}),a.on("click",function(t){o.removeProp("disabled"),t.preventDefault();var e,i=n.select2("val"),a=r.select2("val");i&&a&&(e=i+h.qti+a,x.addPair(e),n.select2("val",""),r.select2("val",""))})}function m(e){e.off("click",".pair-deleter").on("click",".pair-deleter",function(e){e.preventDefault();var i=t(this),a=i.attr("id").replace(/-delete$/,"").replace(h.html,h.qti);x.removePair(a),i.closest(".grid-row").remove()})}function f(t){var i=parseFloat(y.mappingAttributes.defaultValue);return e.map(t,function(t,e){return g(t,e,parseFloat(t)===i)})}function g(t,i,a){var n=i.split(h.qti);return{id:i.replace(h.qti,h.html),score:t,defaultScore:!!a,leftId:n[0],rightId:n[1],left:e.isFunction(p.formatLeft)?p.formatLeft(n[0]):n[0],right:e.isFunction(p.formatRight)?p.formatRight(n[1]):n[1],defineCorrect:o.defineCorrect(y),correct:e.contains(e.values(y.getCorrect()),i)}}function v(){var i={},n=e.values(y.getCorrect());b.length&&(a.on("mappingAttributeChange",function(i){"defaultValue"===i.key&&e.forEach(q,function(e){var a=t('[name="'+e.id+'-score"]',b);a.data("default")&&(a.val(i.value),y.setMapEntry(e.id.replace(h.html,h.qti),i.value))})}),e.forEach(q,function(a){var r=a.id.replace(h.html,h.qti);i[a.id+"-score"]=function(e,i){t('[name="'+a.id+'-score"]',b).removeAttr("data-default").removeData("default"),e.setMapEntry(r,i)},i[a.id+"-correct"]=function(t,i){i===!0?e.contains(n,r)||n.push(r):n=e.without(n,r),t.setCorrect(n)}}),s.setChangeCallbacks(b,y,i))}var b,I=a.$container,C=a.element,y=C.getResponseDeclaration(),w=[],q=[],x={load:function(){var a=(e.values(y.getCorrect()),y.getMapEntries());return w.length?w.empty():w=d(I),p&&(p.entries?(q=f(p.entries),y.removeMapEntries(),e.forEach(q,function(t){("undefined"==typeof t.score||null===t.score)&&(t.score=y.mappingAttributes.defaultValue||0),y.setMapEntry(t.id.replace(h.html,h.qti),t.score)})):q=f(a),b=t(n({title:p.title||i("Pair scoring"),leftTitle:p.leftTitle||i("Choices"),rightTitle:p.rightTitle||i("Gaps"),defineCorrect:o.defineCorrect(y),scoreMin:y.getMappingAttribute("lowerBound"),scoreMax:y.getMappingAttribute("upperBound"),pairs:e.map(q,r),pairLeft:e.isFunction(p.pairLeft)?p.pairLeft():e.values(C.getChoices()),pairRight:e.isFunction(p.pairRight)?p.pairRight():e.values(C.getChoices())})),v(),w.append(b),l(w),c(w),m(w),u(w)),this},addPair:function(i){var a=y.mappingAttributes.defaultValue,n=g(a,i,!0);return q.push(n),y.setMapEntry(i,a),t(".pairs",w).append(r(n)),v(),e.isFunction(p.add)&&p.add(i),this},removePair:function(t){return e.remove(q,{id:t.replace(h.qti,h.html)}),y.removeMapEntry(t),e.isFunction(p.remove)&&p.remove(t),this},destroy:function(){w.length&&w.remove(),t("#item-editor-panel").css("overflow","")}};return x.load()}}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function(t,e,i,a,n,r,o,s,c){function l(){{var t=this.widget,a=t.element,n=a.getResponseDeclaration(),s=e.values(n.getCorrect());0===e.size(n.getMapEntries())?s:e.keys(n.getMapEntries())}r.destroy(a),o.appendInstruction(a,i("Please fill the gap with the texts below, then edit the score for each pair.")),a.responseMappingMode=!0,r.render.call(a.getRenderer(),a),h(t.$container),0===e.size(n.getMapEntries())?p(t,s):p(t),t.$container.on("responseChange.qti-widget",function(i,r){var o,s,c="single"===n.attr("cardinality")?"base":"list";r&&r.response&&r.response[c]&&(o=e.invoke(r.response[c].directedPair,Array.prototype.join," "),s=e.keys(n.getMapEntries()),e(o).difference(s).forEach(a.pairScoringForm.addPair,a.pairScoringForm)),h(t.$container)})}function d(){var t=this.widget,e=t.element;t.$container.off("responseChange.qti-widget"),e.pairScoringForm&&e.pairScoringForm.destroy(),o.removeInstructions(e),r.destroy(e)}function h(e){t(".gapmatch-content",e).removeClass("filled").addClass("gap-info").each(function(){var e=t(this);e.text(e.data("identifier"))})}function p(t,a){var n=t.element,r=n.getResponseDeclaration(),o=r.getMapEntries(),s=e.transform(n.getChoices(),function(t,e){t[e.id()]=e.val()},{}),l={leftTitle:i("Choice"),rightTitle:i("Gap"),type:"directedPair",pairLeft:function(){return e.map(n.getChoices(),function(t){return{id:t.id(),value:t.val()}})},pairRight:function(){return e.map(n.getGaps(),function(t){return{id:t.id(),value:t.id()}})},formatLeft:function(t){return s[t]||t}};a&&(l.entries=e.transform(a,function(t,e){t[e]=void 0!==o[e]?o[e]:r.mappingAttributes.defaultValue},{})),n.pairScoringForm=c(t,l)}return a.create(n,l,d)}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/GapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement"],function(t,e,i,a,n){var r={createPaper:function(t){var e,i=this.$original,n=i.parents(".qti-item"),r=this.element.object.attributes,o=this.element.serial;return r.data?(e=a.responsivePaper("graphic-paper-"+o,o,{width:r.width,height:r.height,img:this.baseUrl+r.data,imgId:"bg-image-"+o,container:i,resize:t}),n.on("resize.gridEdit."+o,function(){i.trigger("resize.qti-widget."+o)})):this._createPlaceholder(),e},_createPlaceholder:function(){var e=this,a=this.$original,r=a.find(".main-image-box"),o=a.find(".image-editor"),s=o.outerWidth()-o.width()+(a.outerWidth()-a.width())+1;n.get({icon:"image",css:{width:a.innerWidth()-s,height:200},title:i("Select an image first.")}).click(function(){var i=t('[data-role="upload-trigger"]',e.$form);i.length&&i.trigger("click")}).appendTo(r)},createChoices:function(){e.forEach(this.element.getChoices(),this._currentChoices,this)},_currentChoices:function(t){a.createElement(this.element.paper,t.attr("shape"),t.attr("coords"),{id:t.serial,touchEffect:!1})}};return r}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},a=function(){};return t.extend(e,i,a)}),define("tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return"tall"}function o(t,e){var a,n,r="";return r+='\n        <li class="separator"></li>\n        <li data-type="target"><span title="'+p((a=i.__||t&&t.__,n={hash:{},data:e},a?a.call(t,"Drop the target to select a point",n):h.call(t,"__","Drop the target to select a point",n)))+'" class="icon-target"></span></li>\n        '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h=i.helperMissing,p=this.escapeExpression,u=this;return d+='<div class="image-sidebar lft  ',s=i["if"].call(e,e&&e.showTarget,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+='">\n    <ul class="none forms solid">\n        <li data-type="rect"><span title="'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Draw a rectangle on the image",l):h.call(e,"__","Draw a rectangle on the image",l)))+'" class="icon-rectangle"></span></li>\n        <li data-type="circle"><span title="'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Draw a circle on the image",l):h.call(e,"__","Draw a circle on the image",l)))+'" class="icon-circle"></span></li>\n        <li data-type="ellipse"><span title="'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Draw an ellipsis on the image",l):h.call(e,"__","Draw an ellipsis on the image",l)))+'" class="icon-ellipsis"></span></li>\n        <li data-type="path"><span title="'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Draw a free form on the image",l):h.call(e,"__","Draw a free form on the image",l)))+'" class="icon-free-form"></span></li>\n    \n        ',s=i["if"].call(e,e&&e.showTarget,{hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n}),(s||0===s)&&(d+=s),d+='\n\n        <li class="separator"></li>\n        <li class="bin disabled"><span title="'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Remove the selected shape",l):h.call(e,"__","Remove the selected shape",l)))+'" class="icon-bin"></span></li>\n    </ul>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar",["jquery","lodash","tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar"],function(t,e,i){var a={create:function(a,n){var r=a.find(".image-editor"),o=a.data("serial"),s=(t(".main-image-box",r),t(i({showTarget:!!n})).insertBefore(r)),c=t("li[data-type]",s),l=t("li.bin",s),d=function(e){c.filter(".active").each(function(){h(t(this))}),e.addClass("active"),s.trigger("shapeactive.qti-widget",[e,e.data("type")])},h=function(t){t.removeClass("active"),s.trigger("shapedeactive.qti-widget",[t,t.data("type")])};return s.on("enablebin.qti-widget",function(){l.removeClass("disabled").on("click",function(t){t.preventDefault(),s.trigger("bin.qti-widget")})}),s.on("disablebin.qti-widget",function(){l.addClass("disabled").off("click")}),c.click(function(e){e.preventDefault();var i=t(this);i.hasClass("active")?h(i):d(i)}),a.on("resize.qti-widget."+o,function(){e.defer(function(){s.find(".forms").height(r.innerHeight())})}),a.trigger("resize.qti-widget."+o),s},remove:function(e){{var i=t(".image-sidebar",e),a=e.find(".image-editor");t(".main-image-box",a)}i.length&&(i.remove(),e.off("resize.qti-widget.sidebar"),e.trigger("resize.qti-widget"))}};return a}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers",["jquery","lodash","raphael"],function(t,e,i){var a=function(t,a){var n=function(t){var a,n=t.getBBox(),r=n.width>25?6:4,o=r/2,s=n.width/2,c=n.height/2;switch(t.type){case"circle":a={midTop:[n.x+s-o,n.y-r,r,r],midRight:[n.x+n.width,n.y+c-o,r,r],midBot:[n.x+s-o,n.y+n.height,r,r],midLeft:[n.x-r,n.y+c-o,r,r]};break;case"path":a={},e.forEach(i.parsePathString(t.attr("path")),function(t,e){3===t.length&&(a["point"+e]=t.slice(1).concat(o))});break;case"rect":case"ellipse":a={topLeft:[n.x-r,n.y-r,r,r],midTop:[n.x+s-o,n.y-r,r,r],topRight:[n.x+n.width,n.y-r,r,r],midRight:[n.x+n.width,n.y+c-o,r,r],botRight:[n.x+n.width,n.y+n.height,r,r],midBot:[n.x+s-o,n.y+n.height,r,r],botLeft:[n.x-r,n.y+n.height,r,r],midLeft:[n.x-r,n.y+c-o,r,r]}}return a};return e.map(n(a),function(e,i){var n,r,o;if("path"===a.type)n="move",o="circle";else switch(o="rect",i){case"topLeft":n="nw-resize",r={ix:!0,iy:!0};break;case"midTop":n="ns-resize",r={iy:!0};break;case"topRight":n="ne-resize",r={x:!0,iy:!0};break;case"midRight":n="ew-resize",r={x:!0};break;case"botRight":n="se-resize";break;case"midBot":n="ns-resize",r={y:!0};break;case"botLeft":n="sw-resize",r={ix:!0,y:!0};break;case"midLeft":n="ew-resize",r={ix:!0}}return t[o].apply(t,e).attr({fill:"#eeeeee",cursor:n}).data("constraints",r)})};return a}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function(t,e){var i=function(t,i){function n(){var e;switch(t.type){case"circle":e={x:t.attrs.cx,y:t.attrs.cy};break;case"ellipse":case"rect":e=t.getBBox()}return e}var r;t&&t.type&&i.stop&&(r=e.bind(a[t.type],a),i.start||(i.start=n(t)),e.isFunction(r)&&t.animate(r(i),100,"linear",e.isFunction(i.resized)?i.resized:e.noop))},a={rect:function(t){var e=t.start,i=t.stop,a=t.constraints,n={};return(!a||a.x)&&(n.width=i.x-e.x,n.width<0&&(n.x=i.x,n.width=-1*n.width)),(!a||a.y)&&(n.height=i.y-e.y,n.height<0&&(n.y=i.y,n.height=-1*n.height)),a&&a.ix&&(n.x=i.x,n.width=e.width-(i.x-e.x),n.width<0&&(n.x=i.x,n.width=-1*n.width)),a&&a.iy&&(n.y=i.y,n.height=e.height-(i.y-e.y),n.height<0&&(n.y=i.y,n.height=-1*n.height)),n.width<10&&(n.width=10),n.height<10&&(n.height=10),n},circle:function(t){var e=t.start,i=t.stop,a=i.x>e.x?i.x-e.x:e.x-i.x,n=i.y>e.y?i.y-e.y:e.y-i.y,r=Math.floor(Math.sqrt(Math.pow(a,2)+Math.pow(n,2)));return{r:5>r?5:r}},ellipse:function(t){var e={},i=this.rect(t);return i.x&&(e.x=i.x),i.y&&(e.y=i.y),i.width&&(e.rx=i.width/2),i.height&&(e.ry=i.height/2),e},path:function(t){var i={};return t.path&&t.start&&(i.path="",e.forEach(t.path,function(e,a){i.path+=e[0],3===e.length&&(i.path+=a===t.pointIndex||0===t.pointIndex&&1===a?t.stop.x+","+t.stop.y:e[1]+","+e[2])})),i}};return i}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover",["jquery","lodash"],function(t,e){var i=function(t,i,n){var r;t&&t.type&&(r=e.bind(a[t.type],a),e.isFunction(r)&&t.animate(r(i,n)))},a={rect:function(t,e){return{x:e.x-t.x,y:e.y-t.y}},circle:function(t,e){return{cx:e.x,cy:e.y}},ellipse:function(t,e){return{cx:e.x,cy:e.y}},path:function(t,i){var a={path:""};return e.forEach(t.path,function(e){a.path+=e[0],3===e.length&&(a.path+=e[1]+i.x-t.x+","+(e[2]+i.y-t.y))}),a}};return i}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function(t,e,i){var a=function(t){var a={_path:null,closed:!1,set:null,points:[],getPath:function(){return this._path},start:function(t){return this.points=[],this.add(t)},add:function(e){var a,n=this;return a=t.circle(e.x,e.y,3).attr({stroke:"black","stroke-width":1,fill:"white",opacity:.7,cursor:"pointer"}).click(function(t){t.preventDefault(),t.stopPropagation(),n.points.length>2&&(this.attr("fill","green"),n.close())}),0===this.points.length&&(a.attr("fill","red"),this.set=t.set(),this._path=t.path("M"+e.x+","+e.y).attr(i._style.active).attr("opacity",.3),this.set.push(this._path)),this.points.push(e),this.set.push(a),this._path.animate({path:this._path.attr("path")+"L"+e.x+","+e.y}),this},close:function(){return this._path.attr({path:this._path.attr("path")+"Z"}).attr(i._style.active).attr("opacity",1),this.set.forEach(function(t){"circle"===t.type&&t.remove()}),this.closed=!0,e.isFunction(this.closeCb)&&this.closeCb(),this},onClose:function(t){return this.closeCb=t,this}};return a};return a}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function(t,e,i,a,n,r,o){var s=function(t){var a=t.paper,r=t.background,s=t.$container,c=t.isResponsive||!1,l=t.type||"rect",d={states:{drawing:!1},_events:{},on:function(t,i){e.isFunction(i)&&(this._events[t]=i)},is:function(t){return this.states[t]===!0},setState:function(t,e){this.states[t]=e},start:function(){switch(l){case"path":this.startDrawingPath();break;case"target":this.startPositionTarget();break;default:this.startWithMouse()}},startPositionTarget:function(){var t=this;t.setState("drawing",!0),r.click(function(e){e.preventDefault(),e.stopPropagation();var n=i.getPoint(e,a,s,c);i.createTarget(a,{point:n,create:function(e){t.setState("drawing",!1),r.unclick(),t._events["created.qti-widget"]&&t._events["created.qti-widget"].call(this,e)},remove:!1,hover:!1})})},startDrawingPath:function(){function t(){e.setState("drawing",!1),r.unclick(),e._events["created.qti-widget"]&&e._events["created.qti-widget"].call(this,n.getPath())}var e=this,n=o(a);e.setState("drawing",!0),n.onClose(t),r.click(function(t){t.preventDefault(),t.stopPropagation(),e.is("drawing")&&n.add(i.getPoint(t,a,s,c))})},startWithMouse:function(){function t(){p.setState("drawing",!1),r.unmousedown().unmousemove().unmouseup(),h.unmousedown().unmouseup().unmousemove(),p._events["created.qti-widget"]&&p._events["created.qti-widget"].call(this,h)}function o(t){p.is("drawing")&&n(h,{start:d,stop:i.getPoint(t,a,s,c)})}var d,h,p=this,u=e.throttle(o,10);r.mousedown(function(e){e.preventDefault(),p.is("drawing")||(p.setState("drawing",!0),d=i.getPoint(e,a,s,c),h=i.createElement(a,l,[d.x,d.y,25,25],{style:"creator",hover:!1,touchEffect:!1,qtiCoords:!1}),h.mouseup(t),r.mouseup(t),h.mousemove(u),r.mousemove(u))})},stop:function(){r.unmousedown().unmousemove().unmouseup().unclick()}};return d};return s}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function(t,e,i,a,n,r){var o=function(o,s){var c=s.paper,l=s.background,d=s.$container,h=s.isResponsive||!1,p={shape:null,handlers:[],states:{drawing:!1,handling:!1,resizing:!1,moving:!1},_events:{},on:function(t,i){return e.isFunction(i)&&(this._events[t]=i),this},trigger:function(t){return e.isFunction(this._events[t])&&this._events[t].apply(this,Array.prototype.slice.call(arguments,1)),this},is:function(t){return this.states[t]===!0},setState:function(t,e){return this.states[t]=e,this},_init:function(t){var e=this;return t&&t.type&&(e.shape=t,l.click(function(){!e.is("resizing")&&e.is("handling")&&e.quitHandling()}),e.shape.click(function(){e.is("resizing")||(e.is("handling")?e.quitHandling():e.enterHandling())})),this},enterHandling:function(){function s(){var t,a=this;b.setState("resizing",!0).trigger("shapechanging.qti-widget"),b.layer=b.shape.clone(),b.layer.attr(i._style.basic),b.layer.attr("cursor",a.attrs.cursor),t=b.layer.getBBox(),b.layerTxt=i.createShapeText(c,b.layer,{style:"layer-pos-text",content:parseInt(t.width,10)+" x "+parseInt(t.height,10)}),"path"===b.shape.type&&e.forEach(b.shape.attr("path"),function(t,e){return 3===t.length&&t[1]===this.attr("cx")&&t[2]===this.attr("cy")?(this.pointIndex=e,!1):void 0},a),e.invoke(e.reject(e.clone(b.handlers),function(t){return t===a}),"hide")}function p(t,a,r,o,s){var l,p;b.is("resizing")&&(l=i.getPoint(s,c,d,h),p={stop:l,constraints:this.data("constraints"),resized:e.throttle(function(){var t=this.getBBox();b.layerTxt.attr("text",parseInt(t.width,10)+" x "+parseInt(t.height,10))},100)},"path"===b.shape.type&&(p.start=e.pick(this.attrs,["cx","cy"]),p.path=b.layer.attr("path"),p.pointIndex=this.pointIndex),n(b.layer,p),this.animate("circle"===this.type?{cx:l.x,cy:l.y}:l))}function u(){b.shape.animate(e.pick(b.layer.attrs,["x","y","cx","cy","r","rx","ry","width","height","path"]),200,function(){b.setState("resizing",!1).trigger("shapechange.qti-widget")}),b.layer.remove(),b.layerTxt.remove(),e.invoke(b.handlers,"remove"),b.handlers=[]}function m(t){var i,a,n;if(!b.is("moving")){switch(b.setState("moving",!0),e.invoke(b.handlers,"remove"),i=o.attr(),b.shape.type){case"rect":n={x:0,y:0},a={x:39===t?i.x+1:37===t?i.x-1:i.x,y:40===t?i.y+1:38===t?i.y-1:i.y};break;case"ellipse":case"circle":n={x:0,y:0},a={x:39===t?i.cx+1:37===t?i.cx-1:i.cx,y:40===t?i.cy+1:38===t?i.cy-1:i.cy};break;case"path":n={path:i.path},a={}}r(b.shape,n,a),b.setState("moving",!1).trigger("shapechange.qti-widget")}}function f(t,a,n){b.setState("moving",!0).trigger("shapechanging.qti-widget");var r=i.getPoint(n,c,d,h);this.startPoint={x:r.x-this.attr("x"),y:r.y-this.attr("y")},"path"===this.type&&(this.startPoint.path=this.attr("path")),b.shape.attr("cursor","move"),l.attr("cursor","move"),e.invoke(b.handlers,"remove")}function g(t,e,a,n,o){b.is("moving")&&r(this,this.startPoint,i.getPoint(o,c,d,h))}function v(){delete this.startPoint,b.shape.attr("cursor","pointer"),l.attr("cursor","default"),b.setState("moving",!1).trigger("shapechange.qti-widget")}var b=this;if(b.setState("handling",!0).trigger("enterhandling.qti-widget"),"set"!==b.shape.type){b.handlers=a(c,b.shape),e.forEach(b.handlers,function(t){t.drag(p,s,u)}),b.shape.drag(g,f,v);var I=e.throttle(m,20);return t(document).on("keydown.qti-widget",function(t){var e=t.which;e>=37&&40>=e&&(t.preventDefault(),I(e))}),this}},quitHandling:function(){return t(document).off("keydown.qti-widget"),this.shape.undrag(),e.invoke(this.handlers,"remove"),this.handlers=[],this.setState("moving",!1).setState("resizing",!1).setState("handling",!1).trigger("quithandling.qti-widget"),this},removeShape:function(){var t,e;return this.shape&&(this.quitHandling(),t=this.shape.id,e=this.shape.data,this.shape.remove(),this.trigger("remove.qti-widget",t,e)),this},destroy:function(){return this.is("handling")&&this.quitHandling(),this.shape&&(this.shape.unclick(),l.unclick()),this.shape=null,this.handlers=[],this._events={},this}};return p._init(o)};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor"],function(t,e,i,a,n,r){return function(t,o){var s={editors:[],create:function(){function s(t,i){var a=r(t,b);a.on("enterhandling.qti-widget",function(){e.invoke(e.reject(d,a),"quitHandling"),I.trigger("enablebin.qti-widget").on("bin.qti-widget",function(){a.removeShape(),a.destroy(),d=e.reject(d,a),a=void 0}),e.isFunction(o.enterHandling)&&o.enterHandling(t)}).on("shapechanging.qti-widget",function(){e.isFunction(o.shapeChanging)&&o.shapeChanging(t)}).on("shapechange.qti-widget",function(){e.isFunction(o.shapeChange)&&o.shapeChange(t)}).on("quithandling.qti-widget",function(){e.isFunction(o.quitHandling)&&o.quitHandling(t),I.trigger("disablebin.qti-widget").off("click").off("bin.qti-widget")}).on("remove.qti-widget",function(t,i){e.isFunction(o.shapeRemoved)&&o.shapeRemoved(t,i),e.remove(v,t)}),d.push(a),i&&a.enterHandling()}function c(t,i){var a=h[t];h[t]||(a=n(e.merge({type:t},b)),h[t]=a),a.on("created.qti-widget",i),a.start()}function l(t,e,i){var a,n;"target"!==t?s(e,i):(a=f.getById("layer-"+e.id),n=f.set(e,a),n.id=e.id,n.data=e.data(),s(n,i))}var d=this.editors,h={},p=t.$container,u=t.$original,m=t.element,f=m.paper,g=f.getById("bg-image-"+m.serial),v=o.currents||e.pluck(m.getChoices(),"serial"),b={paper:m.paper,background:g,$container:p.find(".main-image-box"),isResponsive:u.hasClass("responsive")},I=a.create(u,!!o.target);I.on("shapeactive.qti-widget",function(t,i,a){c(a,function(t){e.isFunction(o.shapeCreated)&&o.shapeCreated(t,a),i.removeClass("active"),l(a,t)})}),I.on("shapedeactive.qti-widget",function(t,e,i){h&&h[i]&&h[i].stop()}),e.forEach(v,function(t){var e=f.getById(t);e&&(e.attr(i._style.creator).unmouseover().unmouseout(),/^target/.test(e.id)?l("target",e):l(e.type,e,!1))})},destroy:function(){var n=t.$original,r=t.element,s=r.paper,c=o.currents||e.pluck(r.getChoices(),"serial");a.remove(n),e.invoke(this.editors,"destroy"),e.forEach(c,function(t){var e=s.getById(t);e&&e.attr(i._style.basic).hover(function(){e.flashing||i.updateElementState(this,"hover")},function(){e.flashing||i.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")})})}};return s}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector",["jquery","lodash","i18n","util/image","ui/resourcemgr"],function(t,e,i,a){return function(n,r){var o=t('[data-role="upload-trigger"]',n),s=t("input[name=data]",n),c=t("input[name=width]",n),l=t("input[name=height]",n),d=t("input[name=type]",n),h=r.title?r.title:i('Please select a background picture for your interaction from the resource manager. You can add new files from your computer with the button "Add file(s)".'),p=function(){o.resourcemgr({title:h,appendContainer:r.mediaManager.appendContainer,root:"/",browseUrl:r.mediaManager.browseUrl,uploadUrl:r.mediaManager.uploadUrl,deleteUrl:r.mediaManager.deleteUrl,downloadUrl:r.mediaManager.downloadUrl,params:{uri:r.uri,lang:r.lang,filters:"image/jpeg,image/png,image/gif"},pathParam:"path",select:function(t,i){var n;i.length>0&&(n=i[0],a.getSize(r.baseUrl+i[0].file,function(t){t&&t.width>=0&&(c.val(t.width).trigger("change"),l.val(t.height).trigger("change")),d.val(n.mime).trigger("change"),e.defer(function(){s.val(n.file).trigger("change")})}))},open:function(){s.hasClass("tooltipstered")&&s.blur().tooltipster("hide")},close:function(){s.blur()}})};o.on("click",p),s.val()||p()}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Interaction Background",s):l.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div class="panel">\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Mime Type",s):l.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n    \n     <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of associations",s):l.call(e,"__","Allowed number of associations",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of associations that the candidate is required to make to form a valid response.",s):l.call(e,"__","The minimum number of associations that the candidate is required to make to form a valid response.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"he maximum number of associations that the candidate is allowed to make.",s):l.call(e,"__","he maximum number of associations that the candidate is allowed to make.",s)))+'\n        </span>\n    </h3>\n\n    <div class="panel">\n        <label for="minAssociations" class="spinner">Min</label>\n        <input name="minAssociations" value="',(o=i.minAssociations)?r=o.call(e,{hash:{},data:n}):(o=e&&e.minAssociations,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="maxAssociations" class="spinner">Max</label>\n        <input name="maxAssociations" value="',(o=i.maxAssociations)?r=o.call(e,{hash:{},data:n}):(o=e&&e.maxAssociations,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='\n<div class="panel">\n    <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"identifier",s):l.call(e,"__","identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):l.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" \n           placeholder="e.g. my-hotspot_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+');">\n</div>\n\n<h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of matches",s):l.call(e,"__","Allowed number of matches",s)))+'\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of choices this choice must be associated with to form a valid response.",s):l.call(e,"__","The minimum number of choices this choice must be associated with to form a valid response.",s)))+"<br>\n        "+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices this choice may be associated with.",s):l.call(e,"__","The maximum number of choices this choice may be associated with.",s)))+'\n    </span>\n</h3>\n\n<div>\n    <label for="matchMin" class="spinner">Min</label>\n    <input name="matchMin" value="',(o=i.matchMin)?r=o.call(e,{hash:{},data:n}):(o=e&&e.matchMin,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n</div>\n<div>\n    <label for="matchMax" class="spinner">Max</label>\n    <input name="matchMax" value="',(o=i.matchMax)?r=o.call(e,{hash:{},data:n}):(o=e&&e.matchMax,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n</div>\n\n<h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Shape position",s):l.call(e,"__","Shape position",s)))+'</h3>\n\n<div class="panel">\n    <label for="x">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Left",s):l.call(e,"__","Left",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="x" value="',(o=i.x)?r=o.call(e,{hash:{},data:n}):(o=e&&e.x,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="y">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Top",s):l.call(e,"__","Top",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="y" value="',(o=i.y)?r=o.call(e,{hash:{},data:n}):(o=e&&e.y,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n\n'
})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","taoQtiItem/qtiCreator/helper/dummyElement","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,a,n,r,o,s,c,l,d,h,p,u,m){var f=function(){function i(i){var a,n,r=s.getChoice(i);if(r){a=s.paper.getById(i),n=a.getBBox(),v.empty().html(p({identifier:r.id(),fixed:r.attr("fixed"),serial:i,matchMin:r.attr("matchMin"),matchMax:r.attr("matchMax"),choicesCount:e.size(s.getChoices()),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10)})),c.initWidget(v);var o=c.getMinMaxAttributeCallbacks(v,"matchMin","matchMax");o.identifier=d.updateChoiceIdentifier,o.fixed=c.getAttributeChangeCallback(),c.setChangeCallbacks(v,r,o),I.show(),m.openSections(I.children("section")),m.closeSections(b.children("section")),h=t("input[name=x]",v),u=t("input[name=y]",v),f=t("input[name=width]",v),g=t("input[name=height]",v)}}function n(){"none"!==I.css("display")&&(m.openSections(b.children("section")),I.hide(),v.empty())}var r=this.widget,s=r.element,l=(r.options,s.paper);if(l){var h,u,f,g,v=r.choiceForm,b=t("#item-editor-interaction-property-bar"),I=t("#item-editor-choice-property-bar");r._editor=o(r,{shapeCreated:function(t,e){var i=s.createChoice({shape:"path"===e?"poly":e,coords:a.qtiCoords(t)});t.id=i.serial},shapeRemoved:function(t){s.removeChoice(t)},enterHandling:function(t){i(t.id)},quitHandling:function(){n()},shapeChange:function(t){var e,i=s.getChoice(t.id);i&&(i.attr("coords",a.qtiCoords(t)),h&&h.length&&(e=t.getBBox(),h.val(parseInt(e.x,10)),u.val(parseInt(e.y,10)),f.val(parseInt(e.width,10)),g.val(parseInt(e.height,10))))}}),r._editor.create()}},g=function(){var e=this.widget,i=e.element,a=i.paper;a&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy())},v=n.extend(r,f,g);return v.prototype.initForm=function(){var t=this.widget,i=t.options,a=t.element,n=t.$form,r=function(t){var e=0;return t>0?Math.round(t*(t-1)/2):e};n.html(h({baseUrl:i.baseUrl,maxAssociations:parseInt(a.attr("maxAssociations"),10),minAssociations:parseInt(a.attr("minAssociations"),10),choicesCount:r(e.size(a.getChoices())),data:a.object.attr("data"),width:a.object.attr("width"),height:a.object.attr("height"),type:a.object.attr("type")})),s(n,i),c.initWidget(n);var o=c.getMinMaxAttributeCallbacks(n,"minAssociations","maxAssociations");o.data=function(e,i){a.object.attr("data",i),t.rebuild({ready:function(t){t.changeState("question")}})},o.width=function(t,e){a.object.attr("width",e)},o.height=function(t,e){a.object.attr("height",e)},o.type=function(t,e){e&&""!==e?a.object.attr("type",e):a.object.removeAttr("type")},c.setChangeCallbacks(n,a,o,{validateOnInit:!1}),l.syncMaxChoices(t,"minAssociations","maxAssociations")},v}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function a(){i.forward(this.widget)}function n(){}return t.extend(e,a,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o){function s(){var i=this.widget,a=i.element,s=a.getResponseDeclaration(),c=t.values(s.getCorrect());n.destroy(a),a.paper&&(r.appendInstruction(a,e("Please set the correct associations by linking the choices.")),n.render.call(a.getRenderer(),a),n.setResponse(a,o.serialize(t.invoke(c,String.prototype.split," "),a)),i.$container.on("responseChange.qti-widget",function(e,i){i.response&&i.response.list&&s.setCorrect(t.map(i.response.list.pair,function(t){return t.join(" ")}))}))}function c(){var t=this.widget,e=t.element;e.paper&&(t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),n.destroy(e),e.paper=t.createPaper(),t.createChoices())}return i.create(a,s,c)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function(t,e,i,a,n,r,o,s,c,l){function d(){{var t=this.widget,a=t.element,n=a.getResponseDeclaration(),s=e.values(n.getCorrect());0===e.size(n.getMapEntries())?s:e.keys(n.getMapEntries())}r.destroy(a),a.paper&&(o.appendInstruction(a,i("Create assocations and fill the score in the form below")),a.responseMappingMode=!0,r.render.call(a.getRenderer(),a),u(a),0===e.size(n.getMapEntries())?m(t,s):m(t),t.$container.on("responseChange.qti-widget",function(t,i){var r,o,s="single"===n.attr("cardinality")?"base":"list";i&&i.response&&i.response[s]&&(r=e.invoke(i.response[s].pair,Array.prototype.join," "),o=e.keys(n.getMapEntries()),e(r).difference(o).forEach(a.pairScoringForm.addPair,a.pairScoringForm),h(a))}))}function h(t){e.delay(function(){e.forEach(t._vsets,function(t){e.invoke(t,"remove")}),t._vsets=[]},500)}function p(){var t=this.widget,e=t.element;e.paper&&(t.$container.off("responseChange.qti-widget"),e.pairScoringForm&&e.pairScoringForm.destroy(),o.removeInstructions(e),r.destroy(e),e.paper=t.createPaper(),t.createChoices())}function u(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&s.createShapeText(t.paper,i,{shapeClick:!0,content:e.id()}).transform("t0,-10").toFront()})}function m(t,a){var n=t.element,r=n.getResponseDeclaration(),o=r.getMapEntries(),s=function(){return e.map(n.getChoices(),function(t){return{id:t.id(),value:t.id()}})},c={leftTitle:i("left"),rightTitle:i("right"),type:"pair",pairLeft:s,pairRight:s};a&&(c.entries=e.transform(a,function(t,e){t[e]=void 0!==o[e]?o[e]:r.mappingAttributes.defaultValue},{})),n.pairScoringForm=l(t,c)}return a.create(n,d,p)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states"],function(t,e,i,a,n,r){var o=e.extend(a.clone(),n,{initCreator:function(t){var e;this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(r),a.initCreator.call(this),e=this.createPaper(),e&&(this.element.paper=e,this.createChoices())},destroy:function(){var e=this.$original,i=e.parents(".qti-item");i.off("resize.gridEdit."+this.element.serial),t(window).off("resize.qti-widget."+this.element.serial),e.off("resize.qti-widget."+this.element.serial),a.destroy.call(this)}});return o}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.choiceForm=this.getOption("choiceOptionForm"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},a=function(){};return t.extend(e,i,a)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Interaction Background",s):l.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div class="panel">\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Mime Type",s):l.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n\n    <div class="panel">\n        <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"identifier",s):l.call(e,"__","identifier",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):l.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n        <input type="text" \n               name="identifier" \n               value="',(o=i.identifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" \n               placeholder="e.g. my-hotspot_1" \n               data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+');">\n    </div>\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Choice Image",s):l.call(e,"__","Choice Image",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div>\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div>\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Mime type",s):l.call(e,"__","Mime type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of matches",s):l.call(e,"__","Allowed number of matches",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices this choice may be associated with.",s):l.call(e,"__","The maximum number of choices this choice may be associated with.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of choices this choice must be associated with to form a valid response.",s):l.call(e,"__","The minimum number of choices this choice must be associated with to form a valid response.",s)))+'\n        </span>\n    </h3>\n\n    <div>\n        <label for="matchMin" class="spinner">Min</label>\n        <input name="matchMin" value="',(o=i.matchMin)?r=o.call(e,{hash:{},data:n}):(o=e&&e.matchMin,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n    <div>\n        <label for="matchMax" class="spinner">Max</label>\n        <input name="matchMax" value="',(o=i.matchMax)?r=o.call(e,{hash:{},data:n}):(o=e&&e.matchMax,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/helper/dummyElement","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,a,n,r,o,s,c,l,d,h,p,u,m,f){var g=function(){function n(){var e=t("ul.source",b.$original),i=t('<li class="empty add-option"><div><span class="icon-add"></span></div></li>');i.on("click",function(){var t=I.createGapImg({});t.object.removeAttr("type"),r(t)}),i.appendTo(e)}function r(e,a){var n,r=t("ul.source",b.$original),o=t(".empty",r),s=t('[data-serial="'+e.serial+'"]',r);s.length||(s=t("<li></li>").insertBefore(o),s.data("serial",e.serial).attr("data-serial",e.serial)),e.object&&e.object.attributes.data?a===!0&&(s.replaceWith(e.render()),s=t('[data-serial="'+e.serial+'"]',r)):(n=m.get({icon:"image",css:{width:58,height:58},title:i("Select an image.")}),s.addClass("placeholder qti-choice qti-gapImg").empty().append(n)),s.addClass("widget-box"),t(u()).appendTo(s).show().click(function(t){t.preventDefault(),t.stopPropagation(),s.remove(),I.removeGapImg(e)}),s.off("click").on("click",function(){if(s.hasClass("active"))s.removeClass("active"),g();else if(t(".active",r).removeClass("active"),s.addClass("active"),v(e.serial),s.hasClass("placeholder")){var i=t('[data-role="upload-trigger"]',Q);i.length&&i.trigger("click")}})}function d(i){var a,n,r=I.getChoice(i);if(r){a=I.paper.getById(i),n=a.getBBox(),Q.empty().html(h({identifier:r.id(),fixed:r.attr("fixed"),serial:i,matchMin:r.attr("matchMin"),matchMax:r.attr("matchMax"),choicesCount:e.size(I.getChoices()),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10)})),c.initWidget(Q);var o=c.getMinMaxAttributeCallbacks(Q,"matchMin","matchMax");o.identifier=l.updateChoiceIdentifier,o.fixed=c.getAttributeChangeCallback(),c.setChangeCallbacks(Q,r,o),R.show(),f.openSections(R.children("section")),f.closeSections(k.children("section")),w=t("input[name=x]",Q),q=t("input[name=y]",Q),x=t("input[name=width]",Q),_=t("input[name=height]",Q)}}function g(){"none"!==R.css("display")&&(f.openSections(k.children("section")),R.hide(),Q.empty())}function v(t){var a,n,o=I.getGapImg(t);o&&(Q.empty().html(p({identifier:o.id(),fixed:o.attr("fixed"),serial:t,matchMin:o.attr("matchMin"),matchMax:o.attr("matchMax"),choicesCount:e.size(I.getChoices()),baseUrl:C.baseUrl,data:o.object.attr("data"),width:o.object.attr("width"),height:o.object.attr("height"),type:o.object.attr("type")})),n=e.clone(C),n.title=i('Please select the picture from the resource manager. You can add new files from your computer with the button "Add file(s)".'),s(Q,n),c.initWidget(Q),a=c.getMinMaxAttributeCallbacks(Q,"matchMin","matchMax"),a.identifier=l.updateChoiceIdentifier,a.fixed=c.getAttributeChangeCallback(),a.data=function(t,e){o.object.attr("data",e),r(o,!0)},a.width=function(t,e){o.object.attr("width",e)},a.height=function(t,e){o.object.attr("height",e)},a.type=function(t,e){e&&""!==e?o.object.attr("type",e):I.object.removeAttr("type")},c.setChangeCallbacks(Q,o,a),R.show(),f.openSections(R.children("section")),f.closeSections(k.children("section")),"function"==typeof window.scroll&&window.scroll(0,Q.offset().top))}var b=this.widget,I=b.element,C=b.options,y=I.paper;if(y){var w,q,x,_,Q=b.choiceForm,k=t("#item-editor-interaction-property-bar"),R=t("#item-editor-choice-property-bar");b._editor=o(b,{shapeCreated:function(t,e){var i=I.createChoice({shape:"path"===e?"poly":e,coords:a.qtiCoords(t)});t.id=i.serial},shapeRemoved:function(t){I.removeChoice(t)},enterHandling:function(t){d(t.id)},quitHandling:function(){g()},shapeChange:function(t){var e,i=I.getChoice(t.id);i&&(i.attr("coords",a.qtiCoords(t)),w&&w.length&&(e=t.getBBox(),w.val(parseInt(e.x,10)),q.val(parseInt(e.y,10)),x.val(parseInt(e.width,10)),_.val(parseInt(e.height,10))))}}),b._editor.create(),e.forEach(I.getGapImgs(),r),n(),t(window).on("resize.changestate",function(){b.changeState("sleep")})}},v=function(){var e=this.widget,i=e.element,a=i.paper;a&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy(),t("ul.source .empty",e.$original).remove(),e.$container.find(".qti-gapImg").removeClass("active").find(".mini-tlb").remove())},b=n.extend(r,g,v);return b.prototype.initForm=function(){var t=this.widget,e=t.options,i=t.element,a=t.$form;a.html(d({baseUrl:e.baseUrl,data:i.object.attr("data"),width:i.object.attr("width"),height:i.object.attr("height"),type:i.object.attr("type")})),s(a,e),c.initWidget(a);var n={};n.data=function(e,a){i.object.attr("data",a),t.rebuild({ready:function(t){t.changeState("question")}})},n.width=function(t,e){i.object.attr("width",e)},n.height=function(t,e){i.object.attr("height",e)},n.type=function(t,e){e&&""!==e?i.object.attr("type",e):i.object.removeAttr("type")},c.setChangeCallbacks(a,i,n,{validateOnInit:!1})},b}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function a(){i.forward(this.widget)}function n(){}return t.extend(e,a,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o){function s(){var i=this.widget,a=i.element,s=a.getResponseDeclaration(),c=t.values(s.getCorrect());n.destroy(a),a.paper&&(r.appendInstruction(a,e("Please fill the gap with the correct choices below.")),i.createGapImgs(),n.render.call(a.getRenderer(),a),n.setResponse(a,o.serialize(t.invoke(c,String.prototype.split," "),a)),i.$container.on("responseChange.qti-widget",function(e,i){i.response&&i.response.list&&s.setCorrect(t.map(i.response.list.directedPair,function(t){return t.join(" ")}))}))}function c(){var e=this.widget,i=e.element;i.paper&&(e.$container.off("responseChange.qti-widget"),r.removeInstructions(i),n.destroy(i),i.paper=e.createPaper(t.bind(e.scaleGapList,e)),e.createChoices(),e.createGapImgs())}return i.create(a,s,c)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function(t,e,i,a,n,r,o,s,c,l){function d(){{var t=this.widget,a=t.element,n=a.getResponseDeclaration(),s=e.values(n.getCorrect());0===e.size(n.getMapEntries())?s:e.keys(n.getMapEntries())}r.destroy(a),a.paper&&(o.appendInstruction(a,i("Please fill the gap with the images below, then edit the score for each gap/image pair.")),a.responseMappingMode=!0,t.createGapImgs(),r.render.call(a.getRenderer(),a),u(a),0===e.size(n.getMapEntries())?m(t,s):m(t),t.$container.on("responseChange.qti-widget",function(t,i){var r,o,s="single"===n.attr("cardinality")?"base":"list";i&&i.response&&i.response[s]&&(r=e.invoke(i.response[s].directedPair,Array.prototype.join," "),o=e.keys(n.getMapEntries()),e(r).difference(o).forEach(a.pairScoringForm.addPair,a.pairScoringForm)),p(a)}))}function h(){var t=this.widget,i=t.element;i.paper&&(t.$container.off("responseChange.qti-widget"),i.pairScoringForm&&i.pairScoringForm.destroy(),o.removeInstructions(i),r.destroy(i),i.paper=t.createPaper(e.bind(t.scaleGapList,t)),t.createChoices(),t.createGapImgs())}function p(t){e.forEach(t.gapFillers,function(t){t.remove()}),t.gapFillers=[]}function u(t){e.forEach(t.getChoices(),function(e){var i=t.paper.getById(e.serial);i&&s.createShapeText(t.paper,i,{shapeClick:!0,content:e.id()})})}function m(t,a){var n=t.element,r=n.getResponseDeclaration(),o=r.getMapEntries(),s={};e.forEach(n.getGapImgs(),function(e){e.object&&e.object.attr("data")&&(s[e.id()]=t.options.baseUrl+e.object.attr("data"))});var c={leftTitle:i("Choice"),rightTitle:i("Gap"),type:"directedPair",pairLeft:function(){return e.map(n.getChoices(),function(t){return{id:t.id(),value:t.id()}})},pairRight:function(){return e.map(n.getGapImgs(),function(t){return{id:t.id(),value:t.id()}})},formatRight:function(t){var e=t;return s[t]&&(e+="<br><img height='24px' src='"+s[t]+"' />"),e}};a&&(c.entries=e.transform(a,function(t,e){t[e]=void 0!==o[e]?o[e]:r.mappingAttributes.defaultValue},{})),n.pairScoringForm=l(t,c)}return a.create(n,d,h)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg"],function(t,e,i,a,n,r){var o=e.extend(a.clone(),n,{initCreator:function(t){var i;this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(r),a.initCreator.call(this),i=this.createPaper(e.bind(this.scaleGapList,this)),i&&(this.element.paper=i,this.createChoices(),this.createGapImgs())},destroy:function(){var e=this.$original,i=e.parents(".qti-item");i.off("resize.gridEdit."+this.element.serial),t(window).off("resize.qti-widget."+this.element.serial),e.off("resize.qti-widget."+this.element.serial),a.destroy.call(this)},scaleGapList:function(e,i){var a=this.$original,n=t("ul.source",a);n.css("max-width",e+"px"),i&&1!==i&&n.find("img").each(function(){var e=t(this);e.width(e.attr("width")*i),e.height(e.attr("height")*i)})},createGapImgs:function(){var i=this.element,a=this.$original,n=t("ul.source",a);n.empty(),e.forEach(i.gapImgs,function(t){n.append(t.render())})}});return o}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.choiceForm=this.getOption("choiceOptionForm"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},a=function(){};return t.extend(e,i,a)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Interaction Background",s):l.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div class="panel">\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Mime Type",s):l.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of choices",s):l.call(e,"__","Allowed number of choices",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",s):l.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices that the candidate is allowed to select.",s):l.call(e,"__","The maximum number of choices that the candidate is allowed to select.",s)))+'\n        </span>\n    </h3>\n\n    <div class="panel">\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n</div>\n'
})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='\n<div class="panel">\n    <label for="">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"identifier",s):l.call(e,"__","identifier",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s):l.call(e,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',s)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',(o=i.identifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.identifier,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" \n           placeholder="e.g. my-hotspot_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+');">\n</div>\n\n<h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Shape position",s):l.call(e,"__","Shape position",s)))+'</h3>\n\n<div class="panel">\n    <label for="x">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Left",s):l.call(e,"__","Left",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="x" value="',(o=i.x)?r=o.call(e,{hash:{},data:n}):(o=e&&e.x,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="y">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Top",s):l.call(e,"__","Top",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="y" value="',(o=i.y)?r=o.call(e,{hash:{},data:n}):(o=e&&e.y,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",s):l.call(e,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",s)))+'</div>\n    <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,a,n,r,o,s,c,l,d,h,p){var u=function(){function e(e){var i,a,n=o.getChoice(e);n&&(i=o.paper.getById(e),a=i.getBBox(),g.empty().html(h({identifier:n.id(),fixed:n.attr("fixed"),serial:e,x:parseInt(a.x,10),y:parseInt(a.y,10),width:parseInt(a.width,10),height:parseInt(a.height,10)})),s.initWidget(g),s.setChangeCallbacks(g,n,{identifier:l.updateChoiceIdentifier,fixed:s.getAttributeChangeCallback()}),b.show(),p.openSections(b.children("section")),p.closeSections(v.children("section")),d=t("input[name=x]",g),u=t("input[name=y]",g),m=t("input[name=width]",g),f=t("input[name=height]",g))}function a(){"none"!==b.css("display")&&(p.openSections(v.children("section")),b.hide(),g.empty())}var n=this.widget,o=n.element,c=o.paper;if(c){var d,u,m,f,g=n.choiceForm,v=t("#item-editor-interaction-property-bar"),b=t("#item-editor-choice-property-bar");n._editor=r(n,{shapeCreated:function(t,e){var a=o.createChoice({shape:"path"===e?"poly":e,coords:i.qtiCoords(t)});t.id=a.serial},shapeRemoved:function(t){o.removeChoice(t)},enterHandling:function(t){e(t.id)},quitHandling:function(){a()},shapeChange:function(t){var e,a=o.getChoice(t.id);a&&(a.attr("coords",i.qtiCoords(t)),d&&d.length&&(e=t.getBBox(),d.val(parseInt(e.x,10)),u.val(parseInt(e.y,10)),m.val(parseInt(e.width,10)),f.val(parseInt(e.height,10))))}}),n._editor.create(),t(window).on("resize.changestate",function(){n.changeState("sleep")}),n.on("attributeChange",function(t){"maxChoices"===t.key&&n.renderOrderList()})}},m=function(){var e=this.widget,i=e.element,a=i.paper;a&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy())},f=a.extend(n,u,m);return f.prototype.initForm=function(){var t=this.widget,i=t.options,a=t.element,n=t.$form;n.html(d({baseUrl:i.baseUrl,maxChoices:parseInt(a.attr("maxChoices")),minChoices:parseInt(a.attr("minChoices")),choicesCount:e.size(a.getChoices()),data:a.object.attr("data"),width:a.object.attr("width"),height:a.object.attr("height"),type:a.object.attr("type")})),o(n,i),s.initWidget(n);var r=s.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");r.data=function(e,i){a.object.attr("data",i),t.rebuild({ready:function(t){t.changeState("question")}})},r.width=function(t,e){a.object.attr("width",e)},r.height=function(t,e){a.object.attr("height",e)},r.type=function(t,e){e&&""!==e?a.object.attr("type",e):a.object.removeAttr("type")},s.setChangeCallbacks(n,a,r,{validateOnInit:!1}),c.syncMaxChoices(t)},f}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function a(){i.forward(this.widget)}function n(){}return t.extend(e,a,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o){function s(){var i=this.widget,a=i.element,s=a.getResponseDeclaration();n.destroy(a),a.paper&&(r.appendInstruction(a,e("Please order the choices below to set the correct answer")),n.render.call(a.getRenderer(),a),n.setResponse(a,o.serialize(t.values(s.getCorrect()),a)),i.$container.on("responseChange.qti-widget",function(t,e){s.setCorrect(o.unserialize(e.response,a))}))}function c(){var e=this.widget,i=e.element;i.paper&&(e.$container.off("responseChange.qti-widget"),r.removeInstructions(i),n.destroy(i),i.paper=e.createPaper(t.bind(e.scaleOrderList,e)),e.createChoices(),e.renderOrderList())}return i.create(a,s,c)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states"],function(t,e,i,a,n,r){var o=e.extend(a.clone(),n,{initCreator:function(t){var i;this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(r),a.initCreator.call(this),i=this.createPaper(e.bind(this.scaleOrderList,this)),i&&(this.element.paper=i,this.createChoices(),this.renderOrderList())},destroy:function(){var e=this.$original,i=e.parents(".qti-item");i.off("resize.gridEdit."+this.element.serial),t(window).off("resize.qti-widget."+this.element.serial),e.off("resize.qti-widget."+this.element.serial),a.destroy.call(this)},scaleOrderList:function(e){t("ul.block-listing",this.$original).css("max-width",e+"px")},renderOrderList:function(){var i=this.element,a=e.size(i.getChoices()),n=i.attr("minChoices"),r=i.attr("maxChoices"),o=t("ul.block-listing",this.$original);r>0&&a>r?a=r:n>0&&a>n&&(a=n),o.empty(),e.times(a,function(e){var i=e+1,a=t('<li class="selectable" data-number="'+i+'">'+i+"</li>");0===e&&a.addClass("active"),o.append(a)})}});return o}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.choiceForm=this.getOption("choiceOptionForm"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(i){"responsive"===i.key&&(i.value===!0?e.addClass("responsive"):e.removeClass("responsive"),t.rebuild())})},a=function(){};return t.extend(e,i,a)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Interaction Background",s):l.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div class="panel">\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Mime Type",s):l.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" readonly />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of choices",s):l.call(e,"__","Allowed number of choices",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",s):l.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices that the candidate is allowed to select.",s):l.call(e,"__","The maximum number of choices that the candidate is allowed to select.",s)))+'\n        </span>\n    </h3>\n\n    <div class="panel">\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/editor/editor"],function(t,e,i,a,n,r,o,s,c,l,d,h,p){var u=function(){function e(e){var i,a,n=o.getChoice(e);n&&(i=o.paper.getById(e),a=i.getBBox(),g.empty().html(h({identifier:n.id(),fixed:n.attr("fixed"),serial:e,x:parseInt(a.x,10),y:parseInt(a.y,10),width:parseInt(a.width,10),height:parseInt(a.height,10)})),s.initWidget(g),s.setChangeCallbacks(g,n,{identifier:l.updateChoiceIdentifier,fixed:s.getAttributeChangeCallback()}),b.show(),p.openSections(b.children("section")),p.closeSections(v.children("section")),d=t("input[name=x]",g),u=t("input[name=y]",g),m=t("input[name=width]",g),f=t("input[name=height]",g))}function a(){"none"!==b.css("display")&&(p.openSections(v.children("section")),b.hide(),g.empty())}var n=this.widget,o=n.element,c=o.paper;if(c){var d,u,m,f,g=n.choiceForm,v=t("#item-editor-interaction-property-bar"),b=t("#item-editor-choice-property-bar");n._editor=r(n,{shapeCreated:function(t,e){var a=o.createChoice({shape:"path"===e?"poly":e,coords:i.qtiCoords(t)});t.id=a.serial},shapeRemoved:function(t){o.removeChoice(t)},enterHandling:function(t){e(t.id)},quitHandling:function(){a()},shapeChange:function(t){var e,a=o.getChoice(t.id);a&&(a.attr("coords",i.qtiCoords(t)),d&&d.length&&(e=t.getBBox(),d.val(parseInt(e.x,10)),u.val(parseInt(e.y,10)),m.val(parseInt(e.width,10)),f.val(parseInt(e.height,10))))}}),n._editor.create(),t(window).on("resize.changestate",function(){n.changeState("sleep")})}},m=function(){var e=this.widget,i=e.element,a=i.paper;a&&(t(window).off("resize.changestate"),e._editor&&e._editor.destroy())},f=a.extend(n,u,m);return f.prototype.initForm=function(){var t=this.widget,i=t.options,a=t.element,n=t.$form;n.html(d({baseUrl:i.baseUrl,maxChoices:parseInt(a.attr("maxChoices")),minChoices:parseInt(a.attr("minChoices")),choicesCount:e.size(a.getChoices()),data:a.object.attr("data"),width:a.object.attr("width"),height:a.object.attr("height"),type:a.object.attr("type")})),o(n,i),s.initWidget(n);var r=s.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");r.data=function(i,n){a.object.attr("data",n),t.rebuild({ready:function(t){e.defer(function(){t.changeState("question")})}})},r.width=function(t,e){a.object.attr("width",e)},r.height=function(t,e){a.object.attr("height",e)},r.type=function(t,e){e&&""!==e?a.object.attr("type",e):a.object.removeAttr("type")},s.setChangeCallbacks(n,a,r,{validateOnInit:!1}),c.syncMaxChoices(t)},f}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){function a(){i.forward(this.widget)}function n(){}return t.extend(e,a,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o){function s(){var i=this.widget,a=i.element,s=a.getResponseDeclaration();n.destroy(a),a.paper&&(r.appendInstruction(a,e("Please select the correct hotspot choices below.")),n.render.call(a.getRenderer(),a),n.setResponse(a,o.serialize(t.values(s.getCorrect()),a)),i.$container.on("responseChange.qti-widget",function(t,e){s.setCorrect(o.unserialize(e.response,a))}))}function c(){var t=this.widget,e=t.element;e.paper&&(t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),n.destroy(e),e.paper=t.createPaper(),t.createChoices())}return i.create(a,s,c)}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup",["jquery","lodash"],function(t){return function(e,i,a,n){var r,o=10,s=t(i.node),c=t('<div class="mapping-editor arrow-left-top"></div>'),l=a.offset(),d=s.offset(),h=i.getBBox(),p=h.width;return n&&(r=e.w/e.width,p=Math.round(p*(2-r))),c.css({top:d.top-l.top-o,left:d.left-l.left+p+o}).appendTo(a),c}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,s="";return s+='\n        <div class="panel" data-edit="correct">\n            <label>\n                '+p((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Correct",r):h.call(t,"__","Correct",r)))+'\n                <input name="correct" type="checkbox" ',a=i["if"].call(t,t&&t.correct,{hash:{},inverse:u.noop,fn:u.program(2,o,e),data:e}),(a||0===a)&&(s+=a),s+=' />\n                <span class="icon-checkbox"></span>\n            </label>\n            <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">'+p((n=i.__||t&&t.__,r={hash:{},data:e},n?n.call(t,"Is this choice the correct response?",r):h.call(t,"__","Is this choice the correct response?",r)))+"</span>\n        </div>\n"}function o(){return' checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h=i.helperMissing,p=this.escapeExpression,u=this,m="function";return d+='    <a class="closer" href="#" data-close=":parent .mapping-editor"></a>\n    <div class="form-container">\n        <h2>',(c=i.identifier)?s=c.call(e,{hash:{},data:n}):(c=e&&e.identifier,s=typeof c===m?c.call(e,{hash:{},data:n}):c),d+=p(s)+"</h2>\n\n",s=i.unless.call(e,e&&e.noCorrect,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+='\n        <div class="panel">\n            <label for="score">'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Score",l):h.call(e,"__","Score",l)))+'</label>\n            <input value="',(c=i.score)?s=c.call(e,{hash:{},data:n}):(c=e&&e.score,s=typeof c===m?c.call(e,{hash:{},data:n}):c),d+=p(s)+'" type="text" data-for="',(c=i.identifier)?s=c.call(e,{hash:{},data:n}):(c=e&&e.identifier,s=typeof c===m?c.call(e,{hash:{},data:n}):c),d+=p(s)+'" name="score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n            <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"Set the score for this response",l):h.call(e,"__","Set the score for this response",l)))+'</span>\n        </div>\n        <span class="arrow"></span>\n        <span class="arrow-cover"></span>\n    </div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/deleter","ui/tooltipster"],function(t,e,i,a,n,r,o,s,c,l,d,h,p,u,m){function f(){var t=this.widget,a=t.element,n=a.getResponseDeclaration();r.destroy(a),a.paper&&(o.appendInstruction(a,i("Please the score of each hotspot choice.")),a.responseMappingMode=!0,a.paper=t.createPaper(),t.createChoices(),v(t),r.setResponse(a,c.serialize(e.values(n.getCorrect()),a)))}function g(){var t=this.widget,e=t.element;e.paper&&(o.removeInstructions(e),r.destroy(e),e.paper=t.createPaper(),t.createChoices())}function v(i){var a={},n=i.element,r=i.$original,o=r.hasClass("responsive"),c=t(".main-image-box",r),f=n.getResponseDeclaration(),g=f.getMapEntries(),v=e.values(f.getCorrect());e.forEach(n.getChoices(),function(u){var m=n.paper.getById(u.serial),b=d(n.paper,m,c,o),I=g[u.id()]||f.mappingAttributes.defaultValue||"0";a[u.serial]=s.createShapeText(n.paper,m,{id:"score-"+u.serial,content:I,style:"score-text-default",shapeClick:!0}).data("default",!0);var C=t(h({identifier:u.id(),correctDefined:l.isCorrectDefined(i),correct:e.contains(f.getCorrect(),u.id()),score:I,scoreMin:f.getMappingAttribute("lowerBound"),scoreMax:f.getMappingAttribute("upperBound")}));p.setChangeCallbacks(C,f,{score:function(t,e){var i=a[u.serial];""===e?(t.removeMapEntry(u.id()),i.attr({text:t.mappingAttributes.defaultValue}).data("default",!0)):(t.setMapEntry(u.id(),e,!0),i.attr({text:e}).data("default",!1))},correct:function(t,i){i===!0?e.contains(v,u.id())||(v.push(u.id()),m.active=!0,s.updateElementState(m,"active")):(v=e.without(v,u.id()),m.active=!1,s.updateElementState(m,"basic")),t.setCorrect(v)}}),m.click(function(){t(".mapping-editor",r).hide(),b.show()}),b.append(C)}),u(r),m(r),n.paper.getById("bg-image-"+n.serial).click(function(){t(".mapping-editor",r).hide()}),t(".mapping-editor",r).on("click",".closer",function(){t(this).parent(".mapping-editor").hide()}),i.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&e.forEach(a,function(e){e.data("default")===!0&&e.attr({text:t.value})})})}return a.create(n,f,g)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states"],function(t,e,i,a,n,r){var o=e.extend(a.clone(),n,{initCreator:function(t){var e;this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(r),a.initCreator.call(this),e=this.createPaper(),e&&(this.element.paper=e,this.createChoices())},destroy:function(){var e=this.$original,i=e.parents(".qti-item");i.off("resize.gridEdit."+this.element.serial),t(window).off("resize.qti-widget."+this.element.serial),e.off("resize.qti-widget."+this.element.serial),a.destroy.call(this)}});return o}),define("taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.choiceForm=this.getOption("choiceOptionForm"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hottext",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of choices",s):l.call(e,"__","Allowed number of choices",s)))+'</h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",s):l.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",s)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.choicesCount)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choicesCount,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices that the candidate is allowed to select to form a valid response.",s):l.call(e,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",s)))+"\n        </span>\n    </div>\n</div>\n"})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext-create",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<span class="mini-tlb" data-edit="',(o=i.state)?r=o.call(e,{hash:{},data:n}):(o=e&&e.state,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-for="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-role="create-hottext-tlb">\n    <span class="rgt tlb-button" title="'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Create hottext",s):h.call(e,"__","Create hottext",s)))+'" data-role="create-hottext">\n        <span class="icon-magicwand"></span>\n    </span>\n</span>'
})}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Question",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hottext","tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext-create"],function(t,e,i,a,n,r,o){var s=e.extend(i);return s.prototype.initForm=function(){var e=this.widget,i=e.$form,o=e.element;i.html(r({maxChoices:o.attr("maxChoices"),minChoices:o.attr("minChoices"),choicesCount:t.size(o.getChoices())})),a.initWidget(i);var s=a.getMinMaxAttributeCallbacks(i,"minChoices","maxChoices",!0);a.setChangeCallbacks(i,o,s),n.syncMaxChoices(e)},s.prototype.getGapModel=function(){return{toolbarTpl:o,qtiClass:"hottext",afterCreate:function(t,e,i){e.element.body(i),e.$container.find(".hottext-content").html(i),e.changeState("choice")}}},s}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){this.widget.$original.find(".hottext-checkmark > input").removeProp("disabled"),i.forward(this.widget)},function(){this.widget.$original.find(".hottext-checkmark > input").prop("disabled","disabled")});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o){function s(){var i=this.widget,a=i.element,s=a.getResponseDeclaration();n.destroy(a),r.appendInstruction(a,e("Please select the correct hottext choices below.")),n.render.call(a.getRenderer(),a),n.setResponse(a,o.serialize(t.values(s.getCorrect()),a)),i.$container.on("responseChange.qti-widget",function(t,e){s.setCorrect(o.unserialize(e.response,a))})}function c(){var t=this.widget,e=t.element;t.$container.off("responseChange.qti-widget"),r.removeInstructions(e),n.destroy(e)}return i.create(a,s,c)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(t,e,i,a,n,r,o,s,c,l){function d(){var t=this.widget,a=t.element,n=a.getResponseDeclaration(),c=e.values(n.getCorrect());r.destroy(a),s.appendInstruction(a,i("Please enter the score for the given hottexts.")),a.responseMappingMode=!0,u(a,t.$container),r.render.call(a.getRenderer(),a),r.setResponse(a,l.serialize(c,a)),t.$container.on("responseChange.qti-widget",function(t,e){var i="single"===n.attr("cardinality")?"base":"list";e&&e.response&&e.response[i]&&n.setCorrect(e.response[i].identifier)}),t.on("metaChange",function(e){"defineCorrect"===e.key&&(p(t.$container,e.value),e.value===!1&&n.setCorrect([]))}),p(t.$container,o.defineCorrect(n))}function h(){var e=this.widget,i=e.element,a=e.$container;a.off("responseChange.qti-widget"),t(".score",a).remove(),p(a,!0),s.removeInstructions(i),r.destroy(i)}function p(e,i){i?t(".hottext-checkmark > input",e).removeProp("disabled").removeClass("disabled"):t(".hottext-checkmark > input",e).prop("disabled",!0).prop("checked",!1).addClass("disabled")}function u(a,n){var r={},s=a.getResponseDeclaration(),l=s.getMapEntries();t(".hottext",n).on("click",function(e){(t(e.target).hasClass("score")||o.defineCorrect(s)===!1)&&(e.preventDefault(),e.stopImmediatePropagation())}),e.forEach(a.getChoices(),function(e){var a,o=e.serial+"-score",c=t('[data-serial="'+e.serial+'"]',n);c.length&&(a=t("<input type='text' name='"+o+"' class='score' title='"+i("Score value")+"' data-validate='$numeric' data-validate-option='$allowEmpty; $event(type=keyup)' />"),a.val(void 0!==l[e.id()]?l[e.id()]:s.mappingAttributes.defaultValue),c.append(a),r[o]=function(t,i){""===i?t.removeMapEntry(e.id()):t.setMapEntry(e.id(),i,!0)})}),c.setChangeCallbacks(n,s,r)}return a.create(n,d,h)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/HottextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget"],function(t){var e=t.clone();return e.destroy=function(){this.$original.off(".qti-widget"),this.$container.remove(),this.offEvents()},e}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement","lodash"],function(t,e,i,a,n){var r=e.extend(i,function(){this.buildEditor()},function(){this.destroyEditor()});return r.prototype.createToolbar=function(){var t=this.widget,e=t.$container.find("td:last");return a.initShufflePinToggle(t),a.initDelete(t),e},r.prototype.buildEditor=function(){var e=this.widget,i=e.$container.children("td:first");i.attr("contentEditable",!0),i.on("keyup.qti-widget",n.throttle(function(){e.element.val(t(this).text()),e.$original.width(t(this).width())},200)).on("focus.qti-widget",function(){e.changeState("choice")}).on("keypress.qti-widget",function(i){13===i.which&&(i.preventDefault(),t(this).blur(),e.changeState("question"))})},r.prototype.destroyEditor=function(){var t=this.widget.$container;t.find("td").removeAttr("contentEditable"),t.children("td:first").off("keyup.qti-widget")},r}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier"],function(t,e,i,a,n){var r=t.extend(e);return r.prototype.initForm=function(){var t=this.widget;t.$form.html(i({serial:t.element.getSerial(),identifier:t.element.id()})),a.setChangeCallbacks(t.$form,t.element,{identifier:n.updateChoiceIdentifier})},r}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){t.initCreator.call(this),this.registerStates(e)},i}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=t.create(e,function(){var t=this.widget,e=this.widget.$original;e.on("click.qti-widget.sleep",function(e){e.stopPropagation(),t.changeState("question")}),e.on("mouseenter.sleep",function(){e.addClass("hover"),e.parent().trigger("mouseleave.sleep")}).on("mouseleave.sleep",function(){e.removeClass("hover"),e.parent().trigger("mouseenter.sleep")})},function(){this.widget.$original.removeClass("hover").off(".sleep")});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Active"],function(t,e,i,a){var n=i.extend(a,function(){var i=this;t(window).on("resize.active",e.throttle(function(){i.positionWidget()},200)),this.positionWidget()},function(){t(window).off(".active"),this.widget.$container.hide()});return n.prototype.positionWidget=function(){var t=this.widget,e=t.$itemContainer.offset(),i=t.$original.offset();t.$container.show().css({position:"absolute",top:i.top-e.top-22,left:i.left-e.left-32})},n}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=this,h=i.helperMissing,p=this.escapeExpression;return l+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',o=i["if"].call(e,e&&e.shuffle,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Shuffle choices",c):h.call(e,"__","Shuffle choices",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",c):h.call(e,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be “shuffled” of “fixed” individually.",c)))+'\n    </span>\n</div>\n<div class="panel">\n    <label>\n        <input name="required" type="checkbox" ',o=i["if"].call(e,e&&e.required,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"required",c):h.call(e,"__","required",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+p((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",c):h.call(e,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",c)))+"\n    </span>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice"],function(t,e,i,a,n){var r=e.extend(i,function(){var e=this.widget.$container.find(".main-option"),i=this.widget.$original;t(document).on("choiceTextChange.qti-widget.question",function(){i.width(e.width())})},function(){t(document).off(".qti-widget.question")});return r.prototype.addNewChoiceButton=function(){var e=this.widget,i=e.$container.find(".add-option"),a=e.element;i.data("initialized")||(i.on("click.qti-widget",function(i){i.stopPropagation();var n=a.createChoice();t(this).closest("tr").before(e.renderChoice(n)),e.buildChoice(n,{ready:function(t){t.changeState("question")}})}),i.data("initialized",!0))},r.prototype.initForm=function(){var t=this.widget,e=t.$form,i=t.element;e.html(n({shuffle:!!i.attr("shuffle"),required:!!i.attr("required")})),a.initWidget(e),a.setChangeCallbacks(e,i,{shuffle:a.getAttributeChangeCallback(),required:a.getAttributeChangeCallback()})},r}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){i.forward(this.widget)},function(){});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,a){var n={create:function(e,i){var n=this,r=e.element,o=$("<select>"),s=e.$container.find(".widget-response").append(o);this.commonRenderer=new t({shuffleChoices:!1}),this.commonRenderer.load(function(){r.render({},o,"",this),r.postRender({allowEmpty:!1,placeholderText:a("select correct choice")},"",this),i.call(n,this),s.siblings(".padding").width(s.width()+50)},["inlineChoice","inlineChoiceInteraction"])},setResponse:function(t,e){this.commonRenderer.setResponse(t.element,this.formatResponse(e))},destroy:function(t){t.$container.find(".widget-response").empty(),t.$container.find(".padding").removeAttr("style")},formatResponse:function(t){return i.isString(t)||(t=i.values(t),t&&t.length&&(t=t[0])),{base:{identifier:t}}},unformatResponse:function(t){var e=[];return t.base&&t.base.identifier&&e.push(t.base.identifier),e}};return n}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget","lodash"],function(t,e,i,a){var n=t.create(e,function(){var t=this.widget,e=this.widget.element.getResponseDeclaration();t.$container.find("table").hide(),i.create(t,function(){i.setResponse(t,a.values(e.getCorrect())),t.$container.on("responseChange.qti-widget",function(t,a){e.setCorrect(i.unformatResponse(a.response))})})},function(){var t=this.widget.$container;t.find("table").show(),t.off("responseChange.qti-widget"),i.destroy(this.widget)});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/helper/interactionHelper","lodash"],function(t,e,i,a,n,r){var o=e.create(i,function(){var e=this.widget,i=e.$container,o=e.element,s=o.getResponseDeclaration();i.find("[data-edit=map]").show();var c=r.values(s.getCorrect());if(c.length){var l=o.getChoiceByIdentifier(c.pop());l&&i.find('input[name=correct][value="'+l.serial+'"]').prop("checked",!0)}a.setChangeCallbacks(i,s,{correct:function(t,e){t.setCorrect(n.serialToIdentifier(o,e))},score:function(e,i){var a=parseFloat(i);isNaN(a)||e.setMapEntry(n.serialToIdentifier(o,t(this).data("for")),a)}})},function(){});return o}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e;return e=typeof t===d?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d="function",h=this.escapeExpression,p=i.helperMissing,u=this,m=i.blockHelperMissing;return l+='<div class="widget-box widget-inline widget-inlineChoiceInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===d?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" data-edit="active">\n    <div class="qti-interaction qti-inlineChoiceInteraction">\n        <table>\n            <colgroup>\n                <col class="text">\n                <col class="icon">\n                <col class="icon">\n            </colgroup>\n            <tbody>\n                <tr>\n                    <td class="main-option"><div>-- '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"edit choices",c):p.call(e,"__","edit choices",c)))+' --<span class="icon-down"></span></div></td>\n                    <td class="icon-title" data-edit="map">correct</td>\n                    <td class="icon-title" data-edit="map">score</td>\n                </tr>\n                ',c={hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n},(s=i.choices)?o=s.call(e,c):(s=e&&e.choices,o=typeof s===d?s.call(e,c):s),i.choices||(o=m.call(e,o,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n})),(o||0===o)&&(l+=o),l+='\n                <tr data-edit="question">\n                    <td>\n                        <div class="add-option">\n                            <span class="icon-add"></span>\n                            '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Add choice",c):p.call(e,"__","Add choice",c)))+'\n                        </div>\n                    </td>\n                    <td colspan="2"></td>\n                </tr>\n            </tbody>\n        </table>\n        <div>\n            <div class="widget-response" data-edit="correct"></div>\n            <div class="padding"></div>\n        </div>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return"pin"}function o(){return"shuffle"}function s(){var t="";return t}function c(){return"display:none;"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,d,h="",p="function",u=this.escapeExpression,m=this;return h+='<tr class="widget-box widget-inlineChoice qti-choice" data-edit="active" data-serial="',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'">\n    <td class="option"><div contenteditable="true">',(d=i.body)?l=d.call(e,{hash:{},data:n}):(d=e&&e.body,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'</div></td>\n    <td class="mini-tlb">\n        <span data-edit="question" class="tlb-button">\n            <span  class="icon-',l=i["if"].call(e,(l=e&&e.attributes,null==l||l===!1?l:l.fixed),{hash:{},inverse:m.program(3,o,n),fn:m.program(1,r,n),data:n}),(l||0===l)&&(h+=l),h+='" data-role="shuffle-pin" style="',l=i["if"].call(e,e&&e.interactionShuffle,{hash:{},inverse:m.program(7,c,n),fn:m.program(5,s,n),data:n}),(l||0===l)&&(h+=l),h+='"></span>\n        </span>\n        <label data-edit="map">\n            <input name="correct" type="radio" value="',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'">\n            <span class="icon-radio"></span>\n        </label>\n    </td>\n    <td class="mini-tlb">\n        <span data-edit="question" class="icon-bin" data-role="delete"></span>\n        <input class="score" name="score" data-edit="map" value="',(d=i.score)?l=d.call(e,{hash:{},data:n}):(d=e&&e.score,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'" data-for="',(d=i.serial)?l=d.call(e,{hash:{},data:n}):(d=e&&e.serial,l=typeof d===p?d.call(e,{hash:{},data:n}):d),h+=u(l)+'" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)"/>\n    </td>\n</tr>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice"],function(t,e,i,a,n,r,o){var s=i.clone();return s.initCreator=function(e){var a=this;this.registerStates(n),i.initCreator.call(this),this.$choiceOptionForm=e.choiceOptionForm,t.each(this.element.getChoices(),function(t){a.buildChoice(t)}),this.$container.find(".tlb-title").remove()},s.renderChoice=function(t,e){var i={tag:t.qtiClass,serial:t.serial,attributes:t.attributes,body:t.text,interactionShuffle:e};return o(i)},s.renderInteraction=function(){var i=this,a=this.element,n=a.attr("shuffle"),o={tag:a.qtiClass,serial:a.serial,attributes:a.attributes,choices:[]};return t.each(a.getChoices(),function(t){e.isA(t,"choice")&&o.choices.push(i.renderChoice(t,n))}),r(o)},s.buildChoice=function(t,e){a.build(t,this.$container.find('.widget-inlineChoice[data-serial="'+t.serial+'"]'),this.$choiceOptionForm,e)},s.buildContainer=function(){var t,e;this.$original.length&&(t=this.$original[0].previousSibling,e=this.$original[0].nextSibling,(!t||3===t.nodeType&&""===t.nodeValue||3!==t.nodeType)&&this.$original.before("&nbsp;"),(!e||3===e.nodeType&&""===e.nodeValue||3!==e.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-inlineChoiceInteraction[data-serial="+this.element.getSerial()+"]")},s}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<span class="widget-box inlineChoiceInteraction-placeholder" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-qti-class="inlineChoiceInteraction">\n    <label>-- '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"edit choices",s):h.call(e,"__","edit choices",s)))+' --</label>\n    <span class="icon-down"></span>\n</span>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder"],function(t,e,i,a){var n=t.clone(e);return n.template=a,n.render=function(t,e){return e=e||{},e.choiceOptionForm=this.getOption("choiceOptionForm"),i.build(t,$('.inlineChoiceInteraction-placeholder[data-serial="'+t.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),e)},n}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder",["handlebars"],function(t){return t.template(function(t,e,i,a,n){return this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{},'<div class="clearfix add-options" data-edit="question">\n    <div class="rgt">\n        <span class="add-option" data-role="add-row"><span class="icon-add"></span>Add new row</span>\n        <span class="add-option" data-role="add-col"><span class="icon-add"></span>Add new column</span>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'\n    <td>\n        <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n        </label>\n    </td>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d="function",h=this,p=i.helperMissing;return l+="<tr>\n    ",(s=i.choice)?o=s.call(e,{hash:{},data:n}):(s=e&&e.choice,o=typeof s===d?s.call(e,{hash:{},data:n}):s),(o||0===o)&&(l+=o),l+="\n    ",s=i["for"]||e&&e["for"],c={hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n},o=s?s.call(e,0,e&&e.otherMatchSetCount,1,c):p.call(e,"for",0,e&&e.otherMatchSetCount,1,c),(o||0===o)&&(l+=o),l+="\n</tr>"})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell",["handlebars"],function(t){return t.template(function(t,e,i,a,n){return this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{},'<td>\n    <label>\n        <input type="checkbox" >\n        <span class="icon-checkbox cross"></span>\n    </label>\n</td>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell","taoQtiItem/qtiCreator/helper/adaptSize"],function(t,e,i,a,n,r,o,s,c){var l=i.extend(a);return l.prototype.initForm=n.prototype.initForm,l.prototype.addNewChoiceButton=function(){var i=this.widget,a=i.element,n=i.$container.find(".match-interaction-area"),l="simpleAssociableChoice.matchInteraction",d=function(t){t.postRender({ready:function(t){t.changeState("question")}},l)};n.find(".add-option").length||(n.append(r()),n.find(".add-options").show(),n.find(".add-option[data-role=add-col]").on("click",function(){var t=a.createChoice(0);n.find("thead > tr").append(t.render(l)),n.find("tbody > tr").append(s({})),d(t)}),n.find(".add-option[data-role=add-row]").on("click",function(){var t=a.createChoice(1);n.find("tbody").append(o({choice:t.render(l),otherMatchSetCount:e.size(a.choices[0])})),d(t)})),t(".qti-item").on("toolbarchange",function(){n.find("tbody .mini-tlb").each(function(){var e=t(this);"false"!==e.parent().attr("contenteditable")&&e.css({left:-1*(e.width()+10),top:-1})})}),n.find("tr ").each(function(){var e=t(this).find('[data-html-editable="true"]');i.on("containerBodyChange",function(){c.height(e)})})},l}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){i.forward(this.widget)},function(){});return a}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<input value="',(o=i.score)?r=o.call(e,{hash:{},data:n}):(o=e&&e.score,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" \n       title="Score of this answer" \n       type="text" \n       data-for="',(o=i.choiceIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.choiceIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" \n       name="score" \n       class="score" \n       placeholder = "',(o=i.placeholder)?r=o.call(e,{hash:{},data:n}):(o=e&&e.placeholder,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'"\n       data-validate="$numeric" \n       data-validate-option="$allowEmpty; $event(type=keyup)" />'})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget",["taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score","lodash","i18n","polyfill/placeholders"],function(t,e,i,a,n,r){var o={create:function(i,a){var n=i.element;t.destroy(n),a?(e.appendInstruction(i.element,r("Please define the correct response and the score below.")),n.data("responseMappingMode",!0),o.createScoreWidgets(i),o.createCorrectWidgets(i)):(e.appendInstruction(i.element,r("Please define the correct response below.")),o.createCorrectWidgets(i)),t.render(n),i.$container.find("table.matrix input[type=checkbox]").removeProp("disabled").attr("data-edit","correct").attr("data-role","correct")},setResponse:function(e,i){t.setResponse(e,o.formatResponse(i))},destroy:function(e){var i=e.element;t.destroy(i),i.removeData("responseMappingMode"),e.$container.find("table.matrix input[type=checkbox]").prop("disabled","disabled"),e.$container.find("table.matrix .score").remove(),e.$container.off("responseChange.qti-widget")},createScoreWidgets:function(e){var n=e.$container,r=e.element,o=r.getResponseDeclaration(),s=o.getMapEntries(),c=o.getMappingAttribute("defaultValue");n.find("table.matrix td>label").each(function(){var e=t.inferValue(this).join(" ");$(this).append(a({serial:r.getSerial(),choiceIdentifier:e,score:s[e]?s[e]:"",placeholder:c}))});var l=n.find("table.matrix .score");l.on("click",function(t){t.stopPropagation(),t.preventDefault()}),e.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&l.attr("placeholder",t.value)}),i.setChangeCallbacks(n,o,{score:function(t,e){var i=$(this).data("for");""===e?t.removeMapEntry(i):t.setMapEntry(i,e,!0)}})},createCorrectWidgets:function(t){var e=t.element,i=e.getResponseDeclaration();t.$container.on("responseChange.qti-widget",function(t,e){i.setCorrect(o.unformatResponse(e.response))})},formatResponse:function(t){var e={list:{directedPair:[]}};if(1===n.size(t)){var i=n.values(t).pop().split(" ");e={base:{directedPair:i}}}else e={list:{directedPair:[]}},n.each(t,function(t){var i=t.split(" ");e.list.directedPair.push(i)});return e},unformatResponse:function(t){var e=[];return t.list&&t.list.directedPair?n.each(t.list.directedPair,function(t){e.push(t.join(" "))}):t.base&&t.base.directedPair&&e.push(t.base.directedPair.join(" ")),e}};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function(t,e,i,a){var n=t.create(e,function(){var t=this.widget,e=t.element,n=e.getResponseDeclaration();
i.create(t),i.setResponse(e,a.values(n.getCorrect()))},function(){i.destroy(this.widget)});return n}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function(t,e,i,a,n){var r=e.create(i,function(){var e=this.widget,i=e.element,r=i.getResponseDeclaration();a.create(e,!0),a.setResponse(i,n.values(r.getCorrect())),e.on("metaChange",function(i){"defineCorrect"===i.key&&(i.value?t('.match-interaction-area input[type="checkbox"]',e.$container).removeProp("disabled").removeClass("disabled"):t('.match-interaction-area input[type="checkbox"]',e.$container).prop("disabled",!0).prop("checked",!1).addClass("disabled"),i.value===!1&&r.setCorrect([]))})},function(){a.destroy(this.widget)});return r}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c,l="",d=i.helperMissing,h=this.escapeExpression,p="function",u=this;return l+='<!--\n<div class="panel">\n      TO BE COMPLETED : add "object" editor (see : http://www.imsglobal.org/question/qtiv2p1/imsqti_infov2p1.html#element10173)\n</div>\n-->\n\n<div class="panel">\n    \n    <div>\n        <label>\n            <div>'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Media file path or YouTube video address",c):d.call(e,"__","Media file path or YouTube video address",c)))+'</div>\n            <input type="text" name="data" placeholder="Please select media file" value="',(s=i.data)?o=s.call(e,{hash:{},data:n}):(s=e&&e.data,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" data-validate="$notEmpty;"/>\n            <div><button class=\'selectMediaFile btn-info small block\'>'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Select media file",c):d.call(e,"__","Select media file",c)))+'</button></div>\n        </label>\n    </div>\n    \n    <div>\n        <label for="width" class="spinner">Width</label>\n        <input name="width" value="',(s=i.width)?o=s.call(e,{hash:{},data:n}):(s=e&&e.width,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" type="text"   data-increment="1" data-min="0" data-max="1920" style=\'min-width: 55px!important;\' />\n    </div>\n    \n    <div>\n        <label for="height" class="spinner">Height</label>\n        <input name="height" value="',(s=i.height)?o=s.call(e,{hash:{},data:n}):(s=e&&e.height,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" type="text"  data-increment="1" data-min="0" data-max="1080" style=\'min-width: 55px!important;\' />\n    </div>\n    \n</div>\n\n<div class="panel">\n    <label>\n        <input name="autostart" type="checkbox" ',o=i["if"].call(e,e&&e.autostart,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Autostart",c):d.call(e,"__","Autostart",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",c):d.call(e,"__","The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",c)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <label>\n        <input name="loop" type="checkbox" ',o=i["if"].call(e,e&&e.loop,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Loop",c):d.call(e,"__","Loop",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n       '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",c):d.call(e,"__","The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",c)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <label>\n        <input name="pause" type="checkbox" ',o=i["if"].call(e,e&&e.pause,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(o||0===o)&&(l+=o),l+='/>\n        <span class="icon-checkbox"></span>\n        '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Pause",c):d.call(e,"__","Pause",c)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n       '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"Enable the test taker to pause and restart the playing.",c):d.call(e,"__","Enable the test taker to pause and restart the playing.",c)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <div>\n        <label for="maxPlays" class="spinner">Max plays count</label>\n        <input name="maxPlays" value="',(s=i.maxPlays)?o=s.call(e,{hash:{},data:n}):(s=e&&e.maxPlays,o=typeof s===p?s.call(e,{hash:{},data:n}):s),l+=h(o)+'" data-increment="1" data-min="0" data-max="1000" type="text" style=\'min-width: 55px!important;\' />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+h((s=i.__||e&&e.__,c={hash:{},data:n},s?s.call(e,"The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",c):d.call(e,"__","The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",c)))+"\n        </span>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","ui/resourcemgr"],function(t,e,i,a,n,r,o){var s=function(){this.widget.renderInteraction()},c=function(){this.widget.destroyInteraction()},l=a.extend(n,s,c);return l.prototype.initForm=function(){var a=this.widget,n=a.$form,s=a.$original,c=a.options,l=a.element,d={},h=e.throttle(function(t){p(t),a.destroyInteraction(),a.renderInteraction()},1e3),p=function(t){t.attr("responseIdentifier",t.attr("responseIdentifier"))};n.html(o({autostart:!!l.attr("autostart"),loop:!!l.attr("loop"),maxPlays:parseInt(l.attr("maxPlays"),10),pause:l.hasClass("pause"),data:l.object.attr("data"),type:l.object.attr("type"),width:l.object.attr("width"),height:l.object.attr("height")})),r.initWidget(n),d.autostart=function(t,e,i){t.attr(i,e),h(t)},d.loop=function(t,e,i){t.attr(i,e),h(t)},d.maxPlays=function(t,e,i){t.attr(i,e),h(t)},d.pause=function(t,e){e?s.hasClass("pause")||(s.addClass("pause"),t.addClass("pause")):(s.removeClass("pause"),t.removeClass("pause"))},d.width=function(t,e,i){t.object.attr(i,e),h(t)},d.height=function(t,e,i){t.object.attr(i,e),h(t)},d.data=function(e,i,n){if(e.object.attr(n)!==i){e.object.attr(n,i),p(e);var r=t.trim(i).toLowerCase();/^http(s)?:\/\/(www\.)?youtu/.test(r)&&e.object.attr("type","video/youtube"),e.object&&(!e.object.attr("width")||parseInt(e.object.attr("width"),10)<=0)&&e.object.attr("width",a.$original.innerWidth()),h(e)}},r.setChangeCallbacks(n,l,d,{invalidate:!0});var u=n.find("input[name=data]"),m=n.find(".selectMediaFile"),f=function(){m.resourcemgr({title:i('Please select a media file (video or audio) from the resource manager. You can add files from your computer with the button "Add file(s)".'),appendContainer:c.mediaManager.appendContainer,root:"/",browseUrl:c.mediaManager.browseUrl,uploadUrl:c.mediaManager.uploadUrl,deleteUrl:c.mediaManager.deleteUrl,downloadUrl:c.mediaManager.downloadUrl,params:{uri:c.uri,lang:c.lang,filters:"video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg"},pathParam:"path",select:function(t,e){e&&e.length&&(l.object.attr("type",e[0].mime),n.find("input[name=data]").val(e[0].file).trigger("change"))},open:function(){u.hasClass("tooltipstered")&&u.blur().tooltipster("hide")},close:function(){u.blur()}})};m.on("click",f),u.val()||f()},l}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e,i){var a=function(){this.widget.renderInteraction(),this.widget.$original.append('<div class="overlay"></div>')},n=function(){this.widget.destroyInteraction(),this.widget.$original.children(".overlay").remove()};return e.extend(i,a,n)}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep"],function(t,e){return t.createBundle(e,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget",["jquery","lodash","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction"],function(t,e,i,a,n){var r=e.extend(i.clone(),{initCreator:function(){var t=this,n=this.$original,r=n.parents(".qti-item");this.registerStates(a),i.initCreator.call(this),r.off("."+this.element.serial).on("resize."+this.element.serial,e.throttle(function(){var e=n.innerWidth();e>0&&(t.element.object.attr("width",n.innerWidth()),t.destroyInteraction(),t.renderInteraction())},100))},destroy:function(){var t=this.$original,e=t.parents(".qti-item");e.off("resize.gridEdit."+this.element.serial).off("resize.qti-widget. "+this.element.serial),i.destroy.call(this)},renderInteraction:function(){var t=(this.$original,this.element);n.render.call(t.getRenderer(),t,{features:"full",controlPlaying:!1})},destroyInteraction:function(){var t=this.element;n.destroy.call(t.getRenderer(),t)}});return r}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-mediaInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n	',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n	<div class="instruction-container"></div>\n    <div class="media-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction"],function(t,e,i,a){var e=t.clone(e);return e.template=a,e.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},e}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question"],function(t,e,i){var a=t.extend(e);return a.prototype.initForm=function(){i.prototype.initForm.call(this,!1)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer"],function(t,e){var i=t.extend(e,function(){this.widget.changeState("correct")},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,a,n,r){var o=t.create(e,function(){s(this.widget)},function(){c(this.widget)}),s=function(t){var e=t.element,o=e.getResponseDeclaration(),s=n.values(o.getCorrect());a.appendInstruction(t.element,r("Please define the correct order in the box to the right.")),i.render(t.element),i.setResponse(e,l(s)),t.$container.on("responseChange.qti-widget",function(t,e){o.setCorrect(d(e.response))})},c=function(t){t.$container.off("responseChange.qti-widget"),i.destroy(t.element)},l=function(t){return{list:{identifier:t}}},d=function(t){var e=[];return t.list&&t.list.identifier&&(e=t.list.identifier),e};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(t,e){var i=function(){var t=this.widget,e=t.element;t.on("metaChange",function(t){"responsive"===t.key&&(t.value===!0?e.addClass("responsive"):e.removeClass("responsive"))})},a=function(){};return t.extend(e,i,a)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='<div class="panel">\n\n    \n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Interaction Background",s):l.call(e,"__","Interaction Background",s)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"File",s):l.call(e,"__","File",s)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The file path to the image.",s):l.call(e,"__","The file path to the image.",s)))+'</div>\n        <input type="text" name="data" value="',(o=i.data)?r=o.call(e,{hash:{},data:n}):(o=e&&e.data,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(o=i.baseUrl)?r=o.call(e,{hash:{},data:n}):(o=e&&e.baseUrl,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Select image",s):l.call(e,"__","Select image",s)))+'</button>\n    </div>\n\n    <div class="panel">\n        <label for="width">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Width",s):l.call(e,"__","Width",s)))+'</label>\n        <input name="width" value="',(o=i.width)?r=o.call(e,{hash:{},data:n}):(o=e&&e.width,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="height">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Height",s):l.call(e,"__","Height",s)))+'</label>\n        <input name="height" value="',(o=i.height)?r=o.call(e,{hash:{},data:n}):(o=e&&e.height,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="type">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Mime Type",s):l.call(e,"__","Mime Type",s)))+'</label>\n        <input name="type" value="',(o=i.type)?r=o.call(e,{hash:{},data:n}):(o=e&&e.type,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    </div>\n\n    <hr>\n\n    <h3>'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Allowed number of choices",s):l.call(e,"__","Allowed number of choices",s)))+'\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The minimum number of choices that the candidate is required to select to form a valid response.",s):l.call(e,"__","The minimum number of choices that the candidate is required to select to form a valid response.",s)))+"<br>\n            "+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The maximum number of choices that the candidate is allowed to select.",s):l.call(e,"__","The maximum number of choices that the candidate is allowed to select.",s)))+'\n        </span>\n    </h3>\n\n    <div class="panel">\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(o=i.minChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.minChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    </div>\n\n    <div class="panel">\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',(o=i.maxChoices)?r=o.call(e,{hash:{},data:n}):(o=e&&e.maxChoices,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question",["jquery","lodash","util/image","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint"],function(t,e,i,a,n,r,o,s,c){var l=a.extend(n);return l.prototype.initForm=function(){var t=this.widget,i=t.options,a=t.element,n=t.$form;n.html(c({baseUrl:i.baseUrl,maxChoices:parseInt(a.attr("maxChoices")),minChoices:parseInt(a.attr("minChoices")),choicesCount:e.size(a.getChoices()),data:a.object.attr("data"),width:a.object.attr("width"),height:a.object.attr("height"),type:a.object.attr("type")})),r(n,i),o.initWidget(n);var l=o.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices");l.data=function(e,i){a.object.attr("data",i),t.rebuild({ready:function(t){t.changeState("question")}})},l.width=function(t,e){a.object.attr("width",e)},l.height=function(t,e){a.object.attr("height",e)},l.type=function(t,e){e&&""!==e?a.object.attr("type",e):a.object.removeAttr("type")},o.setChangeCallbacks(n,a,l,{validateOnInit:!1}),s.syncMaxChoices(t)},l}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e){function i(){this.widget.changeState("map")}function a(){}return t.extend(e,i,a)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/incrementer","ui/tooltipster"],function(t,e,i,a,n,r,o,s,c,l,d,h,p,u){function m(){var t=this.widget,a=t.element,n=(t.$original,a.getResponseDeclaration());t._targets=[],a.paper&&(r.destroy(a),o.appendInstruction(a,i("Please create areas that correspond to the response and associate them a score.\nYou can also position the target to the exact point as the correct response.")),a.responseMappingMode=!0,e.isPlainObject(n.mapEntries)&&(n.mapEntries=e.values(n.mapEntries)),a.paper=t.createPaper(),v(t),t._editor=b(t),y(t))}function f(t){return t.shape+"-"+t.coords.replace(/,*/g,"-")}function g(t,i){var a=!1;return e.forEach(t.mapEntries,function(t,e){return f(t)===i?(a=e,!1):void 0}),a}function v(i){var a=i.element,n=i.$original,r=a.getResponseDeclaration(),o=e.values(r.getCorrect());e.forEach(r.mapEntries,function(t){var e=i.createResponseArea(t.shape,t.coords);C(i,t,e,!1)}),l.defineCorrect(r)&&o.length&&e.forEach(o,function(t){var e=t.split(" ");if(e.length>=2){var n=s.createTarget(a.paper,{point:{x:e[0],y:e[1]}});i._targets.push(n.id)}}),a.paper.getById("bg-image-"+a.serial).click(function(){t(".-mapping-editor",n).hide()})}function b(i){var a=i.element,n=a.getResponseDeclaration(),r=d(i,{currents:n.mapEntries.map(f).concat(i._targets),target:!0,shapeCreated:function(t,e){var a,r,o;"target"===e?(a=t.data("target"),r=n.getCorrect()||[],r.push(I(a)),n.setCorrect(r)):(o={shape:"path"===e?"poly":e,coords:s.qtiCoords(t),mappedValue:n.mappingAttributes.defaultValue||"0"},C(i,o,t,!0),n.mapEntries.push(o))},shapeRemoved:function(i,r){var o;/^target/.test(i)&&r.target?n.setCorrect(e.without(n.getCorrect(),I(r.target))):(o=a.paper.getById("score-"+i),o&&o.remove(),t("#score-popup-"+i).remove(),e.remove(n.mapEntries,function(t){return i&&f(t)===i}))},enterHandling:function(e){"set"===e.type?e.forEach(function(t){return"path"===t.type?void t.attr(s._style["target-hover"]):void 0}):(e.toFront(),t("#score-popup-"+e.id).show())},quitHandling:function(e){if("set"===e.type)e.forEach(function(t){return"path"===t.type?void t.attr(s._style["target-success"]):void 0});else{var i=a.paper.getById("score-"+e.id);i&&i.show().toFront(),t("#score-popup-"+e.id).hide()}},shapeChanging:function(e){var i=a.paper.getById("score-"+e.id);i&&i.remove(),t("#score-popup-"+e.id).remove()},shapeChange:function(t){var e,a=g(n,t.id);a!==!1&&(e=n.mapEntries[a],n.mapEntries[a].coords=s.qtiCoords(t),C(i,e,t,e.mappedValue===n.mappingAttributes.defaultValue),t.id=f(e))}});return r.create(),r}function I(t){return Math.round(t.x)+" "+Math.round(t.y)}function C(e,a,n,r){var o=e.element,c=e.$original,l=c.hasClass("responsive"),d=o.getResponseDeclaration(),m=f(a),g=t(".main-image-box",c),v=h(o.paper,n,g,l),b=(a.mappedValue||d.mappingAttributes.defaultValue||"0",s.createShapeText(o.paper,n,{id:"score-"+m,content:a.mappedValue+"",style:"score-text-default",title:i("Score value"),shapeClick:!0}));b.data("default",!!r),n.id=m,v.attr("id","score-popup-"+m);var I=t(p({score:a.mappedValue,scoreMin:d.getMappingAttribute("lowerBound"),scoreMax:d.getMappingAttribute("upperBound"),noCorrect:!0}));u.setChangeCallbacks(I,d,{score:function(t,e){""===e?b.attr({text:t.mappingAttributes.defaultValue}).data("default",!0):b.attr({text:e}).data("default",!1),a.mappedValue=parseFloat(e)}}),I.appendTo(v)}function y(t){var i=t.element,a=t.$container,n=a.find('[data-type="target"]'),r=n.prev(".separator");t.on("mappingAttributeChange",function(t){"defaultValue"===t.key&&i.paper.forEach(function(e){/^score/.test(e.id)&&e.data("default")===!0&&e.attr({text:t.value})})}),t.on("metaChange",function(a){"defineCorrect"===a.key&&(a.value?(n.show(),r.show()):(n.hide(),r.hide(),e.forEach(t._targets,function(t){var e=i.paper.getById(t),a=i.paper.getById("layer-"+t);e.remove(),a.remove()})))})}function w(){var t=this.widget,e=t.element;e.paper&&(t._editor&&t._editor.destroy(),o.removeInstructions(e),r.destroy(e),e.paper=this.widget.createPaper())}return a.create(n,m,w)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function(t,e,i,a,n,r,o){var s=e.extend(a.clone(),n,{initCreator:function(t){var e;this.baseUrl=t.baseUrl,this.choiceForm=t.choiceForm,this.registerStates(r),a.initCreator.call(this),e=this.createPaper(),e&&(this.element.paper=e)},destroy:function(){var e=this.$original,i=e.parents(".qti-item");i.off("resize.gridEdit."+this.element.serial),t(window).off("resize.qti-widget."+this.element.serial),e.off("resize.qti-widget."+this.element.serial),a.destroy.call(this)},createResponseArea:function(t,e){return o.createElement(this.element.paper,t,e,{touchEffect:!1})}});return s}),define("taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return a=a||{},a.baseUrl=this.getOption("baseUrl"),a.choiceForm=this.getOption("choiceOptionForm"),a.uri=this.getOption("uri"),a.lang=this.getOption("lang"),a.mediaManager=this.getOption("mediaManager"),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l=i.helperMissing,d=this.escapeExpression,h="function";return c+='\n<div class="panel">\n    <label for="lowerBound" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Lower Bound",s):l.call(e,"__","Lower Bound",s)))+'</label>\n    <input name="lowerBound" value="',(o=i.lowerBound)?r=o.call(e,{hash:{},data:n}):(o=e&&e.lowerBound,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The lower bound of the slider",s):l.call(e,"__","The lower bound of the slider",s)))+'</span>\n    <label for="upperBound" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Upper Bound",s):l.call(e,"__","Upper Bound",s)))+'</label>\n    <input name="upperBound" value="',(o=i.upperBound)?r=o.call(e,{hash:{},data:n}):(o=e&&e.upperBound,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The upper bound of the slider",s):l.call(e,"__","The upper bound of the slider",s)))+'</span>\n</div>\n\n<div class="panel">\n    <label for="step" class="spinner">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Step",s):l.call(e,"__","Step",s)))+'</label>\n    <input name="step" value="',(o=i.step)?r=o.call(e,{hash:{},data:n}):(o=e&&e.step,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="0" data-max="',(o=i.upperBound)?r=o.call(e,{hash:{},data:n}):(o=e&&e.upperBound,r=typeof o===h?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The number of units corresponding to a step on the slider",s):l.call(e,"__","The number of units corresponding to a step on the slider",s)))+"</span>\n</div>\n"
})}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider"],function(t,e,i,a){var n=t.extend(e);return n.prototype.initForm=function(){var t=this.widget,e=t.$form,n=t.element;e.html(a({lowerBound:parseFloat(n.attr("lowerBound")),upperBound:parseFloat(n.attr("upperBound")),orientation:n.attr("orientation"),reverse:!!n.attr("reverse"),step:parseInt(n.attr("step")),stepLabel:!!n.attr("stepLabel")})),i.initWidget(e);var r={};r.lowerBound=function(e,i){e.attr("lowerBound",parseFloat(i));var a=e.attr("lowerBound"),n=e.attr("upperBound"),o=n-a,s=e.attr("step"),c=!!e.attr("reverse");a>n&&(r.upperBound(e,a),t.$form.find('input[name="upperBound"]').val(a)),s>o&&o>=0&&(r.step(e,o),t.$form.find('input[name="step"]').val(o)),t.$container.find(c?".slider-max":".slider-min").text(i),t.$container.find("span.qti-slider-cur-value").text(a),t.$container.find(".qti-slider").noUiSlider({range:{min:a,max:n}},!0),t.$container.find(".qti-slider").val(a)},r.upperBound=function(e,i){e.attr("upperBound",parseFloat(i));var a=e.attr("lowerBound"),n=e.attr("upperBound"),o=n-a,s=e.attr("step"),c=!!e.attr("reverse");a>n&&(r.lowerBound(e,n),t.$form.find('input[name="lowerBound"]').val(n)),s>o&&o>=0&&(r.step(e,o),t.$form.find('input[name="step"]').val(o)),t.$form.find('input[name="step"]').incrementer("options",{max:n}),t.$container.find(c?".slider-min":".slider-max").text(i),t.$container.find(".qti-slider").noUiSlider({range:{min:e.attr("lowerBound"),max:e.attr("upperBound")}},!0)},r.orientation=function(e,i){e.attr("orientation",i);e.attr("orientation")?e.attr("orientation"):"horizontal",e.attr("reverse");t.$container.find(".qti-slider").noUiSlider({orientation:e.attr("orientation")},!0)},r.reverse=function(e,i){e.attr("reverse",!!i);var a=e.attr("reverse"),n=parseInt(e.attr("lowerBound")),r=parseInt(e.attr("upperBound")),o=t.$container.find(".qti-slider"),s=a?r:n;o.noUiSlider({start:s},!0),t.$container.find("span.qti-slider-cur-value").text(n),t.$container.find(".slider-min").text(a?r:n),t.$container.find(".slider-max").text(a?n:r)},r.step=function(e,i){var a=e.attr("lowerBound"),n=e.attr("upperBound"),r=parseInt(i),o=n-a;o>=r&&(e.attr("step",r),t.$container.find(".qti-slider").noUiSlider({step:e.attr("step")},!0),t.$form.find('input[name="step"]').incrementer("options",{max:o}))},r.stepLabel=function(e,i){if(e.attr("stepLabel",!!i),t.$container.find("span.slider-middle").remove(),e.attr("stepLabel")){var a=e.attr("upperBound"),n=e.attr("lowerBound"),r=e.attr("step"),o=e.attr("reverse"),s=parseInt((a-n)/r),c=parseInt(s/2),l=100/s*c,d=o?a-c*r:n+c*r;t.$container.find(".slider-min").after('<span class="slider-middle" style="left:'+l+'%">'+d+"</span>")}},i.setChangeCallbacks(e,n,r)},n}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e){var i=t.extend(e,function(){this.widget.changeState("correct")},function(){});return i}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Helper","lodash","i18n"],function(t,e,i,a,n,r){var o=t.create(e,function(){s(this.widget)},function(){c(this.widget)}),s=function(t){var e=t.element,o=e.getResponseDeclaration(),s=n.values(o.getCorrect());i.setResponse(e,l(s));var c=t.$container.find(".qti-slider");c.removeAttr("disabled"),a.appendInstruction(e,r("Please define the correct response using the slider.")),t.$container.on("responseChange.qti-widget",function(t,e){o.setCorrect(d(e.response))})},c=function(t){var e=t.$container.find(".qti-slider"),i=t.element.attributes.lowerBound;e.attr("disabled","disabled"),e.val(i),t.$container.find("span.qti-slider-cur-value").text(""+i),a.removeInstructions(t.element),t.$container.off("responseChange.qti-widget")},l=function(t){return{base:{integer:t}}},d=function(t){return[t.base.integer]};return o}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct"],function(t,e){return t.createBundle(e,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this),this.$container.find(".qti-slider").attr("disabled","disabled")},i}),define("taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget"],function(t,e,i){var a=t.clone(e);return a.render=function(t,a){return e.render(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},a}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<div class="panel">\r\n    <label for="placeholderText" class="spinner">Placeholder Text</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="placeholderText" value="',(o=i.placeholderText)?r=o.call(e,{hash:{},data:n}):(o=e&&e.placeholderText,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" />\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",s):h.call(e,"__","In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",s)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="patternMask" class="spinner">Pattern Mask</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="patternMask" value="',(o=i.patternMask)?r=o.call(e,{hash:{},data:n}):(o=e&&e.patternMask,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" type="text" data-validate="$validRegex;" placeholder="e.g. [A-Z][a-z]{3,}"/>\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid.Care is needed to ensure that the format of the required input is clear to the candidate, especially when validity checking of responses is required for progression through a test. This could be done by providing an illustrative sample response in the prompt, for example.",s):h.call(e,"__","If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid.Care is needed to ensure that the format of the required input is clear to the candidate, especially when validity checking of responses is required for progression through a test. This could be done by providing an illustrative sample response in the prompt, for example.",s)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="expectedLength" class="spinner">Expected Length</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="expectedLength" value="',(o=i.expectedLength)?r=o.call(e,{hash:{},data:n}):(o=e&&e.expectedLength,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="1" data-max="100" type="text" />\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"The expectedLength attribute provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",s):h.call(e,"__","The expectedLength attribute provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",s)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="base" class="spinner">Base</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="base" value="',(o=i.base)?r=o.call(e,{hash:{},data:n}):(o=e&&e.base,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-increment="1" data-min="1" data-max="100" type="text" />\r\n    <span class="tooltip-content">\r\n        '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",s):h.call(e,"__","If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",s)))+"\r\n    </span>\r\n</div>\r\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry"],function(t,e,i,a){var n=t.extend(e);return n.prototype.initForm=function(){var t=this.widget,e=t.$form,n=t.element;e.html(a({base:parseInt(n.attr("base")),patternMask:n.attr("patternMask"),placeholderText:n.attr("placeholderText"),expectedLength:parseInt(n.attr("expectedLength"))})),i.initWidget(e),i.setChangeCallbacks(e,n,{base:i.getAttributeChangeCallback(),patternMask:i.getAttributeChangeCallback(),placeholderText:i.getAttributeChangeCallback(),expectedLength:i.getAttributeChangeCallback()})},n}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(t,e,i){var a=t.extend(e,function(){i.forward(this.widget)},function(){});return a}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","lodash"],function(t,e,i,a){var n=e.create(i,function(){var e=this.widget.$container,i=this.widget.element.getResponseDeclaration(),n=a.values(i.getCorrect()).pop()||"";e.find("tr[data-edit=correct] input[name=correct]").focus().val(n),e.on("keyup.correct","tr[data-edit=correct] input[name=correct]",function(){var e=t(this).val();i.setCorrect(e)})},function(){this.widget.$container.off(".correct")});return n}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<tr class="" data-edit="map">\r\n    <td data-text><input type="text" name="text" value="',(s=i.text)?o=s.call(e,{hash:{},data:n}):(s=e&&e.text,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" data-old-text="',(s=i.text)?o=s.call(e,{hash:{},data:n}):(s=e&&e.text,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'"/></td>\r\n    <td class="mini-tlb" colspan="2">\r\n        <label>\r\n            <input name="correct" type="radio" ',o=i["if"].call(e,e&&e.correct,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+=' />\r\n            <span class="icon-radio"></span>\r\n        </label>\r\n        <input name="score" class="score" value="',(s=i.score)?o=s.call(e,{hash:{},data:n}):(s=e&&e.score,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" data-for="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)"/>\r\n        <span class="icon-bin" data-role="delete-option"></span>\r\n    </td>\r\n</tr>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry","lodash"],function(t,e,i,a,n,r){var o=function(t){return t.closest("tr").find("input[name=text]").val()},s=e.create(i,function(){this.initMapEntries(),this.initFormCallbacks(),this.hideCorrectInput()},function(){this.widget.$container.off(".map"),this.widget.$container.find("tr[data-edit=map]:not([data-add-option])").remove()});return s.prototype.hideCorrectInput=function(){var t=this.widget.$container.find("tr[data-edit=correct]");this.widget.on("metaChange",function(e){"defineCorrect"===e.key&&t.hide()}),t.hide(),r.delay(function(){t.hide()},200)},s.prototype.initFormCallbacks=function(){var e=this.widget.$container,i=this.widget.element.getResponseDeclaration();a.setChangeCallbacks(e,i,{text:r.throttle(function(e,i){var a=t(this),n=a.data("old-text"),r=a.closest("tr"),o=!!r.find("input[name=correct]:checked").length,s=parseInt(r.find(".score").val());isNaN(s)||(e.removeMapEntry(n,!0),e.setMapEntry(i,s),a.data("old-text",i),o&&e.setCorrect(i))},600),correct:function(e){var i=o(t(this));e.setCorrect(i)},score:function(e,i){var a=o(t(this)),n=parseFloat(i);isNaN(n)||e.setMapEntry(a,n)}})},s.prototype.initMapEntries=function(){var e=this,i=this.widget.element.getResponseDeclaration(),a=r.values(i.getCorrect()).pop(),s=this.widget.$container.find("tr[data-add-option]"),c=function(e,i){var r=t(n({text:e||"",score:i||0,correct:e===a}));r.show(),s.before(r)};r.size(i.mapEntries)||(i.mapEntries={"":0}),r.forIn(i.mapEntries,function(t,e){c(e,t)}),this.widget.$container.on("click.map","[data-role=delete-option]",function(){var e=t(this),a=o(e),n=!!e.closest("tr").find("input[name=correct]:checked").length;i.removeMapEntry(a,!0),e.closest("tr").remove(),n&&i.resetCorrect()}).on("click.map",".add-option",function(){c("",0),e.initFormCallbacks()})},s}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map"],function(t,e){return t.createBundle(e,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s,c="",l="function",d=this.escapeExpression,h=i.helperMissing;return c+='<div class="widget-box widget-inline widget-textEntryInteraction" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" data-edit="active">\r\n\r\n    <div class="qti-interaction qti-textEntryInteraction">\r\n        <table>\r\n            <colgroup>\r\n                <col class="text">\r\n                <col class="icon">\r\n                <col class="icon">\r\n            </colgroup>\r\n            <tbody>\r\n                <tr data-edit="question">\r\n                    <td class="main-option"></td>\r\n                    <td colspan="2"></td>\r\n                </tr>\r\n                <tr data-edit="correct">\r\n                    <td data-text><input type="text" name="correct" value="',(o=i.text)?r=o.call(e,{hash:{},data:n}):(o=e&&e.text,r=typeof o===l?o.call(e,{hash:{},data:n}):o),c+=d(r)+'" /></td>\r\n                    <td class="mini-tlb" colspan="2">\r\n                    </td>\r\n                </tr>\r\n                <tr data-add-option data-edit="map">\r\n                    <td>\r\n                        <div class="add-option">\r\n                            <span class="icon-add"></span>\r\n                            '+d((o=i.__||e&&e.__,s={hash:{},data:n},o?o.call(e,"Add another option",s):h.call(e,"__","Add another option",s)))+'\r\n                        </div>\r\n                    </td>\r\n                    <td colspan="2"></td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget",["lodash","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction"],function(t,e,i,a){var n=e.clone();return n.initCreator=function(){this.registerStates(i),e.initCreator.call(this),this.$container.find(".tlb-title").remove()},n.renderInteraction=function(){var t=this.element,e={tag:t.qtiClass,serial:t.serial,attributes:t.attributes};return a(e)},n.buildContainer=function(){var t,e;this.$original.length&&(t=this.$original[0].previousSibling,e=this.$original[0].nextSibling,(!t||3===t.nodeType&&""===t.nodeValue||3!==t.nodeType)&&this.$original.before("&nbsp;"),(!e||3===e.nodeType&&""===e.nodeValue||3!==e.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-textEntryInteraction[data-serial="+this.element.getSerial()+"]")},n}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<span class="widget-box textEntryInteraction-placeholder" data-serial="',(o=i.serial)?r=o.call(e,{hash:{},data:n}):(o=e&&e.serial,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" data-qti-class="textEntryInteraction">\r\n    <label>&nbsp;</label>\r\n</span>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder"],function(t,e,i,a){var n=t.clone(e);return n.template=a,n.render=function(t,e){return e=e||{},i.build(t,$('.textEntryInteraction-placeholder[data-serial="'+t.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),e)},n}),define("taoQtiItem/qtiCreator/helper/uploadMime",["i18n"],function(t){var e={getMimeTypes:function(){return[{mime:"application/zip",label:t("ZIP file")},{mime:"text/plain",label:t("Plain text")},{mime:"application/pdf",label:t("PDF file")},{mime:"image/jpeg",label:t("JPEG image")},{mime:"image/png",label:t("PNG image")},{mime:"image/gif",label:t("GIF image")},{mime:"image/svg+xml",label:t("SVG image")},{mime:"application/ogg",label:t("audio/mpeg")},{mime:"audio/x-ms-wma",label:t("Windows Media audio")},{mime:"audio/x-wav",label:t("WAV audio")},{mime:"video/mpeg",label:t("MPEG video")},{mime:"video/mp4",label:t("MP4 video")},{mime:"video/quicktime",label:t("Quicktime video")},{mime:"video/x-ms-wmv",label:t("Windows Media video")},{mime:"video/x-flv",label:t("Flash video")},{mime:"text/csv",label:t("CSV file")},{mime:"application/msword",label:t("Microsoft Word file")},{mime:"application/vnd.ms-excel",label:t("Microsoft Excel file")},{mime:"application/vnd.ms-powerpoint",label:t("Microsoft Powerpoint file")}]}};return e}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+='\n    		<option value="',(n=i.mime)?a=n.call(t,{hash:{},data:e}):(n=t&&t.mime,a=typeof n===h?n.call(t,{hash:{},data:e}):n),r+=p(a)+'" ',a=i["if"].call(t,t&&t.selected,{hash:{},inverse:u.noop,fn:u.program(2,o,e),data:e}),(a||0===a)&&(r+=a),r+=">",(n=i.label)?a=n.call(t,{hash:{},data:e}):(n=t&&t.label,a=typeof n===h?n.call(t,{hash:{},data:e}):n),r+=p(a)+"</option>\n    	"}function o(){return'selected="selected"'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var s,c,l,d="",h="function",p=this.escapeExpression,u=this,m=i.helperMissing;return d+="<h3>"+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"MIME-type",l):m.call(e,"__","MIME-type",l)))+'</h3>\n<span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n<div class="tooltip-content">'+p((c=i.__||e&&e.__,l={hash:{},data:n},c?c.call(e,"The MIME-type attribute describes which kind of file may be uploaded.",l):m.call(e,"__","The MIME-type attribute describes which kind of file may be uploaded.",l)))+'</div>\n\n<div class="reset-group">\n    <select name="type" class="select2" data-has-search="false">\n    	',s=i.each.call(e,e&&e.types,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(s||0===s)&&(d+=s),d+="\n    </select>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/helper/uploadMime","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload"],function(t,e,i,a,n,r,o){var s=i.extend(a);return s.prototype.initForm=function(){var t=this.widget,i=t.$form,a=t.element,s=r.getMimeTypes();if(s.unshift({mime:"any/kind",label:e("-- Any kind of file --")}),"undefined"!=typeof a.attr("type"))if(""===a.attr("type"))delete a.attributes.type;else for(var c in s)a.attr("type")==s[c].mime&&(s[c].selected=!0);i.html(o({types:s})),n.initWidget(i),callbacks={},callbacks.type=function(t,e){"any/kind"===e?t.removeAttr("type"):t.attr("type",e)},n.setChangeCallbacks(i,a,callbacks)},s}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question"],function(t,e){return t.createBundle(e,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states"],function(t,e){var i=t.clone();return i.initCreator=function(){this.registerStates(e),t.initCreator.call(this)},i}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===l?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',(s=i.serial)?o=s.call(e,{hash:{},data:n}):(s=e&&e.serial,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'">\n	',o=i["if"].call(e,e&&e.prompt,{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+='\n	<div class="instruction-container"></div>\n    <div class="fixed-grid-row file-upload">\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n    </div>\n</div>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction"],function(t,e,i,a){var e=t.clone(e);return e.template=a,e.render=function(t,a){return e.resetGui(t),i.build(t,e.getContainer(t),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),a)},e}),define("taoQtiItem/qtiCreator/helper/simpleParser",["lodash","jquery","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/core/Loader"],function(t,e,i,a){function n(t,e){return e?e+"\\:"+t:t}function r(t){var e=t.prop("tagName").toLowerCase();return e=e.replace(/.*:/,""),h[e]?h[e]:e}function o(t){var a=r(t),n={qtiClass:a,serial:i.buildSerial(a+"_"),attributes:{}};return e.each(t[0].attributes,function(){this.specified&&(n.attributes[this.name]=this.value)}),n}function s(t,i){var a=o(t);return a.mathML=t.html(),a.annotations={},t.find(n("annotation",i.ns.math)).each(function(){var t=e(this),i=t.attr("encoding");i&&(a.annotations[i]=t.html())}),a.ns={name:"m",uri:"http://www.w3.org/1998/Math/MathML"},a}function c(a,r){var c=t.merge(t.clone(p),r||{}),h={serial:i.buildSerial("_container_"),body:"",elements:{}};return t.each(d,function(t){a.find(t).each(function(){var t=e(this),i=o(t,r);h.elements[i.serial]=i,t.replaceWith(l(i))})}),a.find(n("math",c.ns.math)).each(function(){var t=e(this),i=s(t,r);h.elements[i.serial]=i,t.replaceWith(l(i))}),h.body=a.html(),h}function l(t){return"{{"+t.serial+"}}"}var d=["img","object"],h={rubricblock:"rubricBlock"},p={ns:{math:""},loaded:null,model:null},u={parse:function(i,n){var r=e(i),s=o(r,n),l=c(r,n);if(l.body&&(s.body=l),t.isFunction(n.loaded)&&n.model){var d=(new a).setClassesLocation(n.model);d.loadElement(s,n.loaded)}return s}};return u}),define("taoQtiItem/qtiCreator/model/Container",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Container"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{afterCreate:function(){this.body("Lorem ipsum dolor sit amet, consectetur adipisicing ...")}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/Img",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Img"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{src:"",alt:""}},afterCreate:function(){this.data("responsive",!0)}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/Math",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Math"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{}},afterCreate:function(){this.getNamespace()}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/Object",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Object"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{data:"",type:""}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/RubricBlock",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/RubricBlock"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{view:["candidate"],use:""}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/AssociableHotspot",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/AssociableHotspot"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{matchMax:0,matchMin:0}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/Gap",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/Gap"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{required:!1}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/GapImg",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/GapImg"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{matchMin:0,matchMax:0}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/GapText",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/GapText"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{fixed:!1,matchMax:1,matchMin:0}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/HotspotChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/HotspotChoice"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/Hottext",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/Hottext"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{fixed:!1}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/InlineChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/InlineChoice"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{fixed:!1,showHide:"show"}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{fixed:!1,showHide:"show",matchMax:0,matchMin:0}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/choices/SimpleChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/SimpleChoice"],function(t,e,i){var a={};return t.extend(a,e),t.extend(a,{getDefaultAttributes:function(){return{fixed:!1,showHide:"show"}}}),i.extend(a)}),define("taoQtiItem/qtiCreator/model/helper/response",["lodash"],function(t){return{removeChoice:function(e,i){var a=i.id().replace(/([.-])/g,"\\$1"),n=new RegExp("([^a-z_-d.]*)("+a+")([^a-z_-d.]*)");for(var r in e.correctResponse)e.correctResponse[r].match(n)&&delete e.correctResponse[r];var o={};t.forIn(e.mapEntries,function(t,e){e.match(n)||(o[e]=t)}),e.mapEntries=o}}}),define("taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/variables/ResponseDeclaration","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/response/SimpleFeedbackRule","taoQtiItem/qtiItem/helper/response"],function(t,e,i,a,n,r,o){var s={};
return e.extend(s,n),e.extend(s,{setTemplate:function(e){var i=o.getTemplateUriFromName(e);return i&&this.template!==i&&(this.template=i,t(document).trigger("responseTemplateChange.qti-widget",{element:this,value:e})),this},getTemplate:function(){return this.template},resetCorrect:function(){return this.correctResponse=null,t(document).trigger("correctResponseChange.qti-widget",{element:this,value:null}),this},setCorrect:function(i){return e.isString(i)&&(i=[i]),this.correctResponse=i,t(document).trigger("correctResponseChange.qti-widget",{element:this,value:i}),this},getCorrect:function(){return e.clone(this.correctResponse)},setMappingAttribute:function(e,i){this.mappingAttributes[e]=i,t(document).trigger("mappingAttributeChange.qti-widget",{element:this,key:e,value:i})},removeMappingAttribute:function(e){delete this.mappingAttributes[e],t(document).trigger("mappingAttributeChange.qti-widget",{element:this,key:e,value:null})},getMappingAttribute:function(t){return this.mappingAttributes[t]},setMapEntry:function(e,i,a){if(i=parseFloat(i),a=a?!0:!1,isNaN(i))throw"the mapped value is not a number";if("multiple"===this.attr("cardinality")&&"pair"===this.attr("baseType")){var n=e.split(" "),r=n[1]+" "+n[0];this.mapEntries[r]?this.mapEntries[r]=i:this.mapEntries[e]=i}else this.mapEntries[e]=i;return t(document).trigger("mapEntryChange.qti-widget",{element:this,mapKey:e,mappedValue:i,caseSensitive:a}),this},removeMapEntry:function(e,i){if("undefined"==typeof i&&(i=!1),e||i){if("multiple"===this.attr("cardinality")&&"pair"===this.attr("baseType")){var a=e.split(" "),n=a[1]+" "+a[0];delete this.mapEntries[n]}delete this.mapEntries[e],t(document).trigger("mapEntryRemove.qti-widget",{element:this,mapKey:e})}return this},getMapEntries:function(){return e.clone(this.mapEntries)},removeMapEntries:function(){e(this.mapEntries).keys().forEach(this.removeMapEntry,this)},createFeedbackRule:function(){var e=this.getRelatedItem(),i=e.createOutcomeDeclaration({identifier:"FEEDBACK",cardinality:"single",baseType:"identifier"}),a=e.createModalFeedback({identifier:"feedbackModal",outcomeIdentifier:i.id()}),n=new r("",i,a);n.setCondition(this,"correct"),this.feedbackRules[n.getSerial()]=n;var o=this.getRenderer();return o&&(n.setRenderer(o),a.setRenderer(o)),t(document).trigger("feedbackRuleCreated.qti-widget",{element:this,rule:n}),n},getFeedbackRule:function(t){return this.feedbackRules[t]},getFeedbackRules:function(){return e.clone(this.feedbackRules)},setCondition:function(e,i,a){e.setCondition(this,i,a),t(document).trigger("feedbackRuleConditionChange.qti-widget",{element:this,rule:e,condition:i,value:a})},deleteFeedbackRule:function(e){var i,a=this.getRelatedItem();return a.remove("outcomes",e.feedbackOutcome),a.remove("modalFeedbacks",e.feedbackThen),a.remove("modalFeedbacks",e.feedbackElse||""),i=this.remove("feedbackRules",e),t(document).trigger("feedbackRuleRemoved.qti-widget",{element:this,rule:e}),i},createFeedbackElse:function(e){var a;if(i.isA(e,"_simpleFeedbackRule")){a=this.getRelatedItem().createModalFeedback({identifier:"feedbackModal",outcomeIdentifier:e.feedbackOutcome.id()}),e.setFeedbackElse(a);var n=this.getRenderer();n&&a.setRenderer(n),t(document).trigger("feedbackRuleElseCreated.qti-widget",{element:this,rule:e,modalFeedback:a})}return a},deleteFeedbackElse:function(e){this.getRelatedItem().remove("modalFeedbacks",e.feedbackElse),e.feedbackElse=null,t(document).trigger("feedbackRuleElseRemoved.qti-widget",{element:this,rule:e})},getDefaultAttributes:function(){return{}}}),a.extend(s)}),define("taoQtiItem/qtiCreator/model/mixin/editableInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/variables/ResponseDeclaration","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(t,e,i,a,n){var r={removeChoice:function(t){var i,r="";return"string"==typeof t?r=t:e.isA(t,"choice")&&(r=t.getSerial()),this.choices[r]&&(i=this.choices[r],delete this.choices[r],n.removeChoice(this.getResponseDeclaration(),i),a.deleted(i,this)),this},createResponse:function(t,e){var a=new i;t&&a.attr(t),this.getRelatedItem().addResponseDeclaration(a),a.buildIdentifier("RESPONSE",!1),a.setTemplate(e||"MATCH_CORRECT"),this.attr("responseIdentifier",a.id()),a.mappingAttributes.defaultValue=0;var n=this.getRenderer();return n&&a.setRenderer(n),a},deleteResponse:function(){var t=this.getResponseDeclaration();return t&&this.getRelatedItem().deleteResponseDeclaration(t),this.removeAttr("responseIdentifier"),this},beforeRemove:function(){var e=this.serial,i=this.getRelatedItem().getInteractions();this.deleteResponse(),2===t.size(i)&&t.each(i,function(t){if(t.serial!==e){var i=t.getResponseDeclaration();t.attr("responseIdentifier","RESPONSE"),i.id("RESPONSE")}})}};return r}),define("taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/AssociateInteraction","taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice"],function(t,e,i,a,n){var r={};return t.extend(r,e),t.extend(r,i),t.extend(r,{getDefaultAttributes:function(){return{shuffle:!1,maxAssociations:0,minAssociations:0}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createResponse({baseType:"pair",cardinality:"multiple"})},createChoice:function(){var e=new n;this.addChoice(e);var i=t.size(this.getChoices());return e.body("choice #"+i).buildIdentifier("choice"),this.getRenderer()&&e.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:e,interaction:this}),e}}),a.extend(r)}),define("taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/model/choices/SimpleChoice"],function(t,e,i,a,n){var r={};return t.extend(r,e),t.extend(r,i),t.extend(r,{getDefaultAttributes:function(){return{shuffle:!1,maxChoices:0,minChoices:0,orientation:"vertical"}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"multiple"})},createChoice:function(){var e=new n;this.addChoice(e);var i=t.size(this.getChoices());return e.body("choice #"+i).buildIdentifier("choice"),this.getRenderer()&&e.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:e,interaction:this}),e}}),a.extend(r)}),define("taoQtiItem/qtiCreator/model/interactions/CustomInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/CustomInteraction","taoQtiItem/qtiCreator/helper/pciCreator"],function(t,e,i,a,n){var r=function(t,e){throw e+" not available for pci of type "+t.typeIdentifier},o={};return t.extend(o,e),t.extend(o,i),t.extend(o,{getDefaultAttributes:function(){return{}},getDefaultPciProperties:function(){var e=n.getPciInstance(this);return t.isFunction(e.createChoice)?e.getDefaultPciProperties(this):{}},afterCreate:function(){var e=n.getPciInstance(this);return t.isFunction(e.createChoice)?e.afterCreate(this):void 0},createChoice:function(){var e=n.getPciInstance(this);return t.isFunction(e.createChoice)?e.createChoice(this):void r(this,"createChoice")}}),a.extend(o)}),define("taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction"],function(t,e,i,a){var n={};return t.extend(n,e),t.extend(n,i),t.extend(n,{getDefaultAttributes:function(){return{format:"plain"}},afterCreate:function(){this.createResponse({baseType:"string",cardinality:"single"})},createChoice:function(){throw"extendedTextInteraction does not have any choices"}}),a.extend(n)}),define("taoQtiItem/qtiCreator/model/interactions/GapMatchInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GapMatchInteraction","taoQtiItem/qtiCreator/model/choices/GapText","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(t,e,i,a,n,r,o,s){var c={};return t.extend(c,i),t.extend(c,a),t.extend(c,{getDefaultAttributes:function(){return{shuffle:!1}},afterCreate:function(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>"),this.createChoice(),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createChoice:function(e){var i=new r;return this.addChoice(i),i.val(e||"choice #"+t.size(this.getChoices())).buildIdentifier("choice"),this.getRenderer()&&i.setRenderer(this.getRenderer()),o.choiceCreated(i,this),i},createGap:function(t,e){var i=new r("",t);return this.addChoice(i),i.buildIdentifier("gap"),i.body(e),this.getRenderer()&&i.setRenderer(this.getRenderer()),o.choiceCreated(i,this),i},removeChoice:function(t){var i,a="";return"string"==typeof t?a=t:e.isA(t,"gap")?a=t.serial:e.isA(t,"gapText")&&(a=t.serial),(i=this.getBody().getElement(a))?(this.getBody().removeElement(i),s.removeChoice(this.getResponseDeclaration(),i),o.deleted(i,this)):(i=this.getChoice(a))&&(delete this.choices[a],s.removeChoice(this.getResponseDeclaration(),i),o.deleted(i,this)),this}}),n.extend(c)}),define("taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/model/choices/AssociableHotspot"],function(t,e,i,a,n,r){var o={};return e.extend(o,i),e.extend(o,a),e.extend(o,{getDefaultAttributes:function(){return{maxAssociations:0,minAssociations:0}},afterCreate:function(){var t=this.getRelatedItem(),e=t.data("responsive");e===!0&&this.addClass("responsive"),this.createResponse({baseType:"pair",cardinality:"multiple"})},createChoice:function(e){var i=new r("",e);return this.addChoice(i),i.buildIdentifier("associablehotspot"),this.getRenderer()&&i.setRenderer(this.getRenderer()),t(document).trigger("choiceCreated.qti-widget",{choice:i,interaction:this}),i}}),n.extend(o)}),define("taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/model/choices/GapImg","taoQtiItem/qtiCreator/model/choices/AssociableHotspot"],function(t,e,i,a,n,r,o){var s={};return e.extend(s,i),e.extend(s,a),e.extend(s,{afterCreate:function(){var t=this.getRelatedItem(),e=t.data("responsive");e===!0&&this.addClass("responsive"),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createGapImg:function(e,i){var a=new r;return a.object.attributes=e,i&&a.attr("objectLabel",i),this.gapImgs||(this.gapImgs=[]),this.addGapImg(a),a.buildIdentifier("gapimg"),this.getRenderer()&&a.setRenderer(this.getRenderer()),t(document).trigger("choiceCreated.qti-widget",{choice:a,interaction:this}),a},createChoice:function(e){var i=new o("",e);return this.addChoice(i),i.buildIdentifier("associablehotspot"),this.getRenderer()&&i.setRenderer(this.getRenderer()),t(document).trigger("choiceCreated.qti-widget",{choice:i,interaction:this}),i}}),n.extend(s)}),define("taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/model/choices/HotspotChoice"],function(t,e,i,a,n,r){var o={};return e.extend(o,i),e.extend(o,a),e.extend(o,{getDefaultAttributes:function(){return{}},afterCreate:function(){var t=this.getRelatedItem(),e=t.data("responsive");e===!0&&this.addClass("responsive"),this.createResponse({baseType:"identifier",cardinality:"ordered"})},createChoice:function(e){var i=new r("",e);return this.addChoice(i),i.buildIdentifier("hotspot"),this.getRenderer()&&i.setRenderer(this.getRenderer()),t(document).trigger("choiceCreated.qti-widget",{choice:i,interaction:this}),i}}),n.extend(o)}),define("taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/HotspotInteraction","taoQtiItem/qtiCreator/model/choices/HotspotChoice"],function(t,e,i,a,n,r){var o={};return e.extend(o,i),e.extend(o,a),e.extend(o,{getDefaultAttributes:function(){return{maxChoices:0,minChoices:0}},afterCreate:function(){var t=this.getRelatedItem(),e=t.data("responsive");e===!0&&this.addClass("responsive"),this.createResponse({baseType:"identifier",cardinality:"single"})},createChoice:function(e){var i=new r("",e);return this.addChoice(i),i.buildIdentifier("hotspot"),this.getRenderer()&&i.setRenderer(this.getRenderer()),t(document).trigger("choiceCreated.qti-widget",{choice:i,interaction:this}),i}}),n.extend(o)}),define("taoQtiItem/qtiCreator/model/interactions/HottextInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/HottextInteraction","taoQtiItem/qtiCreator/model/choices/Hottext","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(t,e,i,a,n,r,o,s){var c={};return t.extend(c,i),t.extend(c,a),t.extend(c,{getDefaultAttributes:function(){return{maxChoices:0,minChoices:0}},afterCreate:function(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>"),this.createResponse({baseType:"identifier",cardinality:"multiple"})},createChoice:function(t,e){var i=new r("",t);return this.addChoice(i),i.buildIdentifier("hottext"),i.body(e),this.getRenderer()&&i.setRenderer(this.getRenderer()),o.choiceCreated(i,this),i},removeChoice:function(t){var i,a="";return"string"==typeof t?a=t:e.isA(t,"hottext")&&(a=t.getSerial()),i=this.getBody().getElement(a),i&&(this.getBody().removeElement(i),s.removeChoice(this.getResponseDeclaration(),i),o.deleted(i,this)),this}}),n.extend(c)}),define("taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/model/choices/InlineChoice"],function(t,e,i,a,n){var r={};return t.extend(r,e),t.extend(r,i),t.extend(r,{getDefaultAttributes:function(){return{shuffle:!1,required:!1}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"single"})},createChoice:function(){var e=new n;this.addChoice(e);var i=t.size(this.getChoices());return e.val("choice #"+i).buildIdentifier("choice"),this.getRenderer()&&e.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:e,interaction:this}),e}}),a.extend(r)}),define("taoQtiItem/qtiCreator/model/interactions/MatchInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/MatchInteraction","taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(t,e,i,a,n,r,o,s){var c={};return t.extend(c,i),t.extend(c,a),t.extend(c,{getDefaultAttributes:function(){return{shuffle:!1,maxAssociations:0,minAssociations:0}},afterCreate:function(){this.createChoice(0),this.createChoice(0),this.createChoice(1),this.createChoice(1),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createChoice:function(e,i){var a=new r("",i);this.addChoice(a,e);var n=t.size(this.getChoices(e));return a.body("choice #"+n).buildIdentifier("choice"),this.getRenderer()&&a.setRenderer(this.getRenderer()),o.choiceCreated(a,this),a},removeChoice:function(t){var i,a="";return"string"==typeof t?a=t:e.isA(t,"choice")&&(a=t.getSerial()),i=this.choices[0][a]||this.choices[1][a]||null,i&&(delete this.choices[0][a],delete this.choices[1][a],s.removeChoice(this.getResponseDeclaration(),i),o.deleted(i,this)),this}}),n.extend(c)}),define("taoQtiItem/qtiCreator/model/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/MediaInteraction"],function(t,e,i,a){var n={};return t.extend(n,e),t.extend(n,i),t.extend(n,{getDefaultAttributes:function(){return{autostart:!1,minPlays:0,maxPlays:0,loop:!1}},afterCreate:function(){this.createResponse({baseType:"integer",cardinality:"single"})},createChoice:function(){throw"mediaInteraction does not have any choices"}}),a.extend(n)}),define("taoQtiItem/qtiCreator/model/interactions/OrderInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/OrderInteraction","taoQtiItem/qtiCreator/model/choices/SimpleChoice"],function(t,e,i,a,n){var r={};return t.extend(r,e),t.extend(r,i),t.extend(r,{getDefaultAttributes:function(){return{shuffle:!1,orientation:"vertical"}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"ordered"})},createChoice:function(){var e=new n;this.addChoice(e);var i=t.size(this.getChoices());return e.body("choice #"+i).buildIdentifier("choice"),this.getRenderer()&&e.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:e,interaction:this}),e}}),a.extend(r)}),define("taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/SelectPointInteraction"],function(t,e,i,a,n){var r={};return e.extend(r,i),e.extend(r,a),e.extend(r,{getDefaultAttributes:function(){return{maxChoices:0,minChoices:0}},afterCreate:function(){var t=this.getRelatedItem(),e=t.data("responsive");e===!0&&this.addClass("responsive"),this.createResponse({baseType:"point",cardinality:"multiple"},"MAP_RESPONSE_POINT")}}),n.extend(r)}),define("taoQtiItem/qtiCreator/model/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/SliderInteraction"],function(t,e,i,a){var n={};return t.extend(n,e),t.extend(n,i),t.extend(n,{getDefaultAttributes:function(){return{lowerBound:0,upperBound:100,orientation:"horizontal",reverse:!1,step:1,stepLabel:!1}},afterCreate:function(){this.createResponse({baseType:"integer",cardinality:"single"})},createChoice:function(){throw"sliderInteraction does not have any choices"}}),a.extend(n)}),define("taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/TextEntryInteraction"],function(t,e,i,a){var n={};return t.extend(n,e),t.extend(n,i),t.extend(n,{getDefaultAttributes:function(){return{base:10,placeholderText:""}},afterCreate:function(){this.createResponse({baseType:"string",cardinality:"single"})},createChoice:function(){throw new Error("text entry interaction has no choice")}}),a.extend(n)}),define("taoQtiItem/qtiCreator/model/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/UploadInteraction"],function(t,e,i,a){var n={};return t.extend(n,e),t.extend(n,i),t.extend(n,{getDefaultAttributes:function(){return{type:""}},afterCreate:function(){this.createResponse({baseType:"file",cardinality:"single"})},createChoice:function(){throw"uploadInteraction does not have any choices"}}),a.extend(n)}),define("taoQtiItem/qtiCreator/model/mixin/editableChoice",["lodash"],function(t){var e=function(e,i,a){var n=i.replace(/([.-])/g,"\\$1"),r=new RegExp("\\b("+n+")\\b");for(var o in e.correctResponse)e.correctResponse[o]=e.correctResponse[o].replace(r,a);var s={};t.forIn(e.mapEntries,function(t,e){e=e.replace(r,a),s[e]=t}),e.mapEntries=s},i=t.throttle(function(t,i){var a=t.id();if(a!==i){var n=t.getInteraction().getResponseDeclaration();e(n,a,i),t.id(i)}},300),a={id:function(t){i(this,t)}};return a}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(t,e){var i=t.extend(e,function(){{var t=this.widget;t.element}},function(){this.widget});return i.prototype.initResponseForm=function(){{var t=this.widget;t.$form,t.element}},i}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/container",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="function";return(o=i.body)?r=o.call(e,{hash:{},data:n}):(o=e&&e.body,r=typeof o===s?o.call(e,{hash:{},data:n}):o),r||0===r?r:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/Container",["tpl!taoQtiItem/qtiXmlRenderer/tpl/container"],function(t){var e=function(t){return t.replace(/&nbsp;/g,"&#160;")},i=function(t){var e="";return t&&(e=t,e=e.replace(/<br([^>]*)?>/gi,"<br />"),e=e.replace(/<hr([^>]*)?>/gi,"<hr />"),e=e.replace(/(<img([^>]*)?\s?[^\/]>)+/gi,function(t){return t.replace(">"," />")})),e};return{qtiClass:"_container",template:t,getData:function(t,a){return a.body=e(a.body),a.body=i(a.body),a}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/element",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return r+="<",(n=i.tag)?a=n.call(t,{hash:{},data:e}):(n=t&&t.tag,a=typeof n===d?n.call(t,{hash:{},data:e}):n),r+=h(a),a=i["if"].call(t,t&&t.attributes,{hash:{},inverse:p.noop,fn:p.program(2,o,e),data:e}),(a||0===a)&&(r+=a),r+=">",(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===d?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="</",(n=i.tag)?a=n.call(t,{hash:{},data:e}):(n=t&&t.tag,a=typeof n===d?n.call(t,{hash:{},data:e}):n),r+=h(a)+">"}function o(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):l.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function s(t,e){var a,n,r="";return r+="<",(n=i.tag)?a=n.call(t,{hash:{},data:e}):(n=t&&t.tag,a=typeof n===d?n.call(t,{hash:{},data:e}):n),r+=h(a),a=i["if"].call(t,t&&t.attributes,{hash:{},inverse:p.noop,fn:p.program(2,o,e),data:e}),(a||0===a)&&(r+=a),r+=" />"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l=i.helperMissing,d="function",h=this.escapeExpression,p=this;return c=i["if"].call(e,e&&e.body,{hash:{},inverse:p.program(4,s,n),fn:p.program(1,r,n),data:n}),c||0===c?c:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/Img",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"img",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/item",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n="";return n+=" ",a=i["if"].call(t,null==e||e===!1?e:e.key,{hash:{},inverse:b.noop,fn:b.program(2,o,e),data:e}),(a||0===a)&&(n+=a),n}function o(t,e){var i,a="";return a+="xmlns:"+v((i=null==e||e===!1?e:e.key,typeof i===g?i.apply(t):i))+'="'+v(typeof t===g?t.apply(t):t)+'"'}function s(t,e){var a,n,r;return n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):I.call(t,"join",t&&t.attributes,"="," ",'"',r),a||0===a?a:""}function c(t){var e,i="";return i+="\n        ",e=typeof t===g?t.apply(t):t,(e||0===e)&&(i+=e),i}function l(){return'\n            <div class="empty"></div>\n        '}function d(t,e){var a,n,r="";return r+="\n            ",(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===g?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r+="\n        "}function h(t){var e;return e=typeof t===g?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var p,u,m,f="",g="function",v=this.escapeExpression,b=this,I=i.helperMissing,C=i.blockHelperMissing;return f+='<?xml version="1.0" encoding="UTF-8"?>\n<assessmentItem xmlns="http://www.imsglobal.org/xsd/imsqti_v2p1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.imsglobal.org/xsd/imsqti_v2p1  http://www.imsglobal.org/xsd/qti/qtiv2p1/imsqti_v2p1.xsd"',p=i.each.call(e,e&&e.namespaces,{hash:{},inverse:b.noop,fn:b.program(1,r,n),data:n}),(p||0===p)&&(f+=p),f+="\n    ",p=i["if"].call(e,e&&e.attributes,{hash:{},inverse:b.noop,fn:b.program(4,s,n),data:n}),(p||0===p)&&(f+=p),f+=">",m={hash:{},inverse:b.noop,fn:b.program(6,c,n),data:n},(u=i.responses)?p=u.call(e,m):(u=e&&e.responses,p=typeof u===g?u.call(e,m):u),i.responses||(p=C.call(e,p,{hash:{},inverse:b.noop,fn:b.program(6,c,n),data:n})),(p||0===p)&&(f+=p),m={hash:{},inverse:b.noop,fn:b.program(6,c,n),data:n},(u=i.outcomes)?p=u.call(e,m):(u=e&&e.outcomes,p=typeof u===g?u.call(e,m):u),i.outcomes||(p=C.call(e,p,{hash:{},inverse:b.noop,fn:b.program(6,c,n),data:n})),(p||0===p)&&(f+=p),m={hash:{},inverse:b.noop,fn:b.program(6,c,n),data:n},(u=i.stylesheets)?p=u.call(e,m):(u=e&&e.stylesheets,p=typeof u===g?u.call(e,m):u),i.stylesheets||(p=C.call(e,p,{hash:{},inverse:b.noop,fn:b.program(6,c,n),data:n})),(p||0===p)&&(f+=p),f+="\n    \n    <itemBody>\n        ",p=i["if"].call(e,e&&e.empty,{hash:{},inverse:b.program(10,d,n),fn:b.program(8,l,n),data:n}),(p||0===p)&&(f+=p),f+="\n    </itemBody>\n    \n    ",(u=i.responseProcessing)?p=u.call(e,{hash:{},data:n}):(u=e&&e.responseProcessing,p=typeof u===g?u.call(e,{hash:{},data:n}):u),(p||0===p)&&(f+=p),m={hash:{},inverse:b.noop,fn:b.program(12,h,n),data:n},(u=i.feedbacks)?p=u.call(e,m):(u=e&&e.feedbacks,p=typeof u===g?u.call(e,m):u),i.feedbacks||(p=C.call(e,p,{hash:{},inverse:b.noop,fn:b.program(12,h,n),data:n})),(p||0===p)&&(f+=p),f+="\n</assessmentItem>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/Item",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/item"],function(t,e){return{qtiClass:"assessmentItem",template:e,getData:function(e,i){var a=t.clone(e.namespaces)||[],n=this;delete a[""],delete a.xsi,delete a.xml;var r={responses:[],outcomes:[],stylesheets:[],feedbacks:[],namespaces:a,empty:e.isEmpty(),responseProcessing:e.responseProcessing?e.responseProcessing.render(n):""};return t.each(e.responses,function(t){r.responses.push(t.render(n))}),t.each(e.outcomes,function(t){r.outcomes.push(t.render(n))}),t.each(e.stylesheets,function(t){r.stylesheets.push(t.render(n))}),t.each(e.modalFeedbacks,function(t){r.feedbacks.push(t.render(n))}),t.merge(i||{},r)}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Math",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"math",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/Object",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"object",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/outcomeDeclaration",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):p.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function o(){return"/>\n"}function s(t,e){var a,n="";return n+=">\n    ",a=i["if"].call(t,(a=t&&t.defaultValue,null==a||a===!1?a:a.length),{hash:{},inverse:f.noop,fn:f.program(6,c,e),data:e}),(a||0===a)&&(n+=a),n+="</outcomeDeclaration>"}function c(t,e){var a,n="";return n+="<defaultValue>\n        ",a=i.each.call(t,t&&t.defaultValue,{hash:{},inverse:f.noop,fn:f.program(7,l,e),data:e}),(a||0===a)&&(n+=a),n+="</defaultValue>\n    "}function l(t){var e="";return e+="<value>"+m(typeof t===u?t.apply(t):t)+"</value>\n        "}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var d,h="",p=i.helperMissing,u="function",m=this.escapeExpression,f=this;return h+="\n<outcomeDeclaration",d=i["if"].call(e,e&&e.attributes,{hash:{},inverse:f.noop,fn:f.program(1,r,n),data:n}),(d||0===d)&&(h+=d),d=i["if"].call(e,e&&e.empty,{hash:{},inverse:f.program(5,s,n),fn:f.program(3,o,n),data:n}),(d||0===d)&&(h+=d),h})}),define("taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/outcomeDeclaration"],function(t,e){return{qtiClass:"outcomeDeclaration",template:e,getData:function(e,i){var a=[];e.defaultValue&&(a="object"==typeof e.defaultValue?t.values(e.defaultValue):[e.defaultValue]);var n={empty:!t.size(a),defaultValue:a};return t.merge(i||{},n)}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responseDeclaration",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(){return"/>"}function o(t,e){var a,n="";return n+=">",a=i["if"].call(t,(a=t&&t.defaultValue,null==a||a===!1?a:a.length),{hash:{},inverse:x.noop,fn:x.program(4,s,e),data:e}),(a||0===a)&&(n+=a),a=i["if"].call(t,(a=t&&t.correctResponse,null==a||a===!1?a:a.length),{hash:{},inverse:x.noop,fn:x.program(7,l,e),data:e}),(a||0===a)&&(n+=a),a=i["if"].call(t,t&&t.MAP_RESPONSE,{hash:{},inverse:x.noop,fn:x.program(10,h,e),data:e}),(a||0===a)&&(n+=a),a=i["if"].call(t,t&&t.MAP_RESPONSE_POINT,{hash:{},inverse:x.noop,fn:x.program(16,f,e),data:e}),(a||0===a)&&(n+=a),n+="\n    </responseDeclaration>"}function s(t,e){var a,n="";return n+="\n    <defaultValue>",a=i.each.call(t,t&&t.defaultValue,{hash:{},inverse:x.noop,fn:x.program(5,c,e),data:e}),(a||0===a)&&(n+=a),n+="\n    </defaultValue>\n    "}function c(t){var e="";return e+="\n        <value>"+q(typeof t===w?t.apply(t):t)+"</value>\n        "}function l(t,e){var a,n="";return n+="\n    <correctResponse>",a=i.each.call(t,t&&t.correctResponse,{hash:{},inverse:x.noop,fn:x.program(8,d,e),data:e}),(a||0===a)&&(n+=a),n+="\n    </correctResponse>\n    "}function d(t){var e="";return e+="\n        <value>"+q(typeof t===w?t.apply(t):t)+"</value>"}function h(t,e){var a,n="";return a=i["if"].call(t,t&&t.mapEntries,{hash:{},inverse:x.noop,fn:x.program(11,p,e),data:e}),(a||0===a)&&(n+=a),n+="\n    "}function p(t,e){var a,n="";return n+="<mapping",a=i.each.call(t,t&&t.mappingAttributes,{hash:{},inverse:x.noop,fn:x.program(12,u,e),data:e}),(a||0===a)&&(n+=a),n+=">",a=i.each.call(t,t&&t.mapEntries,{hash:{},inverse:x.noop,fn:x.program(14,m,e),data:e}),(a||0===a)&&(n+=a),n+="\n        </mapping>\n        "}function u(t,e){var i,a="";return a+=" "+q((i=null==e||e===!1?e:e.key,typeof i===w?i.apply(t):i))+'="'+q(typeof t===w?t.apply(t):t)+'"'}function m(t,e){var i,a="";return a+='\n            <mapEntry mapKey="'+q((i=null==e||e===!1?e:e.key,typeof i===w?i.apply(t):i))+'" mappedValue="'+q(typeof t===w?t.apply(t):t)+'" caseSensitive="false"/>'}function f(t,e){var a,n="";return a=i["if"].call(t,t&&t.mapEntries,{hash:{},inverse:x.noop,fn:x.program(17,g,e),data:e}),(a||0===a)&&(n+=a),n+="\n    "}function g(t,e){var a,n="";return n+="<areaMapping",a=i.each.call(t,t&&t.mappingAttributes,{hash:{},inverse:x.noop,fn:x.program(12,u,e),data:e}),(a||0===a)&&(n+=a),n+=">",a=i.each.call(t,t&&t.mapEntries,{hash:{},inverse:x.noop,fn:x.program(18,v,e),data:e}),(a||0===a)&&(n+=a),n+="\n        </areaMapping>\n        "
}function v(t,e){var a,n,r="";return r+='\n            <areaMapEntry shape="',(n=i.shape)?a=n.call(t,{hash:{},data:e}):(n=t&&t.shape,a=typeof n===w?n.call(t,{hash:{},data:e}):n),r+=q(a)+'" coords="',(n=i.coords)?a=n.call(t,{hash:{},data:e}):(n=t&&t.coords,a=typeof n===w?n.call(t,{hash:{},data:e}):n),r+=q(a)+'" mappedValue="',(n=i.mappedValue)?a=n.call(t,{hash:{},data:e}):(n=t&&t.mappedValue,a=typeof n===w?n.call(t,{hash:{},data:e}):n),r+=q(a)+'" />'}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var b,I,C,y="",w="function",q=this.escapeExpression,x=this,_=i.helperMissing;return y+="<responseDeclaration ",I=i.join||e&&e.join,C={hash:{},data:n},b=I?I.call(e,e&&e.attributes,"="," ",'"',C):_.call(e,"join",e&&e.attributes,"="," ",'"',C),(b||0===b)&&(y+=b),b=i["if"].call(e,e&&e.empty,{hash:{},inverse:x.program(3,o,n),fn:x.program(1,r,n),data:n}),(b||0===b)&&(y+=b),y})}),define("taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responseDeclaration"],function(t,e){return{qtiClass:"responseDeclaration",template:e,getData:function(e,i){var a={empty:!t.size(e.mapEntries)&&!t.size(e.correctResponse)&&!t.size(e.defaultValue),correctResponse:t.values(e.correctResponse),MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct"===e.template,MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response"===e.template,MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point"===e.template,mappingAttributes:e.mappingAttributes,mapEntries:e.mapEntries};return t.merge(a,i||{})}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responseProcessing",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r="";return(n=i.xml)?a=n.call(t,{hash:{},data:e}):(n=t&&t.xml,a=typeof n===h?n.call(t,{hash:{},data:e}):n),(a||0===a)&&(r+=a),r}function o(t,e){var a,n,r="";return r+='<responseProcessing template="',(n=i.template)?a=n.call(t,{hash:{},data:e}):(n=t&&t.template,a=typeof n===h?n.call(t,{hash:{},data:e}):n),r+=p(a)+'"/>'}function s(t,e){var a,n,r,o="";return o+="<responseProcessing>\n    ",r={hash:{},inverse:u.noop,fn:u.program(6,c,e),data:e},(n=i.responseRules)?a=n.call(t,r):(n=t&&t.responseRules,a=typeof n===h?n.call(t,r):n),i.responseRules||(a=m.call(t,a,{hash:{},inverse:u.noop,fn:u.program(6,c,e),data:e})),(a||0===a)&&(o+=a),o+="\n    ",r={hash:{},inverse:u.noop,fn:u.program(6,c,e),data:e},(n=i.feedbackRules)?a=n.call(t,r):(n=t&&t.feedbackRules,a=typeof n===h?n.call(t,r):n),i.feedbackRules||(a=m.call(t,a,{hash:{},inverse:u.noop,fn:u.program(6,c,e),data:e})),(a||0===a)&&(o+=a),o+="\n</responseProcessing>"}function c(t){var e;return e=typeof t===h?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var l,d="",h="function",p=this.escapeExpression,u=this,m=i.blockHelperMissing;return l=i["if"].call(e,e&&e.custom,{hash:{},inverse:u.noop,fn:u.program(1,r,n),data:n}),(l||0===l)&&(d+=l),l=i["if"].call(e,e&&e.template,{hash:{},inverse:u.noop,fn:u.program(3,o,n),data:n}),(l||0===l)&&(d+=l),l=i["if"].call(e,e&&e.templateDriven,{hash:{},inverse:u.noop,fn:u.program(5,s,n),data:n}),(l||0===l)&&(d+=l),d})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/match_correct",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier="',(o=i.responseIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.responseIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n            <correct identifier="',(o=i.responseIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.responseIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n        </match>\n        <setOutcomeValue identifier="',(o=i.outcomeIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.outcomeIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n            <sum>\n                <variable identifier="',(o=i.outcomeIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.outcomeIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n                <baseValue baseType="integer">1</baseValue>\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>'})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<responseCondition>\n    <responseIf>\n        <not>\n            <isNull>\n                <variable identifier="',(o=i.responseIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.responseIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n            </isNull>\n        </not>\n        <setOutcomeValue identifier="',(o=i.outcomeIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.outcomeIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n            <sum>\n                <variable identifier="',(o=i.outcomeIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.outcomeIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n                <mapResponse identifier="',(o=i.responseIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.responseIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>'})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response_point",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c="function",l=this.escapeExpression;return s+='<responseCondition>\n    <responseIf>\n        <not>\n            <isNull>\n                <variable identifier="',(o=i.responseIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.responseIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n            </isNull>\n        </not>\n        <setOutcomeValue identifier="',(o=i.outcomeIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.outcomeIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'">\n            <sum>\n                <variable identifier="',(o=i.outcomeIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.outcomeIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n                <mapResponsePoint identifier="',(o=i.responseIdentifier)?r=o.call(e,{hash:{},data:n}):(o=e&&e.responseIdentifier,r=typeof o===c?o.call(e,{hash:{},data:n}):o),s+=l(r)+'" />\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>'})}),define("taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responseProcessing","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/match_correct","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response_point"],function(t,e,i,a,n){var r=function(t){var e="",i=t.getResponseDeclaration();return i.template&&(e=o(i.template,{responseIdentifier:i.id(),outcomeIdentifier:"SCORE"})),e},o=function(t,e){var r="";switch(t){case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct":case"MATCH_CORRECT":r=i(e);break;case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response":case"MAP_RESPONSE":r=a(e);break;case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point":case"MAP_RESPONSE_POINT":r=n(e);break;default:throw new Error("unknown rp template : "+t)}return r},s=function(e,i){var a=[];return t.each(i.getFeedbackRules(),function(t){a.push(t.render(e))}),a};return{qtiClass:"responseProcessing",template:e,getData:function(e,i){var a={},n=this;switch(e.processingType){case"custom":a.custom=!0,a.xml=e.xml;break;case"templateDriven":var o=e.getRelatedItem().getInteractions();if(1===o.length){var c=o[0].getResponseDeclaration();if(!t.size(c.getFeedbackRules())){a.template=c.template;break}}a.templateDriven=!0,a.responseRules=[],t.each(o,function(t){a.responseRules.push(r(t))}),a.feedbackRules=[],t.each(o,function(e){a.feedbackRules=t.union(a.feedbackRules,s(n,e.getResponseDeclaration()))})}return t.merge(i||{},a)}}}),define("taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element","lodash"],function(t,e){return{qtiClass:"rubricBlock",template:t,getData:function(t,i){var a={view:i.attributes.view?e.values(i.attributes.view).join(" "):""};return e.merge(i||{},a)}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"stylesheet",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"associableHotspot",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"gap",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/choices/gapImg",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):l.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l=i.helperMissing,d=this,h="function";return c+="<gapImg",o=i["if"].call(e,e&&e.attributes,{hash:{},inverse:d.noop,fn:d.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+=">\n    ",(s=i.renderedObject)?o=s.call(e,{hash:{},data:n}):(s=e&&e.renderedObject,o=typeof s===h?s.call(e,{hash:{},data:n}):s),(o||0===o)&&(c+=o),c+="\n</gapImg>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiXmlRenderer/tpl/choices/gapImg"],function(t){return{qtiClass:"gapImg",template:t,getData:function(t,e){return e.renderedObject=t.object.render(this),e}}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"gapText",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"hotspotChoice",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"hottext",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"inlineChoice",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"simpleAssociableChoice",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"simpleChoice",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"modalFeedback",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):m.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function o(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===f?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function s(t,e){var a,n;return(n=i.object)?a=n.call(t,{hash:{},data:e}):(n=t&&t.object,a=typeof n===f?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function c(t){var e;return e=typeof t===f?t.apply(t):t,e||0===e?e:""}function l(t,e){var a,n;return(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===f?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var d,h,p,u="",m=i.helperMissing,f="function",g=this.escapeExpression,v=this,b=i.blockHelperMissing;return u+="<",(h=i.tag)?d=h.call(e,{hash:{},data:n}):(h=e&&e.tag,d=typeof h===f?h.call(e,{hash:{},data:n}):h),u+=g(d),d=i["if"].call(e,e&&e.attributes,{hash:{},inverse:v.noop,fn:v.program(1,r,n),data:n}),(d||0===d)&&(u+=d),u+=">",d=i["if"].call(e,e&&e.prompt,{hash:{},inverse:v.noop,fn:v.program(3,o,n),data:n}),(d||0===d)&&(u+=d),d=i["if"].call(e,e&&e.object,{hash:{},inverse:v.noop,fn:v.program(5,s,n),data:n}),(d||0===d)&&(u+=d),p={hash:{},inverse:v.noop,fn:v.program(7,c,n),data:n},(h=i.choices)?d=h.call(e,p):(h=e&&e.choices,d=typeof h===f?h.call(e,p):h),i.choices||(d=b.call(e,d,{hash:{},inverse:v.noop,fn:v.program(7,c,n),data:n})),(d||0===d)&&(u+=d),d=i["if"].call(e,e&&e.body,{hash:{},inverse:v.noop,fn:v.program(9,l,n),data:n}),(d||0===d)&&(u+=d),u+="\n</",(h=i.tag)?d=h.call(e,{hash:{},data:n}):(h=e&&e.tag,d=typeof h===f?h.call(e,{hash:{},data:n}):h),u+=g(d)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"associateInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"choiceInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/EndAttemptInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"endAttemptInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"extendedTextInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"gapMatchInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"graphicAssociateInteraction",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):p.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function o(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===u?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function s(t){var e;return e=typeof t===u?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d,h="",p=i.helperMissing,u="function",m=this,f=i.blockHelperMissing;return h+="<graphicGapMatchInteraction",c=i["if"].call(e,e&&e.attributes,{hash:{},inverse:m.noop,fn:m.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+=">",c=i["if"].call(e,e&&e.prompt,{hash:{},inverse:m.noop,fn:m.program(3,o,n),data:n}),(c||0===c)&&(h+=c),h+="\n    ",(l=i.object)?c=l.call(e,{hash:{},data:n}):(l=e&&e.object,c=typeof l===u?l.call(e,{hash:{},data:n}):l),(c||0===c)&&(h+=c),d={hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n},(l=i.gapImgs)?c=l.call(e,d):(l=e&&e.gapImgs,c=typeof l===u?l.call(e,d):l),i.gapImgs||(c=f.call(e,c,{hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n})),(c||0===c)&&(h+=c),d={hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n},(l=i.choices)?c=l.call(e,d):(l=e&&e.choices,c=typeof l===u?l.call(e,d):l),i.choices||(c=f.call(e,c,{hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n})),(c||0===c)&&(h+=c),h+="\n</graphicGapMatchInteraction>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/graphicGapMatchInteraction"],function(t){return{qtiClass:"graphicGapMatchInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"graphicOrderInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"hotspotInteraction",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):h.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function o(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===p?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function s(t,e){var a,n;return(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===p?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d="",h=i.helperMissing,p="function",u=this.escapeExpression,m=this;return d+="<",(l=i.tag)?c=l.call(e,{hash:{},data:n}):(l=e&&e.tag,c=typeof l===p?l.call(e,{hash:{},data:n}):l),d+=u(c),c=i["if"].call(e,e&&e.attributes,{hash:{},inverse:m.noop,fn:m.program(1,r,n),data:n}),(c||0===c)&&(d+=c),d+=">",c=i["if"].call(e,e&&e.prompt,{hash:{},inverse:m.noop,fn:m.program(3,o,n),data:n}),(c||0===c)&&(d+=c),c=i["if"].call(e,e&&e.body,{hash:{},inverse:m.noop,fn:m.program(5,s,n),data:n}),(c||0===c)&&(d+=c),d+="\n</",(l=i.tag)?c=l.call(e,{hash:{},data:n}):(l=e&&e.tag,c=typeof l===p?l.call(e,{hash:{},data:n}):l),d+=u(c)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/hottextInteraction"],function(t){return{qtiClass:"hottextInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"inlineChoiceInteraction",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/matchInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):p.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function o(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===u?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function s(t){var e;return e=typeof t===u?t.apply(t):t,e||0===e?e:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var c,l,d,h="",p=i.helperMissing,u="function",m=this.escapeExpression,f=this,g=i.blockHelperMissing;return h+="<",(l=i.tag)?c=l.call(e,{hash:{},data:n}):(l=e&&e.tag,c=typeof l===u?l.call(e,{hash:{},data:n}):l),h+=m(c),c=i["if"].call(e,e&&e.attributes,{hash:{},inverse:f.noop,fn:f.program(1,r,n),data:n}),(c||0===c)&&(h+=c),h+=">",c=i["if"].call(e,e&&e.prompt,{hash:{},inverse:f.noop,fn:f.program(3,o,n),data:n}),(c||0===c)&&(h+=c),h+="\n    <simpleMatchSet>\n        ",d={hash:{},inverse:f.noop,fn:f.program(5,s,n),data:n},(l=i.matchSet1)?c=l.call(e,d):(l=e&&e.matchSet1,c=typeof l===u?l.call(e,d):l),i.matchSet1||(c=g.call(e,c,{hash:{},inverse:f.noop,fn:f.program(5,s,n),data:n})),(c||0===c)&&(h+=c),h+="\n    </simpleMatchSet>\n    <simpleMatchSet>\n        ",d={hash:{},inverse:f.noop,fn:f.program(5,s,n),data:n},(l=i.matchSet2)?c=l.call(e,d):(l=e&&e.matchSet2,c=typeof l===u?l.call(e,d):l),i.matchSet2||(c=g.call(e,c,{hash:{},inverse:f.noop,fn:f.program(5,s,n),data:n})),(c||0===c)&&(h+=c),h+="\n    </simpleMatchSet>\n</",(l=i.tag)?c=l.call(e,{hash:{},data:n}):(l=e&&e.tag,c=typeof l===u?l.call(e,{hash:{},data:n}):l),h+=m(c)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/matchInteraction"],function(t){return{qtiClass:"matchInteraction",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,t&&t.attributes,"="," ",'"',r):m.call(t,"join",t&&t.attributes,"="," ",'"',r),(a||0===a)&&(o+=a),o}function o(t,e){var a,n;return(n=i.prompt)?a=n.call(t,{hash:{},data:e}):(n=t&&t.prompt,a=typeof n===f?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}function s(t,e){var a,n,r,o="";return o+=" ",n=i.join||t&&t.join,r={hash:{},data:e},a=n?n.call(t,(a=t&&t.object,null==a||a===!1?a:a.attributes),"="," ",'"',r):m.call(t,"join",(a=t&&t.object,null==a||a===!1?a:a.attributes),"="," ",'"',r),(a||0===a)&&(o+=a),o}function c(t){var e;return e=typeof t===f?t.apply(t):t,e||0===e?e:""}function l(t,e){var a,n;return(n=i.body)?a=n.call(t,{hash:{},data:e}):(n=t&&t.body,a=typeof n===f?n.call(t,{hash:{},data:e}):n),a||0===a?a:""}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var d,h,p,u="",m=i.helperMissing,f="function",g=this.escapeExpression,v=this,b=i.blockHelperMissing;return u+="<",(h=i.tag)?d=h.call(e,{hash:{},data:n}):(h=e&&e.tag,d=typeof h===f?h.call(e,{hash:{},data:n}):h),u+=g(d),d=i["if"].call(e,e&&e.attributes,{hash:{},inverse:v.noop,fn:v.program(1,r,n),data:n}),(d||0===d)&&(u+=d),u+=">",d=i["if"].call(e,e&&e.prompt,{hash:{},inverse:v.noop,fn:v.program(3,o,n),data:n}),(d||0===d)&&(u+=d),u+="\r\n    <object ",d=i["if"].call(e,(d=e&&e.object,null==d||d===!1?d:d.attributes),{hash:{},inverse:v.noop,fn:v.program(5,s,n),data:n}),(d||0===d)&&(u+=d),u+=" />",p={hash:{},inverse:v.noop,fn:v.program(7,c,n),data:n},(h=i.choices)?d=h.call(e,p):(h=e&&e.choices,d=typeof h===f?h.call(e,p):h),i.choices||(d=b.call(e,d,{hash:{},inverse:v.noop,fn:v.program(7,c,n),data:n})),(d||0===d)&&(u+=d),d=i["if"].call(e,e&&e.body,{hash:{},inverse:v.noop,fn:v.program(9,l,n),data:n}),(d||0===d)&&(u+=d),u+="\r\n</",(h=i.tag)?d=h.call(e,{hash:{},data:n}):(h=e&&e.tag,d=typeof h===f?h.call(e,{hash:{},data:n}):h),u+=g(d)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/mediaInteraction"],function(t){return{qtiClass:"mediaInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"orderInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"prompt",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"selectPointInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"sliderInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(t){return{qtiClass:"textEntryInteraction",template:t}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(t){return{qtiClass:"uploadInteraction",template:t}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="function";return(o=i.rule)?r=o.call(e,{hash:{},data:n}):(o=e&&e.rule,r=typeof o===s?o.call(e,{hash:{},data:n}):o),r||0===r?r:""})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_condition",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t,e){var a,n="";return a=i["if"].call(t,t&&t.mapResponsePoint,{hash:{},inverse:f.program(4,s,e),fn:f.program(2,o,e),data:e}),(a||0===a)&&(n+=a),n}function o(t,e){var a,n,r="";return r+='\n            <mapResponsePoint identifier="',(n=i.response)?a=n.call(t,{hash:{},data:e}):(n=t&&t.response,a=typeof n===u?n.call(t,{hash:{},data:e}):n),r+=m(a)+'" />'}function s(t,e){var a,n,r="";return r+='\n            <mapResponse identifier="',(n=i.response)?a=n.call(t,{hash:{},data:e}):(n=t&&t.response,a=typeof n===u?n.call(t,{hash:{},data:e}):n),r+=m(a)+'" />'}function c(t,e){var a,n,r="";return r+='\n            <variable identifier="',(n=i.outcome)?a=n.call(t,{hash:{},data:e}):(n=t&&t.outcome,a=typeof n===u?n.call(t,{hash:{},data:e}):n),r+=m(a)+'" />'}function l(t){var e,i="";return i+='\n    <responseElse>\n        <setOutcomeValue identifier="'+m((e=t&&t.feedback,e=null==e||e===!1?e:e.outcome,typeof e===u?e.apply(t):e))+'">\n            <baseValue baseType="identifier">'+m((e=t&&t.feedback,e=null==e||e===!1?e:e["else"],typeof e===u?e.apply(t):e))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var d,h,p="",u="function",m=this.escapeExpression,f=this;return p+="<responseCondition>\n    <responseIf>\n        <",(h=i.condition)?d=h.call(e,{hash:{},data:n}):(h=e&&e.condition,d=typeof h===u?h.call(e,{hash:{},data:n}):h),p+=m(d)+">",d=i["if"].call(e,e&&e.response,{hash:{},inverse:f.program(6,c,n),fn:f.program(1,r,n),data:n}),(d||0===d)&&(p+=d),p+='\n            <baseValue baseType="float">',(h=i.comparedValue)?d=h.call(e,{hash:{},data:n}):(h=e&&e.comparedValue,d=typeof h===u?h.call(e,{hash:{},data:n}):h),p+=m(d)+"</baseValue>\n        </",(h=i.condition)?d=h.call(e,{hash:{},data:n}):(h=e&&e.condition,d=typeof h===u?h.call(e,{hash:{},data:n}):h),p+=m(d)+'>\n        <setOutcomeValue identifier="'+m((d=e&&e.feedback,d=null==d||d===!1?d:d.outcome,typeof d===u?d.apply(e):d))+'">\n            <baseValue baseType="identifier">'+m((d=e&&e.feedback,d=null==d||d===!1?d:d.then,typeof d===u?d.apply(e):d))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",d=i["if"].call(e,(d=e&&e.feedback,null==d||d===!1?d:d["else"]),{hash:{},inverse:f.noop,fn:f.program(8,l,n),data:n}),(d||0===d)&&(p+=d),p+="\n</responseCondition>"})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_correct",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e,i="";return i+='\n    <responseElse>\n        <setOutcomeValue identifier="'+d((e=t&&t.feedback,e=null==e||e===!1?e:e.outcome,typeof e===l?e.apply(t):e))+'">\n            <baseValue baseType="identifier">'+d((e=t&&t.feedback,e=null==e||e===!1?e:e["else"],typeof e===l?e.apply(t):e))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier="',(s=i.response)?o=s.call(e,{hash:{},data:n}):(s=e&&e.response,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" />\n            <correct identifier="',(s=i.response)?o=s.call(e,{hash:{},data:n}):(s=e&&e.response,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" />\n        </match>\n        <setOutcomeValue identifier="'+d((o=e&&e.feedback,o=null==o||o===!1?o:o.outcome,typeof o===l?o.apply(e):o))+'">\n            <baseValue baseType="identifier">'+d((o=e&&e.feedback,o=null==o||o===!1?o:o.then,typeof o===l?o.apply(e):o))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",o=i["if"].call(e,(o=e&&e.feedback,null==o||o===!1?o:o["else"]),{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+="\n</responseCondition>"})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_incorrect",["handlebars"],function(t){return t.template(function(t,e,i,a,n){function r(t){var e,i="";return i+='\n    <responseElse>\n        <setOutcomeValue identifier="'+d((e=t&&t.feedback,e=null==e||e===!1?e:e.outcome,typeof e===l?e.apply(t):e))+'">\n            <baseValue baseType="identifier">'+d((e=t&&t.feedback,e=null==e||e===!1?e:e["else"],typeof e===l?e.apply(t):e))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var o,s,c="",l="function",d=this.escapeExpression,h=this;return c+='<responseCondition>\n    <responseIf>\n        <not>\n            <match>\n                <variable identifier="',(s=i.response)?o=s.call(e,{hash:{},data:n}):(s=e&&e.response,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" />\n                <correct identifier="',(s=i.response)?o=s.call(e,{hash:{},data:n}):(s=e&&e.response,o=typeof s===l?s.call(e,{hash:{},data:n}):s),c+=d(o)+'" />\n            </match>\n        </not>\n        <setOutcomeValue identifier="'+d((o=e&&e.feedback,o=null==o||o===!1?o:o.outcome,typeof o===l?o.apply(e):o))+'">\n            <baseValue baseType="identifier">'+d((o=e&&e.feedback,o=null==o||o===!1?o:o.then,typeof o===l?o.apply(e):o))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",o=i["if"].call(e,(o=e&&e.feedback,null==o||o===!1?o:o["else"]),{hash:{},inverse:h.noop,fn:h.program(1,r,n),data:n}),(o||0===o)&&(c+=o),c+="\n</responseCondition>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",["tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_condition","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_correct","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_incorrect"],function(t,e,i,a){return{qtiClass:"_simpleFeedbackRule",template:t,getData:function(t,n){var r=null,o="",s={response:t.comparedOutcome.id(),feedback:{outcome:t.feedbackOutcome.id(),then:t.feedbackThen.id(),"else":t.feedbackElse?t.feedbackElse.id():""}};switch(t.condition){case"correct":r=i;break;case"incorrect":r=a;break;case"lt":case"lte":case"equal":case"gte":case"gt":r=e,s.condition=t.condition,s.comparedValue=t.comparedValue;break;default:throw new Error("unknown condition in simple feedback rule rendering : "+t.condition)}return r&&(o=r(s)),_.merge(n||{},{rule:o})}}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/math-popup",["handlebars"],function(t){return t.template(function(t,e,i,a,n){this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,t.helpers),n=n||{};var r,o,s="",c=i.helperMissing,l=this.escapeExpression;return s+='<div id="item-editor-math-editor" class="sidebar-popup-container-box">\n    <div id="math-editor-container" class="sidebar-popup">\n        <h3 id="math-editor-title">'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"Title",o):c.call(e,"__","Title",o)))+'</h3>\n        <span class="icon-grip-h"></span>\n        <textarea id="math-editor-textarea"></textarea>\n        <a class="closer" href="#" data-close="#math-editor-container"></a>\n    </div>\n    <div class="clearfix">\n\n        <!-- this would be the content of static/math.tpl -->\n        <label>'+l((r=i.__||e&&e.__,o={hash:{},data:n},r?r.call(e,"Label",o):c.call(e,"__","Label",o)))+'</label>\n        <input name="latex" id="math-inp" value="" type="text">\n        <span>…</span>\n\n    </div>\n</div>\n'})});