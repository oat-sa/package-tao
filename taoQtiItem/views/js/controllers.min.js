define("taoQtiItem/controller/routes",[],function(){"use strict";return{QtiPreview:{actions:{index:"taoItems/controller/preview/itemRunner"}},QtiCreator:{actions:{index:"controller/creator/main"}}}}),define("taoQtiItem/qtiCreator/model/helper/event",["jquery","lodash"],function($,_){"use strict";var _ns=".qti-creator",_ns_model=".qti-creator",eventList=["containerBodyChange","containerElementAdded","elementCreated.qti-widget","attributeChange.qti-widget","choiceCreated.qti-widget","correctResponseChange.qti-widget","mapEntryChange.qti-widget","mapEntryRemove.qti-widget","deleted.qti-widget","choiceTextChange.qti-widget","responseTemplateChange.qti-widget","mappingAttributeChange.qti-widget","feedbackRuleConditionChange.qti-widget","feedbackRuleCreated.qti-widget","feedbackRuleRemoved.qti-widget","feedbackRuleElseCreated.qti-widget","feedbackRuleElseRemoved.qti-widget"],event={
choiceCreated:function(choice,interaction){$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:interaction})},deleted:function(element,parent){element.isset()&&element.unset(),$(document).off("."+element.getSerial()),$(document).trigger("deleted.qti-widget",{element:element,parent:parent})},getList:function(addedNamespace){var events=_.clone(eventList);return addedNamespace?_.map(events,function(e){return e+"."+addedNamespace}):events},initElementToWidgetListeners:function(){var ns=".widget-container";$(document).off(ns).on(event.getList(ns).join(" "),function(e,data){var element=data.element||data.container||null;data&&element&&element.data("widget")&&element.data("widget").$container.trigger(e.type+_ns+_ns_model,data);
})},getNs:function(){return _ns},getNsModel:function(){return _ns_model}};return event}),define("taoQtiItem/qtiItem/helper/util",["lodash"],function(_){"use strict";var util={buildSerial:function(prefix){for(var id=prefix||"",chars="abcdefghijklmnopqrstuvwxyz0123456789",i=0;22>i;i++)id+=chars.charAt(Math.floor(Math.random()*chars.length));return id},buildId:function(item,prefix){var id,usedIds,i=1,suffix="",exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");usedIds=item.getUsedIds();do exists=!1,id=prefix+suffix,_.contains(usedIds,id)&&(exists=!0,suffix="_"+i,i++);while(exists);return id},buildIdentifier:function(item,prefix,useSuffix){
var id,usedIds,suffix="",i=1,exists=!1;if(!item)throw new TypeError("A item is required to generate a unique identifier");usedIds=item.getUsedIdentifiers(),useSuffix=_.isUndefined(useSuffix)?!0:useSuffix,prefix?(prefix=prefix.replace(/_[0-9]+$/gi,"_").replace(/[^a-zA-Z0-9_]/gi,"_").replace(/(_)+/gi,"_"),useSuffix&&(suffix="_"+i)):(prefix=this.qtiClass,suffix="_"+i);do exists=!1,id=prefix+suffix,usedIds[id]&&(exists=!0,suffix="_"+i,i++);while(exists);return id},findInCollection:function(element,collectionNames,searchedSerial){var found=null;if(_.isString(collectionNames)&&(collectionNames=[collectionNames]),!_.isArray(collectionNames))throw new Error("invalid argument : collectionNames must be an array or a string");
return _.each(collectionNames,function(collectionName){var collection=element;_.each(collectionName.split("."),function(nameToken){collection=collection[nameToken]});var elt=collection[searchedSerial];return elt?(found={parent:element,element:elt},!1):(_.each(collection,function(elt){return _.isFunction(elt.find)&&(found=elt.find(searchedSerial))?!1:void 0}),found?!1:void 0)}),found},addMarkupNamespace:function(markup,ns){return ns?markup=markup.replace(/<(\/)?([a-z:]+)(\s?)([^><]*)>/g,function($0,$1,$2,$3,$4){return $2.indexOf(":")>0?$0:($1=$1||"",$3=$3||"","<"+$1+ns+":"+$2+$3+$4+">")}):markup},removeMarkupNamespaces:function(markup){return markup.replace(/<(\/)?(\w*):([^>]*)>/g,"<$1$3>");
},getMarkupUsedNamespaces:function(markup){var namespaces=[];return markup.replace(/<(\/)?(\w*):([^>]*)>/g,function(original,slash,ns,node){return namespaces.push(ns),"<"+slash+node+">"}),_.uniq(namespaces)}};return util}),define("taoQtiItem/qtiItem/helper/rendererConfig",["lodash","jquery"],function(_,$){var rendererConfigHelper={};return rendererConfigHelper.getOptionsFromArguments=function(args){var options={data:{},placeholder:null,subclass:"",renderer:null};return _.each(args,function(arg){arg&&(arg.isRenderer?options.renderer=arg:arg instanceof $&&arg.length?options.placeholder=arg:_.isString(arg)?options.subclass=arg:_.isPlainObject(arg)?options.data=arg:console.log("invalid arg",arg,args));
}),options},rendererConfigHelper}),define("taoQtiItem/qtiItem/core/Element",["jquery","lodash","class","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Class,util,rendererConfig){"use strict";var _instances={},Element=Class.extend({qtiClass:"",serial:"",relatedItem:null,init:function(serial,attributes){if(this.attributes={},this.metaData={},"object"==typeof serial&&(attributes=serial,serial=""),serial||(serial=util.buildSerial(this.qtiClass+"_")),serial&&("string"!=typeof serial||!serial.match(/^[a-z_0-9]*$/i)))throw"invalid QTI serial : ("+typeof serial+") "+serial;if(_instances[serial])throw"a QTI Element with the same serial already exists "+serial;
_instances[serial]=this,this.serial=serial,this.setAttributes(attributes||{}),"function"==typeof this.initContainer&&this.initContainer(arguments[2]||""),"function"==typeof this.initObject&&this.initObject()},is:function(qtiClass){return qtiClass===this.qtiClass},placeholder:function(){return"{{"+this.serial+"}}"},getSerial:function(){return this.serial},getUsedIdentifiers:function(){var usedIds={},elts=this.getComposingElements();for(var i in elts){var elt=elts[i],id=elt.attr("identifier");id&&(usedIds[id]=elt)}return usedIds},getUsedIds:function(){var usedIds=[];return _.forEach(this.getComposingElements(),function(elt){var id=elt.attr("id");id&&!_.contains(usedIds,id)&&usedIds.push(id);
}),usedIds},attr:function(name,value){if(name)if(void 0!==value)this.attributes[name]=value;else if("object"==typeof name)for(var prop in name)this.attr(prop,name[prop]);else if("string"==typeof name)return void 0===this.attributes[name]?void 0:this.attributes[name];return this},data:function(name,value){if(name)if(void 0!==value)this.metaData[name]=value,$(document).trigger("metaChange.qti-widget",{element:this,key:name,value:value});else if("object"==typeof name)for(var prop in name)this.data(prop,name[prop]);else if("string"==typeof name)return void 0===this.metaData[name]?void 0:this.metaData[name];return this},removeData:function(name){return delete this.metaData[name],
this},removeAttr:function(name){return this.removeAttributes(name)},setAttributes:function(attributes){return this.attributes=attributes,this},getAttributes:function(){return _.clone(this.attributes)},removeAttributes:function(attrNames){"string"==typeof attrNames&&(attrNames=[attrNames]);for(var i in attrNames)delete this.attributes[attrNames[i]];return this},getComposingElements:function(){function append(element){elts[element.getSerial()]=element,elts=_.extend(elts,element.getComposingElements())}var elts={};return"function"==typeof this.initContainer&&append(this.getBody()),"function"==typeof this.initObject&&append(this.getObject()),_.each(this.metaData,function(v){
Element.isA(v,"_container")?append(v):_.isArray(v)&&_.each(v,function(v){Element.isA(v,"_container")&&append(v)})}),elts},getUsedClasses:function(){var ret=[this.qtiClass],composingElts=this.getComposingElements();return _.each(composingElts,function(elt){ret.push(elt.qtiClass)}),_.uniq(ret)},find:function(serial){var found=null;if("function"==typeof this.initObject){var object=this.getObject();object.serial===serial&&(found={parent:this,element:object,location:"object"})}return found||"function"!=typeof this.initContainer||(found=this.getBody().find(serial,this)),found},parent:function(){var item=this.getRelatedItem();if(item){var found=item.find(this.getSerial());
if(found)return found.parent}return null},setRelatedItem:function(item,recursive){if(recursive="undefined"==typeof recursive?!0:recursive,Element.isA(item,"assessmentItem")){this.relatedItem=item;var composingElts=this.getComposingElements();for(var i in composingElts)composingElts[i].setRelatedItem(item,!1)}},getRelatedItem:function(){var ret=null;return Element.isA(this.relatedItem,"assessmentItem")&&(ret=this.relatedItem),ret},setRenderer:function(renderer){if(!renderer||!renderer.isRenderer)throw"invalid qti rendering engine";this.renderer=renderer;var elts=this.getComposingElements();for(var serial in elts)elts[serial].setRenderer(renderer)},getRenderer:function(){
return this.renderer},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),_renderer=args.renderer||this.getRenderer(),tplData={},defaultData={tag:this.qtiClass,serial:this.serial,attributes:this.getAttributes()};if(!_renderer)throw"render: no renderer found for the element "+this.qtiClass+":"+this.serial;"function"==typeof this.initContainer&&(defaultData.body=this.getBody().render(args.renderer)),"function"==typeof this.initObject&&(defaultData.object={attributes:this.object.getAttributes()},defaultData.object.attributes.data=_renderer.resolveUrl(this.object.attr("data"))),tplData=_.merge(defaultData,args.data||{}),tplData=_renderer.getData(this,tplData,args.subclass);
var rendering=_renderer.renderTpl(this,tplData,args.subclass);return args.placeholder&&args.placeholder.replaceWith(rendering),rendering},postRender:function(data,altClassName,renderer){var postRenderers=[],_renderer=renderer||this.getRenderer();if("function"==typeof this.initContainer&&(postRenderers=this.getBody().postRender({},"",renderer)),!_renderer)throw"postRender: no renderer found for the element "+this.qtiClass+":"+this.serial;return postRenderers.push(_renderer.postRender(this,data,altClassName)),_.compact(postRenderers)},getContainer:function($scope,subclass){var renderer=this.getRenderer();if(renderer)return renderer.getContainer(this,$scope,subclass);
throw"getContainer: no renderer found for the element "+this.qtiClass+":"+this.serial},toArray:function(){var arr={serial:this.serial,type:this.qtiClass,attributes:this.getAttributes()};return"function"==typeof this.initContainer&&(arr.body=this.getBody().toArray()),"function"==typeof this.initObject&&(arr.object=this.object.toArray()),arr},isEmpty:function(){return!1},addClass:function(className){var clazz=this.attr("class")||"";_containClass(clazz,className)||this.attr("class",clazz+(clazz.length?" ":"")+className)},hasClass:function(className){return _containClass(this.attr("class"),className)},removeClass:function(className){var clazz=this.attr("class")||"";
if(clazz){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)");clazz=clazz.replace(regex," ").trim(),clazz?this.attr("class",clazz):this.removeAttr("class")}},toggleClass:function(className,state){return"boolean"==typeof state?state?this.addClass(className):this.removeClass(className):this.hasClass(className)?this.removeClass(className):this.addClass(className)},isset:function(){return Element.issetElement(this.serial)},unset:function(){return Element.unsetElement(this.serial)}}),_containClass=function(allClassStr,className){var regex=new RegExp("(?:^|\\s)"+className+"(?:\\s|$)","");return allClassStr&&regex.test(allClassStr)};return Element.isA=function(qtiElement,qtiClass){
return qtiElement instanceof Element&&qtiElement.is(qtiClass)},Element.getElementBySerial=function(serial){return _instances[serial]},Element.issetElement=function(serial){return!!_instances[serial]},Element.unsetElement=function(serial){var element=Element.getElementBySerial(serial);if(element){var composingElements=element.getComposingElements();return _.each(composingElements,function(elt){delete _instances[elt.serial]}),delete _instances[element.serial],!0}return!1},Element}),define("taoQtiItem/qtiCreator/helper/panel",["jquery","lodash","taoQtiItem/qtiItem/core/Element"],function($,_,Element){"use strict";var _getItemContainer=function(){return $("#item-editor-panel");
},showPanel=function($panel,$fold){$panel.show(),openSections($panel.children("section")),$fold&&$fold.length&&closeSections($fold.children("section"))},initFormVisibilityListener=function(){$(document).off(".panel");var $itemContainer=_getItemContainer(),_staticElements={img:"Image",object:"Media",rubricBlock:"Rubric Block",math:"Math",include:"Shared Stimulus"},$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar"),$formResponsePanel=$("#item-editor-response-property-bar"),$formItemPanel=$("#item-editor-item-property-bar"),$formBodyElementPanel=$("#item-editor-body-element-property-bar"),$formTextBlockPanel=$("#item-editor-text-property-bar"),$formModalFeedbackPanel=$("#item-editor-modal-feedback-property-bar"),$formStylePanel=$("#item-style-editor-bar"),$appearanceToggler=$("#appearance-trigger"),$menuLabel=$appearanceToggler.find(".menu-label"),$itemIcon=$appearanceToggler.find(".icon-item"),$styleIcon=$appearanceToggler.find(".icon-style"),_toggleAppearanceEditor=function(active){
active?($appearanceToggler.addClass("active"),$formStylePanel.show(),$formItemPanel.hide(),$itemContainer.trigger("styleedit"),showPanel($formStylePanel),$menuLabel.text($menuLabel.data("item")),$itemIcon.show(),$styleIcon.hide()):($appearanceToggler.removeClass("active"),$formStylePanel.hide(),showPanel($formItemPanel),$menuLabel.text($menuLabel.data("style")),$itemIcon.hide(),$styleIcon.show())};$appearanceToggler.on("click",function(){_toggleAppearanceEditor($appearanceToggler.hasClass("active")?!1:!0)}),_.delay(function(){showPanel($formItemPanel)},200),$(document).on("afterStateInit.qti-widget.panel",function(e,element,state){switch(state.name){case"active":
_toggleAppearanceEditor(!1),Element.isA(element,"assessmentItem")||$formItemPanel.hide();var label=_staticElements[element.qtiClass];label?($formBodyElementPanel.find("h2").html(label+" Properties"),showPanel($formBodyElementPanel)):"_container"===element.qtiClass&&showPanel($formTextBlockPanel),"modalFeedback"===element.qtiClass&&(showPanel($formModalFeedbackPanel),$formResponsePanel.hide());break;case"question":showPanel($formInteractionPanel);break;case"answer":showPanel($formResponsePanel);break;case"choice":showPanel($formChoicePanel,$formInteractionPanel);break;case"sleep":_staticElements[element.qtiClass]?$formBodyElementPanel.hide():"_container"===element.qtiClass&&$formTextBlockPanel.hide(),
Element.isA(element,"choice")||$itemContainer.find(".widget-box.edit-active").length||showPanel($formItemPanel)}}).on("afterStateExit.qti-widget.panel",function(e,element,state){switch(state.name){case"active":"modalFeedback"===element.qtiClass&&(showPanel($formResponsePanel),$formModalFeedbackPanel.hide());break;case"question":element.is("interaction")&&($formChoicePanel.hide(),$formInteractionPanel.hide());break;case"choice":$formChoicePanel.hide(),showPanel($formInteractionPanel);break;case"answer":$formResponsePanel.hide()}}).on("elementCreated.qti-widget.panel",function(e,data){"_container"===data.element.qtiClass&&enableSubGroup("inline-interactions")}).on("deleted.qti-widget.panel",function(e,data){
"_container"===data.element.qtiClass&&toggleInlineInteractionGroup()})},toggleInlineInteractionGroup=function(){var $itemContainer=_getItemContainer();$itemContainer.find(".widget-textBlock").length?enableSubGroup("inline-interactions"):disableSubGroup("inline-interactions")},heading="h2",section="section",panel="hr, .panel",closed="closed",ns="accordion",initSidebarAccordion=function($sidebar){var $sections=$sidebar.find(section),$allTriggers=($sidebar.children(panel).hide(),$sidebar.find(heading));return 0===$allTriggers.length?!0:($allTriggers.each(function(){var $heading=$(this),$section=$heading.parents(section),$panel=$section.children(panel),$closer=$("<span>",{
"class":"icon-up"}),$opener=$("<span>",{"class":"icon-down"}),action=$panel.is(":visible")?"open":"close";$heading.append($closer).append($opener).addClass(closed),$heading.hasClass("_accordion")||($heading.addClass("_accordion"),$panel.on("panelclose."+ns+" panelopen."+ns,function(e,args){var fn="panelclose"===e.type?"add":"remove";args.heading[fn+"Class"](closed)}),$panel.trigger("panel"+action+"."+ns,{heading:$heading}))}),void $sections.each(function(){$(this).find(heading).on("click",function(e,args){var action,classFn,$heading=$(this),$panel=$heading.parents(section).children(panel),actions=(!(!args||!args.preserveOthers),{close:"hide",open:"fadeIn"}),forceState=args&&args.forceState?args.forceState:!1;
forceState&&(classFn="open"===forceState?"addClass":"removeClass",$heading[classFn](closed)),action=$heading.hasClass(closed)?"open":"close",$panel.trigger("panel"+action+"."+ns,{heading:$heading})[actions[action]]()})}))},_toggleSections=function(sections,preserveOthers,state){sections.each(function(){$(this).find(heading).trigger("click",{preserveOthers:preserveOthers,forceState:state})})},closeSections=function(sections,preserveOthers){_toggleSections(sections,!!preserveOthers,"close")},openSections=function(sections,preserveOthers){_toggleSections(sections,!!preserveOthers,"open")},_toggleSubGroup=function(subGroup,state){if(subGroup=$("."+subGroup),subGroup.length){
var fn="disable"===state?"addClass":"removeClass";subGroup.data("cover")[fn]("blocking")}},enableSubGroup=function(subGroup){_toggleSubGroup(subGroup,"enable")},disableSubGroup=function(subGroup){_toggleSubGroup(subGroup,"disable")};return{initFormVisibilityListener:initFormVisibilityListener,showPanel:showPanel,toggleInlineInteractionGroup:toggleInlineInteractionGroup,initSidebarAccordion:initSidebarAccordion,openSections:openSections,closeSections:closeSections,enableSubGroup:enableSubGroup,disableSubGroup:disableSubGroup}}),define("taoQtiItem/qtiItem/core/qtiClasses",[],function(){return{_container:"taoQtiItem/qtiItem/core/Container",assessmentItem:"taoQtiItem/qtiItem/core/Item",
responseProcessing:"taoQtiItem/qtiItem/core/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",stylesheet:"taoQtiItem/qtiItem/core/Stylesheet",math:"taoQtiItem/qtiItem/core/Math",img:"taoQtiItem/qtiItem/core/Img",object:"taoQtiItem/qtiItem/core/Object",outcomeDeclaration:"taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",responseDeclaration:"taoQtiItem/qtiItem/core/variables/ResponseDeclaration",rubricBlock:"taoQtiItem/qtiItem/core/RubricBlock",associableHotspot:"taoQtiItem/qtiItem/core/choices/AssociableHotspot",gap:"taoQtiItem/qtiItem/core/choices/Gap",gapImg:"taoQtiItem/qtiItem/core/choices/GapImg",gapText:"taoQtiItem/qtiItem/core/choices/GapText",
hotspotChoice:"taoQtiItem/qtiItem/core/choices/HotspotChoice",hottext:"taoQtiItem/qtiItem/core/choices/Hottext",inlineChoice:"taoQtiItem/qtiItem/core/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiItem/core/choices/SimpleChoice",associateInteraction:"taoQtiItem/qtiItem/core/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",endAttemptInteraction:"taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",extendedTextInteraction:"taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",
graphicAssociateInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiItem/core/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiItem/core/interactions/HottextInteraction",inlineChoiceInteraction:"taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiItem/core/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiItem/core/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiItem/core/interactions/OrderInteraction",
prompt:"taoQtiItem/qtiItem/core/interactions/Prompt",selectPointInteraction:"taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiItem/core/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiItem/core/interactions/UploadInteraction",feedbackBlock:"taoQtiItem/qtiItem/core/feedbacks/FeedbackBlock",feedbackInline:"taoQtiItem/qtiItem/core/feedbacks/FeedbackInline",modalFeedback:"taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",customInteraction:"taoQtiItem/qtiItem/core/interactions/CustomInteraction",infoControl:"taoQtiItem/qtiItem/core/PortableInfoControl",
include:"taoQtiItem/qtiItem/core/Include"}}),define("taoQtiItem/qtiItem/core/Loader",["lodash","class","taoQtiItem/qtiItem/core/qtiClasses","taoQtiItem/qtiItem/core/Element"],function(_,Class,qtiClasses,Element){function loadPortableCustomElementData(portableElement,data){portableElement.typeIdentifier=data.typeIdentifier,portableElement.markup=data.markup,portableElement.entryPoint=data.entryPoint,portableElement.properties=data.properties,portableElement.libraries=data.libraries}var Loader=Class.extend({init:function(item,classesLocation){this.qti={},this.classesLocation={},this.item=item||null,this.setClassesLocation(classesLocation||qtiClasses)},setClassesLocation:function(qtiClasses){
return _.extend(this.classesLocation,qtiClasses),this},getRequiredClasses:function(data){var ret=[];for(var i in data)"qtiClass"===i&&"_container"!==data[i]&&"relatedItem"!==i?ret.push(data[i]):"object"==typeof data[i]&&"responseRules"!==i&&(ret=_.union(ret,this.getRequiredClasses(data[i])));return ret},loadRequiredClasses:function(data,callback,reload){var requiredClasses=this.getRequiredClasses(data,reload),required=[];for(var i in requiredClasses){var requiredClass=requiredClasses[i];if(!this.classesLocation[requiredClass])throw new Error("missing qti class location declaration : "+requiredClass);required.push(this.classesLocation[requiredClass])}var _this=this;
require(required,function(){_.each(arguments,function(QtiClass){_this.qti[QtiClass.prototype.qtiClass]=QtiClass}),callback.call(_this,_this.qti)})},getLoadedClasses:function(){return _.keys(this.qti)},loadItemData:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){var i;if("object"==typeof data&&"assessmentItem"===data.qtiClass){data.serial&&Element.unsetElement(data.serial),_this.item=new Qti.assessmentItem(data.serial,data.attributes||{}),_this.loadContainer(_this.item.getBody(),data.body);for(i in data.outcomes){var outcome=_this.buildOutcome(data.outcomes[i]);outcome&&_this.item.addOutcomeDeclaration(outcome)}for(i in data.feedbacks){
var feedback=_this.buildElement(data.feedbacks[i]);feedback&&_this.item.addModalFeedback(feedback)}for(i in data.stylesheets){var stylesheet=_this.buildElement(data.stylesheets[i]);stylesheet&&_this.item.addStylesheet(stylesheet)}for(i in data.responses){var response=_this.buildResponse(data.responses[i]);if(response){_this.item.addResponseDeclaration(response);var feedbackRules=data.responses[i].feedbackRules;feedbackRules&&_.forIn(feedbackRules,function(fbData,serial){response.feedbackRules[serial]=_this.buildSimpleFeedbackRule(fbData,response)})}}data.responseProcessing&&_this.item.setResponseProcessing(_this.buildResponseProcessing(data.responseProcessing)),
_this.item.setNamespaces(data.namespaces),_this.item.setSchemaLocations(data.schemaLocations),_this.item.setApipAccessibility(data.apipAccessibility)}"function"==typeof callback&&callback.call(_this,_this.item)})},loadAndBuildElement:function(data,callback){var _this=this;_this.loadRequiredClasses(data,function(Qti){var element=_this.buildElement(data);"function"==typeof callback&&callback.call(_this,element)})},loadElement:function(element,data,callback){var _this=this;this.loadRequiredClasses(data,function(){_this.loadElementData(element,data),"function"==typeof callback&&callback.call(_this,element)})},loadElements:function(data,callback){var _this=this;if(!_this.item)throw"QtiLoader : cannot load elements in empty item";
this.loadRequiredClasses(data,function(){var allElements=_this.item.getComposingElements();for(var i in data){var elementData=data[i];elementData&&elementData.qtiClass&&elementData.serial&&allElements[elementData.serial]&&_this.loadElementData(allElements[elementData.serial],elementData)}"function"==typeof callback&&callback.call(_this,_this.item)})},buildResponse:function(data){var response=this.buildElement(data);return response.template=data.howMatch||null,response.defaultValue=data.defaultValue||null,response.correctResponse=data.correctResponses||null,_.size(data.mapping)?response.mapEntries=data.mapping:_.size(data.areaMapping)?response.mapEntries=data.areaMapping:response.mapEntries={},
response.mappingAttributes=data.mappingAttributes||{},response},buildSimpleFeedbackRule:function(data,response){var feedbackRule=this.buildElement(data);feedbackRule.setCondition(response,data.condition,data.comparedValue||null),feedbackRule.feedbackOutcome=this.item.outcomes[data.feedbackOutcome]||null,feedbackRule.feedbackThen=this.item.modalFeedbacks[data.feedbackThen]||null,feedbackRule.feedbackElse=this.item.modalFeedbacks[data.feedbackElse]||null;var response=feedbackRule.comparedOutcome;return feedbackRule.feedbackThen&&feedbackRule.feedbackThen.data("relatedResponse",response),feedbackRule.feedbackElse&&feedbackRule.feedbackElse.data("relatedResponse",response),
feedbackRule},buildOutcome:function(data){var outcome=this.buildElement(data);return outcome.defaultValue=data.defaultValue||null,outcome},buildResponseProcessing:function(data){var rp=this.buildElement(data);return data&&data.processingType&&("custom"===data.processingType?(rp.xml=data.data,rp.processingType="custom"):rp.processingType="templateDriven"),rp},loadContainer:function(bodyObject,bodyData){if(!Element.isA(bodyObject,"_container"))throw"bodyObject must be a QTI Container";if(!bodyData||"string"!=typeof bodyData.body||"array"!=typeof bodyData.elements&&"object"!=typeof bodyData.elements)throw"wrong bodydata format";for(var serial in bodyData.elements){
var eltData=bodyData.elements[serial],element=this.buildElement(eltData);element&&bodyObject.setElement(element,bodyData.body)}bodyObject.body(bodyData.body)},buildElement:function(elementData){var elt=null;if(!(elementData&&elementData.qtiClass&&elementData.serial))throw"wrong elementData format";var className=elementData.qtiClass;if(!this.qti[className])throw"the qti element class does not exist: "+className;return elt=new this.qti[className](elementData.serial),this.loadElementData(elt,elementData),elt},loadElementData:function(element,data){var attributes=_.defaults(data.attributes||{},element.attributes||{});return element.setAttributes(attributes),element.body&&data.body&&element.bdy&&this.loadContainer(element.getBody(),data.body),
element.object&&data.object&&element.object&&this.loadObjectData(element.object,data.object),Element.isA(element,"interaction")?this.loadInteractionData(element,data):Element.isA(element,"choice")?this.loadChoiceData(element,data):Element.isA(element,"math")?this.loadMathData(element,data):Element.isA(element,"infoControl")&&this.loadPicData(element,data),element},loadInteractionData:function(interaction,data){Element.isA(interaction,"blockInteraction")&&data.prompt&&this.loadContainer(interaction.prompt.getBody(),data.prompt),this.buildInteractionChoices(interaction,data),Element.isA(interaction,"customInteraction")&&this.loadPciData(interaction,data)},buildInteractionChoices:function(interaction,data){
if(data.choices){if(Element.isA(interaction,"matchInteraction"))for(var set=0;2>set;set++){if(!data.choices[set])throw"missing match set #"+set;var matchSet=data.choices[set];for(var serial in matchSet){var choice=this.buildElement(matchSet[serial]);choice&&interaction.addChoice(choice,set)}}else for(var serial in data.choices){var choice=this.buildElement(data.choices[serial]);choice&&interaction.addChoice(choice)}if(Element.isA(interaction,"graphicGapMatchInteraction")&&data.gapImgs)for(var serial in data.gapImgs){var gapImg=this.buildElement(data.gapImgs[serial]);gapImg&&interaction.addGapImg(gapImg)}}},loadChoiceData:function(choice,data){Element.isA(choice,"textVariableChoice")?choice.val(data.text):Element.isA(choice,"gapImg")||Element.isA(choice,"containerChoice");
},loadObjectData:function(object,data){object.setAttributes(data.attributes),data._alt&&("object"===data._alt.qtiClass?object._alt=Loader.buildElement(data._alt):object._alt=data._alt)},loadMathData:function(math,data){math.ns=data.ns||{},math.setMathML(data.mathML||""),_.forIn(data.annotations||{},function(value,encoding){math.setAnnotation(encoding,value)})},loadPciData:function(pci,data){loadPortableCustomElementData(pci,data)},loadPicData:function(pic,data){loadPortableCustomElementData(pic,data)}});return Loader}),define("taoQtiItem/qtiCreator/model/helper/invalidator",["lodash"],function(_){"use strict";var invalidator={completelyValid:function(element){
var serial,invalidElements,item=element.getRelatedItem();item&&(serial=element.getSerial(),invalidElements=item.data("invalid")||{},delete invalidElements[serial],item.data("invalid",invalidElements))},valid:function(element,key){var invalidElements,item=element.getRelatedItem(),serial=element.getSerial();if(item){if(invalidElements=item.data("invalid")||{},!key)throw new Error('missing required argument "key"');invalidElements[serial]&&invalidElements[serial][key]&&(delete invalidElements[serial][key],_.size(invalidElements[serial])||delete invalidElements[serial],item.data("invalid",invalidElements))}},invalid:function(element,key,message,stateName){var invalidElements,item=element.getRelatedItem(),serial=element.getSerial();
if(item){if(invalidElements=item.data("invalid")||{},!key)throw new Error('missing required arguments "key"');invalidElements[serial]||(invalidElements[serial]={}),invalidElements[serial][key]={message:message||"",stateName:stateName||"active"},item.data("invalid",invalidElements)}},isValid:function(element){var invalidElements,item=element.getRelatedItem(),serial=element.getSerial();return item?(invalidElements=item.data("invalid")||{},!invalidElements[serial]):!0}};return invalidator}),define("taoQtiItem/qtiCreator/model/mixin/editable",["lodash","jquery","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/invalidator","util/url"],function(_,$,Element,event,invalidator,url){
"use strict";var _removeSelf=function(element){var removed=!1,related=element.getRelatedItem();if(!related)throw"no related item found";var found=related.find(element.getSerial());if(found){var parent=found.parent;Element.isA(parent,"interaction")?("gapImg"===element.qtiClass?parent.removeGapImg(element):Element.isA(element,"choice")&&parent.removeChoice(element),removed=!0):"body"===found.location&&_.isFunction(parent.initContainer)?(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.getBody().removeElement(element),removed=!0):Element.isA(parent,"_container")&&(_.isFunction(element.beforeRemove)&&element.beforeRemove(),parent.removeElement(element),
removed=!0),removed&&(element.data("removed",!0),invalidator.completelyValid(element),event.deleted(element,parent))}return removed},_removeElement=function(element,containerPropName,eltToBeRemoved){if(element[containerPropName]){var targetElt,targetSerial="";"string"==typeof eltToBeRemoved?(targetSerial=eltToBeRemoved,targetElt=Element.getElementBySerial[targetSerial]):eltToBeRemoved instanceof Element&&(targetSerial=eltToBeRemoved.getSerial(),targetElt=eltToBeRemoved),targetSerial&&(invalidator.completelyValid(targetElt),delete element[containerPropName][targetSerial],Element.unsetElement(targetSerial))}return element},methods={init:function(serial,attributes){
"object"==typeof serial&&(attributes=serial,serial="");var attr={};_.isFunction(this.getDefaultAttributes)&&_.extend(attr,this.getDefaultAttributes()),_.extend(attr,attributes),this._super(serial,attr)},attr:function(key,value){var ret=this._super(key,value);return void 0!==key&&void 0!==value&&$(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:value}),url.encodeAsXmlAttr(ret)},removeAttr:function(key){var ret=this._super(key);return $(document).trigger("attributeChange.qti-widget",{element:this,key:key,value:null}),ret},remove:function(){if(0===arguments.length)return _removeSelf(this);if(2===arguments.length)return _removeElement(this,arguments[0],arguments[1]);
throw"invalid number of argument given"}};return methods}),define("taoQtiItem/qtiCreator/model/qtiClasses",["lodash","taoQtiItem/qtiItem/core/qtiClasses"],function(_,qtiClasses){"use strict";return _.defaults({assessmentItem:"taoQtiItem/qtiCreator/model/Item",_container:"taoQtiItem/qtiCreator/model/Container",img:"taoQtiItem/qtiCreator/model/Img",math:"taoQtiItem/qtiCreator/model/Math",object:"taoQtiItem/qtiCreator/model/Object",rubricBlock:"taoQtiItem/qtiCreator/model/RubricBlock",modalFeedback:"taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/model/interactions/OrderInteraction",
associateInteraction:"taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",matchInteraction:"taoQtiItem/qtiCreator/model/interactions/MatchInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",simpleChoice:"taoQtiItem/qtiCreator/model/choices/SimpleChoice",simpleAssociableChoice:"taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",inlineChoice:"taoQtiItem/qtiCreator/model/choices/InlineChoice",mediaInteraction:"taoQtiItem/qtiCreator/model/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/model/interactions/UploadInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",
sliderInteraction:"taoQtiItem/qtiCreator/model/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",graphicInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",
hotspotChoice:"taoQtiItem/qtiCreator/model/choices/HotspotChoice",gapImg:"taoQtiItem/qtiCreator/model/choices/GapImg",associableHotspot:"taoQtiItem/qtiCreator/model/choices/AssociableHotspot",gapMatchInteraction:"taoQtiItem/qtiCreator/model/interactions/GapMatchInteraction",hottextInteraction:"taoQtiItem/qtiCreator/model/interactions/HottextInteraction",hottext:"taoQtiItem/qtiCreator/model/choices/Hottext",gapText:"taoQtiItem/qtiCreator/model/choices/GapText",gap:"taoQtiItem/qtiCreator/model/choices/Gap",responseDeclaration:"taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",responseProcessing:"taoQtiItem/qtiCreator/model/ResponseProcessing",customInteraction:"taoQtiItem/qtiCreator/model/interactions/PortableCustomInteraction",
endAttemptInteraction:"taoQtiItem/qtiCreator/model/interactions/EndAttemptInteraction",infoControl:"taoQtiItem/qtiCreator/model/PortableInfoControl",include:"taoQtiItem/qtiCreator/model/Include"},qtiClasses)}),define("taoQtiItem/qtiCreator/model/helper/container",["jquery","lodash","taoQtiItem/qtiCreator/model/qtiClasses"],function($,_,qtiClasses){"use strict";var methods={createElements:function(container,body,callback){var regex=/{{([a-z_]+)\.?([a-z_]*):new}}/gi,required={};body.replace(regex,function(original,qtiClass,subClass){if(!qtiClasses[qtiClass])throw"missing required class : "+qtiClass;required[qtiClass]=qtiClasses[qtiClass]}),require(_.values(required),function(){
var Qti=_.reduce([].slice.call(arguments),function(acc,qtiClassElt){return acc[qtiClassElt.prototype.qtiClass]=qtiClassElt,acc},{}),newElts={},newBody=body.replace(regex,function(original,qtiClass,subClass){if(Qti[qtiClass]){var elt=new Qti[qtiClass];return container.getRenderer()&&elt.setRenderer(container.getRenderer()),newElts[elt.getSerial()]=elt,subClass&&(elt.typeIdentifier=subClass),elt.placeholder()}return original});container.setElements(newElts,newBody);var $doc=$(document);_.each(newElts,function(elt){_.isFunction(elt.buildIdentifier)&&elt.buildIdentifier(),_.isFunction(elt.afterCreate)&&elt.afterCreate(),$doc.trigger("elementCreated.qti-widget",{parent:container.parent(),
element:elt})}),"function"==typeof callback&&callback.call(container,newElts)})}};return methods}),define("taoQtiItem/qtiCreator/model/mixin/editableContainer",["taoQtiItem/qtiCreator/model/helper/container"],function(containerHelper){"use strict";var methods={createElements:function(body,callback){var _this=this;containerHelper.createElements(_this.getBody(),body,function(newElts){callback.call(_this,newElts)})}};return methods}),define("taoQtiItem/qtiItem/core/IdentifiedElement",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/util"],function(Element,util){"use strict";var IdentifiedElement=Element.extend({buildIdentifier:function(prefix,useSuffix){
var item=this.getRelatedItem(),id=util.buildIdentifier(item,prefix,useSuffix);return id&&this.attr("identifier",id),this},id:function(value){return value||this.attr("identifier")||this.buildIdentifier(this.qtiClass,!0),this.attr("identifier",value)}});return IdentifiedElement}),define("taoQtiItem/qtiItem/mixin/Mixin",[],function(){return{augment:function(targetClass,methods,options){if("function"==typeof targetClass&&"object"==typeof methods)for(var methodName in methods)if(Object.hasOwnProperty(targetClass.prototype,methodName)){if(options&&options.append){var _parent=targetClass.prototype[methodName];targetClass.prototype[methodName]=function(){return methods[methodName].apply(this,arguments),
_parent.apply(this,arguments)}}}else targetClass.prototype[methodName]=methods[methodName]}}}),define("taoQtiItem/qtiItem/core/Container",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,Element,rendererConfig){"use strict";var Container=Element.extend({qtiClass:"_container",init:function(body){if(this._super(),body&&"string"!=typeof body)throw"the body of a container must be a string";this.bdy=body||"",this.elements={}},body:function(body){if("undefined"==typeof body)return this.bdy;if("string"!=typeof body)throw"body must be a string";this.bdy=body,$(document).trigger("containerBodyChange",{body:body,
container:this})},setElements:function(elements,body){var returnValue=!1;for(var i in elements){var elt=elements[i];if(!(elt instanceof Element))throw returnValue=!1,"expected a qti element";body=body||this.bdy,-1===body.indexOf(elt.placeholder())&&(body+=elt.placeholder()),elt.setRelatedItem(this.getRelatedItem()||null),this.elements[elt.getSerial()]=elt,$(document).trigger("containerElementAdded",{element:elt,container:this}),returnValue=!0}return this.body(body),returnValue},setElement:function(element,body){return this.setElements([element],body)},removeElement:function(element){var serial="";return"string"==typeof element?serial=element:element instanceof Element&&(serial=element.getSerial()),
delete this.elements[serial],this.body(this.body().replace("{{"+serial+"}}","")),this},getElements:function(qtiClass){var elts={};if("string"==typeof qtiClass)for(var serial in this.elements)Element.isA(this.elements[serial],qtiClass)&&(elts[serial]=this.elements[serial]);else elts=_.clone(this.elements);return elts},getElement:function(serial){return this.elements[serial]?this.elements[serial]:null},getComposingElements:function(){var elements=this.getElements(),elts={};for(var serial in elements)elts[serial]=elements[serial],elts=_.extend(elts,elements[serial].getComposingElements());return elts},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),elementsData=[],tpl=this.body();
for(var serial in this.elements){var elt=this.elements[serial];if("function"!=typeof elt.render)throw"render() is not defined for the qti element: "+serial;"_container"===elt.qtiClass?tpl=tpl.replace(elt.placeholder(),elt.render(renderer)):(tpl=tpl.replace(elt.placeholder(),"{{{"+serial+"}}}"),elementsData[serial]=elt.render(renderer))}if(renderer.isRenderer)return this._super({body:renderer.renderDirect(tpl,elementsData),contentModel:this.contentModel||"flow"},renderer,args.placeholder);throw"invalid qti renderer for qti container"},postRender:function(data,altClassName,renderer){renderer=renderer||this.getRenderer();var res=_(this.elements).filter(function(elt){
return"function"==typeof elt.postRender}).map(function(elt){return elt.postRender(data,"",renderer)}).flatten(!0).value().concat(this._super(data,altClassName,renderer));return res},toArray:function(){var arr={serial:this.serial,body:this.bdy,elements:{}};for(var serial in this.elements)arr.elements[serial]=this.elements[serial].toArray();return arr},find:function(serial,parent){var found=null;return this.elements[serial]?found={parent:parent||this,element:this.elements[serial],location:"body"}:_.each(this.elements,function(elt){return found=elt.find(serial),found?!1:void 0}),found},isEmpty:function(){return!this.bdy}});return Container}),define("taoQtiItem/qtiItem/mixin/Container",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/core/Container"],function(Mixin,Container){
var methods={initContainer:function(body){this.bdy=new Container(body||""),this.bdy.setRelatedItem(this.getRelatedItem()||null),this.bdy.contentModel="blockStatic"},getBody:function(){return this.bdy},body:function(body){var ret=this.bdy.body(body);return body?this:ret},setElement:function(element,body){return this.bdy.setElement(element,body),this},removeElement:function(element){return this.bdy.removeElement(element)},getElements:function(qtiClass){return this.bdy.getElements(qtiClass)},getElement:function(serial){return this.bdy.getElement(serial)}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/mixin/ContainerItemBody",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){
var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="itemBody"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Item",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/ContainerItemBody","lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(Element,IdentifiedElement,Container,_,$,util){"use strict";var Item=IdentifiedElement.extend({qtiClass:"assessmentItem",init:function(serial,attributes){this._super(serial,attributes),
this.relatedItem=this,this.stylesheets={},this.responses={},this.outcomes={},this.modalFeedbacks={},this.namespaces={},this.schemaLocations={},this.responseProcessing=null,this.apipAccessibility=null},getInteractions:function(){var interactions=[],elts=this.getComposingElements();for(var serial in elts)Element.isA(elts[serial],"interaction")&&interactions.push(elts[serial]);return interactions},addResponseDeclaration:function(response){if(!Element.isA(response,"responseDeclaration"))throw"is not a qti response declaration";return response.setRelatedItem(this),this.responses[response.getSerial()]=response,this},getResponseDeclaration:function(identifier){for(var i in this.responses)if(this.responses[i].attr("identifier")===identifier)return this.responses[i];
return null},addOutcomeDeclaration:function(outcome){if(!Element.isA(outcome,"outcomeDeclaration"))throw"is not a qti outcome declaration";return outcome.setRelatedItem(this),this.outcomes[outcome.getSerial()]=outcome,this},addModalFeedback:function(feedback){if(!Element.isA(feedback,"modalFeedback"))throw"is not a qti modal feedback";return feedback.setRelatedItem(this),this.modalFeedbacks[feedback.getSerial()]=feedback,this},getComposingElements:function(){var elts=this._super(),_this=this;return _.each(["responses","outcomes","modalFeedbacks","stylesheets"],function(elementCollection){for(var i in _this[elementCollection]){var elt=_this[elementCollection][i];
elts[i]=elt,elts=_.extend(elts,elt.getComposingElements())}}),this.responseProcessing instanceof Element&&(elts[this.responseProcessing.getSerial()]=this.responseProcessing),elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["responses","outcomes","modalFeedbacks","stylesheets"],serial)),found},getResponses:function(){return _.clone(this.responses)},getRelatedItem:function(){return this},addNamespace:function(name,uri){this.namespaces[name]=uri},setNamespaces:function(namespaces){this.namespaces=namespaces},getNamespaces:function(){return _.clone(this.namespaces)},setSchemaLocations:function(locations){this.schemaLocations=locations;
},getSchemaLocations:function(){return _.clone(this.schemaLocations)},setApipAccessibility:function(apip){this.apipAccessibility=apip||null},getApipAccessibility:function(){return this.apipAccessibility},addStylesheet:function(stylesheet){if(!Element.isA(stylesheet,"stylesheet"))throw"is not a qti stylesheet declaration";return stylesheet.setRelatedItem(this),this.stylesheets[stylesheet.getSerial()]=stylesheet,this},removeStyleSheet:function(stylesheet){return delete this.stylesheets[stylesheet.getSerial()],this},stylesheetExists:function(href){var exists=!1;return _.each(this.stylesheets,function(stylesheet){return stylesheet.attr("href")===href?(exists=!0,!1):void 0;
}),exists},setResponseProcessing:function(rp){if(!Element.isA(rp,"responseProcessing"))throw"is not a response processing";return rp.setRelatedItem(this),this.responseProcessing=rp,this},toArray:function(){var arr=this._super(),toArray=function(elt){return elt.toArray()};return arr.namespaces=this.namespaces,arr.schemaLocations=this.schemaLocations,arr.outcomes=_.map(this.outcomes,toArray),arr.responses=_.map(this.responses,toArray),arr.stylesheets=_.map(this.stylesheets,toArray),arr.modalFeedbacks=_.map(this.modalFeedbacks,toArray),arr.responseProcessing=this.responseProcessing.toArray(),arr},isEmpty:function(){var body=this.body().trim();if(body){var $dummy=$("<div>").html(body),$children=$dummy.children();
return 1===$children.length&&$children.hasClass("empty")?!0:!1}return!0},clear:function(){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.destroy)&&renderer.destroy(this)}});return Container.augment(Item),Item}),define("taoQtiItem/qtiItem/core/Stylesheet",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){var Stylesheet=Element.extend({qtiClass:"stylesheet",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={href:renderer.resolveUrl(this.attr("href"))},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer);
}});return Stylesheet}),define("taoQtiItem/qtiCreator/model/Stylesheet",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Stylesheet"],function(_,editable,Stylesheet){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{href:"css/tao-user-styles.css",title:"",type:"text/css",media:"all"}}}),Stylesheet.extend(methods)}),define("taoQtiItem/qtiItem/core/ResponseProcessing",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){var ResponseProcessing=Element.extend({qtiClass:"responseProcessing",processingType:"",xml:"",toArray:function(){var arr=this._super();
return arr.processingType=this.processingType,arr.xml=this.xml,arr}});return ResponseProcessing}),define("taoQtiItem/qtiCreator/model/ResponseProcessing",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/ResponseProcessing"],function(_,editable,ResponseProcessing){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{}},setProcessingType:function(processingType){this.processingType!==processingType&&("custom"===this.processingType&&_.each(this.getRelatedItem().getResponses(),function(r){r.setTemplate("MATCH_CORRECT")}),this.processingType=processingType)}}),ResponseProcessing.extend(methods);
}),define("taoQtiItem/qtiItem/core/variables/VariableDeclaration",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){var VariableDeclaration=IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes),this.defaultValue=null},is:function(qtiClass){return"variableDeclaration"===qtiClass||this._super(qtiClass)},toArray:function(){var arr=this._super();return arr.defaultValue=this.defaultValue,arr}});return VariableDeclaration}),define("taoQtiItem/qtiItem/core/variables/OutcomeDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration"],function(VariableDeclaration){return VariableDeclaration.extend({
qtiClass:"outcomeDeclaration"})}),define("taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/variables/OutcomeDeclaration"],function(_,editable,OutcomeDeclaration){"use strict";var methods={};return _.extend(methods,editable),OutcomeDeclaration.extend(methods)}),define("taoQtiItem/qtiItem/core/feedbacks/ModalFeedback",["taoQtiItem/qtiItem/core/IdentifiedElement","taoQtiItem/qtiItem/mixin/Container"],function(IdentifiedElement,Container){var ModalFeedback=IdentifiedElement.extend({qtiClass:"modalFeedback",is:function(qtiClass){return"feedback"===qtiClass||this._super(qtiClass);
}});return Container.augment(ModalFeedback),ModalFeedback}),define("taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/feedbacks/ModalFeedback"],function(_,editable,ModalFeedback){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{title:"modal feedback title",showHide:"show"}}}),ModalFeedback.extend(methods)}),define("taoQtiItem/qtiCreator/model/Item",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableContainer","taoQtiItem/qtiItem/core/Item","taoQtiItem/qtiCreator/model/Stylesheet","taoQtiItem/qtiCreator/model/ResponseProcessing","taoQtiItem/qtiCreator/model/variables/OutcomeDeclaration","taoQtiItem/qtiCreator/model/feedbacks/ModalFeedback"],function(_,editable,editableContainer,Item,Stylesheet,ResponseProcessing,OutcomeDeclaration,ModalFeedback){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableContainer),_.extend(methods,{getDefaultAttributes:function(){return{identifier:"myItem_1",title:"Item title",adaptive:!1,timeDependent:!1}},createResponseProcessing:function(){var rp=new ResponseProcessing;return rp.processingType="templateDriven",this.setResponseProcessing(rp),rp},createStyleSheet:function(href){if(href&&_.isString(href)){var stylesheet=new Stylesheet({href:href});return stylesheet.setRenderer(this.getRenderer()),this.addStylesheet(stylesheet),stylesheet}throw'missing or invalid type for the required arg "href"'},createOutcomeDeclaration:function(attributes){
var identifier=attributes.identifier||"";delete attributes.identifier;var outcome=new OutcomeDeclaration(attributes);return this.addOutcomeDeclaration(outcome),outcome.buildIdentifier(identifier),outcome},createModalFeedback:function(attributes,response){var identifier=attributes.identifier||"";delete attributes.identifier;var modalFeedback=new ModalFeedback(attributes);return this.addModalFeedback(modalFeedback),modalFeedback.buildIdentifier(identifier),modalFeedback.body("Some feedback text."),response&&"responseDeclaration"===response.qtiClass&&modalFeedback.data("relatedResponse",response),modalFeedback},deleteResponseDeclaration:function(response){var serial,self=this;
return _.isString(response)?serial=response:response&&"responseDeclaration"===response.qtiClass&&(serial=response.getSerial()),this.responses[serial]&&(_.each(this.responses[serial].feedbackRules,function(rule){var feedbacks=[];rule.feedbackThen&&rule.feedbackThen.is("modalFeedback")&&feedbacks.push(rule.feedbackThen.serial),rule.feedbackElse&&rule.feedbackElse.is("modalFeedback")&&feedbacks.push(rule.feedbackElse.serial),self.modalFeedbacks=_.omit(self.modalFeedbacks,feedbacks),rule.feedbackOutcome&&rule.feedbackOutcome.is("outcomeDeclaration")&&(self.outcomes=_.omit(self.outcomes,rule.feedbackOutcome.serial))}),this.responses=_.omit(this.responses,serial)),
this}}),Item.extend(methods)}),define("taoQtiItem/qtiCreator/helper/itemLoader",["jquery","helpers","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/qtiClasses"],function($,helpers,Loader,Item,qtiClasses){"use strict";var _generateIdentifier=function(uri){var pos=uri.lastIndexOf("#");return uri.substr(pos+1)},creatorLoader={loadItem:function(config,callback){config.uri&&$.ajax({url:helpers._url("getItemData","QtiCreator","taoQtiItem"),dataType:"json",data:{uri:config.uri}}).done(function(data){if(data.itemData&&"assessmentItem"===data.itemData.qtiClass){var loader=(new Loader).setClassesLocation(qtiClasses),itemData=data.itemData;
loader.loadItemData(itemData,function(item){item.isEmpty()&&item.body(""),callback(item,this.getLoadedClasses())})}else{var item=(new Item).id(_generateIdentifier(config.uri)).attr("title",config.label),outcome=item.createOutcomeDeclaration({cardinality:"single",baseType:"float"});outcome.buildIdentifier("SCORE",!1),item.createResponseProcessing(),item.setNamespaces({"":"http://www.imsglobal.org/xsd/imsqti_v2p1",xsi:"http://www.w3.org/2001/XMLSchema-instance",m:"http://www.w3.org/1998/Math/MathML"}),item.setSchemaLocations({"http://www.imsglobal.org/xsd/imsqti_v2p1":"http://www.imsglobal.org/xsd/qti/qtiv2p1/imsqti_v2p1.xsd"}),item.data("new",!0),callback(item);
}})}};return creatorLoader}),define("taoQtiItem/qtiItem/helper/interactionHelper",["lodash","taoQtiItem/qtiItem/core/Element"],function(_,Element){return{convertChoices:function(choices,outputType){var ret=[],_this=this;return _.each(choices,function(c){if(Element.isA(c,"choice"))switch(outputType){case"serial":ret.push(c.getSerial());break;case"identifier":ret.push(c.id());break;default:ret.push(c)}else _.isArray(c)&&ret.push(_this.convertChoices(c,outputType))}),ret},findChoices:function(interaction,choices,inputType){var ret=[],_this=this;return _.each(choices,function(c){var choice;_.isString(c)?"serial"===inputType?(choice=interaction.getChoice(c),choice&&ret.push(choice)):"identifier"===inputType?(choice=interaction.getChoiceByIdentifier(c),
choice&&ret.push(choice)):ret.push(c):_.isArray(c)?ret.push(_this.findChoices(interaction,c,inputType)):ret.push(c)}),ret},shuffleChoices:function(choices){var r=[],f={},j=0;for(var i in choices){if(!Element.isA(choices[i],"choice"))throw"invalid element in array: is not a qti choice";var choice=choices[i];choice.attr("fixed")&&(f[j]=choice),r.push(choice),j++}for(var n=0;n<r.length-1;n++)if(!f[n]){var k=-1;do k=n+Math.floor(Math.random()*(r.length-n));while(f[k]);var tmp=r[k];r[k]=r[n],r[n]=tmp}return r},serialToIdentifier:function(interaction,choiceSerial){var choice=interaction.getChoice(choiceSerial);return choice?choice.id():""}}}),define("taoQtiItem/qtiRunner/core/Renderer",["lodash","jquery","handlebars","core/promise","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/interactionHelper","ui/themeLoader"],function(_,$,Handlebars,Promise,Element,interactionHelper,themeLoader){
"use strict";function getDocumentBaseUrl(){return window.location.protocol+"//"+window.location.host+window.location.pathname.replace(/([^\/]*)$/,"")}var _isValidRenderer=function(renderer){var valid=!0;if("object"!=typeof renderer)return!1;var classCorrect=!1;if(renderer.qtiClass)if(_.indexOf(_renderableClasses,renderer.qtiClass)>=0)classCorrect=!0;else{var pos=renderer.qtiClass.indexOf(".");if(pos>0){var qtiClass=renderer.qtiClass.slice(0,pos),subClass=renderer.qtiClass.slice(pos+1);_renderableSubclasses[qtiClass]&&_.indexOf(_renderableSubclasses[qtiClass],subClass)>=0&&(classCorrect=!0)}}if(!classCorrect)throw valid=!1,new Error("invalid qti class name in renderer declaration : "+renderer.qtiClass);
if(!renderer.template)throw valid=!1,new Error("missing template in renderer declaration : "+renderer.qtiClass);return valid},_renderableClasses=["_container","assessmentItem","stylesheet","responseDeclaration","outcomeDeclaration","responseProcessing","_simpleFeedbackRule","img","math","object","modalFeedback","rubricBlock","associateInteraction","choiceInteraction","extendedTextInteraction","gapMatchInteraction","graphicAssociateInteraction","graphicGapMatchInteraction","graphicOrderInteraction","hotspotInteraction","hottextInteraction","inlineChoiceInteraction","matchInteraction","mediaInteraction","orderInteraction","selectPointInteraction","sliderInteraction","textEntryInteraction","uploadInteraction","endAttemptInteraction","customInteraction","prompt","associableHotspot","gap","gapImg","gapText","hotspotChoice","hottext","inlineChoice","simpleAssociableChoice","simpleChoice","infoControl","include"],_dependencies={
assessmentItem:["stylesheet","_container","prompt","modalFeedback"],rubricBlock:["_container"],associateInteraction:["simpleAssociableChoice"],choiceInteraction:["simpleChoice"],gapMatchInteraction:["gap","gapText"],graphicAssociateInteraction:["associableHotspot"],graphicGapMatchInteraction:["associableHotspot","gapImg"],graphicOrderInteraction:["hotspotChoice"],hotspotInteraction:["hotspotChoice"],hottextInteraction:["hottext"],inlineChoiceInteraction:["inlineChoice"],matchInteraction:["simpleAssociableChoice"],orderInteraction:["simpleChoice"]},_renderableSubclasses={simpleAssociableChoice:["associateInteraction","matchInteraction"],simpleChoice:["choiceInteraction","orderInteraction"]
},_defaults={shuffleChoices:!0},Renderer=function(options){var _locations={},_renderers={};options=_.defaults(options||{},_defaults),this.isRenderer=!0,this.name="",this.shuffledChoices=[];var _getClassRenderer=function(qtiClass){var ret=null;if(_renderers[qtiClass])ret=_renderers[qtiClass];else{var pos=qtiClass.indexOf(".");pos>0&&(qtiClass=qtiClass.slice(0,pos),_renderers[qtiClass]&&(ret=_renderers[qtiClass]))}return ret};this.setOption=function(key,value){return"string"==typeof key&&(options[key]=value),this},this.setOptions=function(opts){return options=_.extend(options,opts),this},this.getOption=function(key){return"string"==typeof key&&options[key]?options[key]:null;
},this.getAssetManager=function(){return options.assetManager},this.getThemeLoader=function(){return this.themeLoader},this.renderTpl=function(element,data,qtiSubclass){var res,ret="",qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass),decorators=this.getOption("decorators");if(!renderer||!_.isFunction(renderer.template))throw new Error("no renderer template loaded under the class name : "+qtiClass);return _.isObject(decorators)&&_.isFunction(decorators.before)&&(res=decorators.before(element,qtiSubclass),_.isString(res)&&(ret+=res)),ret+=renderer.template(data),_.isObject(decorators)&&_.isFunction(decorators.after)&&(res=decorators.after(element,qtiSubclass),
_.isString(res)&&(ret+=res)),ret},this.getData=function(element,data,qtiSubclass){var ret=data,qtiClass=qtiSubclass||element.qtiClass,renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.getData&&(ret=renderer.getData.call(this,element,data)),ret},this.renderDirect=function(tpl,data){return Handlebars.compile(tpl)(data)},this.getContainer=function(qtiElement,$scope,qtiSubclass){var ret=null,qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer found for the class : "+qtiElement.qtiClass;return ret=renderer.getContainer(qtiElement,$scope)},this.postRender=function(qtiElement,data,qtiSubclass){
var qtiClass=qtiSubclass||qtiElement.qtiClass,renderer=_getClassRenderer(qtiClass);return renderer&&"function"==typeof renderer.render?renderer.render.call(this,qtiElement,data):void 0},this.setResponse=function(qtiInteraction,response,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;if("function"==typeof renderer.setResponse){ret=renderer.setResponse.call(this,qtiInteraction,response);var $container=renderer.getContainer.call(this,qtiInteraction);$container instanceof $&&$container.length&&$container.trigger("responseSet",[qtiInteraction,response]);
}return ret},this.getResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.getResponse&&(ret=renderer.getResponse.call(this,qtiInteraction)),ret},this.resetResponse=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return"function"==typeof renderer.resetResponse&&(ret=renderer.resetResponse.call(this,qtiInteraction)),ret},this.getState=function(qtiInteraction,qtiSubclass){
var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return ret=_.isFunction(renderer.getState)?renderer.getState.call(this,qtiInteraction):renderer.getResponse.call(this,qtiInteraction)},this.setState=function(qtiInteraction,state,qtiSubclass){var qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;_.isFunction(renderer.setState)?renderer.setState.call(this,qtiInteraction,state):(renderer.resetResponse.call(this,qtiInteraction),renderer.setResponse.call(this,qtiInteraction,state));
},this.destroy=function(qtiInteraction,qtiSubclass){var ret=!1,qtiClass=qtiSubclass||qtiInteraction.qtiClass,renderer=_getClassRenderer(qtiClass);if(!renderer)throw"no renderer registered under the name : "+qtiClass;return _.isFunction(renderer.destroy)&&(ret=renderer.destroy.call(this,qtiInteraction)),ret},this.getLoadedRenderers=function(){return _renderers},this.register=function(renderersLocations){_.extend(_locations,renderersLocations)},this.load=function(callback,requiredClasses){var self=this,required=[];if(options.themes&&(options.themes.base=this.resolveUrl(options.themes.base),_.forEach(options.themes.available,function(theme,index){options.themes.available[index].path=self.resolveUrl(theme.path);
}),this.themeLoader=themeLoader(options.themes).load()),requiredClasses){if(!_.isArray(requiredClasses))throw new Error('invalid argument type: expected array for arg "requireClasses"');requiredClasses=_.intersection(requiredClasses,_renderableClasses),_.each(requiredClasses,function(reqClass){var deps=_dependencies[reqClass];deps&&(requiredClasses=_.union(requiredClasses,deps))}),_.forEach(requiredClasses,function(qtiClass){if(_renderableSubclasses[qtiClass]){var requiredSubClasses=_.intersection(requiredClasses,_renderableSubclasses[qtiClass]);_.each(requiredSubClasses,function(subclass){if(_locations[qtiClass+"."+subclass])required.push(_locations[qtiClass+"."+subclass]);else{
if(!_locations[qtiClass])throw new Error(self.name+" : missing qti class location declaration: "+qtiClass+", subclass: "+subclass);required.push(_locations[qtiClass])}})}else if(_locations[qtiClass]===!1)_renderers[qtiClass]=!1;else{if(!_locations[qtiClass])throw new Error(self.name+" : missing qti class location declaration: "+qtiClass);required.push(_locations[qtiClass])}})}else required=_.values(_locations);var _this=this;return require(required,function(){_.each(arguments,function(clazz){_isValidRenderer(clazz)&&(_renderers[clazz.qtiClass]=clazz)}),"function"==typeof callback&&callback.call(_this,_renderers)}),this},this.unload=function(){return this.themeLoader&&themeLoader(options.themes).unload(),
this},this.setShuffledChoices=function(interaction,choices,identificationType){Element.isA(interaction,"interaction")&&(this.shuffledChoices[interaction.getSerial()]=_.pluck(interactionHelper.findChoices(interaction,choices,identificationType),"serial"))},this.getShuffledChoices=function(interaction,reshuffle,returnedType){var serial,i,choices=[];if(Element.isA(interaction,"interaction")){if(serial=interaction.getSerial(),!this.shuffledChoices[serial]||reshuffle)if(Element.isA(interaction,"matchInteraction"))for(this.shuffledChoices[serial]=[],i=0;2>i;i++)choices[i]=interactionHelper.shuffleChoices(interaction.getChoices(i)),this.shuffledChoices[serial][i]=_.pluck(choices[i],"serial");else choices=interactionHelper.shuffleChoices(interaction.getChoices()),
this.shuffledChoices[serial]=_.pluck(choices,"serial");else Element.isA(interaction,"matchInteraction")?_.forEach(choices,function(choice,index){2>index&&_.forEach(this.shuffledChoices[serial][i],function(choiceSerial){choice.push(interaction.getChoice(choiceSerial))})}):_.forEach(this.shuffledChoices[serial],function(choiceSerial){choices.push(interaction.getChoice(choiceSerial))});return"serial"===returnedType||"identifier"===returnedType?interactionHelper.convertChoices(choices,returnedType):_.clone(choices)}return[]},this.getRenderers=function(){return _renderers},this.getLocations=function(){return _locations},this.resolveUrl=function(url){return options.assetManager?"string"==typeof url&&url.length>0?options.assetManager.resolve(url):void 0:url;
},this.getAbsoluteUrl=function(relUrl){if(console.warn("DEPRECATED used getAbsoluteUrl with ",arguments),this.getOption("userRelativeUrl"))return relUrl.replace(/^\.?\//,"");if(/^http(s)?:\/\//i.test(relUrl)||/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/.test(relUrl))return relUrl;var absUrl="",runtimeLocations=this.getOption("runtimeLocations");if(runtimeLocations&&_.size(runtimeLocations)&&_.forIn(runtimeLocations,function(runtimeLocation,typeIdentifier){return 0===relUrl.indexOf(typeIdentifier)?(absUrl=relUrl.replace(typeIdentifier,runtimeLocation),!1):void 0}),absUrl)return absUrl;var baseUrl=this.getOption("baseUrl")||getDocumentBaseUrl();return baseUrl+relUrl;
}};return{build:function(renderersLocations,name,defaultOptions){var NewRenderer=function(){var options=_.isPlainObject(arguments[0])?arguments[0]:{};Renderer.apply(this),this.register(renderersLocations),this.name=name||"",this.setOptions(_.defaults(options,defaultOptions||{}))};return NewRenderer.prototype=Renderer.prototype,NewRenderer}}}),define("taoItems/assets/manager",["lodash","util/url"],function(_,urlUtil){"use strict";var assetManagerFactory=function(strategies,data,options){var cache={};strategies=_.isArray(strategies)?strategies:[strategies],data=data||{},options=_.defaults(options||{},{parseUrl:!0});var assetManager={_strategies:[],addStrategy:function(strategy){
if(!_.isPlainObject(strategy)||!_.isFunction(strategy.handle)||!_.isString(strategy.name))throw new TypeError("An asset resolution strategy is an object with a handle method and a name");this._strategies.push(strategy)},setStrategies:function(newStrategies){var self=this;this._strategies=[],_.forEach(newStrategies,function(strategy){_.isPlainObject(strategy)?assetManager.addStrategy(strategy):_.isFunction(strategy)&&self.addStrategy({name:"strategy_"+(self._strategies.length+1),handle:strategy})})},setData:function(key,value){_.isString(key)&&"undefined"!=typeof value?data[key]=value:_.isPlainObject(key)&&(data=key)},getData:function(key){return _.isString(key)?data[key]:data;
},resolve:function(url){var resolved,inputUrl;return options.cache&&cache.hasOwnProperty(url)?cache[url]:(inputUrl=options.parseUrl?urlUtil.parse(url):url,_.forEach(this._strategies,function(strategy){var result=strategy.handle(inputUrl,data);return result?(resolved=result,!1):void 0}),resolved=resolved||"",options.cache&&(cache[url]=resolved),resolved)},resolveBy:function(name,url){var inputUrl,resolved="",strategy=_.find(this._strategies,{name:name});return strategy&&(inputUrl=options.parseUrl?urlUtil.parse(url):url,resolved=strategy.handle(inputUrl,data)),resolved},clearCache:function(){options.cache&&(cache={})}};return assetManager.setStrategies(strategies),
assetManager};return assetManagerFactory}),define("taoItems/assets/strategies",["util/url"],function(urlUtil){"use strict";var strategies={baseUrl:{name:"baseUrl",handle:function(url,data){return"string"==typeof data.baseUrl&&urlUtil.isRelative(url)?data.slashcat===!0?data.baseUrl.replace(/\/$/,"")+"/"+url.directory.replace(/^\.\//,"").replace(/^\//,"")+encodeURIComponent(url.file.replace(/^\.\//,"").replace(/^\//,"")):data.baseUrl+url.directory.replace(/^\.?\//,"")+encodeURIComponent(url.file.replace(/^\.?\//,"")):void 0}},external:{name:"external",handle:function(url,data){return urlUtil.isAbsolute(url)?url.toString():void 0}},base64:{name:"base64",handle:function(url){
return urlUtil.isBase64(url)?url.toString():void 0}},taomedia:{name:"taomedia",handle:function(url,data){var baseUrl=data.baseUrl||"./";return"object"==typeof url&&"taomedia"===url.protocol||/^taomedia:\/\//.test(url.toString())?baseUrl+url.toString():void 0}}};return strategies}),define("taoQtiItem/qtiCommonRenderer/renderers/config",["lodash","context","ui/themes","taoItems/assets/manager","taoItems/assets/strategies"],function(_,context,themes,assetManagerFactory,assetStrategies){"use strict";var itemThemes=themes.get("items"),portableAssetStrategy={name:"portableElementLocation",handle:function(url){return url.source===url.relative?window.location.pathname.replace(/([^\/]*)$/,"")+url.toString()+"/":void 0;
}},assetManager=assetManagerFactory([{name:"theme",handle:function(url){return itemThemes&&url.path&&(url.path===itemThemes.base||_.contains(_.pluck(itemThemes.available,"path"),url.path))?context.root_url+url.toString():void 0}},assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl,portableAssetStrategy],{baseUrl:""}),locations={assessmentItem:"taoQtiItem/qtiCommonRenderer/renderers/Item",_container:"taoQtiItem/qtiCommonRenderer/renderers/Container",_simpleFeedbackRule:!1,stylesheet:"taoQtiItem/qtiCommonRenderer/renderers/Stylesheet",outcomeDeclaration:!1,responseDeclaration:!1,responseProcessing:!1,img:"taoQtiItem/qtiCommonRenderer/renderers/Img",
math:"taoQtiItem/qtiCommonRenderer/renderers/Math",object:"taoQtiItem/qtiCommonRenderer/renderers/Object",rubricBlock:"taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",modalFeedback:"taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",prompt:"taoQtiItem/qtiCommonRenderer/renderers/interactions/Prompt",choiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",extendedTextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",orderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",associateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",
matchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",textEntryInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",sliderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",hottext:"taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",gap:"taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",
gapText:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",inlineChoice:"taoQtiItem/qtiCommonRenderer/renderers/choices/InlineChoice",hottextInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",hotspotInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",hotspotChoice:!1,gapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",
selectPointInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",mediaInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",gapImg:"taoQtiItem/qtiCommonRenderer/renderers/choices/GapImg",graphicAssociateInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",associableHotspot:!1,
customInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",infoControl:"taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiCommonRenderer/renderers/Include",endAttemptInteraction:"taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction"};return{name:"commonRenderer",locations:locations,options:{assetManager:assetManager,themes:itemThemes}}}),define("taoQtiItem/qtiCreator/renderers/config",["lodash","context","taoQtiItem/qtiCommonRenderer/renderers/config","taoItems/assets/manager","taoItems/assets/strategies"],function(_,context,commonRenderConfig,assetManagerFactory,assetStrategies){
"use strict";var assetManager=assetManagerFactory([assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl],{baseUrl:""}),locations=_.defaults({_container:"taoQtiItem/qtiCreator/renderers/Container",assessmentItem:"taoQtiItem/qtiCreator/renderers/Item",rubricBlock:"taoQtiItem/qtiCreator/renderers/RubricBlock",img:"taoQtiItem/qtiCreator/renderers/Img",math:"taoQtiItem/qtiCreator/renderers/Math",object:"taoQtiItem/qtiCreator/renderers/Object",modalFeedback:"taoQtiItem/qtiCreator/renderers/ModalFeedback",choiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",orderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",
matchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",associateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",inlineChoiceInteraction:"taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",textEntryInteraction:"taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",hotspotInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",selectPointInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",graphicOrderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",graphicAssociateInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",
graphicGapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",mediaInteraction:"taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",uploadInteraction:"taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",sliderInteraction:"taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",extendedTextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction","simpleChoice.choiceInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction","simpleChoice.orderInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction","simpleAssociableChoice.associateInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction",
"simpleAssociableChoice.matchInteraction":"taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",gapMatchInteraction:"taoQtiItem/qtiCreator/renderers/interactions/GapMatchInteraction",hottextInteraction:"taoQtiItem/qtiCreator/renderers/interactions/HottextInteraction",customInteraction:"taoQtiItem/qtiCreator/renderers/interactions/PortableCustomInteraction",endAttemptInteraction:"taoQtiItem/qtiCreator/renderers/interactions/EndAttemptInteraction",infoControl:"taoQtiItem/qtiCreator/renderers/PortableInfoControl",include:"taoQtiItem/qtiCreator/renderers/Include",gap:"taoQtiItem/qtiCreator/renderers/choices/Gap",gapText:"taoQtiItem/qtiCreator/renderers/choices/GapText",
hottext:"taoQtiItem/qtiCreator/renderers/choices/Hottext"},commonRenderConfig.locations);return{name:"creatorRenderer",locations:locations,options:{assetManager:assetManager}}}),define("taoQtiItem/qtiCreator/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCreator/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoQtiItem/qtiCreator/helper/creatorRenderer",["jquery","lodash","taoQtiItem/qtiCreator/renderers/Renderer","taoItems/assets/manager","taoItems/assets/strategies","helpers","util/dom"],function($,_,Renderer,assetManagerFactory,assetStrategies,helpers,dom){
"use strict";function _extractInteractionsConfig(config){var ret={};return config&&config.properties&&_.each(_configurableInteractions,function(interactionName){config.properties[interactionName]&&(ret[interactionName]=config.properties[interactionName])}),ret}var _creatorRenderer=null,_configurableInteractions=["endAttempt"],get=function(reset,config){var $bodyEltForm;return(!_creatorRenderer||reset)&&($bodyEltForm=_creatorRenderer?_creatorRenderer.getOption("bodyElementOptionForm"):null,!reset&&$bodyEltForm&&$bodyEltForm.length&&dom.contains($bodyEltForm)||(_creatorRenderer=new Renderer({lang:"",uri:"",shuffleChoices:!1,itemOptionForm:$("#item-editor-item-property-bar .panel"),
interactionOptionForm:$("#item-editor-interaction-property-bar .panel"),choiceOptionForm:$("#item-editor-choice-property-bar .panel"),responseOptionForm:$("#item-editor-response-property-bar .panel"),bodyElementOptionForm:$("#item-editor-body-element-property-bar .panel"),textOptionForm:$("#item-editor-text-property-bar .panel"),modalFeedbackOptionForm:$("#item-editor-modal-feedback-property-bar .panel"),mediaManager:{appendContainer:"#mediaManager",browseUrl:helpers._url("files","ItemContent","taoItems"),uploadUrl:helpers._url("upload","ItemContent","taoItems"),deleteUrl:helpers._url("delete","ItemContent","taoItems"),downloadUrl:helpers._url("download","ItemContent","taoItems"),
fileExistsUrl:helpers._url("fileExists","ItemContent","taoItems"),mediaSourcesUrl:config.properties.mediaSourcesUrl},interactions:_extractInteractionsConfig(config)}),_creatorRenderer.getAssetManager().setData({baseUrl:config.properties.baseUrl||""}))),_creatorRenderer};return{get:function(reset,config){return get(reset,config)},setOption:function(name,value){return get().setOption(name,value)},setOptions:function(options){return get().setOptions(options)},load:function(qtiClasses,done){return get().load(function(){_.isFunction(done)&&done.apply(this,arguments)},qtiClasses)}}}),define("taoQtiItem/qtiCommonRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiCommonRenderer/renderers/config"],function(Renderer,config){
"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoQtiItem/qtiCommonRenderer/helpers/container",["lodash","jquery","taoQtiItem/qtiItem/core/Element"],function(_,$,Element){"use strict";var _containers={},_$containerContext=$(),_getSelector=function(element){var serial=element.getSerial(),selector="[data-serial="+serial+"]";return Element.isA(element,"choice")?selector=".qti-choice"+selector:Element.isA(element,"interaction")&&(selector=".qti-interaction"+selector),selector},containerHelper={setContext:function($scope){_$containerContext=$scope},get:function(element,$scope){var serial=element.getSerial();return $scope instanceof $&&$scope.length?$scope.find(_getSelector(element)):_$containerContext instanceof $&&_$containerContext.length?_$containerContext.find(_getSelector(element)):(_containers[serial]&&_containers[serial].length||(_containers[serial]=$(_getSelector(element))),
_containers[serial])},reset:function(element){element instanceof Element&&_containers[element.getSerial()]&&(_containers=_.omit(_containers,element.getSerial()))},clear:function(){_containers={},_$containerContext=$()},trigger:function(eventType,element,data){eventType&&(data&&!_.isArray(data)&&(data=[data]),this.get(element).trigger(eventType,data))},triggerResponseChangeEvent:function(interaction,extraData){this.trigger("responseChange",interaction,[{interaction:interaction,response:interaction.getResponse()},extraData])},targetBlank:function($container){$container.on("click","a",function(e){e.preventDefault();var href=$(this).attr("href");href&&href.match(/^http/i)&&window.open(href,"_blank");
})}};return containerHelper}),define("taoQtiItem/qtiCreator/helper/commonRenderer",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Renderer","taoQtiItem/qtiCommonRenderer/helpers/container"],function(_,Renderer,containerHelper){"use strict";var _$previousContext=null,_renderer=new Renderer({shuffleChoices:!0}),commonRenderer={render:function(item,$container){return commonRenderer.setContext($container),_renderer.load(function(){$container.append(item.render(this)),item.postRender({},"",this)},item.getUsedClasses())},get:function(){return _renderer},setOption:function(name,value){return _renderer.setOption(name,value)},setOptions:function(options){return _renderer.setOptions(options);
},setContext:function($context){return _$previousContext=$context,containerHelper.setContext($context)},restoreContext:function(){containerHelper.setContext(_$previousContext),_$previousContext=null},load:function(qtiClasses,done){return _renderer.load(function(){_.isFunction(done)&&done.apply(this,arguments)},qtiClasses)}};return commonRenderer}),define("taoQtiItem/qtiCreator/helper/qtiElements",["jquery","lodash","i18n"],function($,_,__){"use strict";var QtiElements={};return QtiElements.classes={itemBody:{parents:["bodyElement"],contains:["block"],"abstract":!0},atomicBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["inline"],"abstract":!0
},atomicInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],"abstract":!0},simpleBlock:{parents:["blockStatic","bodyElement","flowStatic"],contains:["block"],"abstract":!0},simpleInline:{parents:["bodyElement","flowStatic","inlineStatic"],contains:["inline"],"abstract":!0},flowStatic:{parents:["flow"],"abstract":!0},blockStatic:{parents:["block"],"abstract":!0},inlineStatic:{parents:["inline"],"abstract":!0},flow:{parents:["objectFlow"],"abstract":!0},tableCell:{parents:["bodyElement"],contains:["flow"],"abstract":!0},caption:{parents:["bodyElement"],contains:["inline"],xhtml:!0},col:{parents:["bodyElement"],xhtml:!0},colgroup:{parents:["bodyElement"],
contains:["col"],xhtml:!0},div:{parents:["blockStatic","bodyElement","flowStatic"],contains:["flow"],xhtml:!0},dl:{parents:["blockStatic","bodyElement","flowStatic"],contains:["dlElement"],xhtml:!0},dt:{parents:["dlElement"],contains:["inline"],xhtml:!0},dd:{parents:["dlElement"],contains:["flow"],xhtml:!0},hr:{parents:["blockStatic","bodyElement","flowStatic"],xhtml:!0},math:{parents:["blockStatic","flowStatic","inlineStatic"],xhtml:!0},li:{parents:["bodyElement"],contains:["flow"],xhtml:!0},ol:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},ul:{parents:["blockStatic","bodyElement","flowStatic"],contains:["li"],xhtml:!0},object:{
parents:["bodyElement","flowStatic","inlineStatic"],contains:["objectFlow"],xhtml:!0},param:{parents:["objectFlow"],xhtml:!0},table:{parents:["blockStatic","bodyElement","flowStatic"],contains:["caption","col","colgroup","thead","tfoot","tbody"],xhtml:!0},tbody:{parents:["bodyElement"],contains:["tr"],xhtml:!0},tfoot:{parents:["bodyElement"],contains:["tr"],xhtml:!0},thead:{parents:["bodyElement"],contains:["tr"],xhtml:!0},td:{parents:["tableCell"],xhtml:!0},th:{parents:["tableCell"],xhtml:!0},tr:{parents:["bodyElement"],contains:["tableCell"],xhtml:!0},a:{parents:["simpleInline"],xhtml:!0},abbr:{parents:["simpleInline"],xhtml:!0},acronym:{parents:["simpleInline"],
xhtml:!0},b:{parents:["simpleInline"],xhtml:!0},big:{parents:["simpleInline"],xhtml:!0},cite:{parents:["simpleInline"],xhtml:!0},code:{parents:["simpleInline"],xhtml:!0},dfn:{parents:["simpleInline"],xhtml:!0},em:{parents:["simpleInline"],xhtml:!0},i:{parents:["simpleInline"],xhtml:!0},kbd:{parents:["simpleInline"],xhtml:!0},q:{parents:["simpleInline"],xhtml:!0},samp:{parents:["simpleInline"],xhtml:!0},small:{parents:["simpleInline"],xhtml:!0},span:{parents:["simpleInline"],xhtml:!0},strong:{parents:["simpleInline"],xhtml:!0},sub:{parents:["simpleInline"],xhtml:!0},sup:{parents:["simpleInline"],xhtml:!0},tt:{parents:["simpleInline"],xhtml:!0},"var":{parents:["simpleInline"],
xhtml:!0},blockquote:{parents:["simpleBlock"],xhtml:!0},address:{parents:["atomicBlock"],xhtml:!0},h1:{parents:["atomicBlock"],xhtml:!0},h2:{parents:["atomicBlock"],xhtml:!0},h3:{parents:["atomicBlock"],xhtml:!0},h4:{parents:["atomicBlock"],xhtml:!0},h5:{parents:["atomicBlock"],xhtml:!0},h6:{parents:["atomicBlock"],xhtml:!0},p:{parents:["atomicBlock"],xhtml:!0},pre:{parents:["atomicBlock"],xhtml:!0},img:{parents:["atomicInline"],xhtml:!0,attributes:["src","alt","longdesc","height","width"]},br:{parents:["atomicInline"],xhtml:!0},infoControl:{parents:["blockStatic","bodyElement","flowStatic"],qti:!0},textRun:{parents:["inlineStatic","flowstatic"],qti:!0},feedbackInline:{
parents:["simpleInline","feedbackElement"],qti:!0},feedbackBlock:{parents:["simpleBlock"],qti:!0},rubricBlock:{parents:["simpleBlock"],qti:!0},blockInteraction:{parents:["block","flow","interaction"],qti:!0},inlineInteraction:{parents:["inline","flow","interaction"],qti:!0},gap:{parents:["inlineStatic"],qti:!0},hottext:{parents:["flowstatic","inlineStatic"],contains:["inlineStatic"],qti:!0},printedVariable:{parents:["bodyElement","flowStatic","inlineStatic","textOrVariable"],qti:!0},prompt:{parents:["bodyElement"],contains:["inlineStatic"],qti:!0},templateElement:{parents:["bodyElement"],qti:!0},templateBlock:{parents:["blockStatic","flowStatic","templateElement"],
contains:["blockStatic"],qti:!0},templateInline:{parents:["inlineStatic","flowStatic","templateElement"],contains:["inlineStatic"],qti:!0},choiceInteraction:{parents:["blockInteraction"],qti:!0},associateInteraction:{parents:["blockInteraction"],qti:!0},orderInteraction:{parents:["blockInteraction"],qti:!0},matchInteraction:{parents:["blockInteraction"],qti:!0},hottextInteraction:{parents:["blockInteraction"],qti:!0},gapMatchInteraction:{parents:["blockInteraction"],qti:!0},mediaInteraction:{parents:["blockInteraction"],qti:!0},sliderInteraction:{parents:["blockInteraction"],qti:!0},uploadInteraction:{parents:["blockInteraction"],qti:!0},drawingInteraction:{parents:["blockInteraction"],
qti:!0},graphicInteraction:{parents:["blockInteraction"],qti:!0},hotspotInteraction:{parents:["graphicInteraction"],qti:!0},graphicAssociateInteraction:{parents:["graphicInteraction"],qti:!0},graphicOrderInteraction:{parents:["graphicInteraction"],qti:!0},graphicGapMatchInteraction:{parents:["graphicInteraction"],qti:!0},selectPointInteraction:{parents:["graphicInteraction"],qti:!0},textEntryInteraction:{parents:["stringInteraction","inlineInteraction"],qti:!0},extendedTextInteraction:{parents:["stringInteraction","blockInteraction"],qti:!0},inlineChoiceInteraction:{parents:["inlineInteraction"],qti:!0},endAttemptInteraction:{parents:["inlineInteraction"],qti:!0
},customInteraction:{parents:["block","flow","interaction"],qti:!0},_container:{parents:["block"],qti:!0}},QtiElements.cache={containable:{},children:{},parents:{}},QtiElements.getAllowedContainersElements=function(qtiClass,$container){var classes=QtiElements.getAllowedContainers(qtiClass),jqSelector="";for(var i in classes)classes[i].qti||(jqSelector+=classes[i]+", ");return jqSelector&&(jqSelector=jqSelector.substring(0,jqSelector.length-2)),$(jqSelector,$container?$container:$(document)).filter(":not([data-qti-type])")},QtiElements.getAllowedContainers=function(qtiClass){if(QtiElements.cache.containable[qtiClass])var ret=QtiElements.cache.containable[qtiClass];else{
var ret=[],parents=QtiElements.getParentClasses(qtiClass,!0);for(var aClass in QtiElements.classes){var model=QtiElements.classes[aClass];if(model.contains){var intersect=_.intersection(model.contains,parents);intersect.length&&(model["abstract"]||ret.push(aClass),ret=_.union(ret,QtiElements.getChildClasses(aClass,!0)))}}QtiElements.cache.containable[qtiClass]=ret}return ret},QtiElements.getAllowedContents=function(qtiClass,recursive,checked){var ret=[];checked=checked||{};var model=QtiElements.classes[qtiClass];if(model&&model.contains)for(var i in model.contains){var contain=model.contains[i];if(!checked[contain]){checked[contain]=!0,ret.push(contain);var children=QtiElements.getChildClasses(contain,!0);
for(var i in children){var child=children[i];checked[child]||(checked[child]=!0,ret.push(child),recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(child,!0,checked))))}recursive&&(ret=_.union(ret,QtiElements.getAllowedContents(contain,!0,checked)))}}var parents=QtiElements.getParentClasses(qtiClass,!0);for(var i in parents)ret=_.union(ret,QtiElements.getAllowedContents(parents[i],recursive,checked));return _.uniq(ret,!1)},QtiElements.isAllowedClass=function(qtiContainerClass,qtiContentClass){var allowedClasses=QtiElements.getAllowedContents(qtiContainerClass);return _.indexOf(allowedClasses,qtiContentClass)>=0},QtiElements.getParentClasses=function(qtiClass,recursive){
if(recursive&&QtiElements.cache.parents[qtiClass])var ret=QtiElements.cache.parents[qtiClass];else{var ret=[];if(QtiElements.classes[qtiClass]&&(ret=QtiElements.classes[qtiClass].parents,recursive)){for(var i in ret)ret=_.union(ret,QtiElements.getParentClasses(ret[i],recursive));ret=_.uniq(ret,!1)}QtiElements.cache.parents[qtiClass]=ret}return ret},QtiElements.getChildClasses=function(qtiClass,recursive,type){var cacheType=type?type:"all";if(recursive&&QtiElements.cache.children[qtiClass]&&QtiElements.cache.children[qtiClass][cacheType])var ret=QtiElements.cache.children[qtiClass][cacheType];else{var ret=[];for(var aClass in QtiElements.classes){var model=QtiElements.classes[aClass];
_.indexOf(model.parents,qtiClass)>=0&&(type?model[type]&&ret.push(aClass):ret.push(aClass),recursive&&(ret=_.union(ret,QtiElements.getChildClasses(aClass,recursive,type))))}QtiElements.cache.children[qtiClass]||(QtiElements.cache.children[qtiClass]={}),QtiElements.cache.children[qtiClass][cacheType]=ret}return ret},QtiElements.isBlock=function(qtiClass){return QtiElements.is(qtiClass,"block")},QtiElements.isInline=function(qtiClass){return QtiElements.is(qtiClass,"inline")},QtiElements.is=function(qtiClass,topClass){if(qtiClass===topClass)return!0;var parents=QtiElements.getParentClasses(qtiClass,!0);return _.indexOf(parents,topClass)>=0},QtiElements.getAvailableAuthoringElements=function(){
return{choiceInteraction:{label:__("Choice Interaction"),description:__("Select a single (radio buttons) or multiple (check boxes) responses among a set of choices."),icon:"icon-choice","short":__("Choice"),qtiClass:"choiceInteraction",tags:["Common Interactions","mcq"]},orderInteraction:{label:__("Order Interaction"),icon:"icon-order",description:__("Arrange a list of choices in the correct order."),"short":__("Order"),qtiClass:"orderInteraction",tags:["Common Interactions","ordering"]},associateInteraction:{label:__("Associate Interaction"),icon:"icon-associate",description:__("Create pair(s) from a series of choices."),"short":__("Associate"),qtiClass:"associateInteraction",
tags:["Common Interactions","association"]},matchInteraction:{label:__("Match Interaction"),icon:"icon-match",description:__("Create association(s) between two sets of choices displayed in a table (row and column)."),"short":__("Match"),qtiClass:"matchInteraction",tags:["Common Interactions","association"]},hottextInteraction:{label:__("Hottext Interaction"),icon:"icon-hottext",description:__("Select one or more text parts (hottext) within a text."),"short":__("Hottext"),qtiClass:"hottextInteraction",tags:["Common Interactions","text"]},gapMatchInteraction:{label:__("Gap Match Interaction"),icon:"icon-gap-match",description:__(" Fill in the gaps in a text from a set of choices."),
"short":__("Gap Match"),qtiClass:"gapMatchInteraction",tags:["Common Interactions","text","association"]},sliderInteraction:{label:__("Slider Interaction"),icon:"icon-slider",description:__("Select a value within a numerical range."),"short":__("Slider"),qtiClass:"sliderInteraction",tags:["Common Interactions","special"]},extendedTextInteraction:{label:__("Extended Text Interaction"),icon:"icon-extended-text",description:__("Collect open-ended information in one or more text area(s) (strings or numeric values)."),"short":__("Extended Text"),qtiClass:"extendedTextInteraction",tags:["Common Interactions","text"]},uploadInteraction:{label:__("File Upload Interaction"),
icon:"icon-upload",description:__("Upload a file (e.g. document, picture...) as a response."),"short":__("File Upload"),qtiClass:"uploadInteraction",tags:["Common Interactions","special"]},mediaInteraction:{label:__("Media Interaction"),icon:"icon-media",description:__("Control the playing parameters (auto-start, loop) of a video or audio file and report the number of time it has been played."),"short":__("Media"),qtiClass:"mediaInteraction",tags:["Common Interactions","media"]},_container:{label:__("Text Block"),icon:"icon-font",description:__("Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions."),
"short":__("Block"),qtiClass:"_container",tags:["Inline Interactions","text"]},inlineChoiceInteraction:{label:__("Inline Choice Interaction"),icon:"icon-inline-choice",description:__("Select a choice from a drop-down list."),"short":__("Inline Choice"),qtiClass:"inlineChoiceInteraction",tags:["Inline Interactions","inline-interactions","mcq"]},textEntryInteraction:{label:__("Text Entry Interaction"),icon:"icon-text-entry",description:__("Collect open-ended information in a short text input (strings or numeric values)."),"short":__("Text Entry"),qtiClass:"textEntryInteraction",tags:["Inline Interactions","inline-interactions","text"]},endAttemptInteraction:{label:__("End Attempt Interaction"),
icon:"icon-end-attempt",description:__("Trigger the end of the item attempt."),"short":__("End Attempt"),qtiClass:"endAttemptInteraction",tags:["Inline Interactions","inline-interactions","button","submit"]},hotspotInteraction:{label:__("Hotspot Interaction"),icon:"icon-hotspot",description:__("Select one or more areas (hotspots) displayed on an picture."),"short":__("Hotspot"),qtiClass:"hotspotInteraction",tags:["Graphic Interactions","mcq"]},graphicOrderInteraction:{label:__("Graphic Order Interaction"),icon:"icon-graphic-order",description:__("Order the areas (hotspots) displayed on a picture."),"short":__("Order"),qtiClass:"graphicOrderInteraction",tags:["Graphic Interactions","ordering"]
},graphicAssociateInteraction:{label:__("Graphic Associate Interaction"),icon:"icon-graphic-associate",description:__("Create association(s) between areas (hotspots) displayed on a picture."),"short":__("Associate"),qtiClass:"graphicAssociateInteraction",tags:["Graphic Interactions","association"]},graphicGapMatchInteraction:{label:__("Graphic Gap Match Interaction"),icon:"icon-graphic-gap",description:__("Fill in the gaps on a picture with a set of image choices."),"short":__("Gap Match"),qtiClass:"graphicGapMatchInteraction",tags:["Graphic Interactions","association"]},selectPointInteraction:{label:__("Select Point Interaction"),icon:"icon-select-point",description:__("Position one or more points on a picture (response areas are not displayed)."),
"short":__("Select Point"),qtiClass:"selectPointInteraction",tags:["Graphic Interactions"]}}},QtiElements}),define("taoQtiItem/qtiItem/helper/simpleParser",["lodash","jquery","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiItem/core/Loader"],function(_,$,util,Loader){"use strict";function _getElementSelector(qtiClass,ns){return ns?ns+"\\:"+qtiClass+","+qtiClass:qtiClass}function getQtiClassFromXmlDom($node){var qtiClass=$node.prop("tagName").toLowerCase();return qtiClass=qtiClass.replace(/.*:/,""),_qtiClassNames[qtiClass]?_qtiClassNames[qtiClass]:qtiClass}function buildElement($elt){var qtiClass=getQtiClassFromXmlDom($elt),elt={qtiClass:qtiClass,serial:util.buildSerial(qtiClass+"_"),
attributes:{}};return $.each($elt[0].attributes,function(){this.specified&&(elt.attributes[this.name]=this.value)}),elt}function buildMath($elt,options){var elt=buildElement($elt);return elt.annotations={},$elt.find(_getElementSelector("annotation",options.ns.math)).each(function(){var $annotation=$(this),encoding=$annotation.attr("encoding");encoding&&(elt.annotations[encoding]=_.unescape($annotation.html())),$annotation.remove()}),elt.mathML=$elt.html(),elt.ns={name:"m",uri:"http://www.w3.org/1998/Math/MathML"},elt}function parseContainer($container,opts){var options=_.merge(_.clone(_defaultOptions),opts||{}),ret={serial:util.buildSerial("_container_"),body:"",
elements:{}};return _.each(_parsableElements,function(qtiClass){$container.find(qtiClass).each(function(){var $qtiElement=$(this),element=buildElement($qtiElement,opts);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))})}),$container.find(_getElementSelector("math",options.ns.math)).each(function(){var $qtiElement=$(this),element=buildMath($qtiElement,opts);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element))}),$container.find(_getElementSelector("include",options.ns.include)).each(function(){var $qtiElement=$(this),element=buildElement($qtiElement,opts);ret.elements[element.serial]=element,$qtiElement.replaceWith(_placeholder(element));
}),ret.body=$container.html(),ret}function _placeholder(element){return"{{"+element.serial+"}}"}var _parsableElements=["img","object"],_qtiClassNames={rubricblock:"rubricBlock"},_defaultOptions={ns:{math:"",include:"xi"},loaded:null,model:null},parser={parse:function(xmlStr,options){var $container=$(xmlStr),element=buildElement($container,options),data=parseContainer($container,options);if(void 0!==data.body&&(element.body=data),_.isFunction(options.loaded)&&options.model){var loader=(new Loader).setClassesLocation(options.model);loader.loadAndBuildElement(element,options.loaded)}return element}};return parser}),define("taoQtiItem/qtiItem/helper/xincludeLoader",["jquery","lodash","taoQtiItem/qtiItem/helper/simpleParser","taoQtiItem/qtiItem/core/Loader"],function($,_,simpleParser,Loader){
function load(xinclude,baseUrl,callback){var href=xinclude.attr("href");href&&baseUrl&&require(["text!"+baseUrl+href],function(stimulusXml){var $wrapper=$("<div>").html(stimulusXml),$sampleXMLrootNode=$wrapper.children(),$stimulus=$("<include>").append($sampleXMLrootNode),mathNs="m",data=simpleParser.parse($stimulus,{ns:{math:mathNs}});(new Loader).loadElement(xinclude,data,function(){if(_.isFunction(callback)){var loadedClasses=this.getLoadedClasses();loadedClasses.push("_container"),callback(xinclude,data,loadedClasses)}})},function(err){callback(xinclude,!1,[])})}return{load:load}}),define("taoQtiItem/qtiCreator/helper/xincludeRenderer",["lodash","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiItem/helper/xincludeLoader"],function(_,commonRenderer,xincludeLoader){
"use strict";return{render:function(xincludeWidget,baseUrl,newHref){var xinclude=xincludeWidget.element;newHref&&xinclude.attr("href",newHref),xincludeLoader.load(xinclude,baseUrl,function(xi,data,loadedClasses){data?commonRenderer.get().load(function(){_.each(xinclude.getComposingElements(),function(elt){elt.setRenderer(commonRenderer.get())}),xincludeWidget.refresh()},loadedClasses):xinclude.removeAttr("href")})}}}),define("json!taoItems/preview/resources/device-list.json",function(){return{tablets:{"193986c3715c81838870f908fa98d69a":{label:"Amazon Kindle Fire HDX 7",width:960,height:600},"4e8eafab11aad1486992d7ee2c8c16ca":{label:"Apple iPad",width:1024,height:768
},"5aac2932d9ad00d6d8a1604b8f9e4e8d":{label:"Google Nexus 10, Motorola Xoom, Xyboard",width:1280,height:800},"9805d9753ad08c7630a9ee5418aa6c6c":{label:"Google Nexus 7",width:966,height:604},d4a431cedf4705d6bf2cba6d5788378b:{label:"Samsung Galaxy Tab 7.7, 8.9, 10.1",width:1280,height:800}},phones:{"1b89338531ef0155c8d6abc2ac02c81a":{label:"Apple iPhone 3GS",width:320,height:480,scaleFactor:1,dpWidth:320,dpHeight:480},"3f89da99d84214cde7df87ebe0699a6f":{label:"Apple iPhone 4",width:640,height:960,scaleFactor:2,dpWidth:320,dpHeight:1920},"0d36971a5b98b367f54ced708c9af849":{label:"Apple iPhone 5",width:640,height:1136,scaleFactor:2,dpWidth:320,dpHeight:2272},"026beffcc051af995660ebdede986ace":{
label:"BlackBerry Z10",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},fd2dd53e667d6d49e4fa73356fa941dd:{label:"BlackBerry Z30",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"707584c1ae17d9b5b2cbe8603c91c147":{label:"Google Nexus 4",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},"91823264de952e7f2347e07db5c4058b":{label:"Google Nexus 5",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760},cd69817a6e147e8a4677389e56fcf568:{label:"Google Nexus S",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"75994faa6a38e31e99b53fcd75534a33":{label:"HTC Evo, Touch HD, Desire HD, Desire",width:480,height:800,
scaleFactor:1.5,dpWidth:320,dpHeight:1200},"0cab4dfccdfc880687cb608cfe4159db":{label:"HTC One X, EVO LTE",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},c4ff41fcba24d74fc21dc3490ca1edc9:{label:"HTC Sensation, Evo 3D",width:540,height:960,scaleFactor:1.5,dpWidth:360,dpHeight:1440},fa969a5e0dd2de53700eeee4ba4ba142:{label:"LG Optimus 2X, Optimus 3D, Optimus Black",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"33c4f9364e295ec03531f3a3425819cf":{label:"LG Optimus G",width:768,height:1280,scaleFactor:2,dpWidth:384,dpHeight:2560},bc47f5275f0efd56fee52d43a8082981:{label:"LG Optimus LTE, Optimus 4X HD",width:720,height:1280,scaleFactor:1.7,
dpWidth:424,dpHeight:2176},"0732887e6e324fd10777b735520a34cf":{label:"LG Optimus One",width:320,height:480,scaleFactor:1.5,dpWidth:213,dpHeight:720},"2e38a78364f09d0da0e9e1a3a68e7fb0":{label:"Motorola Defy, Droid, Droid X, Milestone",width:480,height:854,scaleFactor:1.5,dpWidth:320,dpHeight:1281},bd4b78dddc7c9625a4141a1b1ddabb87:{label:"Motorola Droid 3, Droid 4, Droid Razr, Atrix 4G, Atrix 2",width:540,height:960,scaleFactor:1,dpWidth:540,dpHeight:960},"3bf1edf21cfa81006183d2b02974c84e":{label:"Motorola Droid Razr HD",width:720,height:1280,scaleFactor:1,dpWidth:720,dpHeight:1280},ab5a352e0e016b97dac986f06c394f55:{label:"Nokia C5, C6, C7, N97, N8, X7",width:360,
height:640,scaleFactor:1,dpWidth:360,dpHeight:640},"4826fb7d7257aeaac992ce699df41b3c":{label:"Nokia Lumia 7X0, Lumia 8XX, Lumia 900, N800, N810, N900",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"0a691ab20add7c432200f8fa6527b488":{label:"Samsung Galaxy Note",width:800,height:1280,scaleFactor:2,dpWidth:400,dpHeight:2560},"9c23ee31be29960fbac9e9bbfc2fc7b0":{label:"Samsung Galaxy Note 3",width:1080,height:1920,scaleFactor:2,dpWidth:540,dpHeight:3840},"92177c0508c1d73905a58e2338f2a81f":{label:"Samsung Galaxy Note II",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"5222b8866dc4cc606725e16ffcc0a783":{label:"Samsung Galaxy S III, Galaxy Nexus",
width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"37c1541e2bd55cfd0f4073b0ccdf68b3":{label:"Samsung Galaxy S, S II, W",width:480,height:800,scaleFactor:1.5,dpWidth:320,dpHeight:1200},"2f7f64b7dda0144907ff300e83eed465":{label:"Samsung Galaxy S4",width:1080,height:1920,scaleFactor:3,dpWidth:360,dpHeight:5760},"9c24f9057744dad56043702a9703127f":{label:"Sony Xperia S, Ion",width:720,height:1280,scaleFactor:2,dpWidth:360,dpHeight:2560},"0a8b2732a016a9395c3af5f12dd9c0da":{label:"Sony Xperia Sola, U",width:480,height:854,scaleFactor:1,dpWidth:480,dpHeight:854},"5a153d7f53d82dcb0801f041574a6a43":{label:"Sony Xperia Z, Z1",width:1080,height:1920,scaleFactor:3,
dpWidth:360,dpHeight:5760}},screens:{"9e523ae15b61dc766f5c818726881ecf":{label:"1920  1080",width:1920,height:1080,dpWidth:1920,dpHeight:1080,scaleFactor:1},"07769cd8d0a7d09818b2f0b018042fb7":{label:"1366  768",width:1366,height:768,dpWidth:1366,dpHeight:768,scaleFactor:1},"72d5478a24194f98b9378e8e0fd65737":{label:"1280  1024",width:1280,height:1024,dpWidth:1280,dpHeight:1024,scaleFactor:1},b7a6dd5900cc72e61f0d3479c7e314ec:{label:"1280  800",width:1280,height:800,dpWidth:1280,dpHeight:800,scaleFactor:1},"43193b0ff671a37d8232ab664190a125":{label:"1024  768",width:1024,height:768,dpWidth:1024,dpHeight:768,scaleFactor:1},c29e48814af5443ff5688d9e967ce917:{label:"800  600",
width:800,height:600,dpWidth:800,dpHeight:600,scaleFactor:1}}}}),define("tpl!taoItems/preview/tpl/preview",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n                        <option value="',(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data
}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n                        "}function program2(depth0,data){return'selected="selected"'}function program4(depth0,data){var stack1,buffer="";return buffer+='\n                    <select class="preview-theme-selector">\n                        ',stack1=helpers.each.call(depth0,depth0&&depth0.themes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n                    </select>\n                    "}function program6(depth0,data){var stack1,helper,buffer="";return buffer+='\n                        <option value="',(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-value="',(helper=helpers.dataValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.dataValue,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{
hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n                        "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="preview-overlay tao-scope overlay preview-',
(helper=helpers.previewType)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.previewType,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+' item-no-print"\n     style="display:none">\n    <div class="preview-container-outer">\n        <form class="preview-utility-bar plain">\n            <div class="preview-utility-bar-inner grid-row">\n\n                <div class="col-4">\n                    <input type="hidden" value="" data-value="" class="standard-device-selector preview-device-selector" data-target="standard">\n                    <select class="preview-type-selector">\n                        ',
stack1=helpers.each.call(depth0,depth0&&depth0.previewTypes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                    </select>\n                    ",stack1=helpers["if"].call(depth0,depth0&&depth0.hasThemes,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                </div>\n                <div class="col-6 standard-only device-type-and-orientation"></div>\n                <div class="col-6 desktop-only device-type-and-orientation">\n                    <select class="desktop-device-selector preview-device-selector" data-target="desktop">\n                        ',
stack1=helpers.each.call(depth0,depth0&&depth0.desktopDevices,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                    </select>\n                </div>\n                <div class="col-6 mobile-only device-type-and-orientation">\n                    <select class="mobile-device-selector preview-device-selector" data-target="mobile">\n                        ',stack1=helpers.each.call(depth0,depth0&&depth0.mobileDevices,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                    </select>\n                    <select tabindex="-1" class="mobile-orientation-selector orientation-selector"\n                            data-target="mobile">\n                        <option value="landscape">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Landscape",options):helperMissing.call(depth0,"__","Landscape",options)))+'</option>\n                        <option value="portrait">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Portrait",options):helperMissing.call(depth0,"__","Portrait",options)))+'</option>\n                    </select>\n                </div>\n                <div class="col-2">\n                    <span class="btn-info small preview-closer rgt">\n                        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close",options):helperMissing.call(depth0,"__","Close",options)))+'\n                        <span class="icon-close r"></span>\n                    </span>\n                </div>\n            </div>\n            <div class="preview-message-box">\n                <div class="feedback-info small">\n                    <span class="icon-info"></span>\n                    '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"This preview may be scaled to fit your screen. The final rendering may differ.",options):helperMissing.call(depth0,"__","This preview may be scaled to fit your screen. The final rendering may differ.",options)))+'\n                    <a href="#">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Dont show this again!",options):helperMissing.call(depth0,"__","Dont show this again!",options)))+'</a>\n                    <span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove this message",options):helperMissing.call(depth0,"__","Remove this message",options)))+'" class="icon-close close-trigger"></span>\n                </div>\n            </div>\n        </form>\n        <div class="preview-canvas">\n            <div class="preview-scale-container">\n                <div class="',
(helper=helpers.previewType)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.previewType,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"-preview-frame preview-outer-frame ",(helper=helpers.previewType)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.previewType,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-preview-landscape">\n                    <div class="',(helper=helpers.previewType)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.previewType,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-preview-container preview-container">\n                        <div class="preview-item-container"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n\n    <div id="preview-console">\n        <span class="icon-close preview-console-closer" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close console",options):helperMissing.call(depth0,"__","Close console",options)))+'"></span>\n        <div class="preview-console-header grid-row clearfix">\n            <ul class="col-10 plain action-bar extra-button-action-bar horizontal-action-bar">\n            </ul>\n            <ul class="col-2 plain action-bar console-button-action-bar horizontal-action-bar">\n                <li class="small btn-info action action-button rgt" id="preview-submit-button">\n                    <a class="li-inner" href="#">\n                        <span class="label">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Submit",options):helperMissing.call(depth0,"__","Submit",options)))+'</span>\n                    </a>\n                </li>\n            </ul>\n        </div>\n        <div class="preview-console-body clear">\n            <ul></ul>\n        </div>\n    </div>\n</div>\n\n\n\n'})}),define("taoItems/preview/preview",["jquery","lodash","i18n","util/strPad","json!taoItems/preview/resources/device-list.json","tpl!taoItems/preview/tpl/preview","ui/themes","ui/themeLoader","ui/modal","select2","jquery.cookie"],function($,_,__,strPad,deviceList,previewTpl,themeHandler,themeLoader){"use strict";function _setupScreenSize(){
screenSize={width:$(".preview-overlay").innerWidth(),height:$(".preview-overlay").innerHeight()}}var overlay,container,typeDependant,$feedbackBox,$console,previewContainerMaxWidth,itemUri,orientation="landscape",previewType="standard",previewTypes={desktop:__("Desktop preview"),mobile:__("Mobile preview"),standard:__("Actual size")},themeObj=themeHandler.get("items")||{},$doc=$(document),$window=$(window),$body=$(document.body),screenSize={width:$window.innerWidth(),height:$window.innerHeight()},sizeSettings={width:0,height:0},scaleFactor=1,_getDeviceSelectorData=function(type){var devices="mobile"===type?deviceList.tablets:deviceList.screens,options=[];return _.forEach(devices,function(value){
options.push({value:value.label,label:value.label,dataValue:[value.width,value.height].join(","),selected:previewType===value.label})}),options},_setupTypeDependantElements=function(){typeDependant=overlay.add(overlay.find(".preview-scale-container").find('[class*="'+previewType+'"]'))},_setPreviewType=function(newType){if(newType!==previewType){var re=new RegExp(previewType,"g");typeDependant.each(function(i,el){el.className=el.className.replace(re,newType)}),previewType=newType}},_setOrientation=function(newOrientation){if(newOrientation!==orientation){var re=new RegExp(orientation,"g"),previewFrame=$(".preview-outer-frame")[0];previewFrame.className=previewFrame.className.replace(re,newOrientation),
orientation=newOrientation}},_scale=function(){_computeScaleFactor();var $scaleContainer=$(".preview-scale-container"),_scaleFactor="standard"===previewType?1:scaleFactor,containerScaledWidth=$scaleContainer.width()*_scaleFactor,left=(screenSize.width-containerScaledWidth)/2;$scaleContainer.css({left:left>0?left:0,"-webkit-transform":"scale("+_scaleFactor+","+_scaleFactor+")","-ms-transform":"scale("+_scaleFactor+","+_scaleFactor+")",transform:"scale("+_scaleFactor+","+_scaleFactor+")","-webkit-transform-origin":"0 0","-ms-transform-origin":"0 0","transform-origin":"0 0"})},_positionPreview=function(){var topBarHeight=$(".preview-utility-bar").outerHeight();overlay[0].style.top=topBarHeight+"px",
overlay[0].style.maxHeight="calc(100vh - "+topBarHeight+"px - "+$console.outerHeight()+"px )"},_computeScaleFactor=function(){var scaleValues={x:1,y:1},requiredSize={width:sizeSettings.width+150,height:sizeSettings.height+275};requiredSize.width>screenSize.width&&(scaleValues.x=screenSize.width/requiredSize.width),requiredSize.height>screenSize.height&&(scaleValues.y=screenSize.height/requiredSize.height),scaleFactor=Math.min(scaleValues.x,scaleValues.y)},_setupDeviceSelectors=function(){var previewDeviceSelectors=overlay.find(".preview-device-selector");previewDeviceSelectors.on("change",function(){for(var elem=$(this),option="select"===this.nodeName.toLowerCase()?this.options[this.selectedIndex]:this,type=elem.data("target"),val=$(option).data("value").split(","),i=val.length,container=overlay.find("."+type+"-preview-container");i--;)val[i]=parseFloat(val[i]);
return sizeSettings="mobile"===type&&"portrait"===orientation?{width:val[1],height:val[0]}:{width:val[0],height:val[1]},sizeSettings.width===container.width()&&sizeSettings.height===container.height()?!1:(_setPreviewType(type),container.css(sizeSettings),_scale(),void _adaptFrameSize())}),previewDeviceSelectors.each(function(){"select"===this.nodeName.toLowerCase()&&$(this).select2({minimumResultsForSearch:-1})})},_setupOrientationSelectors=function(){$("select.orientation-selector").on("change",function(){var type=$(this).data("target"),previewFrame=$("."+type+"-preview-frame"),container=previewFrame.find("."+type+"-preview-container"),newOrientation=$(this).val();
return newOrientation===orientation?!1:(sizeSettings={height:container.width(),width:container.height()},container.css(sizeSettings),_setOrientation(newOrientation),_scale(),void _adaptFrameSize())}).select2({minimumResultsForSearch:-1})},_setupClosers=function(){var $closer=overlay.find(".preview-closer"),$feedbackCloser=$feedbackBox.find(".close-trigger"),$hideForever=$feedbackBox.find("a"),$iframe=$("#preview-iframe");$closer.on("click",function(){$doc.trigger("itemunload.preview"),overlay.hide(),$body.removeClass("preview-mode"),$iframe.off("load").attr("src","about:blank")}),$doc.keyup(function(e){27===e.keyCode&&$closer.trigger("click")}),$feedbackCloser.on("click",function(){
$feedbackBox.hide(),$body.addClass("no-preview-feedback"),_positionPreview(),_scale()}),$hideForever.on("click",function(e){e.preventDefault(),$.cookie("hidePreviewFeedback",!0,{expires:1e3,path:"/"}),$feedbackCloser.trigger("click")})},_getThemes=function(){var activeTheme=themeLoader(themeObj).getActiveTheme(),options=[];return _(themeObj.available).forEach(function(data){options.push({value:data.id,label:data.name,selected:data.id===activeTheme})}),options},_getPreviewTypes=function(){var options=[];return _(previewTypes).forEach(function(_previewLabel,_previewType){options.push({value:_previewType,label:_previewLabel,selected:previewType===_previewType})}),
options},_setupViewSelector=function(){$("select.preview-type-selector").on("change",function(){var _previewType=$(this),value=_previewType.val();_setPreviewType(value),$("."+value+"-device-selector").trigger("change")}).select2({minimumResultsForSearch:-1})},_setupThemeSelector=function(){$("select.preview-theme-selector").on("change",function(){var iframe=document.getElementById("preview-container"),iframeDoc=iframe.contentWindow||iframe.contentDocument;iframeDoc.$(".qti-item").trigger("themechange",[$(this).val()])}).select2({minimumResultsForSearch:-1})},_adaptFrameSize=function(){var $previewContainer=$(".preview-container"),$iframe=function(){var _iframe=$previewContainer.find("iframe");
return _iframe.height(""),_iframe}(),contentHeight=$iframe.contents().outerHeight(),containerHeight=$previewContainer.innerHeight();"standard"!==previewType?containerHeight>contentHeight&&(contentHeight=containerHeight):$previewContainer.height(contentHeight+10),$iframe.height(contentHeight)},_updateStandardPreviewSize=function(height){var $selector=$(".standard-device-selector"),values=($selector.val()?$selector.val().split(","):"")||[$window.width().toString()],valueStr=values.join(",");values[1]=height||values[1]||"1200",$selector.val(valueStr).data("value",valueStr)},_initConsole=function(){var $body=$console.find(".preview-console-body"),$listing=$body.find("ul"),$closer=$console.find(".preview-console-closer");
$console.off("updateConsole").on("updateConsole",function(event,type,message){var timer=new Date,logTime=[strPad(timer.getHours(),2,"0","STR_PAD_LEFT"),strPad(timer.getMinutes(),2,"0","STR_PAD_LEFT"),strPad(timer.getSeconds(),2,"0","STR_PAD_LEFT")].join(":"),msgStr='<span class="log-time">'+strPad(logTime,12," ")+'</span> <span class="log-type">'+strPad(type,18," ")+'</span> <span class="log-message">'+strPad(message,18," ")+"</span>";$listing.append("<li><pre>"+msgStr+"</pre></li>"),$body.is(":visible")?$listing.scrollTop(1e4):$body.slideDown("slow",function(){$closer.show(),$listing.scrollTop(1e4)})}),$closer.on("click",function(){$body.slideUp("slow",function(){
$closer.hide()})})},show=function(){$.ajax({url:itemUri,dataType:"html"}).done(function(data){$body.addClass("preview-mode"),overlay[0].style.display="block",overlay.find("select:visible").not(".preview-theme-selector").trigger("change"),_scale(),_positionPreview(),$(".preview-item-container").html(data)})},init=function(_itemUri){if(!_itemUri||0===_itemUri.length)throw new TypeError("Wrong URI");return $(".preview-overlay").remove(),container=null,overlay=$(previewTpl({mobileDevices:_getDeviceSelectorData("mobile"),desktopDevices:_getDeviceSelectorData("desktop"),previewTypes:_getPreviewTypes(),previewType:previewType,themes:_getThemes(),hasThemes:_.size(themeObj.available)>1
})),$body.append(overlay),previewContainerMaxWidth=parseInt($(".preview-container").css("max-width"),10),$feedbackBox=overlay.find(".preview-message-box"),$.cookie("hidePreviewFeedback")&&($feedbackBox.hide(),$body.addClass("no-preview-feedback")),$console=overlay.find("#preview-console"),_initConsole(),_updateStandardPreviewSize(),_setupTypeDependantElements(),_setupDeviceSelectors(),_setupOrientationSelectors(),_setupViewSelector(),_setupThemeSelector(),_setupClosers(),_setupScreenSize(),_computeScaleFactor(),_setPreviewType(previewType),_setOrientation(orientation),$window.on("resize orientationchange",function(){_setupScreenSize(),_updateStandardPreviewSize(),
_computeScaleFactor(),_scale()}),itemUri=_itemUri,overlay};return{init:init,show:show}}),define("taoQtiItem/qtiCreator/editor/preparePrint",["jquery"],function($){"use strict";var preparePrint=function(){function initHideOnPrint(elem){return elem.siblings().each(function(){$(this).addClass("item-no-print")}),elem.parent()}for(var parent=initHideOnPrint($("#item-editor-scope").parent());parent.length&&"body"!==parent.get(0).nodeName.toLowerCase();)parent=initHideOnPrint(parent);$("#item-editor-toolbar, .item-editor-sidebar").addClass("item-no-print")};return $("#print-trigger").on("click",function(){window.print()}),preparePrint}),define("json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json",function(){
return{"sans-serif":['Arial, "Helvetica Neue", Helvetica, sans-serif','"Avant Garde", Avantgarde, "Century Gothic", CenturyGothic, "AppleGothic", sans-serif','Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif','Candara, Calibri, Segoe, "Segoe UI", Optima, Arial, sans-serif','"Century Gothic", CenturyGothic, AppleGothic, sans-serif','Corbel, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "DejaVu Sans", "Bitstream Vera Sans", "Liberation Sans", Verdana, "Verdana Ref", sans-serif','"Franklin Gothic Medium", "Franklin Gothic", "ITC Franklin Gothic", Arial, sans-serif','Frutiger, "Frutiger Linotype", Univers, Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans Condensed", "Liberation Sans", "Nimbus Sans L", Tahoma, Geneva, "Helvetica Neue", Helvetica, Arial, sans-serif','Futura, "Century Gothic", AppleGothic, "Trebuchet MS", sans-serif','Geneva, Verdana, "Lucida Sans", "Lucida Grande", "Lucida Sans Unicode", sans-serif','"Gill Sans", "Gill Sans MT", Calibri, sans-serif','"Helvetica Neue", Helvetica, Arial, sans-serif','Impact, Haettenschweiler, "Franklin Gothic Bold", Charcoal, "Helvetica Inserat", "Bitstream Vera Sans Bold", "Arial Black", sans-serif','"Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif','Optima, Segoe, "Segoe UI", Candara, Calibri, Arial, sans-serif','"Segoe UI", Candara, "Bitstream Vera Sans", "DejaVu Sans", "Bitstream Vera Sans", "Trebuchet MS", Verdana, "Verdana Ref", sans-serif',"Tahoma, Verdana, Segoe, sans-serif",'"Trebuchet MS", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Tahoma, sans-serif',"Verdana, Geneva, Tahoma, sans-serif"],
serif:['Baskerville, "Baskerville Old Face", "Hoefler Text", Garamond, "Times New Roman", serif','"Big Caslon", "Book Antiqua", "Palatino Linotype", Georgia, serif','"Bodoni MT", Didot, "Didot LT STD", "Hoefler Text", Garamond, "Times New Roman", serif','"Book Antiqua", Palatino, "Palatino Linotype", "Palatino LT STD", Georgia, serif','"Calisto MT", "Bookman Old Style", Bookman, "Goudy Old Style", Garamond, "Hoefler Text", "Bitstream Charter", Georgia, serif','Cambria, "Hoefler Text", Utopia, "Liberation Serif", "Nimbus Roman No9 L Regular", Times, "Times New Roman", serif','Constantia, "Lucida Bright", Lucidabright, "Lucida Serif", Lucida, "DejaVu Serif", "Bitstream Vera Serif", "Liberation Serif", Georgia, serif','Didot, "Didot LT STD", "Hoefler Text", Garamond, "Times New Roman", serif','Garamond, Baskerville, "Baskerville Old Face", "Hoefler Text", "Times New Roman", serif','Georgia, Palatino," Palatino Linotype", Times, "Times New Roman", serif','"Goudy Old Style", Garamond, "Big Caslon", "Times New Roman", serif','"Hoefler Text", "Baskerville old face", Garamond, "Times New Roman", serif','"Lucida Bright", Georgia, serif','"Palatino Linotype", Palatino, Palladio, "URW Palladio L", "Book Antiqua", Baskerville, "Bookman Old Style", "Bitstream Charter", "Nimbus Roman No9 L", Garamond, "Apple Garamond", "ITC Garamond Narrow", "New Century Schoolbook", "Century Schoolbook", "Century Schoolbook L", Georgia, serif','Perpetua, Baskerville, "Big Caslon", "Palatino Linotype", Palatino, "URW Palladio L", "Nimbus Roman No9 L", serif','Rockwell, "Courier Bold", Courier, Georgia, Times, "Times New Roman", serif','"Times New Roman", TimesNewRoman, Times, Baskerville, Georgia, serif'],
monospace:['"Andale Mono", AndaleMono, monospace','Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace','"Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace','"Lucida Console", "Lucida Sans Typewriter", Monaco, "Bitstream Vera Sans Mono", monospace','Monaco, Consolas, "Lucida Console", monospace','"Rockwell Extra Bold", "Rockwell Bold", monospace']}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n<li data-css-res="',(helper=helpers.path)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.path,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="icon-preview style-sheet-toggler" title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n    <span class="file-label truncate" title="',(helper=helpers.editLabelTxt)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.editLabelTxt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <input type="text" class="style-sheet-label-editor" value="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="icon-bin" title="',
(helper=helpers.deleteTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.deleteTxt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-role="css-delete"></span>\n    <span class="icon-download" title="',(helper=helpers.downloadTxt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.downloadTxt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-role="css-download"></span>\n</li>\n'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};
var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;return stack1=helpers.each.call(depth0,depth0&&depth0.stylesheets,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleEditor",["jquery","lodash","helpers","i18n","urlParser","tpl!taoQtiItem/qtiCreator/tpl/toolbars/cssToggler","jquery.fileDownload"],function($,_,helpers,__,UrlParser,cssTpl){"use strict";var itemConfig,_getUri=function(action){return helpers._url(action,"QtiCssAuthoring","taoQtiItem")},_basename=function(path){return path.substring(path.lastIndexOf("/")+1)},styleEditor=function($,doc){
var currentItem,style={},$styleElem=function(){var styleElem=$("#item-editor-user-styles");return styleElem.length?styleElem.empty():(styleElem=$("<style>",{id:"item-editor-user-styles"}),$("head").append(styleElem)),styleElem}(),common={title:__("Disable this stylesheet temporarily"),deleteTxt:__("Remove this stylesheet"),editLabelTxt:__("Edit stylesheet label"),downloadTxt:__("Download this stylesheet"),preparingMessageHtml:__("Preparing CSS, please wait"),failMessageHtml:__("There was a problem downloading your CSS, please try again."),isInValidLocalTxt:__("This stylesheet has not been found on the server. you may want to delete this reference")},customStylesheet="",create=function(dontAppend){
var key1,key2,mSelector,mProp,css="";if(_.isEmpty(style))return erase();for(key1 in style)if(style.hasOwnProperty(key1)){css+=key1+"{";for(key2 in style[key1])if(style[key1].hasOwnProperty(key2))if(_.isPlainObject(style[key1][key2]))for(mSelector in style[key1][key2]){css+=key2+"{";for(mProp in style[key1][key2])css+=mProp+":"+style[key1][key2][mSelector]+";";css+="}"}else css+=key2+":"+style[key1][key2]+";";css+="}\n"}return dontAppend||$styleElem.text(css),css},apply=function(selector,property,value){style[selector]=style[selector]||{},value?style[selector][property]=value:(delete style[selector][property],0===_.size(style[selector])&&delete style[selector]),
create(),$(document).trigger("stylechange.qti-creator")},erase=function(){return style={},$styleElem.text(""),!1},save=function(){return verifyInit(),$.post(_getUri("save"),_.extend({},itemConfig,{cssJson:JSON.stringify(style),stylesheetUri:customStylesheet.attr("href")}))},download=function(uri){verifyInit(),$.fileDownload(_getUri("download"),{preparingMessageHtml:common.preparingMessageHtml,failMessageHtml:common.failMessageHtml,successCallback:function(){},httpMethod:"POST",data:_.extend({},itemConfig,{stylesheetUri:uri})})},verifyInit=function(){if(!itemConfig)throw new Error("Missing itemConfig, did you call styleEditor.init()?");return!0},addStylesheet=function(stylesheet){
var fileName,link,listEntry,parser,stylesheets=[],loadStylesheet=function(link,stylesheet,isLocal,isValid){var isInvalidLocal=isLocal&&!isValid,tplData={path:stylesheet.attr("href"),label:stylesheet.attr("title")||fileName,title:common.title,deleteTxt:common.deleteTxt,downloadTxt:common.downloadTxt,editLabelTxt:isInvalidLocal?common.isInValidLocalTxt:common.editLabelTxt};return stylesheets.push(tplData),listEntry=$(cssTpl({stylesheets:stylesheets})),listEntry.data("stylesheetObj",stylesheet),$("#style-sheet-toggler").append(listEntry),isInvalidLocal?(listEntry.addClass("not-available"),void listEntry.find('[data-role="css-download"], .style-sheet-toggler').css("visibility","hidden")):($styleElem.before(link),
void setTimeout(function(){var isInit=!1;$(doc).trigger("customcssloaded.styleeditor",[style]),$(window).trigger("resize"),currentItem.pendingStylesheetsInit&&(isInit=!0,currentItem.pendingStylesheetsInit--),$(doc).trigger("stylechange.qti-creator",[{initializing:isInit}])},isLocal?500:3500))};_.isString(stylesheet)&&(stylesheet=currentItem.createStyleSheet(stylesheet)),fileName=_basename(stylesheet.attr("href")),link=function(){var _link=$(stylesheet.render()),_href=_link.attr("href"),_sep=_href.indexOf("?")>-1?"&":"?";return _link.attr("href",_href+_sep+(new Date).getTime().toString()),_link}(),parser=new UrlParser(link.attr("href")),parser.checkCORS()?$.when($.ajax(link.attr("href"))).then(function(){
loadStylesheet(link,stylesheet,!0,!0)},function(){loadStylesheet(link,stylesheet,!0,!1)}):loadStylesheet(link,stylesheet,!1)},addItemStylesheets=function(){var currentStylesheet;currentItem.pendingStylesheetsInit=_.size(currentItem.stylesheets);for(var key in currentItem.stylesheets)currentItem.stylesheets.hasOwnProperty(key)&&(currentStylesheet=currentItem.stylesheets[key],"tao-user-styles.css"!==_basename(currentStylesheet.attr("href"))?addStylesheet(currentItem.stylesheets[key]):customStylesheet=currentStylesheet);customStylesheet||(customStylesheet=currentItem.createStyleSheet("style/custom/tao-user-styles.css"))},removeOrphanedStylesheets=function(){$("link[data-serial]").remove();
},getItem=function(){return currentItem},init=function(item,config){currentItem=item,itemConfig={uri:config.uri,lang:config.lang,baseUrl:config.baseUrl},removeOrphanedStylesheets(),addItemStylesheets();var resizerTarget=$("#item-editor-item-resizer").data("target"),href=customStylesheet.attr("href");currentItem.data("responsive",!0),$.when($.getJSON(_getUri("load"),_.extend({},itemConfig,{stylesheetUri:href}))).then(function(_style){style=_style,create(),style.length&&currentItem.data("responsive",!(!style[resizerTarget]||!style[resizerTarget].width)),$(doc).trigger("customcssloaded.styleeditor",[style])})},getStyle=function(){return style};return{apply:apply,
save:save,download:download,erase:erase,init:init,create:create,getItem:getItem,getStyle:getStyle,addStylesheet:addStylesheet}}($,document);return styleEditor}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSelector",["jquery","json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","select2"],function($,fontStacks,styleEditor,__){"use strict";var fontSelector=function(){var generic,optGroup,option,l,fontSelector=$("select#item-editor-font-selector"),target=fontSelector.data("target"),$target=$(target),normalize=function(font){return font.replace(/"/g,"'").replace(/, /g,",")},clean=function(font){
return font.substring(0,font.indexOf(",")).replace(/'/g,"")},resetButton=fontSelector.parent().find('[data-role="font-selector-reset"]'),i=0,toLabel=function(font){return font=font.replace(/-/g," "),(font+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase()})},format=function(state){var originalOption=state.element;return state.id?'<span style="font-size: 12px;'+$(originalOption).attr("style")+'">'+state.text+"</span>":state.text},reset=function(){styleEditor.apply(target,"font-family"),fontSelector.select2("val",$target.css("font-family"))};fontSelector.append('<option value="">'+__("Default")+"</option>");for(generic in fontStacks)if(fontStacks.hasOwnProperty(generic)){
for(optGroup=$("<optgroup>",{label:toLabel(generic)}),l=fontStacks[generic].length,i=0;l>i;i++)fontStacks[generic][i]=normalize(fontStacks[generic][i]),option=$("<option>",{value:fontStacks[generic][i],text:clean(fontStacks[generic][i])}).css({fontFamily:fontStacks[generic][i]}),optGroup.append(option);fontSelector.append(optGroup)}resetButton.on("click",reset),fontSelector.select2({formatResult:format,formatSelection:format,width:"resolve"}),$(document).on("customcssloaded.styleeditor",function(e,style){}),fontSelector.on("change",function(){styleEditor.apply(target,"font-family",$(this).val())})};return fontSelector}),define("taoQtiItem/qtiCreator/helper/popup",["jquery","lodash","core/dataattrhandler"],function($,_,dataAttrHandler){
"use strict";function reorderZindex(){}var init=function($trigger,options){var defaults={top:null,right:2,title:null};options=_.assign(defaults,options||{});var open=function($trigger,$popup){var $container=$popup.parents(".sidebar-popup-parent"),$actionBar=$(".item-editor-action-bar"),baseOffsetTop=$actionBar.offset().top-$actionBar.height(),maxHeight=$(window).height()-baseOffsetTop,top=_.isNull(options.top)?$trigger.offset().top-baseOffsetTop-$popup.height()/2:options.top,$titleArea=$popup.find(".sidebar-popup-title"),$title=$titleArea.find("h3");$titleArea.length&&(maxHeight-=$titleArea.height()),$trigger.trigger("beforeopen.popup",{popup:$popup,trigger:$trigger
}),$popup.show(),$popup.css({top:Math.max(baseOffsetTop,top),right:$container.hasClass("item-editor-sidebar-wrapper")?$container.width()+options.right:options.right}),options.title&&$title.text(options.title),$popup.find(".sidebar-popup-content").css({maxHeight:maxHeight}),$trigger.trigger("open.popup",{popup:$popup,trigger:$trigger})},close=function($trigger,$popup){$trigger.trigger("beforeclose.popup",{popup:$popup,trigger:$trigger}),$popup.hide(),$trigger.trigger("close.popup",{popup:$popup,trigger:$trigger})};$trigger.each(function(){var _trigger=$(this),$popup=options.popup||function(){return dataAttrHandler.getTarget("popup",_trigger)}(),$closer=$popup.find(".closer"),$dragger=$popup.find(".sidebar-popup-title").not($closer);
if(!$popup||!$popup.length)throw new Error("No popup found");$closer.length&&$closer.on("click",function(){close(_trigger,$popup)}),$dragger.length&&$popup.draggable({handle:$dragger}),_trigger.prop("popup",$popup)}),$trigger.on("click",function(e){var _trigger=$(e.target),$popup=_trigger.prop("popup");e.preventDefault(),$popup.is(":visible")?close(_trigger,$popup):open(_trigger,$popup)})};return{init:init,reorderZindex:reorderZindex}}),define("lib/farbtastic/farbtastic",["jquery"],function(jQuery){var $=jQuery;jQuery.fn.farbtastic=function(callback){return $.farbtastic(this,callback),this},jQuery.farbtastic=function(container,callback){if(container.length){var container=$(container).get(0);
return container.farbtastic||(container.farbtastic=new jQuery._farbtastic(container,callback))}},jQuery._farbtastic=function(container,callback){var fb=this,e=$("<div>",{"class":"farbtastic"}),colorObj=$("<div>",{"class":"color"}),wheelObj=$("<div>",{"class":"wheel"}),overlayObj=$("<div>",{"class":"overlay"}),hMarkerObj=$("<div>",{"class":"h-marker marker"}),slMarkerObj=$("<div>",{"class":"sl-marker marker"});container=$(container),$(e).append(colorObj),$(e).append(wheelObj),$(e).append(overlayObj),$(e).append(hMarkerObj),$(e).append(slMarkerObj),container.append(e),fb.wheel=wheelObj.get(0),fb.radius=70,fb.square=overlayObj.width(),fb.width=e.width(),fb.linkTo=function(callback){
return"object"==typeof fb.callback&&$(fb.callback).unbind("keyup",fb.updateValue),fb.color=null,"function"==typeof callback?fb.callback=callback:("object"==typeof callback||"string"==typeof callback)&&(fb.callback=$(callback),fb.callback.bind("keyup",fb.updateValue),fb.callback.get(0).value&&fb.setColor(fb.callback.get(0).value)),this},fb.updateValue=function(event){this.value&&this.value!=fb.color&&fb.setColor(this.value)},fb.setColor=function(color){var unpack=fb.unpack(color);return fb.color!=color&&unpack&&(fb.color=color,fb.rgb=unpack,fb.hsl=fb.RGBToHSL(fb.rgb),fb.updateDisplay()),this},fb.setHSL=function(hsl){return fb.hsl=hsl,fb.rgb=fb.HSLToRGB(hsl),fb.color=fb.pack(fb.rgb),
fb.updateDisplay(),this},fb.widgetCoords=function(event){var x,y,el=event.target||event.srcElement,reference=fb.wheel;if("undefined"!=typeof event.offsetX){for(var pos={x:event.offsetX,y:event.offsetY},e=el;e;)e.mouseX=pos.x,e.mouseY=pos.y,pos.x+=e.offsetLeft,pos.y+=e.offsetTop,e=e.offsetParent;for(var e=reference,offset={x:0,y:0};e;){if("undefined"!=typeof e.mouseX){x=e.mouseX-offset.x,y=e.mouseY-offset.y;break}offset.x+=e.offsetLeft,offset.y+=e.offsetTop,e=e.offsetParent}for(e=el;e;)e.mouseX=void 0,e.mouseY=void 0,e=e.offsetParent}else{var pos=fb.absolutePosition(reference);x=(event.pageX||0*(event.clientX+$("html").get(0).scrollLeft))-pos.x,y=(event.pageY||0*(event.clientY+$("html").get(0).scrollTop))-pos.y;
}return{x:x-fb.width/2,y:y-fb.width/2}},fb.mousedown=function(event){document.dragging||($(document).bind("mousemove",fb.mousemove).bind("mouseup",fb.mouseup),document.dragging=!0);var pos=fb.widgetCoords(event);return fb.circleDrag=2*Math.max(Math.abs(pos.x),Math.abs(pos.y))>fb.square,fb.mousemove(event),!1},fb.mousemove=function(event){var pos=fb.widgetCoords(event);if(fb.circleDrag){var hue=Math.atan2(pos.x,-pos.y)/6.28;0>hue&&(hue+=1),fb.setHSL([hue,fb.hsl[1],fb.hsl[2]])}else{var sat=Math.max(0,Math.min(1,-(pos.x/fb.square)+.5)),lum=Math.max(0,Math.min(1,-(pos.y/fb.square)+.5));fb.setHSL([fb.hsl[0],sat,lum])}return!1},fb.mouseup=function(){$(document).unbind("mousemove",fb.mousemove),
$(document).unbind("mouseup",fb.mouseup),document.dragging=!1},fb.updateDisplay=function(){var angle=6.28*fb.hsl[0];$(".h-marker",e).css({left:Math.round(Math.sin(angle)*fb.radius+fb.width/2)+"px",top:Math.round(-Math.cos(angle)*fb.radius+fb.width/2)+"px"}),$(".sl-marker",e).css({left:Math.round(fb.square*(.5-fb.hsl[1])+fb.width/2)+"px",top:Math.round(fb.square*(.5-fb.hsl[2])+fb.width/2)+"px"}),$(".color",e).css("backgroundColor",fb.pack(fb.HSLToRGB([fb.hsl[0],1,.5]))),"object"==typeof fb.callback?($(fb.callback).css({backgroundColor:fb.color,color:fb.hsl[2]>.5?"#000":"#fff"}),$(fb.callback).each(function(){this.value&&this.value!=fb.color&&(this.value=fb.color);
})):"function"==typeof fb.callback&&fb.callback.call(fb,fb.color),container.trigger("colorchange.farbtastic",[fb.color])},fb.absolutePosition=function(el){var r={x:el.offsetLeft,y:el.offsetTop};if(el.offsetParent){var tmp=fb.absolutePosition(el.offsetParent);r.x+=tmp.x,r.y+=tmp.y}return r},fb.pack=function(rgb){var r=Math.round(255*rgb[0]),g=Math.round(255*rgb[1]),b=Math.round(255*rgb[2]);return"#"+(16>r?"0":"")+r.toString(16)+(16>g?"0":"")+g.toString(16)+(16>b?"0":"")+b.toString(16)},fb.unpack=function(color){return 7==color.length?[parseInt("0x"+color.substring(1,3))/255,parseInt("0x"+color.substring(3,5))/255,parseInt("0x"+color.substring(5,7))/255]:4==color.length?[parseInt("0x"+color.substring(1,2))/15,parseInt("0x"+color.substring(2,3))/15,parseInt("0x"+color.substring(3,4))/15]:void 0;
},fb.HSLToRGB=function(hsl){var m1,m2,h=hsl[0],s=hsl[1],l=hsl[2];return m2=.5>=l?l*(s+1):l+s-l*s,m1=2*l-m2,[this.hueToRGB(m1,m2,h+.33333),this.hueToRGB(m1,m2,h),this.hueToRGB(m1,m2,h-.33333)]},fb.hueToRGB=function(m1,m2,h){return h=0>h?h+1:h>1?h-1:h,1>6*h?m1+(m2-m1)*h*6:1>2*h?m2:2>3*h?m1+(m2-m1)*(.66666-h)*6:m1},fb.RGBToHSL=function(rgb){var min,max,delta,h,s,l,r=rgb[0],g=rgb[1],b=rgb[2];return min=Math.min(r,Math.min(g,b)),max=Math.max(r,Math.max(g,b)),delta=max-min,l=(min+max)/2,s=0,l>0&&1>l&&(s=delta/(.5>l?2*l:2-2*l)),h=0,delta>0&&(max==r&&max!=g&&(h+=(g-b)/delta),max==g&&max!=b&&(h+=2+(b-r)/delta),max==b&&max!=r&&(h+=4+(r-g)/delta),h/=6),[h,s,l]},$("*",e).mousedown(fb.mousedown),
fb.setColor("#123456"),callback&&fb.linkTo(callback)}}),define("taoQtiItem/qtiCreator/editor/styleEditor/colorSelector",["jquery","lodash","i18n","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/helper/popup","lib/farbtastic/farbtastic"],function($,_,__,styleEditor,popup){"use strict";function rgbToHex(color){function toHexPair(inp){return("0"+parseInt(inp,10).toString(16)).slice(-2)}if(!_.isString(color))return color;var rgbArr=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i.exec(color);return _.isArray(rgbArr)&&4===rgbArr.length?"#"+toHexPair(rgbArr[1])+toHexPair(rgbArr[2])+toHexPair(rgbArr[3]):color}var colorSelector=function(){
var widgetObj,colorPicker=$(".item-editor-color-picker"),widget=colorPicker.find(".color-picker"),widgetBox=colorPicker.find(".color-picker-container"),titleElement=colorPicker.find("#color-picker-title"),input=colorPicker.find("#color-picker-input"),resetButtons=colorPicker.find(".reset-button"),colorTriggers=colorPicker.find(".color-trigger"),colorTriggerLabels=colorPicker.find("label"),currentProperty="color",$doc=$(document),setTitle=function(property,trigger){titleElement.text(trigger.parent().find("label").text())},setTriggerColor=function(){colorTriggers.each(function(){var value,$trigger=$(this),target=$trigger.data("target"),$target=$(target),style=styleEditor.getStyle()||{};
style[target]&&style[target][$trigger.data("value")]?(value=style[target][$trigger.data("value")],$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):$target.css($trigger.data("value"))?(value=$target.css($trigger.data("value")),$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):($trigger.css("background-color",""),$trigger.attr("title",__("No value set")))})};widgetObj=$.farbtastic(widget).linkTo(input),widget.on("colorchange.farbtastic",function(e,color){styleEditor.apply(widget.prop("target"),currentProperty,color),setTriggerColor()}),setTriggerColor(),colorTriggers.add(colorTriggerLabels).on("click",function(){
var $tmpTrigger=$(this),$trigger="label"===this.nodeName.toLowerCase()?$tmpTrigger.parent().find(".color-trigger"):$tmpTrigger;$trigger.css("background-color");widget.prop("target",$trigger.data("target")),widgetBox.hide(),currentProperty=$trigger.data("value"),setTitle(currentProperty,$trigger),widgetObj.setColor(rgbToHex($trigger.css("background-color"))),widgetBox.show()}),$doc.on("mouseup",function(e){return $(e.target).hasClass("closer")?(widgetBox.hide(),!1):widgetBox.is(e.target)||0!==widgetBox.has(e.target).length?void 0:(widgetBox.hide(),!1)}),$doc.on("keyup",function(e){return 27===e.keyCode?(widgetBox.hide(),!1):void 0}),resetButtons.on("click",function(){
var $this=$(this),$colorTrigger=$this.parent().find(".color-trigger"),target=$colorTrigger.data("target"),value=$colorTrigger.data("value");styleEditor.apply(target,value),setTriggerColor()}),$doc.on("customcssloaded.styleeditor",setTriggerColor)};return colorSelector}),define("taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger",["jquery","lodash","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor"],function($,_,styleEditor){"use strict";var fontSizeChanger=function(){var $fontSizeChanger=$("#item-editor-font-size-changer"),itemSelector=$fontSizeChanger.data("target"),$item=$(itemSelector),itemFontSize=parseInt($item.css("font-size"),10),$resetBtn=$fontSizeChanger.parents(".reset-group").find('[data-role="font-size-reset"]'),$input=$("#item-editor-font-size-text"),resizeFont=function(){
styleEditor.apply(itemSelector+" *","font-size",itemFontSize.toString()+"px")};$fontSizeChanger.find("a").on("click",function(e){if(e.preventDefault(),"reduce"===$(this).data("action")){if(10>=itemFontSize)return;itemFontSize--}else itemFontSize++;resizeFont(),$input.val(itemFontSize),$(this).parent().blur()}),$input.on("keydown",function(e){var c=e.keyCode;return _.contains([8,37,39,46],c)||c>=48&&57>=c||c>=96&&105>=c}),$input.on("blur",function(){itemFontSize=parseInt(this.value,10),resizeFont()}),$input.on("keydown",function(e){var c=e.keyCode;13===c&&$input.trigger("blur")}),$resetBtn.on("click",function(){$input.val(""),styleEditor.apply(itemSelector+" *","font-size");
}),$(document).on("customcssloaded.styleeditor",function(e,style){style[itemSelector]&&style[itemSelector]["font-size"]?($input.val(parseInt(style[itemSelector]["font-size"],10)),$input.trigger("blur")):$input.val(parseInt($item.css("font-size"),10))})};return fontSizeChanger}),define("taoQtiItem/qtiCreator/editor/styleEditor/itemResizer",["jquery","lodash","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","nouislider","jqueryui"],function($,_,styleEditor){"use strict";var itemResizer=function(item){var itemResizer=$("#item-editor-item-resizer"),target=itemResizer.data("target"),$target=$(target),targetWidth=$target.width(),itemWidthPrompt=itemResizer.find('[name="item-width-prompt"]'),sliderBox=itemResizer.find(".slider-box"),slider=itemResizer.find("#item-editor-item-resizer-slider"),input=$("#item-editor-item-resizer-text"),resetButton=itemResizer.find('[data-role="item-width-reset"]'),sliderSettings={
range:{min:Math.min(768,targetWidth),max:Math.max(1200,targetWidth)},start:targetWidth},reset=function(){itemResizer.find('[value="no-slider"]').trigger("click")},resizeItem=function(val){val=parseInt(val).toString()+"px",styleEditor.apply(target,"width",val),styleEditor.apply(target,"max-width","none"),item.data("widget").$container.trigger("resize.itemResizer")};itemWidthPrompt.on("click",function(){"slider"===this.value?(resizeItem($target.width()),input.val($target.width()),sliderBox.slideDown(),slider.val($target.width()).trigger("slide"),item.data("responsive",!1)):(slider.val(sliderSettings.start),sliderBox.slideUp(),input.val(""),styleEditor.apply(target,"width"),
styleEditor.apply(target,"max-width"),item.data("responsive",!0))}),slider.noUiSlider(sliderSettings),slider.on("slide",function(){var value=Math.round(slider.val());input.val(value),resizeItem(value)}),input.on("keydown",function(e){var c=e.keyCode;return _.contains([8,37,39,46],c)||c>=48&&57>=c||c>=96&&105>=c}),input.on("blur",function(){resizeItem(this.value)}),resetButton.on("click",reset),$(document).on("customcssloaded.styleeditor",function(e,style){var width;style[target]&&style[target].width?(width=parseInt(style[target].width,10),input.val(width),slider.val(width),itemResizer.find('[value="slider"]').trigger("click")):input.val($target.width())})};return itemResizer;
}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="feedback-',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+' popup">\n    <span class="icon-',
(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n    ',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+'" class="icon-close close-trigger"></span>\n</div>';
})}),define("taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler",["jquery","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","i18n","helpers","lodash","taoQtiItem/qtiCreator/model/Stylesheet","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","ui/resourcemgr"],function($,styleEditor,__,helpers,_,Stylesheet,genericFeedbackPopup){"use strict";var $doc=$(document),styleSheetToggler=function(){var init=function(itemConfig){var cssToggler=$("#style-sheet-toggler"),uploader=$("#stylesheet-uploader"),customCssToggler=$("[data-custom-css]"),getContext=function(trigger){trigger=$(trigger);var li=trigger.closest("li"),stylesheetObj=li.data("stylesheetObj")||new Stylesheet({
href:li.data("css-res")}),input=li.find(".style-sheet-label-editor"),labelBox=input.prev(".file-label"),label=input.val();return{li:li,input:input,label:label,labelBox:labelBox,isCustomCss:!!li.data("custom-css"),isDisabled:li.find(".icon-preview").hasClass("disabled"),stylesheetObj:stylesheetObj,cssUri:stylesheetObj.attr("href")}};uploader.on("click",function(){uploader.resourcemgr({appendContainer:"#mediaManager",path:"/",root:"local",browseUrl:helpers._url("files","ItemContent","taoItems"),uploadUrl:helpers._url("upload","ItemContent","taoItems"),deleteUrl:helpers._url("delete","ItemContent","taoItems"),downloadUrl:helpers._url("download","ItemContent","taoItems"),
fileExistsUrl:helpers._url("fileExists","ItemContent","taoItems"),params:{uri:itemConfig.uri,lang:itemConfig.lang,filters:"text/css"},pathParam:"path",select:function(e,files){var i,l=files.length;for(i=0;l>i;i++)styleEditor.addStylesheet(files[i].file)}})});var deleteStylesheet=function(trigger){var context=getContext(trigger),attr=context.isDisabled?"disabled-href":"href",cssLinks=$("head link");styleEditor.getItem().removeStyleSheet(context.stylesheetObj),cssLinks.filter("["+attr+'*="'+context.cssUri+'"]').remove(),context.li.remove(),$(".feedback-info").hide(),_createInfoBox({message:__("Style Sheet <b>%s</b> removed<br> Click <i>Add Style Sheet</i> to re-apply.").replace("%s",context.label),
type:"info"}),$doc.trigger("customcssloaded.styleeditor",[styleEditor.getStyle()])},initLabelEditor=function(trigger){var context=getContext(trigger);context.labelBox.hide(),context.input.show()},downloadStylesheet=function(trigger){styleEditor.download(getContext(trigger).cssUri)},saveLabel=function(trigger){var context=getContext(trigger),title=$.trim(context.input.val());return title?(context.stylesheetObj.attr("title",title),context.input.hide(),void context.labelBox.html(title).show()):(context.stylesheetObj.attr("title",""),!1)},handleAvailability=function(trigger){var link,context=getContext(trigger),attrTo="disabled-href",attrFrom="href";context.isCustomCss?context.isDisabled?(styleEditor.create(),
customCssToggler.removeClass("not-available")):(styleEditor.erase(),customCssToggler.addClass("not-available")):(context.isDisabled&&(attrTo="href",attrFrom="disabled-href"),link=$("link["+attrFrom+'$="'+context.cssUri+'"]'),link.attr(attrTo,link.attr(attrFrom)).removeAttr(attrFrom)),$(trigger).toggleClass("disabled")};cssToggler.on("click",function(e){var target=e.target,className=target.className;className.indexOf("icon-bin")>-1?deleteStylesheet(e.target):className.indexOf("file-label")>-1?initLabelEditor(e.target):className.indexOf("icon-preview")>-1?handleAvailability(e.target):className.indexOf("icon-download")>-1&&downloadStylesheet(e.target)}),cssToggler.on("keydown","input",function(e){
13===e.keyCode&&$(e.target).trigger("blur")}),cssToggler.on("blur","input",function(e){saveLabel(e.target)})},_createInfoBox=function(data){var $messageBox=$(genericFeedbackPopup(data)),closeTrigger=$messageBox.find(".close-trigger");return $("body").append($messageBox),closeTrigger.on("click",function(){$messageBox.fadeOut(function(){$(this).remove()})}),setTimeout(function(){closeTrigger.trigger("click")},4523),$messageBox};return{init:init}}();return styleSheetToggler}),define("taoQtiItem/qtiCreator/helper/itemSerializer",["lodash"],function(_){"use strict";var itemSerializer={serialize:function(item){var serialized="";if(item)try{serialized=JSON.stringify(item.toArray());
}catch(e){console.error(e)}return serialized}};return itemSerializer}),define("taoQtiItem/qtiCreator/editor/editor",["jquery","lodash","helpers","core/dataattrhandler","taoItems/preview/preview","taoQtiItem/qtiCreator/editor/preparePrint","taoQtiItem/qtiCreator/editor/styleEditor/fontSelector","taoQtiItem/qtiCreator/editor/styleEditor/colorSelector","taoQtiItem/qtiCreator/editor/styleEditor/fontSizeChanger","taoQtiItem/qtiCreator/editor/styleEditor/itemResizer","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/editor/styleEditor/styleSheetToggler","taoQtiItem/qtiCreator/helper/itemSerializer"],function($,_,helpers,dataAttrHandler,preview,preparePrint,fontSelector,colorSelector,fontSizeChanger,itemResizer,styleEditor,styleSheetToggler,itemSerializer){
"use strict";function limitItemPanelWidth(){var itemEditorPanel=document.getElementById("item-editor-panel"),width=function(){var _width=$("#panel-authoring").outerWidth();return $(".item-editor-sidebar").each(function(){_width-=$(this).outerWidth()}),_width.toString()}(),prefixes=["webkit","ms",""];_.forEach(prefixes,function(prefix){itemEditorPanel.style[prefix+(prefix?"Flex":"flex")]="0 0 "+width+"px"}),itemEditorPanel.style.maxWidth=width+"px"}var lastItemData,askForSave=!1,serializeItem=function(element){return itemSerializer.serialize(element)},setLastItemData=function(element){lastItemData=serializeItem(element)},initLastItemData=function(element){_.isUndefined(lastItemData)&&setLastItemData(element);
},initStyleEditor=function(widget,config){styleEditor.init(widget.element,config),styleSheetToggler.init(config),fontSelector(),colorSelector(),fontSizeChanger(),itemResizer(widget.element)},_confirmPreview=function(overlay){var confirmBox=$(".preview-modal-feedback"),cancel=confirmBox.find(".cancel"),save=confirmBox.find(".save");confirmBox.find(".modal-close");confirmBox.modal({width:500}),save.on("click",function(){overlay.trigger("save.preview"),confirmBox.modal("close")}),cancel.on("click",function(){confirmBox.modal("close")})},initPreview=function(widget){var previewContainer,previewUrl;if(initLastItemData(widget.element),!askForSave){var currentItemData=serializeItem(widget.element);
(lastItemData!==currentItemData||""===currentItemData)&&(lastItemData=currentItemData,askForSave=!0)}previewUrl=helpers._url("index","QtiPreview","taoQtiItem")+"?uri="+encodeURIComponent(widget.itemUri),previewContainer=preview.init(previewUrl),askForSave?(_confirmPreview(previewContainer),previewContainer.on("save.preview",function(){previewContainer.off("save.preview"),askForSave=!1,$.when(styleEditor.save(),widget.save()).done(function(){preview.show()})})):preview.show()},initGui=function(widget,config){lastItemData=void 0,askForSave=!!widget.element.data("new"),initLastItemData(widget.element),$("#save-trigger").off(".qti-creator").on("click.qti-creator",function(){
setLastItemData(widget.element)}).on("aftersave.qti-creator",function(event,success){success&&(askForSave=!1)}),$(document).off("stylechange.qti-creator").on("stylechange.qti-creator",function(event,detail){askForSave=!detail||!detail.initializing}),updateHeight(),limitItemPanelWidth(),$(window).off("resize.qti-editor").on("resize.qti-editor",_.throttle(function(){updateHeight(),limitItemPanelWidth()},50)),initStyleEditor(widget,config),preparePrint();var $itemPanel=$("#item-editor-panel"),$label=$("#item-editor-label"),$actionGroups=$(".action-group");$itemPanel.addClass("has-item"),$label.text(config.label),$actionGroups.show()},updateHeight=function(){var footerTop,contentWrapperTop,remainingHeight,$itemEditorPanel=$("#item-editor-panel"),$itemSidebars=$(".item-editor-sidebar"),$contentPanel=$("#panel-authoring");
$contentPanel.length&&$itemEditorPanel.length&&(footerTop=function(){var footerTop,$footer=$("body > footer");return $itemSidebars.hide(),footerTop=$footer.offset().top,$itemSidebars.show(),footerTop}(),contentWrapperTop=$contentPanel.offset().top,remainingHeight=footerTop-contentWrapperTop-$(".item-editor-action-bar").outerHeight(),$itemEditorPanel.find("#item-editor-scroll-outer").css({minHeight:remainingHeight,maxHeight:remainingHeight,height:remainingHeight}),$itemSidebars.css({minHeight:remainingHeight,maxHeight:remainingHeight,height:remainingHeight}))};return{initGui:initGui,initPreview:initPreview}}),define("taoQtiItem/qtiCreator/editor/customElementRegistryFactory",["lodash","jquery","helpers"],function(_,$,helpers){
"use strict";function create(options){function isValidHook(hook){if(!hook.typeIdentifier)throw"invalid hook : missing typeIdentifier";if(!hook.baseUrl)throw"invalid hook : missing baseUrl";if(!hook.file)throw"invalid hook : missing file";return!0}function register(hooks){var paths={};_(hooks).values().each(function(hook){if(isValidHook(hook)){var id=hook.typeIdentifier;_registeredHooks[id]=hook,paths[id]=hook.baseUrl,_.isFunction(options.onRegister)&&options.onRegister(hook)}}),_requirejs.config({paths:paths})}function loadAll(callback){var required=[];_.each(_registeredHooks,function(hook){required.push(hook.file)}),_requirejs(required,function(){var creators={};
_.each(arguments,function(creator){var id=creator.getTypeIdentifier();creators[id]=creator,_registeredHooks[id].creator=creator}),callback(creators)})}function loadOne(typeIdentifier,callback){var hook=_registeredHooks[typeIdentifier];if(!hook)throw"cannot load the hook because it is not registered "+typeIdentifier;_requirejs([hook.file],function(creator){hook.creator=creator,callback(creator)})}function getCreator(typeIdentifier){var hook=_registeredHooks[typeIdentifier];if(hook){if(hook.creator)return hook.creator;throw"the hook is not loaded "+typeIdentifier}throw"the hook is not registered "+typeIdentifier}function isDev(typeIdentifier){return _registeredHooks[typeIdentifier]&&_registeredHooks[typeIdentifier].dev;
}function get(typeIdentifier){return _registeredHooks[typeIdentifier]}function getBaseUrl(typeIdentifier){return get(typeIdentifier).baseUrl}function getManifest(typeIdentifier){return get(typeIdentifier).manifest}function isDev(typeIdentifier){return _registeredHooks[typeIdentifier]&&_registeredHooks[typeIdentifier].dev}function addRequiredResources(typeIdentifier,itemUri,callback){var registryClass=encodeURIComponent(get(typeIdentifier).registry);return $.getJSON(_urls.addRequiredResources,{registryClass:registryClass,typeIdentifier:typeIdentifier,uri:itemUri},function(r){_.isFunction(callback)&&callback(r)})}options=options||{},options=_.defaults(options,_defaults);
var _registeredHooks={},_requirejs=window.require;return{register:register,loadAll:loadAll,loadOne:loadOne,getBaseUrl:getBaseUrl,getCreator:getCreator,isDev:isDev,get:get,getManifest:getManifest,addRequiredResources:addRequiredResources}}var _defaults={onRegister:_.noop},_urls={addRequiredResources:helpers._url("addRequiredResources","PortableElement","taoQtiItem")};return{create:create}}),define("taoQtiItem/qtiCreator/editor/customInteractionRegistry",["lodash","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/customElementRegistryFactory"],function(_,qtiElements,factory){"use strict";var registry=factory.create({onRegister:function(hook){
qtiElements.classes["customInteraction."+hook.typeIdentifier]={parents:["customInteraction"],qti:!0}}});return registry.getAuthoringData=function(typeIdentifier){var manifest=registry.getManifest(typeIdentifier);return{label:manifest.label,icon:registry.getBaseUrl(typeIdentifier)+manifest.icon,"short":manifest["short"],description:manifest.description,qtiClass:"customInteraction."+manifest.typeIdentifier,tags:_.union(["Custom Interactions"],manifest.tags)}},registry}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionButton",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,helper,buffer="";return buffer+='\n    data-sub-group="',(helper=helpers.subGroup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.subGroup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n'}function program3(depth0,data){return'\n    class="disabled"\n    title="element available in the final release"\n'}function program5(depth0,data){var stack1,helper,buffer="";return buffer+='\n    title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data
}):helper),buffer+=escapeExpression(stack1)+'"\n'}function program7(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <span class="icon ',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n    '}function program9(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <img class="icon" src="',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'">\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<li\n",stack1=helpers["if"].call(depth0,depth0&&depth0.subGroup,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    data-qti-class="',(helper=helpers.qtiClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.qtiClass,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n\n',
stack1=helpers["if"].call(depth0,depth0&&depth0.disabled,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.iconFont,{hash:{},inverse:self.program(9,program9,data),fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    \n    <div class="truncate">',(helper=helpers["short"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["short"],stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\n</li>";
})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionGroup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<section class="tool-group" id="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <h2>',(helper=helpers.label)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h2>\n    <div class="panel clearfix">\n        <ul class="tool-list plain"></ul>\n    </div>\n</section>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">\n        ',
(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/editor/interactionsToolbar",["jquery","lodash","i18n","taoQtiItem/qtiCreator/editor/customInteractionRegistry","tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionButton","tpl!taoQtiItem/qtiCreator/tpl/toolbars/insertInteractionGroup","tpl!taoQtiItem/qtiCreator/tpl/toolbars/tooltip","ui/tooltipster"],function($,_,__,ciRegistry,insertInteractionTpl,insertSectionTpl,tooltipTpl,tooltip){
"use strict";function getGroupId(groupLabel){return groupLabel.replace(/\W+/g,"-").toLowerCase()}function getGroupSectionId(groupLabel){return"sidebar-left-section-"+getGroupId(groupLabel)}function addGroup($sidebar,groupLabel){var groupId=getGroupSectionId(groupLabel),$section=$(insertSectionTpl({id:groupId,label:groupLabel}));return $sidebar.append($section),$section}function create($sidebar,interactions){_.each(interactions,function(interactionAuthoringData){add($sidebar,interactionAuthoringData)}),buildSubGroups($sidebar),$sidebar.data("interaction-toolbar-ready",!0),$sidebar.trigger(_events.interactiontoolbarready)}function getGroup($sidebar,groupLabel){
var groupId=getGroupSectionId(groupLabel);return $sidebar.find("#"+groupId)}function isReady($sidebar){return!!$sidebar.data("interaction-toolbar-ready")}function remove($sidebar,interactionClass){$sidebar.find('li[data-qti-class="'+interactionClass+'"]:not(.dev)').remove()}function exists($sidebar,interactionClass){return!!$sidebar.find('li[data-qti-class="'+interactionClass+'"]').length}function add($sidebar,interactionAuthoringData){if(exists($sidebar,interactionAuthoringData.qtiClass))throw"the interaction is already in the sidebar";var groupLabel=interactionAuthoringData.tags[0]||"",subGroupId=interactionAuthoringData.tags[1],$group=getGroup($sidebar,groupLabel),tplData={
qtiClass:interactionAuthoringData.qtiClass,disabled:!!interactionAuthoringData.disabled,title:interactionAuthoringData.description,iconFont:/^icon-/.test(interactionAuthoringData.icon),icon:interactionAuthoringData.icon,"short":interactionAuthoringData["short"],dev:_customInteractionTag===groupLabel&&ciRegistry.isDev(interactionAuthoringData.qtiClass.replace("customInteraction.",""))};subGroupId&&_subgroups[subGroupId]&&(tplData.subGroup=subGroupId),$group.length||($group=addGroup($sidebar,groupLabel)),subGroupId&&_subgroups[subGroupId]&&(tplData.subGroup=subGroupId),$group.length||($group=addGroup($sidebar,groupLabel));var $interaction=$(insertInteractionTpl(tplData));
return $group.find(".tool-list").append($interaction),$interaction}function buildSubGroups($sidebar){$sidebar.find("[data-sub-group]").each(function(){var $subGroupPanel,$subGroupList,$cover,$element=$(this),$section=$element.parents("section"),subGroup=$element.data("sub-group");subGroup&&($subGroupPanel=$section.find(".sub-group."+subGroup),$subGroupList=$subGroupPanel.find(".tool-list"),$subGroupPanel.length||($subGroupPanel=$("<div>",{"class":"panel clearfix sub-group "+subGroup}),$subGroupList=$("<ul>",{"class":"tool-list plain clearfix"}),$subGroupPanel.append($subGroupList),$section.append($subGroupPanel),$cover=$("<div>",{"class":"sub-group-cover blocking"
}),$subGroupPanel.append($cover),$subGroupPanel.data("cover",$cover)),$subGroupList.append($element))}),addInlineInteractionTooltip()}function addInlineInteractionTooltip(){var timer,$inlineInteractionsPanel=$("#sidebar-left-section-inline-interactions .inline-interactions"),$tooltip=$(tooltipTpl({message:__("Inline interactions need to be inserted into a text block.")}));$inlineInteractionsPanel.append($tooltip),tooltip($inlineInteractionsPanel),$tooltip.css({position:"absolute",zIndex:11,top:0,right:10}),$inlineInteractionsPanel.on("mouseenter",".sub-group-cover",function(){timer=setTimeout(function(){$tooltip.find("[data-tooltip]").tooltipster("show")},300);
}).on("mouseleave",".sub-group-cover",function(){$tooltip.find("[data-tooltip]").tooltipster("hide"),clearTimeout(timer)})}var _customInteractionTag="Custom Interactions",_subgroups={"inline-interactions":"Inline Interactions"},_events={interactiontoolbarready:"interactiontoolbarready.qti-widget"};return{create:create,add:add,exists:exists,addGroup:addGroup,getGroupId:getGroupId,getGroupSectionId:getGroupSectionId,getGroup:getGroup,isReady:isReady,remove:remove,getCustomInteractionTag:function(){return _customInteractionTag}}}),define("taoQtiItem/qtiCreator/editor/infoControlRegistry",["taoQtiItem/qtiCreator/editor/customElementRegistryFactory"],function(factory){
"use strict";return factory.create()}),define("tpl!taoQtiItem/qtiCreator/editor/blockAdder/tpl/addColumnRow",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="add-block-element">\n    <div class="line"></div>\n    <div class="circle" title="Insert block below"><span>+</span></div>\n</div>'})}),define("taoQtiItem/qtiCreator/editor/gridEditor/config",[],function(){"use strict";return{min:{interaction:2,text:1,rubricBlock:12},throttle:{resize:100}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/helper",[],function(){
"use strict";var helpers={getColUnits:function($elt){var cssClasses=$elt.attr("class");if(!cssClasses)throw new Error("the element has no css class");var colMatch=cssClasses.match(/col-([\d]+)/);if(colMatch&&colMatch.length)return parseInt(colMatch.pop());throw"the element has no col-* class"},setUnitsFromClass:function($el){var units=helpers.getColUnits($el);return $el.attr("data-units",units),units}};return helpers}),define("taoQtiItem/qtiCreator/editor/gridEditor/resizable",["lodash","jquery","taoQtiItem/qtiCreator/editor/gridEditor/config","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/helper/qtiElements","jqueryui"],function(_,$,config,helper,qtiElements){
"use strict";var _syncHandleHeight=function($row){var h=$row.height()-parseFloat($row.children('[class^="col-"], [class*=" col-"]').css("margin-bottom"));$row.find(".grid-edit-resizable-zone").height(h)},_createResizables=function($el){var marginWidth=parseFloat($el.find('[class^="col-"]:last, [class*=" col-"]:last').css("margin-left")),activeWidth=20;$el.find('[class^="col-"], [class*=" col-"]').each(function(){var $col=$(this);if($col.parent().hasClass("fixed-grid-row"))return!0;if($col.children(".grid-edit-resizable-zone").length)return!0;var $nextCol=$col.next(),$row=$col.parent(".grid-row"),offset=$col.offset(),max=12,min=qtiElements.is($col.data("qti-class"),"interaction")?config.min.interaction:config.min.text,nextMin=qtiElements.is($nextCol.data("qti-class"),"interaction")?config.min.interaction:config.min.text,unitWidth=$row.width()/max,activeHeight=$row.height()-parseFloat($col.css("margin-bottom")),$activeZone=$("<div>",{
"class":"grid-edit-resizable-zone grid-edit-resizable-zone-active"}).css({top:0,right:-(marginWidth+(activeWidth-marginWidth)/2),width:activeWidth,height:activeHeight}),$handle=$("<span>",{"class":"grid-edit-resizable-handle"});$activeZone.append($handle),$col.append($activeZone);var _syncOutlineHeight=function(){var h=$row.height()-parseFloat($col.css("margin-bottom"));$col.find(".grid-edit-resizable-outline").height(h),$activeZone.height(h)};$activeZone.draggable({containment:$nextCol.length?[offset.left+min*unitWidth-2*marginWidth+10,offset.top,offset.left+$col.outerWidth()+marginWidth+$nextCol.outerWidth()-nextMin*unitWidth-activeWidth/2-10,offset.top+$col.height()]:[offset.left+min*unitWidth-marginWidth-activeWidth/2-10,offset.top,$row.offset().left+$row.outerWidth()-marginWidth-activeWidth/2-12,offset.top+$col.height()],
axis:"x",cursor:"col-resize",start:function(){$col.trigger("resizestart.gridEdit");var $overlay=$("<div>",{"class":"grid-edit-resizable-outline"});$nextCol.length?$overlay.width(parseFloat($col.outerWidth())+marginWidth+parseFloat($nextCol.outerWidth())):$overlay.css({width:"100%","border-right-width":0}),$(this).data("overlay",$overlay),$col.append($overlay),$handle.addClass("grid-edit-resizable-active"),$el.find(".grid-edit-resizable-zone-active").removeClass("grid-edit-resizable-zone-active"),_syncOutlineHeight()},drag:_.throttle(function(){var width=$(this).offset().left+activeWidth/2-offset.left,units=helper.getColUnits($col),nextUnits=$nextCol.length?helper.getColUnits($nextCol):0;
$nextCol.length||$col.find(".grid-edit-resizable-outline").width($handle.offset().left-offset.left),(units-1)*unitWidth>width+0*marginWidth?(units--,_setColUnits($col,units),$nextCol.length&&(nextUnits++,_setColUnits($nextCol,nextUnits)),_syncOutlineHeight(),$col.trigger("resize.gridEdit")):width+marginWidth+20>(units+1)*unitWidth&&(units++,_setColUnits($col,units),$nextCol.length&&(nextUnits--,_setColUnits($nextCol,nextUnits)),_syncOutlineHeight(),$col.trigger("resize.gridEdit"))},config.throttle.resize),stop:function(){$col.find(".grid-edit-resizable-outline").remove(),_deleteResizables($el),_createResizables($el),$col.trigger("resizestop.gridEdit")}}).css("position","absolute");
}),$el.off(".gridEdit.resizable").on("dragoverstart.gridEdit.resizable",function(){_deleteResizables($el)}).on("dragoverstop.gridEdit.resizable",function(){_createResizables($el)}).on("contentChange.gridEdit.resizable",".grid-row",function(){_deleteResizables($el),_createResizables($el)})},_deleteResizables=function($el){$el.find(".grid-edit-resizable-zone").remove()},_setColUnits=function($elt,newUnits){if(!$elt.attr("class").match(/col-([\d]+)/))throw $.error("the element is not a grid column");var oldUnits=$elt.attr("data-units"),$parentRow=$elt.parent(".grid-row"),totalUnits=$parentRow.attr("data-units");$parentRow.attr("data-units",totalUnits-oldUnits+newUnits),
$elt.attr("data-units",newUnits),$elt.removeClass("col-"+oldUnits).addClass("col-"+newUnits)};return{create:function($element){_createResizables($element),$(window).off("resize.qtiEdit.resizable").on("resize.qtiEdit.resizable",function(){_deleteResizables($element),_createResizables($element)})},destroy:function($element,preserveGlobalEvents){_deleteResizables($element),preserveGlobalEvents||$(window).off("resize.qtiEdit.resizable")},syncHandleHeight:function($row){$row.hasClass("grid-row")?_syncHandleHeight($row):$row.find(".grid-row").each(function(){_syncHandleHeight($(this))})}}}),define("taoQtiItem/qtiCreator/editor/gridEditor/content",["jquery","lodash","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function($,_,resizable){
"use strict";var contentHelper={};return contentHelper.getContent=function(element,opts){var options=_.defaults({inner:!0},opts),$body=options.inner?$(element).clone():$("<div>",{"class":"col-fictive content-helper-wrapper"}).append($(element).clone());return contentHelper.destroyGridWidgets($body,!0),contentHelper.serializeElements($body),$body.html()},contentHelper.getChangeCallback=function(container){return _.throttle(function(data){var $pseudoContainer=$("<div>").html(data),newBody=contentHelper.getContent($pseudoContainer);container.body(newBody)},800)},contentHelper.getChangeCallbackForBlockStatic=function(container){return _.throttle(function(data){var $pseudoContainer=$("<div>").html(data);
$pseudoContainer.contents().each(function(){return 3===this.nodeType&&this.nodeValue.trim()?($pseudoContainer.wrapInner("<p>"),$pseudoContainer=$("<div>").html($pseudoContainer.html()),!1):void 0}),container.body(contentHelper.getContent($pseudoContainer))},800)},contentHelper.serializeElements=function($el){var existingElements=[];return $el.find(".widget-box:not(.widget-box *)").each(function(){var $qtiElementWidget=$(this);if($qtiElementWidget.data("serial")){var serial=$qtiElementWidget.data("serial");$qtiElementWidget.replaceWith("{{"+serial+"}}"),existingElements.push(serial)}else{if(!$qtiElementWidget.data("new")||!$qtiElementWidget.data("qti-class"))throw"unknown qti-widget type";
var qtiClass=$qtiElementWidget.data("qti-class");$qtiElementWidget.replaceWith("{{"+qtiClass+":new}}")}}),existingElements},contentHelper.destroyGridWidgets=function($elt,inClone){$elt.removeData("qti-grid-options"),$elt.find('.grid-row, [class*=" col-"], [class^="col-"]').removeAttr("style").removeAttr("data-active").removeAttr("data-units"),$elt.children(".ui-draggable-dragging").remove(),resizable.destroy($elt,inClone),$elt.find(".contextual-popup").remove()},contentHelper}),define("tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/popup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="contextual-popup" style="top:'+escapeExpression((stack1=depth0&&depth0.popup,stack1=null==stack1||stack1===!1?stack1:stack1.top,typeof stack1===functionType?stack1.apply(depth0):stack1))+"px; left:"+escapeExpression((stack1=depth0&&depth0.popup,stack1=null==stack1||stack1===!1?stack1:stack1.left,typeof stack1===functionType?stack1.apply(depth0):stack1))+'px">\n    <div class="arrow" style="left:'+escapeExpression((stack1=depth0&&depth0.arrow,
stack1=null==stack1||stack1===!1?stack1:stack1.left,typeof stack1===functionType?stack1.apply(depth0):stack1))+'px"></div>\n    <div class="arrow-cover" style="left:'+escapeExpression((stack1=depth0&&depth0.arrow,stack1=null==stack1||stack1===!1?stack1:stack1.leftCover,typeof stack1===functionType?stack1.apply(depth0):stack1))+'px"></div>\n    <div class="popup-content">',(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</div>\n    <div class="footer">\n        <button class="btn btn-info small done">done</button>\n        <a href="#" class="btn cancel" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"cancel",options):helperMissing.call(depth0,"__","cancel",options)))+'">cancel</a>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/content",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <li data-group-name="',(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"><a href="#" class="group-selector">',
(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</a></li>\n        "}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <div class="element-group" data-group-name="',(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <ul class="element-list plain">\n                ',stack1=helpers.each.call(depth0,depth0&&depth0.elements,{
hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </ul>\n        </div>\n        "}function program4(depth0,data){var stack1,helper,buffer="";return buffer+='\n                <li data-qti-class="',(helper=helpers.qtiClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.qtiClass,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                    ',stack1=helpers["if"].call(depth0,depth0&&depth0.iconFont,{hash:{},inverse:self.program(7,program7,data),fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                    <span class="label truncate">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n                </li>\n                "}function program5(depth0,data){var stack1,helper,buffer="";return buffer+='\n                    <span class="icon ',
(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n                    '}function program7(depth0,data){var stack1,helper,buffer="";return buffer+='\n                    <img class="icon" src="',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/>\n                    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="elementSelector">\n\n    <ul class="group-list plain">\n        ',stack1=helpers.each.call(depth0,depth0&&depth0.groups,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </ul>\n\n    <div class="element-group-container">\n        ',stack1=helpers.each.call(depth0,depth0&&depth0.groups,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n\n</div>"})}),define("taoQtiItem/qtiCreator/editor/elementSelector/selector",["jquery","lodash","tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/popup","tpl!taoQtiItem/qtiCreator/editor/elementSelector/tpl/content"],function($,_,popupTpl,contentTpl){
function create($anchor,$container,interactions){var positions=_computePosition($anchor,$container),$element=$(popupTpl({popup:positions.popup,arrow:positions.arrow,content:_renderContent(interactions)}));return $anchor.find(".contextual-popup").remove(),$anchor.append($element),$element.off(_ns).on("click"+_ns,".group-list li",function(){var $trigger=$(this);_activatePanel($element,$trigger)}).on("click"+_ns,".element-list li",function(){_activateElement($element,$(this))}).on("click"+_ns,".done",function(){_done($element)}).on("click"+_ns,".cancel",function(){_cancel($element)}),{getPopup:function(){return $element},reposition:function(){var pos=_computePosition($anchor,$container);
$element.css({top:pos.popup.top,left:pos.popup.left}),$element.children(".arrow").css("left",pos.arrow.left),$element.children(".arrow-cover").css("left",pos.arrow.leftCover)},activatePanel:function(groupName){activatePanel($element,groupName)},activateElement:function(qtiClass){activateElement($element,qtiClass)},done:function(){_done($element)},cancel:function(){_cancel($element)},show:function(){$element.show()},destroy:function(){$element.remove()}}}function _done($element){$element.hide(),$element.trigger("done"+_ns)}function _cancel($element){$element.hide(),$element.trigger("cancel"+_ns)}function activatePanel($container,groupName){var $trigger=$container.find('.group-list li[data-group-name="'+groupName+'"]');
_activatePanel($container,$trigger)}function _activatePanel($container,$trigger){if(!$trigger.hasClass("active")){$trigger.addClass("active").siblings(".active").removeClass("active");var group=$trigger.data("group-name"),$group=$container.find('.element-group[data-group-name="'+group+'"]');$group.show().siblings(".element-group").hide()}}function activateElement($container,qtiClass){var $trigger=$container.find('.element-list li[data-qti-class="'+qtiClass+'"]');_activateElement($container,$trigger)}function _activateElement($container,$trigger){var qtiClass=$trigger.data("qti-class");$trigger.hasClass("active")||($container.find(".element-list li").removeClass("active"),
$trigger.addClass("active"),$container.trigger("selected"+_ns,[qtiClass,$trigger]))}function _computePosition($anchor,$container){var popupWidth=500,arrowWidth=6,marginTop=15,marginLeft=15,_anchor={top:$anchor.offset().top,left:$anchor.offset().left,w:$anchor.innerWidth(),h:$anchor.innerHeight()},_container={top:$container.offset().top,left:$container.offset().left,w:$container.innerWidth()},_popup={top:_anchor.h+marginTop,left:-popupWidth/2+_anchor.w/2,w:popupWidth},offset=_anchor.left-_container.left;offset+marginLeft+_anchor.w/2<_popup.w/2?_popup.left=-offset+marginLeft:_container.w-(offset+_anchor.w/2+marginLeft)<_popup.w/2&&(_popup.left=-offset+_container.w-marginLeft-_popup.w);
var _arrow={left:-_popup.left+_anchor.w/2-arrowWidth,leftCover:-_popup.left+_anchor.w/2-arrowWidth-6};return{popup:_popup,arrow:_arrow}}function _filterInteractions(interactions){var block,filtered=_.filter(interactions,function(interaction){var tags=interaction.tags;return"_container"===interaction.qtiClass?(block=interaction,interaction.tags[0]="Text Block",!1):tags&&"Inline Interactions"!==tags[0]?!0:!1});return block.tags[0]="Text Block",filtered.unshift(block),filtered}function _renderContent(interactions){var groups=[];return _.each(_filterInteractions(interactions),function(interaction){var groupName=interaction.tags[0],panel=_.find(groups,{name:groupName
});panel||(panel={name:groupName,label:groupName.replace(/\sInteractions$/,""),elements:[]},groups.push(panel)),panel.elements.push({qtiClass:interaction.qtiClass,disabled:!!interaction.disabled,title:interaction.description,iconFont:/^icon-/.test(interaction.icon),icon:interaction.icon,label:interaction.label})}),contentTpl({groups:groups})}var _ns=".element-selector";return{create:create,activateElement:activateElement,activatePanel:activatePanel}}),define("taoQtiItem/qtiCreator/widgets/Widget",["lodash","jquery","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/helper/invalidator"],function(_,$,Element,invalidator){"use strict";var _pushState=function(widget,stateName){
var currentState=new widget.registeredStates[stateName](widget);widget.stateStack.push(currentState),currentState.init()},_popState=function(widget){var state=widget.stateStack.pop();state&&state.exit()},Widget={init:function(element,$original,$form,options){if(!(element instanceof Element))throw new Error("element is not a QTI Element");return options=options||{},this.element=element,this.serial=element.getSerial(),this.$original=$original,this.$form=$form,this.stateStack=[],this.registeredStates={},this.buildContainer(),this.$container.data("widget",this),this.$original.data("widget",this),this.element.data("widget",this),this.offEvents(),_.each(this.getRequiredOptions(),function(opt){
if(!options[opt])throw new Error("missing required option for image creator : "+opt)}),this.options=options,this.initCreator(options),options.state?this.changeState(options.state):this.changeState("sleep"),_.isFunction(options.ready)&&options.ready.call(this,this),this.$container.trigger("ready.qti-widget",[this]),this},getRequiredOptions:function(){return[]},buildContainer:function(){throw new Error("method buildContainer must be implemented")},build:function(element,$container,$form,options){return this.clone().init(element,$container,$form,options)},clone:function(){return _.clone(this)},initCreator:function(){},getCurrentState:function(){return _.last(this.stateStack);
},changeState:function(stateName){var state,superStateName,_this=this,currentState=this.getCurrentState();if(!this.registeredStates[stateName])throw new Error("unknown target state : "+stateName);if(state=new this.registeredStates[stateName],currentState){if(currentState.name===state.name)return this;if(_.indexOf(state.superState,currentState.name)>=0)for(var i=_.indexOf(state.superState,currentState.name)-1;i>=0;i--)superStateName=state.superState[i],_pushState(this,superStateName);else{if(_.indexOf(currentState.superState,state.name)>=0){for(var i=0;i<=_.indexOf(currentState.superState,state.name);i++)_popState(_this);return this}_popState(_this);var exitedStates=_.difference(currentState.superState,state.superState);
_.each(exitedStates,function(){_popState(_this)});var enteredStates=_.difference(state.superState,currentState.superState);_.eachRight(enteredStates,function(superStateName){_pushState(_this,superStateName)})}}else _.eachRight(state.superState,function(superStateName){_pushState(_this,superStateName)});return _pushState(this,stateName),this},registerState:function(name,State){if(!name||!State)throw new Error("missing required arguments in state registration");this.registeredStates[name]=State},registerStates:function(states){var _this=this;_.forIn(states,function(State,name){_this.registerState(name,State)})},afterStateInit:function(callback,ns){var evtName="afterStateInit.qti-widget."+this.serial+(ns?"."+ns:"");
$(document).on(evtName,callback)},beforeStateInit:function(callback,ns){var evtName="beforeStateInit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},afterStateExit:function(callback,ns){var evtName="afterStateExit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},beforeStateExit:function(callback,ns){var evtName="beforeStateExit.qti-widget."+this.serial+(ns?"."+ns:"");$(document).on(evtName,callback)},offEvents:function(ns){var evtName=".qti-widget."+this.serial+(ns?"."+ns:"");$(document).off(evtName)},destroy:function(){this.changeState("sleep"),this.$container.find("[data-edit]").remove(),$("[data-widget-component="+this.serial+"]").remove(),
this.offEvents()},rebuild:function(options){options=options||{};var element=this.element,postRenderOpts={};_.isFunction(options.ready)&&(postRenderOpts.ready=options.ready);var $container=null;$container=options.context&&options.context.length?options.context.find(".widget-box[data-serial="+element.serial+"]"):this.$container.length&&$.contains(document,this.$container[0])?this.$container:$(".widget-box[data-serial="+element.serial+"]"),this.destroy();var renderer=element.getRenderer();if(renderer&&renderer.isRenderer){if("creatorRenderer"===renderer.name)return element.render($container),element.postRender(postRenderOpts),element.data("widget");throw new Error("The renderer is no longer the creatorRenderer");
}throw new Error("No renderer found to rebuild the widget")},refresh:function(){var currentState=this.getCurrentState().name;this.rebuild({ready:function(widget){widget.changeState(currentState)}})},on:function(qtiElementEventName,callback,live){var _this=this,eventNames=qtiElementEventName.replace(/\s+/g," ").split(" "),$document=$(document);return _.each(eventNames,function(eventName){var eventNameToken=[eventName,"qti-widget",_this.serial];live||eventNameToken.push(_this.getCurrentState().name),$document.on(eventNameToken.join("."),function(e,data){callback.call(_this,data)})}),this},isValid:function(what,valid,why){var element=this.element;return void 0===what?invalidator.isValid(element):void(valid?invalidator.valid(element,what):invalidator.invalid(element,what,why,this.getCurrentState().name));
}};return Widget}),define("taoQtiItem/qtiCreator/editor/widgetToolbar",["jquery","i18n"],function($,__){"use strict";var defaultConfig=[[{title:"Question","class":"question-trigger",status:"off",fn:function(e){var target=arguments[1],toolbar=arguments[2],responseButton=toolbar.find(".answer-trigger a"),answerEditors=target.find('[data-edit="answer"]'),questionEditors=target.find('[data-edit="question"]');responseButton.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),questionEditors.show(),answerEditors.hide(),target.data("mode","question")}},{title:"Answer","class":"answer-trigger",fn:function(e){var target=arguments[1],toolbar=arguments[2],contentButton=toolbar.find(".question-trigger a"),answerEditors=target.find('[data-edit="answer"]'),questionEditors=target.find('[data-edit="question"]');
contentButton.removeClass("tlb-text-button-on").addClass("tlb-text-button-off"),answerEditors.show(),questionEditors.hide(),target.data("mode","answer"),target.find("[contenteditable]").attr("contenteditable",!1),$(document).trigger("widgetBlur")}}],"spacer",[{icon:"bin",title:"Delete",fn:function(e){var target=arguments[1],toolbar=arguments[2],msg=$("<span>",{text:__("You have deleted an element.")+" "}),undo=$("<a>",{text:__("Undo"),href:"#"}),icon=$("<span>",{"class":"icon-info"}),closer=$("<span>",{title:"Remove Message","class":"icon-close close-trigger"}),feedback=$("<div>",{"class":"feedback-info"}).hide();closer.on("click",function(){feedback.fadeOut(function(){
feedback.remove(),target.remove(),toolbar.remove()})}),undo.on("click",function(e){e.preventDefault(),feedback.remove(),target.removeClass("deleted").fadeIn()}),feedback.append(icon),feedback.append(msg),feedback.append(undo),feedback.append(closer),target.before(feedback),toolbar.hide(),target.hide().addClass("deleted"),feedback.fadeIn(function(){setTimeout(function(){closer.trigger("click")},6500)})}}]],structure=function(type){switch(type){case"/":type="break";break;case"-":type="separator";break;case" ":type="spacer"}return $("<span>",{"class":"tlb-"+type})},bar=function(items,target,toolbar){var group,i,bar=$("<div>",{"class":"tlb-bar"}),isTextButton=!items[0].icon,l=items.length;
if(bar.append(structure("start")),isTextButton)for(i=0;l>i;i++)"string"===$.type(items[i])?bar.append(structure(items[i])):(items[i].target=target,items[i].toolbar=toolbar,bar.append(button(items[i],isTextButton)));else for(group=$("<div>",{"class":"tlb-group"}),bar.append(group),i=0;l>i;i++)"string"===$.type(items[i])?group.append(structure(items[i])):(items[i].target=target,items[i].toolbar=toolbar,group.append(button(items[i],isTextButton)));return bar.append(structure("end")),bar},button=function(config,isTextButton){var a,span,button,icon,text,status=config.status||"off",fn=config.fn||function(){},target=config.target||$(),toolbar=config.toolbar||$();return delete config.status,
delete config.fn,delete config.target,delete config.toolbar,isTextButton?(text=__(config.title),delete config.title,config["class"]=config["class"]?config["class"]+" tlb-text-button-box":"tlb-text-button-box",button=$("<span>",config),a=$("<a>",{"class":"tlb-text-button-"+status}),span=$("<span>",{"class":"tlb-text",text:text}),button.append(a),a.append(span)):(icon="icon-"+config.icon.replace("icon-",""),delete config.icon,config["class"]=config["class"]?config["class"]+" tlb-button-"+status:"tlb-button-"+status,button=$("<a>",config),span=$("<span>",{"class":icon}),button.append(span)),button.on("click.toolbar",function(e){return button.hasClass("tlb-text-button-disabled")||button.hasClass("tlb-button-disabled")?!1:(isTextButton?button.find("a").toggleClass("tlb-text-button-off").toggleClass("tlb-text-button-on"):button.toggleClass("tlb-button-off").toggleClass("tlb-button-on"),
void fn.apply(this,[e,target,toolbar]))}),button},handleConfig=function(config,extendDefaultConfig){return $.isArray(config)&&!config.length&&(config=!1),config?extendDefaultConfig&&(config=$.extend(defaultConfig,config)):config=defaultConfig,config},buildToolbar=function(config,target,tlbWrapper){var i,tlb=$("<div>",{"class":"tlb"}),top=$("<div>",{"class":"tlb-top"}),box=$("<div>",{"class":"tlb-box"}),ic=config.length;for(top.append(box),tlb.append(top),i=0;ic>i;i++)"string"===$.type(config[i])?box.append(structure(config[i])):box.append(bar(config[i],target,tlbWrapper));return tlb.data("edit","toolbar"),tlb};return function(){var attach=function(buttonConfig,barConfig){
var toolbar,title,top,defaultBarConfig={offsetTop:-2,title:"",extendDefaultConfig:!1,target:$()},target=$(barConfig.target),tlbWrapper=target.prop("tlb")||$("<div>",{"class":"tlb-wrapper"});return target.prop("tlb")||(buttonConfig=handleConfig(buttonConfig,barConfig.extendDefaultConfig),barConfig=$.extend(defaultBarConfig,barConfig||{}),toolbar=buildToolbar(buttonConfig,target,tlbWrapper),barConfig.title&&(title=$("<span>",{text:barConfig.title,"class":"tlb-title",title:barConfig.title}),tlbWrapper.append(title)),tlbWrapper.append(toolbar),target.prop("tlb",tlbWrapper),target.append(tlbWrapper),tlbWrapper.css("position","absolute"),tlbWrapper.css("display","none"),
tlbWrapper.css("width","100%"),top=defaultBarConfig.offsetTop-tlbWrapper.height(),tlbWrapper.css("top",top)),tlbWrapper.fadeIn(),tlbWrapper};return{attach:attach}}()}),define("taoQtiItem/qtiCreator/widgets/static/Widget",["jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/editor/widgetToolbar"],function($,Widget,toolbar){"use strict";var StaticWidget=Widget.clone();return StaticWidget.initCreator=function(){Widget.initCreator.call(this),this.createToolbar()},StaticWidget.buildContainer=function(){var $wrap=$("<div>",{"data-serial":this.element.serial,"class":"widget-box"});this.$original.wrap($wrap),this.$container=this.$original.parent()},
StaticWidget.createToolbar=function(){return this},StaticWidget.getAssetManager=function(){if(!this.options||!this.options.assetManager)throw new Error("Asset Manager have to be provided");return this.options.assetManager},StaticWidget.createOkButton=function(){var _this=this;this.$container.append($("<button>",{"class":"btn-info small",type:"button",text:"OK","data-edit":"active"}).css({margin:"5px 10px",display:"none"}).on("click.qti-widget",function(e){e.stopPropagation(),_this.changeState("sleep")}))},StaticWidget}),define("taoQtiItem/qtiCreator/widgets/states/factory",["jquery","lodash"],function($,_){var _isValidStateDefinition=function(state){return _.isFunction(state)&&state.prototype.name&&state.prototype.superState&&_.isFunction(state.prototype.init)&&_.isFunction(state.prototype.exit)?!0:!1;
},_create=function(name,superStates,init,exit){var State=function(widget){this.widget=widget};return State.prototype.name=name,State.prototype.superState=superStates||[],init&&exit&&(State.prototype.init=function(){var $container=this.widget.$container;$container.data("edit")===name&&$container.show();var $editableWidgets=$container.find('[data-edit="'+name+'"]').filter(function(){var $parentWidget=$(this).closest(".widget-box");return $parentWidget.length&&$parentWidget[0]===$container[0]?!0:!1});$editableWidgets.show(),this.widget.$container.addClass("edit-"+name),$(document).trigger("beforeStateInit.qti-widget",[this.widget.element,this]),init.call(this),$(document).trigger("afterStateInit.qti-widget",[this.widget.element,this]);
},State.init=init,State.prototype.exit=function(){this.widget.$container.data("edit")===name&&this.widget.$container.hide(),this.widget.$container.find('[data-edit="'+name+'"]').hide(),this.widget.$container.removeClass("edit-"+name),$(document).trigger("beforeStateExit.qti-widget",[this.widget.element,this]),$(document).off([".qti-widget",name,this.widget.serial].join(".")),exit.call(this),$(document).trigger("afterStateExit.qti-widget",[this.widget.element,this])},State.exit=exit),State};return{create:function(){var State,name,superStates,init,exit;if(_.isString(arguments[0]))if(name=arguments[0],_.isArray(arguments[1])){if(superStates=arguments[1],!_.isFunction(arguments[2])||!_.isFunction(arguments[3]))throw new Error("the third and fourth arguments are expected to be functions: init() & exit()");
init=arguments[2],exit=arguments[3],State=_create(name,superStates,init,exit)}else{if(superStates=[],!_.isFunction(arguments[1])||!_.isFunction(arguments[2]))throw new Error("the second and third arguments are expected to be functions: init() & exit()");init=arguments[1],exit=arguments[2],State=_create(name,superStates,init,exit)}else{if(!_isValidStateDefinition(arguments[0]))throw new Error("invalid first argument : expected the state name (string) or a State (function)");if(name=arguments[0].prototype.name,superStates=arguments[0].prototype.superState,!_.isFunction(arguments[1])||!_.isFunction(arguments[2]))throw new Error("the second and third arguments are expected to be functions: init() & exit()");
init=arguments[1],exit=arguments[2],State=_create(name,superStates,init,exit)}return State},extend:function(State,init,exit){var initFn,exitFn,Clone=null;if(!_isValidStateDefinition(State))throw new Error("invalid state to be cloned");return _.isFunction(init)&&(initFn=function(){State.init.call(this),init.call(this)}),_.isFunction(exit)&&(exitFn=function(){exit.call(this),State.exit.call(this)}),Clone=_create(State.prototype.name,State.prototype.superState,initFn,exitFn),_.forIn(State.prototype,function(prop,name){if(_.isFunction(prop)){if(initFn&&"init"===name||exitFn&&"exit"===name)return!0;Clone.prototype[name]=prop,Clone[name]=prop}}),Clone},createBundle:function(arg0,arg1,arg2){
var stateBundle={},newStates=[],excluded=[];return arguments.length>=2?(stateBundle=_.clone(arguments[0]),newStates=arguments[1],excluded=arguments[2]||excluded):newStates=arguments[0],_.each(newStates,function(state){_isValidStateDefinition(state)&&(stateBundle[state.prototype.name]=state)}),_.each(excluded,function(state){delete stateBundle[state]}),stateBundle},throwMissingRequiredImplementationError:function(functionName){throw new Error("Missing required implementation of the function "+functionName+"()")}}}),define("taoQtiItem/qtiCreator/widgets/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("sleep",function(){
var widget=this.widget,$container=this.widget.$container;$container.on("mouseenter.sleep",function(e){$container.addClass("hover"),$container.parent().trigger("mouseleave")}).on("mouseleave.sleep",function(){$container.removeClass("hover"),$container.parent().trigger("mouseenter")}),widget.isValid()||widget.changeState("invalid")},function(){this.widget.$container.removeClass("hover").off(".sleep")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,SleepState){var StaticStateSleep=stateFactory.extend(SleepState,function(){var _widget=this.widget;
_widget.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),_widget.changeState("active")})},function(){var _widget=this.widget;_widget.$container.off(".sleep")});return StaticStateSleep}),define("taoQtiItem/qtiCreator/widgets/helpers/content",["jquery","lodash","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content"],function($,_,creatorRenderer,containerHelper,gridContentHelper){"use strict";var contentHelper={};return contentHelper.createElements=function(container,$container,data,callback){var $dummy=$("<div>").html(data);containerHelper.createElements(container,gridContentHelper.getContent($dummy),function(newElts){
creatorRenderer.get().load(function(){var serial,elt,$placeholder,$widget,widget;for(serial in newElts)elt=newElts[serial],$placeholder=$container.find(".widget-box[data-new][data-qti-class="+elt.qtiClass+"]"),elt.setRenderer(this),elt.render($placeholder),elt.postRender(),widget=elt.data("widget"),$widget=widget.$original,$widget.trigger("contentChange.gridEdit"),_.isFunction(callback)&&callback(widget)},this.getUsedClasses())})},contentHelper.changeInnerWidgetState=function(outerWidget,state){var selector=[];_.each(["img","math","object","include"],function(qtiClass){selector.push("[data-html-editable] .widget-"+qtiClass)}),outerWidget.$container.find(selector.join(",")).each(function(){
var innerWidget=$(this).data("widget");innerWidget&&innerWidget.changeState(state)})},contentHelper}),define("taoQtiItem/qtiCreator/widgets/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/content"],function($,stateFactory,contentHelper){return stateFactory.create("active",function(){var _widget=this.widget,container=_widget.$container[0],item=this.widget.element.getRelatedItem();$("#item-editor-panel").on("mousedown.active."+_widget.serial,function(e){container===e.target||$.contains(container,e.target)||$.contains($("#modalFeedbacks")[0],e.target)||_widget.changeState("sleep")}).on("beforesave.qti-creator.active",function(){
_widget.changeState("sleep")}).on("styleedit.active",function(){_widget.changeState("sleep")}),item&&item.data("widget")&&item.data("widget").$container.on("resizestart.gridEdit.active beforedragoverstart.gridEdit.active",function(){_widget.changeState("sleep")})},function(){contentHelper.changeInnerWidgetState(this.widget,"sleep"),this.widget.$container.off(".active"),$("#item-editor-panel").off(".active."+this.widget.serial);var item=this.widget.element.getRelatedItem();item&&item.data("widget")&&item.data("widget").$container.off(".active")})}),define("taoQtiItem/qtiCreator/widgets/static/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function($,stateFactory,Active){
return stateFactory.extend(Active,function(){var _widget=this.widget,$container=_widget.$container;_widget.beforeStateInit(function(e,element,state){var serial=element.getSerial();if("active"===state.name&&serial!==_widget.serial||"choice"===state.name)if("rubricBlock"===_widget.element.qtiClass){var composingElts=_widget.element.getComposingElements();composingElts[element.serial]||_widget.changeState("sleep")}else _widget.changeState("sleep")},"otherActive"),$container.on("mouseenter.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseenter.sleep");
}).on("click.active",function(e){e.stopPropagation()})},function(){this.widget.$container.off(".active"),$("#item-editor-panel").off(".active."+this.widget.serial),this.widget.offEvents("otherActive")})}),define("taoQtiItem/qtiCreator/widgets/states/Inactive",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("inactive",function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+="\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"You have deleted an element",options):helperMissing.call(depth0,"__","You have deleted an element",options)))+".\n    "}function program3(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"You have deleted",options):helperMissing.call(depth0,"__","You have deleted",options)))+" ",(helper=helpers.count)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.count,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"elements",options):helperMissing.call(depth0,"__","elements",options)))+".\n    "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return buffer+='<div class="feedback-info popup" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="icon-info"></span>\n    ',
helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data},stack1=helper?helper.call(depth0,depth0&&depth0.count,1,options):helperMissing.call(depth0,"equal",depth0&&depth0.count,1,options),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <a class="undo" href="#">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"undo",options):helperMissing.call(depth0,"__","undo",options)))+'</a>\n    <span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+'" class="icon-close close-trigger"></span>\n</div>';
})}),define("taoQtiItem/qtiCreator/widgets/helpers/deletingState",["lodash","jquery","tpl!taoQtiItem/qtiCreator/tpl/notifications/deletingInfoBox"],function(_,$,deletingInfoTpl){var _timeout=1e4,_bindEvents=function($messageBox){var timeout=setTimeout(function(){_confirmDeletion($messageBox,1e3)},_timeout);$("body").on("mousedown.deleting keydown.deleting",function(e){e.target===$messageBox[0]||$.contains($messageBox[0],e.target)||_confirmDeletion($messageBox,400)}),$messageBox.find("a.undo").on("click",function(e){e.preventDefault(),$messageBox.trigger("undo.deleting"),clearTimeout(timeout),$messageBox.remove()}),$messageBox.find(".close-trigger").on("click",function(e){
e.preventDefault(),_confirmDeletion($messageBox,0)})},_confirmDeletion=function($messageBox,fadeDelay){$messageBox.trigger("confirm.deleting"),$messageBox.fadeOut(fadeDelay,function(){$(this).remove()})},deletingHelper={createInfoBox:function(widgets){var $messageBox=$(deletingInfoTpl({serial:"widgets",count:widgets.length}));return $("body").append($messageBox),$messageBox.css({display:"block",position:"fixed",top:"50px",left:"50%","margin-left":"-200px",width:"400px",zIndex:999999}),_bindEvents($messageBox),_.each(widgets,function(w){w.on("beforeStateInit",function(){_confirmDeletion($messageBox,400)})}),$messageBox}};return deletingHelper}),define("taoQtiItem/qtiCreator/helper/gridUnits",["lodash"],function(_){
"use strict";function distributeUnits(cols,min,max){max=max||12;var totalUnits=0,size=0,_cols={},ret={},minimized=[],decimals=[];for(var i in cols)_cols[i]=_.clone(cols[i]),totalUnits+=cols[i].units,size++;var avg=totalUnits/size;if(_cols[size+1]={elt:"middle",units:avg,min:min},totalUnits+Math.round(avg)>max){var refactoredTotalUnits=0;for(var i in _cols){var col=_cols[i],refactoredUnits=col.units*max/(max+avg);decimals[i]=Math.round(refactoredUnits%1*100),col.refactoredUnits=Math.round(refactoredUnits),col.min&&col.refactoredUnits<col.min&&(col.refactoredUnits=col.min,minimized[i]=!0),refactoredTotalUnits+=col.refactoredUnits}if(refactoredTotalUnits>max)for(var i;size+1>i;i++){
var col=_cols[i];if(col.decimal>50&&col.refactoredUnits-1>col.min&&(col.refactoredUnits--,refactoredTotalUnits--),refactoredTotalUnits===max)break}var middleUnitValue=_cols[size+1].refactoredUnits,lastUnitValue=refactoredTotalUnits>max?max:middleUnitValue;delete _cols[size+1],ret={last:lastUnitValue,middle:middleUnitValue,cols:_cols,refactoredTotalUnits:refactoredTotalUnits}}else{var last=max-totalUnits;ret={last:last,middle:last,cols:{}}}return ret}function redistributeUnits(cols,max){max=max||12;var totalUnits=0,_cols=[],totalRefactoredUnits=0,negative=[],positive=[],ret=[];if(_.each(cols,function(col){_cols.push(col),totalUnits+=col.units}),totalUnits>max)throw"the total number of units exceed the maximum of "+max;
return _.each(_cols,function(col){var refactoredUnits=col.units*max/totalUnits,rounded=Math.round(refactoredUnits);totalRefactoredUnits+=rounded,col.refactoredUnits=rounded,rounded>refactoredUnits?positive.push(col):negative.push(col)}),positive=_.sortBy(positive,"refactoredUnits"),negative=_.sortBy(negative,"refactoredUnits"),totalRefactoredUnits>max?_.eachRight(positive,function(col){return col.refactoredUnits--,totalRefactoredUnits--,totalRefactoredUnits===max?!1:void 0}):max>totalRefactoredUnits&&_.each(negative,function(col){return col.refactoredUnits++,totalRefactoredUnits++,totalRefactoredUnits===max?!1:void 0}),_.each(negative,function(col){ret.push(col);
}),_.each(positive,function(col){ret.push(col)}),_cols}return{distribute:function(cols,min,max){return distributeUnits(cols,min,max)},redistribute:function(cols,max){return redistributeUnits(cols,max)}}}),define("taoQtiItem/qtiCreator/widgets/states/Deleting",["lodash","jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/helpers/deletingState","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(_,$,stateFactory,deletingHelper,gridUnits,gridHelper,contentHelper){var DeletingState=stateFactory.create("deleting",function(){var element=this.widget.element;
this.refactoredUnits=[],this.updateBody=!1,this.$elementToRemove=this.getElementToRemove(),this.hideWidget(),this.showMessage(element),element.data("deleting",!0),this.updateBody&&(this.item=element.getRelatedItem(),this.$item=this.item.data("widget").$container.find(".qti-itemBody"),this.$item.trigger("resize.qti-widget"))},function(){this.showWidget(),this.widget.element.data("deleting",!1),$("body").off(".deleting"),this.updateBody&&this.$item.trigger("resize.qti-widget")});DeletingState.prototype.getElementToRemove=function(){var $container=this.widget.$container;if($container.hasClass("qti-choice")){if("TH"!==$container.prop("tagName"))return $container;if("THEAD"===$container.parent().parent().prop("tagName")){
var $tbody=$container.closest("table.matrix").children("tbody"),$tds=$tbody.children("tr").find("td:last");return $container.add($tds)}if("TBODY"===$container.parent().parent().prop("tagName"))return $container.parent()}if($container.hasClass("widget-inline"))return $container.add(this.widget.$original);var $col=$container.parent(),$subCol=$container.parent(".colrow");if($subCol.length){this.updateBody=!0;var $colMulti=$subCol.parent();if(1!==$colMulti.find(".colrow").length)return $subCol;$col=$colMulti}var $row=$col.parent(".grid-row");return $row.length?(this.updateBody=!0,1===$row.children().length?$row:$col):$container.hasClass("grid-row")?(this.updateBody=!0,
$container):$container.hasClass("widget-block")||$container.hasClass("widget-blockInteraction")?$container:void 0},DeletingState.prototype.hideWidget=function(){var $elt=this.$elementToRemove;$elt.length&&($elt.hide(),_isCol($elt)&&(this.refactoredUnits=_redistributeUnits($elt)))};var _isCol=function($col){var attrClass=$col.attr("class");return attrClass&&/col-([\d]+)/.test(attrClass)},_redistributeUnits=function($col){var usedUnits=$col.data("units"),$otherCols=$col.siblings(),cols=[];return $otherCols.each(function(){var $col=$(this),units=$col.data("units");cols.push({elt:$col,units:units}),usedUnits+=units}),cols=gridUnits.redistribute(cols),_.each(cols,function(col){
col.elt.removeClass("col-"+col.units).addClass("col-"+col.refactoredUnits),gridHelper.setUnitsFromClass(col.elt)}),$col.data("redistributedUnits",cols),cols};return DeletingState.prototype.showWidget=function(){var $elt=this.$elementToRemove;$elt.length&&$.contains(document,$elt[0])&&($elt.show(),_isCol($elt)&&_.each(this.refactoredUnits,function(col){col.elt.removeClass("col-"+col.refactoredUnits).addClass("col-"+col.units),gridHelper.setUnitsFromClass(col.elt)}))},DeletingState.prototype.showMessage=function(){var _this=this,_widget=this.widget,$messageBox=deletingHelper.createInfoBox([_widget]);$messageBox.on("confirm.deleting",function(){_this.deleteElement();
}).on("undo.deleting",function(){try{_widget.changeState("question")}catch(e){_widget.changeState("active")}}),this.messageBox=$messageBox},DeletingState.prototype.deleteElement=function(){this.refactoredUnits=[],this.$elementToRemove.remove(),this.widget.destroy(),this.widget.element.remove(),this.updateBody&&this.item.body(contentHelper.getContent(this.$item))},DeletingState}),define("taoQtiItem/qtiCreator/widgets/static/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Deleting"],function(factory){
return factory.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var TextBlockStateSleep=stateFactory.extend(SleepState,function(){},function(){});return TextBlockStateSleep}),define("taoQtiItem/qtiCreator/helper/ckConfigurator",["ui/ckeditor/ckConfigurator","mathJax"],function(ckConfigurator,mathJax){"use strict";var getConfig=function(editor,toolbarType,options){return options=options||{},options.qtiImage=!0,options.qtiInclude=!0,options.underline=!0,options.mathJax=!!mathJax,ckConfigurator.getConfig(editor,toolbarType,options);
};return{getConfig:getConfig}}),define("taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor",["lodash","i18n","jquery","ckeditor","taoQtiItem/qtiCreator/helper/ckConfigurator","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/deletingState"],function(_,__,$,CKEditor,ckConfigurator,Element,contentHelper,deletingHelper){"use strict";function getTrigger($editableContainer){var $toolbar=$editableContainer.data("editor-toolbar");return $toolbar&&$toolbar.length?$toolbar.find('[data-role="cke-launcher"]'):$editableContainer.find('[data-role="cke-launcher"]')}function _buildEditor($editable,$editableContainer,options){
var $trigger;if(options=_.defaults(options,_defaults),!($editable instanceof $&&$editable.length))throw"invalid jquery element for $editable";if(!($editableContainer instanceof $&&$editableContainer.length))throw"invalid jquery element for $editableContainer";$trigger=getTrigger($editableContainer),$editable.attr("placeholder",options.placeholder);var ckConfig={dtdMode:"qti",autoParagraph:!1,enterMode:CKEditor.ENTER_P,floatSpaceDockedOffsetY:10,taoQtiItem:{insert:function(){options.data&&options.data.container&&options.data.widget&&contentHelper.createElements(options.data.container,$editable,_htmlEncode(this.getData()),function(createdWidget){_activateInnerWidget(options.data.widget,createdWidget);
})}},floatSpace:{debug:!0,initialHide:!0,centerElement:function(){return getTrigger($editableContainer)[0]},on:{ready:function(floatSpaceApi){var nose=$(this).find(".cke_nose"),oldParent=nose.parent(),newParent=$(this).find(".cke_toolbox");oldParent.is(".cke")&&newParent.append(nose),floatSpaceApi.hide(),$trigger.on("click",function(){$trigger.hasClass("active")?($trigger.removeClass("active"),floatSpaceApi.hide()):($trigger.addClass("active"),floatSpaceApi.show())})},changeMode:function(oldYMode,newYMode){var element=this,$element=$(element),$nose=$element.find(".cke_nose"),xModeIsReady=function(domElem){var dfd=new $.Deferred,counter=0,check=setInterval(function(){
var style=domElem.getAttribute("style");(counter>5||style.indexOf("left")>-1||style.indexOf("right")>-1)&&(dfd.resolve(),clearInterval(check)),counter++},1e3);return dfd.promise()};oldYMode!==newYMode&&$nose.removeClass("float-space-"+oldYMode).addClass("float-space-"+newYMode),$.when(xModeIsReady(element)).done(function(){element.style.left&&!element.style.right?$nose.removeClass("float-space-right").addClass("float-space-left"):$nose.removeClass("float-space-left").addClass("float-space-right")})}}},on:{instanceReady:function(e){function changed(editor){_detectWidgetDeletion($editable,widgets,editor),_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData()));
}function markupChanged(){_.isFunction(options.markupChange)&&options.markupChange.call($editable),_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData()))}var widgets={},editor=e.editor;$("#cke_"+e.editor.name+" .cke_combopanel").hide(),$editable.data("editor",editor),$editable.data("editor-options",options),$editable.on("change",function(){changed(editor)}),editor.on("change",function(){markupChanged(editor)}),options.data&&options.data.container&&($editable.data("qti-container",options.data.container),widgets=_rebuildWidgets(options.data.container,$editable,{restoreState:!0}),options.shieldInnerContent?_shieldInnerContent($editable,options.data.widget):options.passthroughInnerContent&&_passthroughInnerContent($editable)),
_focus(editor),$editable.trigger("editorready",[editor]),$(".qti-item").trigger("toolbarchange")},focus:function(e){$trigger.show(),_.isFunction(options.focus)&&options.focus.call(this,_htmlEncode(this.getData())),$(".qti-item").trigger("toolbarchange")},blur:function(e){return!1},configLoaded:function(e){var toolbarType="";options.toolbar&&_.isArray(options.toolbar)?ckConfig.toolbar=options.toolbar:toolbarType=getTooltypeFromContainer($editableContainer),e.editor.config=ckConfigurator.getConfig(e.editor,toolbarType,ckConfig)},afterPaste:function(e){}}};return CKEditor.inline($editable[0],ckConfig)}function getTooltypeFromContainer($editableContainer){var toolbarType="qtiFlow";
return $editableContainer.hasClass("widget-blockInteraction")||$editableContainer.hasClass("widget-textBlock")||$editableContainer.hasClass("widget-rubricBlock")?toolbarType="qtiBlock":($editableContainer.hasClass("qti-prompt-container")||$editableContainer.hasClass("widget-hottext"))&&(toolbarType="qtiInline"),toolbarType}function _find($container,dataAttribute){var $collection;return $collection=$container.data(dataAttribute)?$container:$container.find("[data-"+dataAttribute+"=true]")}function _rebuildWidgets(container,$container,options){options=options||{};var widgets={};return _.each(_.values(container.elements),function(elt){var widget=elt.data("widget"),currentState=widget.getCurrentState().name;
widgets[elt.serial]=widget.rebuild({context:$container,ready:function(widget){options.restoreState&&widget.changeState(currentState)}})}),$container.trigger("widgetCreated",[widgets,container]),widgets}function _findWidgetContainer($container,serial){return $container.find(".widget-box[data-serial="+serial+"]")}function _detectWidgetDeletion($container,widgets,editor){var deleted=[];if(_.each(widgets,function(w){if(!w.element.data("removed")){var $widget=_findWidgetContainer($container,w.serial);$widget.length||deleted.push(w)}}),deleted.length){var $messageBox=deletingHelper.createInfoBox(deleted);$messageBox.on("confirm.deleting",function(){_.each(deleted,function(w){
w.element.remove(),w.destroy()})}).on("undo.deleting",function(){editor.undoManager.undo()})}}function addShield($widget){var $shield=$("<button>",{"class":"html-editable-shield"});return $widget.attr("contenteditable",!1),$widget.append($shield),$shield}function _shieldInnerContent($container,containerWidget){$container.find(".widget-box").each(function(){var $widget=$(this);addShield($widget).on("click",function(e){var innerWidget;e.stopPropagation(),innerWidget=$widget.data("widget"),_activateInnerWidget(containerWidget,innerWidget)})})}function _passthroughInnerContent($container){$container.find(".widget-box").each(function(){addShield($(this))})}function _activateInnerWidget(containerWidget,innerWidget){
if(containerWidget&&containerWidget.element&&containerWidget.element.qtiClass){var listenToWidgetCreation=function(){containerWidget.$container.off("widgetCreated").one("widgetCreated",function(e,widgets){var targetWidget=widgets[innerWidget.serial];targetWidget&&_.delay(function(){Element.isA(targetWidget.element,"interaction")?targetWidget.changeState("question"):targetWidget.changeState("active")},100)})};Element.isA(containerWidget.element,"_container")&&!containerWidget.element.data("stateless")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(containerWidget.element,"choice")?(listenToWidgetCreation(),containerWidget.changeState("question")):Element.isA(innerWidget.element,"choice")?innerWidget.changeState("choice"):innerWidget.changeState("active");
}else innerWidget.changeState("active")}function _focus(editor){var range;editor.editable()&&editor.editable().parentNode&&(editor.focus(),range=editor.createRange(),range.moveToElementEditablePosition(editor.editable(),!0),editor.getSelection().selectRanges([range]))}CKEditor.disableAutoInline=!0;var _defaults={placeholder:__("some text ..."),shieldInnerContent:!0,passthroughInnerContent:!1,hideTriggerOnBlur:!1},_htmlEncode=function(encodedStr){return encodedStr},editorFactory={hasEditor:function($container){var hasEditor=!1;return _find($container,"html-editable").each(function(){return hasEditor=!!$(this).data("editor")}),hasEditor},buildEditor:function($container,editorOptions){
_find($container,"html-editable-container").each(function(){var editor,$editableContainer=$(this),$editable=$editableContainer.find("[data-html-editable]");$editable.attr("contenteditable",!0),editor=_buildEditor($editable,$editableContainer,editorOptions)})},destroyEditor:function($container){_find($container,"html-editable-container").each(function(){var $editableContainer=$(this),$editable=$editableContainer.find("[data-html-editable]"),$trigger=getTrigger($editableContainer);if($trigger.off().removeClass("active").hide(),$editable.removeAttr("contenteditable"),$editable.data("editor")){var editor=$editable.data("editor"),options=$editable.data("editor-options");
_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData())),editor.focusManager.blur(!0),editor.destroy(),$editable.removeData("editor").removeData("editor-options"),$editable.data("qti-container")&&_rebuildWidgets($editable.data("qti-container"),$editable)}})},getData:function($editable){var editor=$editable.data("editor");if(editor)return _htmlEncode(editor.getData());throw"no editor attached to the DOM element"},focus:function($editable){_find($editable,"html-editable").each(function(){var editor=$(this).data("editor");editor&&_focus(editor)})}};return editorFactory}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/text",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div class="panel">\n    <em>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"no configuration property needed",options):helperMissing.call(depth0,"__","no configuration property needed",options)))+"</em>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/static/text/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/text"],function(stateFactory,Active,htmlEditor,content,formTpl){
var TextActive=stateFactory.extend(Active,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return TextActive.prototype.buildEditor=function(){var widget=this.widget,$editableContainer=widget.$container,container=widget.element;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:content.getChangeCallback(container),blur:function(){widget.changeState("sleep")},data:{widget:widget,container:container}})},TextActive.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},TextActive.prototype.initForm=function(){
this.widget.$form.html(formTpl())},TextActive}),define("taoQtiItem/qtiCreator/widgets/static/text/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/text/states/Sleep","taoQtiItem/qtiCreator/widgets/static/text/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;
return buffer+='<div class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <div class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>\n';
})}),define("taoQtiItem/qtiCreator/widgets/static/text/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/text/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function($,Widget,states,toolbarTpl){var TextWidget=Widget.clone();return TextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},TextWidget.buildContainer=function(){var $wrap=$("<div>",{"data-serial":this.element.serial,"data-qti-class":"_container","class":"widget-box widget-block widget-textBlock"}).append($("<div>",{"data-html-editable":!0}));this.$original.wrapInner($wrap),this.$container=this.$original.children(".widget-box");
},TextWidget.createToolbar=function(){var _this=this,$tlb=$(toolbarTpl({serial:this.serial,state:"active"}));return this.$container.append($tlb),$tlb.find('[data-role="delete"]').on("click.widget-box",function(e){e.stopPropagation(),_this.changeState("deleting")}),this},TextWidget}),define("taoQtiItem/qtiCreator/editor/blockAdder/blockAdder",["jquery","lodash","tpl!taoQtiItem/qtiCreator/editor/blockAdder/tpl/addColumnRow","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/elementSelector/selector","taoQtiItem/qtiCreator/widgets/static/text/Widget"],function($,_,adderTpl,Element,creatorRenderer,containerHelper,contentHelper,elementSelector,TextWidget){
"use strict";function create(item,$editorPanel,interactions){function _getItemBody(){return $editorPanel.find(".qti-itemBody")}function _initInsertion($widget){var $wrap=$(_wrap),$colRow=$widget.parent(".colrow");$itemEditorPanel.trigger("beforesave.qti-creator.active"),$colRow.length||($widget.wrap(_wrap),$colRow=$widget.parent(".colrow")),$colRow.after($wrap),selector=elementSelector.create($wrap,$editorPanel,interactions),$editorPanel.off(".element-selector").on("selected.element-selector",function(e,qtiClass){var $placeholder=$(_placeholder);widget&&(widget.element.remove(),widget=null,$wrap.find(".widget-box").remove()),$wrap.addClass("tmp").prepend($placeholder),
_insertElement(qtiClass,$placeholder),selector.reposition()}).on("done.element-selector",function(){_done($wrap)}).on("cancel.element-selector",function(){_cancel($wrap)}),$itemEditorPanel.on("click"+_ns+" mousedown"+_ns,function(e){var popup=selector.getPopup()[0];popup===e.target||$.contains(popup,e.target)||_done($wrap)}),selector.activateElement("_container"),selector.activatePanel("Text Block"),_getItemBody().addClass("edit-inserting")}function _endInsertion(){selector.destroy(),selector=null,widget=null,$editorPanel.off(".element-selector"),_getItemBody().removeClass("edit-inserting"),item.body(contentHelper.getContent(_getItemBody())),$itemEditorPanel.off(_ns);
}function _done($wrap){$wrap.removeClass("tmp"),_appendButton(widget.$container),_.defer(function(){widget.element.is("interaction")?widget.changeState("question"):widget.changeState("active"),_endInsertion()})}function _cancel($wrap){widget.element.remove(),$wrap.remove(),_endInsertion()}var selector,widget,$itemEditorPanel=$("#item-editor-panel");$editorPanel.find(".widget-block, .widget-blockInteraction").each(function(){_appendButton($(this))}),$editorPanel.on("mousedown",".add-block-element .circle",function(e){e.preventDefault(),e.stopPropagation();var $widget=$(this).parents(".widget-box");_initInsertion($widget)}).on("ready.qti-widget",function(e,_widget){
var qtiElement=_widget.element;(qtiElement.is("blockInteraction")||qtiElement.is("_container")||qtiElement.is("customInteraction"))&&(_appendButton(_widget.$container),selector&&_widget.$container.parent(".colrow.tmp").length&&(qtiElement.is("customInteraction")&&qtiElement.onPciReady(function(){selector.reposition()}),selector.reposition(),widget=_widget))})}function _appendButton($widget){if(!$widget.children(".add-block-element").length&&!$widget.parent(".colrow.tmp").length){var $adder=$(adderTpl());$widget.append($adder),$adder.on("click mouseenter mouseleave",function(e){e.stopPropagation(),$(this).parent().trigger("mouseleave")})}}function _insertElement(qtiClass,$placeholder){
$placeholder.removeAttr("id"),"rubricBlock"===qtiClass&&($placeholder=$placeholder.parent(".col-12").parent(".grid-row")),$placeholder.addClass("widget-box"),$placeholder.attr({"data-new":!0,"data-qti-class":qtiClass});var $widget=$placeholder.parent().closest(".widget-box, .qti-item"),$editable=$placeholder.closest("[data-html-editable], .qti-itemBody"),widget=$widget.data("widget"),element=widget.element,container=Element.isA(element,"_container")?element:element.getBody();if(!element||!$editable.length)throw new Error("cannot create new element");containerHelper.createElements(container,contentHelper.getContent($editable),function(newElts){var creator=creatorRenderer.get();
creator.load(function(){for(var serial in newElts){var $widget,widget,elt=newElts[serial],$colParent=$placeholder.parent();if(elt.setRenderer(this),Element.isA(elt,"_container")){$placeholder.replaceWith('<div class="text-block"></div>');var $textBlock=$colParent.find(".text-block");$textBlock.html(elt.render()),widget=TextWidget.build(elt,$textBlock,creator.getOption("textOptionForm"),{ready:function(){this.$container.unwrap()}}),$widget=widget.$container}else elt.render($placeholder),elt.postRender(),widget=elt.data("widget"),$widget=Element.isA(elt,"blockInteraction")?widget.$container:widget.$original;$widget.trigger("contentChange.gridEdit"),$widget.trigger("resize.gridEdit");
}},this.getUsedClasses())})}var _ns=".block-adder",_wrap='<div class="colrow"></div>',_placeholder='<div class="placeholder">';return{create:create}}),define("taoQtiItem/controller/creator/main",["jquery","lodash","module","async","core/promise","history","layout/loading-bar","layout/section","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/helper/itemLoader","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/helper/xincludeRenderer","taoQtiItem/qtiCreator/editor/editor","taoQtiItem/qtiCreator/editor/interactionsToolbar","taoQtiItem/qtiCreator/editor/customInteractionRegistry","taoQtiItem/qtiCreator/editor/infoControlRegistry","taoQtiItem/qtiCreator/editor/blockAdder/blockAdder"],function($,_,module,async,Promise,history,loadingBar,section,event,panel,loader,creatorRenderer,commonRenderer,qtiElements,xincludeRenderer,editor,interactionsToolbar,ciRegistry,icRegistry,blockAdder){
"use strict";function _getAuthoringElements(interactionModels){var toolbarInteractions=qtiElements.getAvailableAuthoringElements();return _.each(interactionModels,function(interactionModel){var data=ciRegistry.getAuthoringData(interactionModel.getTypeIdentifier());if(!data.tags||data.tags[0]!==interactionsToolbar.getCustomInteractionTag())throw"invalid authoring data for custom interaction";toolbarInteractions[data.qtiClass]=data}),toolbarInteractions}function _initializeInteractionsToolbar($toolbar,interactionModels){interactionsToolbar.create($toolbar,_getAuthoringElements(interactionModels)),panel.initSidebarAccordion($toolbar),panel.closeSections($toolbar.find("section")),
panel.openSections($toolbar.find("#sidebar-left-section-common-interactions"),!1),panel.toggleInlineInteractionGroup()}function _initializeElementAdder(item,$itemPanel,interactionModels){var authoringElements=_getAuthoringElements(interactionModels);blockAdder.create(item,$itemPanel,authoringElements)}function _initializeHooks(uiHooks,configProperties){require(_.values(uiHooks),function(){_.each(arguments,function(hook){hook.init(configProperties)})})}return loadingBar.start(),{start:function(_config){var config,configProperties,$doc=$(document),$editorScope=$("#item-editor-scope"),$itemContainer=$("#item-editor-scroll-inner"),$propertySidebar=$("#item-editor-item-widget-bar");
loadingBar.start(),config=_.merge({},_config||{},module.config()||{}),creatorRenderer.get(!0,config),configProperties=config.properties,configProperties.dom={getEditorScope:function(){return $editorScope},getMenuLeft:function(){return $editorScope.find(".item-editor-menu.lft")},getMenuRight:function(){return $editorScope.find(".item-editor-menu.rgt")},getInteractionToolbar:function(){return $editorScope.find("#item-editor-interaction-bar")},getItemPanel:function(){return $itemContainer},getItemPropertyPanel:function(){return $editorScope.find("#sidebar-right-item-properties")},getItemStylePanel:function(){return $propertySidebar.find("#item-style-editor-bar");
},getModalContainer:function(){return $editorScope.find("#modal-container")}},$("#authoringBack").on("click",function(e){e.preventDefault(),history&&history.back()}),_initializeHooks(_.union(config.uiHooks,config.hooks),configProperties),async.parallel([function(callback){ciRegistry.register(config.interactions),ciRegistry.loadAll(function(hooks){callback(null,hooks)})},function(callback){icRegistry.register(config.infoControls),icRegistry.loadAll(function(hooks){callback(null,hooks)})},function(callback){loader.loadItem({uri:configProperties.uri,label:configProperties.label},function(item){commonRenderer.setOption("baseUrl",configProperties.baseUrl),commonRenderer.setContext(configProperties.dom.getItemPanel()),
$editorScope.data("item",item),$doc.trigger("itemloaded.qticreator",[item]),item.data("uri",configProperties.uri),callback(null,item)})}],function(err,res){var interactionHooks=res[0],item=(res[1],res[2]);_initializeInteractionsToolbar(configProperties.dom.getInteractionToolbar(),interactionHooks),config.properties["multi-column"]&&_initializeElementAdder(item,configProperties.dom.getItemPanel(),interactionHooks),creatorRenderer.get().setOptions(configProperties).load(function(){var widget;item.setRenderer(this),configProperties.dom.getItemPanel().append(item.render()),Promise.all(item.postRender(_.clone(configProperties))).then(function(){widget=item.data("widget"),
_.each(item.getComposingElements(),function(element){"include"===element.qtiClass&&xincludeRenderer.render(element.data("widget"),config.properties.baseUrl)}),editor.initGui(widget,configProperties),panel.initSidebarAccordion($propertySidebar),panel.initFormVisibilityListener(),loadingBar.stop(),section.on("hide",function(hiddenSection){"authoring"===hiddenSection.id&&($(window).off(".qti-widget"),$doc.off(".qti-widget").off(".qti-creator"))}),$editorScope.data("widget",item),$doc.trigger("widgetloaded.qticreator",[widget]),event.initElementToWidgetListeners()})["catch"](function(err){console.error(err)})},item.getUsedClasses())})}}}),define("taoQtiItem/qtiCreator/editor/MathEditor",["lodash","jquery","mathJax","ui/feedback"],function(_,$,MathJax,feedback){
"use strict";var MathEditor=function(config){if(config=config||{},this.mathML=config.mathML||"",this.tex=config.tex||"",this.display=config.display||"inline",this.processing=!1,this.$target=config.target||$(),!(config.buffer&&config.buffer instanceof $&&config.buffer.length))throw'missing required element in config "buffer"';this.$buffer=config.buffer};MathEditor.prototype.setMathML=function(mathMLstr){return this.mathML=_stripMathTags(mathMLstr),this},MathEditor.prototype.setTex=function(texStr){return this.tex=texStr,this};var _processArguments=function(mathEditor,args){var ret={target:null,callback:null};if(_.each(args,function(arg){_.isFunction(arg)?ret.callback=arg:arg instanceof $&&(ret.target=arg);
}),!ret.target){if(!mathEditor.$target)throw"no target defined for rendering";ret.target=mathEditor.$target}return ret};MathEditor.prototype.renderFromMathML=function(){var args=_processArguments(this,arguments);if("undefined"!=typeof MathJax){if(this.processing)return;var jaxQueue=MathJax.Hub.queue,mathStr=_wrapMathTags(this.mathML,"block"===this.display);this.$buffer.html(mathStr);var _this=this;jaxQueue.Push(["Typeset",MathJax.Hub,this.$buffer[0]],function(){_this.processing=!1,args.target.html(_this.$buffer.html()),_this.$buffer.empty()}),args.callback&&jaxQueue.Push(args.callback)}},MathEditor.prototype.renderFromTex=function(){var args=_processArguments(this,arguments),_this=this,jaxQueue=MathJax.Hub.queue;
"undefined"!=typeof MathJax&&("block"===this.display?_this.$buffer.text("\\[\\displaystyle{"+_this.tex+"}\\]"):_this.$buffer.text("\\(\\displaystyle{"+_this.tex+"}\\)"),jaxQueue.Push(["Typeset",MathJax.Hub,_this.$buffer[0]],function(){var texJax;try{args.target.html(_this.$buffer.html()),texJax=_getJaxByElement(_this.$buffer),_this.$buffer.empty(),"undefined"!=typeof texJax&&_this.texToMathML(texJax,function(mathML){_this.setMathML(_stripMathTags(mathML))})}catch(err){feedback().error("Mathjax error: "+err.message)}}),args.callback&&jaxQueue.Push(args.callback))};var _stripMathTags=function(mathMLstr){return mathMLstr=mathMLstr.replace(/<(\/)?math[^>]*>/g,""),
mathMLstr=mathMLstr.replace(/^\s*[\r\n]/gm,""),mathMLstr=mathMLstr.replace(/\s*[\r\n]$/gm,"")},_getJaxByElement=function($element){if($element instanceof $&&$element.length){var $script=$element.find("script");if($script.length&&$script[0].MathJax&&$script[0].MathJax.elementJax)return $script[0].MathJax.elementJax}},_wrapMathTags=function(mathMLstr,displayBlock){if(!mathMLstr.match(/<math[^>]*>/)){var display=displayBlock?' display="block"':"";mathMLstr="<math"+display+">"+mathMLstr}return mathMLstr.match(/<\/math[^>]*>/)||(mathMLstr+="</math>"),mathMLstr};return MathEditor.prototype.texToMathML=function(texJax,callback){var _this=this,mathML="";try{mathML=texJax.root.toMathML("");
}catch(err){if(!err.restart)throw err;return MathJax.Callback.After(function(){_this.texToMathML(texJax,callback)},err.restart)}MathJax.Callback(callback)(mathML)},MathEditor}),define("taoQtiItem/qtiCreator/editor/ckEditor/ckProtector",["jquery","i18n"],function($,__){"use strict";var ckeProtector=function(){var selector=".widget-box",observeContentChanges=function($context){var contextDomNode=$context[0],MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(MutationObserver){var observer=new MutationObserver(function(mutations){mutations.forEach(function(){$context.trigger("contentchange.protector")})});observer.observe(contextDomNode,{
subtree:!0,characterData:!0})}else contextDomNode.addEventListener("DOMCharacterDataModified",function(){$context.trigger("contentchange.protector")},!1)},getSelector=function(){return selector},protect=function(context,selectorParam){selectorParam&&(selector=selectorParam),context.find(selector).each(function(){var wrapper,widget=$(this),iWidth=widget.outerWidth(),iHeight=widget.outerHeight(),cover=$('<button class="cke-cover-up">'),getProtectedWidgetBySerial=function(serial){return $('[data-serial="'+serial+'"]').each(function(){var widget=$(this);return widget.parent().hasClass("cke-qti-wrapper")?!1:void 0}),widget.length?widget:$()},positionCover=function(cover){
var wrapper=getProtectedWidgetBySerial(cover.prop("serial")).parent(".cke-qti-wrapper"),iOffset=wrapper.offset();cover.css({left:iOffset.left,top:iOffset.top})};return widget.parent(".cke-qti-wrapper").length?!1:(widget.find("*").each(function(){this.innerHTML||(this.innerHTML="&#8203;")}),widget.wrap($('<span class="cke-qti-wrapper" />')),wrapper=widget.parent(),cover.css({width:iWidth,height:iHeight}),$("body").append(cover),wrapper.css({width:iWidth,height:iHeight}),wrapper.attr("contenteditable",!1),wrapper.prop("cover",cover),cover.prop("serial",widget.data("serial")),positionCover(cover),cover.attr("title",__("Click to display interaction widget")),cover.on("click",function(){
var widget=getProtectedWidgetBySerial($(this).prop("serial"));$(document).trigger("removeprotection.ckprotector",{context:context,widget:widget})}),observeContentChanges(context),void context.on("contentchange.protector",function(){positionCover(cover)}))})},unprotect=function(widget){widget.each(function(){var widget=$(this),wrapper=widget.parent(".cke-qti-wrapper");wrapper.length&&(wrapper.prop("cover").remove(),widget.unwrap())})};return{protect:protect,unprotect:unprotect,getSelector:getSelector}}();return ckeProtector}),define("tpl!taoQtiItem/qtiCreator/editor/colorPicker/tpl/popup",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="color-picker-container sidebar-popup">\n    <div class="sidebar-popup-title">\n        <h3 style="font-size:13px;margin:0"></h3>\n        <a class="closer" href="#"></a>\n    </div>\n    <div class="sidebar-popup-content">\n        <div class="color-picker"></div>\n        <input class="color-picker-input" type="text" value="#000000">\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/editor/colorPicker/colorPicker",["jquery","lodash","i18n","taoQtiItem/qtiCreator/helper/popup","tpl!taoQtiItem/qtiCreator/editor/colorPicker/tpl/popup","lib/farbtastic/farbtastic"],function($,_,__,popup,popupTpl){
"use strict";function create($colorTrigger,config){config=_.defaults(config||{},_defaults);var color,$input=$colorTrigger.siblings("input");config.color?(color=config.color,$input.val(color)):color=$input.val(),$colorTrigger.css("background-color",color);var $popup=$(popupTpl());$colorTrigger.data("color-picker",$popup),$("#item-editor-wrapper").append($popup),popup.init($colorTrigger,{popup:$popup}),$colorTrigger.on("open.popup",function(e,params){var title,$trigger=$(this),$container=$trigger.parents(".sidebar-popup"),color=$input.val(),$colorPicker=params.popup.find(".color-picker"),$colorPickerInput=params.popup.find(".color-picker-input");params.popup.css({
right:$(window).width()-$container.offset().left+2,top:$trigger.offset().top+config.offsetTop-$("#item-editor-wrapper").offset().top}),_.isFunction(config.title)?title=config.title.call(this):_.isString(config.title)&&(title=config.title),params.popup.find("h3").text(title),$colorPicker.farbtastic($colorPickerInput),$colorPickerInput.val(color).trigger("keyup"),config.color=color,params.popup.find(".closer").off("click").on("click",function(){params.popup.hide(),$colorPicker.off(".farbtastic")}),$colorPicker.off(".farbtastic").on("colorchange.farbtastic",function(e,color){$colorTrigger.css("background-color",color),$input.val(color).trigger("change")})}),$colorTrigger.on("close.popup",function(e,params){
params.popup.find(".color-picker").off(".farbtastic")})}function destroy($colorTrigger){$colorTrigger.off(".color-picker"),$colorTrigger.removeAttr("data-color-picker");var $popup=$colorTrigger.data("color-picker");$popup instanceof $&&$popup.remove()}var _defaults={title:__("Color Picker"),offsetTop:-40};return{create:create,destroy:destroy}}),define("taoQtiItem/qtiCreator/model/Container",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Container"],function(_,editable,Container){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{afterCreate:function(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>");
},beforeRemove:function(){_.each(this.getComposingElements(),function(element){_.isFunction(element.beforeRemove)&&element.beforeRemove()})}}),Container.extend(methods)}),define("taoQtiItem/qtiXmlRenderer/renderers/config",["taoItems/assets/manager"],function(assetManagerFactory){"use strict";var assetManager=assetManagerFactory([{name:"nomalize",handle:function(url){return url?url.toString().replace(/^\.?\//,""):void 0}}]);return{name:"xmlRenderer",locations:{_container:"taoQtiItem/qtiXmlRenderer/renderers/Container",assessmentItem:"taoQtiItem/qtiXmlRenderer/renderers/Item",stylesheet:"taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",responseDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",
outcomeDeclaration:"taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",responseProcessing:"taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",_simpleFeedbackRule:"taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",math:"taoQtiItem/qtiXmlRenderer/renderers/Math",img:"taoQtiItem/qtiXmlRenderer/renderers/Img",object:"taoQtiItem/qtiXmlRenderer/renderers/Object",modalFeedback:"taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",rubricBlock:"taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",associateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",choiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",
extendedTextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",gapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",graphicAssociateInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",graphicGapMatchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",graphicOrderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",hotspotInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",hottextInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",
inlineChoiceInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",matchInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",mediaInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",orderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",selectPointInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",sliderInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",textEntryInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",uploadInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",
prompt:"taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",associableHotspot:"taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",gap:"taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",gapImg:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",gapText:"taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",hotspotChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",hottext:"taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",inlineChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",simpleAssociableChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",simpleChoice:"taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice",
customInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/PortableCustomInteraction",endAttemptInteraction:"taoQtiItem/qtiXmlRenderer/renderers/interactions/EndAttemptInteraction",infoControl:"taoQtiItem/qtiXmlRenderer/renderers/PortableInfoControl",include:"taoQtiItem/qtiXmlRenderer/renderers/Include"},options:{assetManager:assetManager}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoQtiItem/qtiXmlRenderer/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoQtiItem/qtiCreator/helper/xmlRenderer",["taoQtiItem/qtiXmlRenderer/renderers/Renderer"],function(XmlRenderer){
"use strict";var _xmlRenderer=new XmlRenderer({shuffleChoices:!1}).load(),_render=function(item){var xml="";try{xml=item.render(_xmlRenderer)}catch(e){console.log(e)}return xml};return{render:_render,get:function(){return _xmlRenderer}}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-role="cke-launcher-tlb">\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>'})}),define("taoQtiItem/qtiCreator/editor/containerEditor",["lodash","jquery","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Container","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/qtiClasses","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiItem/helper/simpleParser","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/xincludeRenderer","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger"],function(_,$,Loader,Container,Item,event,qtiClasses,xmlRenderer,simpleParser,creatorRenderer,xincludeRenderer,content,htmlEditor,toolbarTpl){
"use strict";function parser($container){var mathNs="m",data=simpleParser.parse($container.clone(),{ns:{math:mathNs}});if(data.body)return data.body;throw"invalid content for qti container"}function create($container,options){if(options=_.defaults(options||{},_defaults),options.markup){var html=options.markup;if(options.markupSelector){var htmls=extractHtmlFromMarkup(html,options.markupSelector);html=htmls[0]||""}$container.html(html)}var data=parser($container),loader=(new Loader).setClassesLocation(qtiClasses);loader.loadRequiredClasses(data,function(){var container=new Container;container.data("stateless",!0),$container.data("container",container);var item=(new Item).setElement(container);
if(container.setRelatedItem(item),options.related){var containerEditors=options.related.data("container-editors")||[];containerEditors.push(container),options.related.data("container-editors",containerEditors)}this.loadContainer(container,data),creatorRenderer.load(["img","object","math","include","_container"],function(){var baseUrl=this.getOption("baseUrl");container.setRenderer(this),$container.html(container.render()),container.postRender(),_.each(container.getComposingElements(),function(element){"include"===element.qtiClass&&xincludeRenderer.render(element.data("widget"),baseUrl)}),buildContainer($container),createToolbar($container,options.$toolbarLocation),
buildEditor($container,container,{hideTriggerOnBlur:!!options.hideTriggerOnBlur,placeholder:options.placeholder||void 0,toolbar:options.toolbar||void 0}),$container.off("."+_ns).on(event.getList(_ns+event.getNs()+event.getNsModel()).join(" "),_.throttle(function(e,data){var html=container.render(xmlRenderer.get());$container.trigger("containerchange."+_ns,[html]),_.isFunction(options.change)&&options.change(html)},600)),$container.trigger("editorready.containereditor")})})}function buildContainer($container){$container.wrapInner($("<div>",{"class":"container-editor","data-html-editable":!0}))}function createToolbar($container,$appendTo){var $tlb=$(toolbarTpl({
serial:"serial123456",state:"active"}));return $appendTo&&$appendTo.length||($appendTo=$container),$appendTo.append($tlb),$tlb.show(),$container.data("editor-toolbar",$tlb),this}function cleanup($container){var $toolbar=$container.data("editor-toolbar");$toolbar&&$toolbar.remove();var container=$container.data("container");container&&($(document).off("."+container.serial),$container.html(container.render())),$container.removeData("container")}function createFakeWidget($editableContainer,container){var widget={$container:$editableContainer,element:container,changeState:_.noop};return container.data("widget",widget),widget}function buildEditor($editableContainer,container,options){
$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,_.defaults(options||{},{shieldInnerContent:!1,passthroughInnerContent:!1,change:content.getChangeCallback(container),data:{widget:createFakeWidget($editableContainer,container),container:container}}))}function destroyEditor($editableContainer){htmlEditor.destroyEditor($editableContainer),$editableContainer.removeAttr("data-html-editable-container")}function destroy($container){destroyEditor($container),cleanup($container)}function extractHtmlFromMarkup(markupStr,selector){var $found=$("<div>").html(markupStr).find(selector),ret=[];
return $found.each(function(){ret.push($(this).html())}),ret}var _ns="containereditor",_defaults={change:_.noop,markup:"",markupSelector:""};return{create:create,destroy:destroy}}),define("taoQtiItem/qtiCreator/editor/gridEditor/arrow",["jquery","lodash"],function($,_){"use strict";var _eventName="arrowenter.gridEdit.gridDragDrop",_buildArrows=function($col,options){var defaults={insertZoneWidth:20,marginWidth:0};options=_.extend(defaults,options);var $insertRight=$("<div>",{"class":"grid-edit-insert-box"}).css({top:0,width:options.insertZoneWidth,right:-(options.marginWidth+(options.insertZoneWidth-options.marginWidth)/2),height:$col.parent(".grid-row").height()-parseFloat($col.css("margin-bottom"))
}).append($("<div>",{"class":"grid-edit-insert-square"})).append($("<div>",{"class":"grid-edit-insert-triangle"})).append($("<div>",{"class":"grid-edit-insert-line"})).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){$col.trigger(_eventName,["right"]),_removeArrows($col)}),$insertLeft=$insertRight.clone().css({left:-(options.marginWidth+5),right:"auto"}).on("mouseenter",".grid-edit-insert-triangle, .grid-edit-insert-square",function(){$col.trigger(_eventName,["left"]),_removeArrows($col)});$col.append($insertRight).append($insertLeft),_arrowFall($insertRight,function(){$col.trigger(_eventName,["right"]),_removeArrows($col)}),_arrowFall($insertLeft,function(){
$col.trigger(_eventName,["left"]),_removeArrows($col)})},_removeArrows=function($col){$col.find(".grid-edit-insert-box").remove()},_arrowFall=function($insert,callback){var interval=null;$insert.on("mouseenter",function(e){var relY=e.pageY-$(this).offset().top-parseInt($(this).find(".grid-edit-insert-triangle").outerHeight())-parseInt($(this).find(".grid-edit-insert-square").outerHeight()),$arrow=$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square"),t=0;interval=setInterval(function(){var top=4.905*Math.pow(t,2)/100;$arrow.css("top",top),top>relY&&(clearInterval(interval),callback()),t++},10)}).on("mouseleave",function(){$(this).find(".grid-edit-insert-triangle, .grid-edit-insert-square").css("top",0),
clearInterval(interval)})};return{create:_buildArrows}}),define("taoQtiItem/qtiCreator/editor/targetFinder",["jquery","lodash","ui/ckeditor/dtdHandler","taoQtiItem/qtiCreator/helper/qtiElements"],function($,_,dtdHandler,qtiElements){"use strict";var _qtiHtmlEditableTypes={itemBody:".widget-textBlock > [data-html-editable]",prompt:".qti-prompt[data-html-editable]",choice:".qti-choice [data-html-editable]"},targetFinder=function($,_,dh){var inheritedFunctions=function(){var fn,fns={};for(fn in dh)dh.hasOwnProperty(fn)&&dh[fn]instanceof Function&&(fns[fn]=dh[fn]);return fns}(),getTargetsFor=function(qtiClass,context){var child,$qtiContainers,$targets=$();if(context=context||document.body,
context=$(context),qtiElements.is(qtiClass,"inlineInteraction"))$qtiContainers=context.find(_qtiHtmlEditableTypes.itemBody),child="object";else switch($qtiContainers=context.find(_.values(_qtiHtmlEditableTypes).join(",")),$qtiContainers=context.find(_qtiHtmlEditableTypes.itemBody),qtiClass){case"math":child="object";break;case"object.audio":case"object.video":child="object";break;default:child=qtiClass}var parents=dh.getParentsOf(child),parentSelector=parents.join(",");return $qtiContainers.each(function(){var $qtiContainer=$(this),$widget=$qtiContainer.closest(".widget-box");$qtiContainer.is(parentSelector)&&($targets=$targets.add($qtiContainer)),$targets=$targets.add($qtiContainer.find(parentSelector).not(function(){
var $closest=$(this).closest(".widget-box");return $closest.length&&$closest[0]!==$widget[0]}))}),$targets};return _.extend(inheritedFunctions,{getTargetsFor:getTargetsFor})}($,_,dtdHandler);return targetFinder}),define("taoQtiItem/qtiCreator/editor/gridEditor/droppable",["jquery","lodash","taoQtiItem/qtiCreator/helper/gridUnits","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/arrow","taoQtiItem/qtiCreator/editor/targetFinder"],function($,_,gridUnits,qtiElements,helper,arrow,targetFinder){"use strict";var droppableGridEditor={};droppableGridEditor.createDroppableBlocks=function(qtiClass,$el,options){
options=options||{};var minUnits="string"==typeof options.min?options.min:0,$colInitial=options.initialPosition instanceof $?options.initialPosition:null,ns=options.namespace?"."+options.namespace:"",data=options.data||{},$placeholder=$("<div>",{id:"qti-block-element-placeholder","class":"qti-droppable-block-hover"}),marginWidth=parseFloat($el.find('[class^="col-"]:last, [class*=" col-"]:last').css("margin-left")),isEmpty=0===$el.children(".grid-row").length;$el.addClass("dropping"),isEmpty?$el.append(_getNewRow().append(_getNewCol().addClass("col-12"))):$el.find(".grid-row").each(function(){var $row=$(this),cols=[],maxHeight=0,$cols=$row.children(":not(.new-col)").each(function(){
$(this).before(_getNewCol().attr("data-index",$(this).index()/2)),maxHeight=Math.max($(this).height(),maxHeight),cols.push({elt:$(this),units:parseInt($(this).attr("data-units"))})});$cols.last().after(_getNewCol().attr("data-index","last")),$cols.height(maxHeight),$row.data("distributed-units",gridUnits.distribute(cols,minUnits,12)),$row.before(_getNewRow().append(_getNewCol()))}).last().after(_getNewRow().append(_getNewCol()));var _appendPlaceholder=function($col){$col.length&&($placeholder.data("dropped",!0).show().parent().removeClass("col-12").parent().removeData("active"),$col.append($placeholder))},_resetPlaceholder=function(){$placeholder.parent().parent().removeData("active"),
$placeholder.removeData("dropped").hide(),$el.append($placeholder)},_insertBetween=function($col,location){if("left"===location||"right"===location){_restoreTmpCol($el);var $row=$col.parent().attr("data-active",!0);$row.children(":not(.new-col)").each(function(){$(this).attr("data-original-class",$(this).attr("class"))});var distributedUnits=$row.data("distributed-units"),$newCol="left"===location?$col.prev():$col.next();if(_appendPlaceholder($newCol),distributedUnits.refactoredTotalUnits>12){var newUnit=$newCol.is(":last-child")&&distributedUnits.last?distributedUnits.last:distributedUnits.middle;$newCol.attr("class","new-col col-"+newUnit);var cumulatedUnits=0,index=$newCol.data("index"),_appendToNextRow=function($row,$newCol){
$row.next().attr("data-active",!0).append($newCol)};if("last"===index)_appendToNextRow($row,$newCol);else for(var i in distributedUnits.cols){i==index&&(cumulatedUnits+newUnit>12&&_appendToNextRow($row,$newCol),cumulatedUnits+=newUnit);var col=distributedUnits.cols[i];cumulatedUnits+col.refactoredUnits>12&&_appendToNextRow($row,col.elt),col.elt.attr("class","col-"+col.refactoredUnits),cumulatedUnits+=col.refactoredUnits}}else $newCol.is(":last-child")&&distributedUnits.last?$newCol.attr("class","new-col col-"+distributedUnits.last):$newCol.attr("class","new-col col-"+distributedUnits.middle),_.each(distributedUnits.cols,function(col){col.elt.attr("class","col-"+col.refactoredUnits);
});var h=_resetColsHeight($col);$placeholder.css("height","100%").parent().height(h)}},_resetColsHeight=function($col,self){var maxHeight=0;void 0===self&&(self=!0),$placeholder.css("height","auto").parent().removeAttr("style");var $cols=$col.siblings('[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)').andSelf();return $cols.removeAttr("style"),$cols.each(function(){maxHeight=Math.max($(this).height(),maxHeight)}),$cols.height(maxHeight),self||$col.removeAttr("style"),maxHeight};if(_resetPlaceholder(),$colInitial&&$colInitial.length){var $prev=$colInitial.prevAll('[class^="col-"], [class*=" col-"]').first(),$next=$colInitial.nextAll('[class^="col-"], [class*=" col-"]').first();
$prev.length?_insertBetween($prev,"right"):$next.length&&_insertBetween($next,"left")}$el.on("mouseover.gridEdit.gridDragDrop",function(){var $previousCol=$placeholder.parent(".new-col");_restoreTmpCol($el),_resetColsHeight($previousCol,!1);var $newCol=$el.find(".new-col:last").css("background","1px solid red");_appendPlaceholder($newCol),$newCol.addClass("col-12")}).on("mouseover.gridEdit.gridDragDrop",".grid-row",function(e){e.stopPropagation()}).on("mouseenter.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',function(e){var $col=$(this),$previousCol=$placeholder.parent(".new-col");_resetPlaceholder(),_restoreTmpCol($el),
_resetColsHeight($previousCol,!1),_resetColsHeight($col),arrow.create($col,{marginWidth:marginWidth})}).on("arrowenter.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',function(e,position){_insertBetween($(this),position)}).on("mousemove.gridEdit.gridDragDrop",'[class^="col-"]:not(.new-col), [class*=" col-"]:not(.new-col)',_.throttle(function(e){var $col=$(this),h=$col.height(),relY=e.pageY-$col.offset().top,$newRow=h/2>relY?$col.parent().prev():$col.parent().next();if(!$newRow.find("#qti-block-element-placeholder").length){var $newCol=$newRow.attr("data-active",!0).children(".new-col").addClass("col-12");$newCol.length?_appendPlaceholder($newCol):console.log("insert form col failure ",$col,$newRow);
}},100)).on("mouseleave.gridEdit.gridDragDrop",'[class^="col-"], [class*=" col-"]',function(e){e.stopPropagation(),$(this).find(".grid-edit-insert-box").remove()}).on("mouseleave.gridEdit.gridDragDrop",function(){$placeholder.hide(),_resetPlaceholder(),_restoreTmpCol($el)}),$el.one("dragoverstop.gridEdit",function(){$el.off(".gridEdit.gridDragDrop");var $selectedCol=$placeholder.parent(".new-col"),dropped=!!$selectedCol.length;dropped&&($placeholder.removeAttr("id").removeClass("qti-droppable-block-hover"),$selectedCol.data("qti-class",qtiClass).removeClass("new-col").removeAttr("data-index"),helper.setUnitsFromClass($selectedCol),$selectedCol.parent(".grid-row-new").removeClass("grid-row-new"),
$el.find(".grid-row[data-active=true]").each(function(){var $row=$(this);$row.removeClass("grid-row-new"),$row.children(":not(.new-col)").removeAttr("data-original-class").each(function(){helper.setUnitsFromClass($(this))})})),_destroyDroppableBlocks($el),dropped&&$placeholder.data("dropped")&&$el.trigger("dropped.gridEdit"+ns,[qtiClass,$placeholder,data])})};var _pulseTimer=null,_pulse=function($el){_pulseTimer&&clearInterval(_pulseTimer);var intervalDuration=1e3;setInterval(function(){$el.animate({opacity:.1},.5*intervalDuration,function(){$el.animate({opacity:.9},.5*intervalDuration)})},intervalDuration)};droppableGridEditor.createDroppableInlines=function(qtiClass,$el,options){
var ns=options.namespace?"."+options.namespace:"",data=options.data||{},$targets=targetFinder.getTargetsFor(qtiClass,$el),dropped=!1;$targets.addClass("drop-target"),$targets.contents().each(function(){3!==this.nodeType||this.nodeValue.match(/^\s+$/)||$(this).replaceWith($.map(this.nodeValue.split(/(\S+)/),function(w){return w.match(/^\s*$/)?document.createTextNode(w):$("<span>",{text:w,"class":"qti-word-wrap"}).get()}))});var $placeholder=$("<span>",{id:"qti-inline-element-placeholder","data-inline":!0});$placeholder.append($("<span>",{"class":"cursor-h"})).append($("<span>",{"class":"cursor-v"})),_pulse($placeholder);var _resetPlaceholder=function($el){$placeholder.detach(),
dropped=!1};_resetPlaceholder($el);var _showPlaceholder=function(){return dropped=!0,$placeholder};$el.on("mousemove.gridEdit.gridDragDrop","span.qti-word-wrap",function(e){var w=$(this).width(),parentOffset=$(this).offset(),relX=e.pageX-parentOffset.left;w/2>relX?$(this).before(_showPlaceholder()):$(this).after(_showPlaceholder())}).on("mouseover.gridEdit.gridDragDrop",function(e){e.stopPropagation();var $target=$(e.target);$target.hasClass("drop-target")&&!$target.find($placeholder).length?$target.append(_showPlaceholder()):$target[0]===$placeholder[0]||$target.hasClass("qti-word-wrap")||$target.children(".qti-word-wrap").length||_resetPlaceholder($el)}),$el.one("dragoverstop.gridEdit",function(){
dropped&&$placeholder.removeAttr("id").removeAttr("class"),_destroyDroppableInlines($el),dropped?$el.trigger("dropped.gridEdit"+ns,[qtiClass,$placeholder,data]):($placeholder.remove(),$placeholder=null)})},droppableGridEditor.destroyDroppables=function($el){_destroyDroppableInlines($el),_destroyDroppableBlocks($el)};var _destroyDroppableInlines=function($el){$el.off(".gridEdit.gridDragDrop"),$el.find("span.qti-word-wrap").replaceWith(function(){return $(this).text()}),$el.find(".drop-target").removeClass("drop-target")},_destroyDroppableBlocks=function($el){$el.removeClass("dropping").off(".gridEdit.gridDragDrop"),$el.find('[class^="col-"], [class*=" col-"]').removeAttr("style"),
_restoreTmpCol($el);var _toBeRemoved=["#qti-block-element-placeholder",".new-col",".grid-row-new",".grid-edit-insert-box"];$el.find(_toBeRemoved.join(",")).remove()},_getNewRow=function(){return $("<div>",{"class":"grid-row grid-row-new","data-units":0})},_getNewCol=function(){return $("<div>",{"class":"new-col"})},_restoreTmpCol=function($el){$el.find(".grid-row").each(function(){var $row=$(this);if($row.children(".new-col").attr("class","new-col").removeAttr("style"),$row.hasClass("grid-row-new")){var $children=$row.children();$children.length>1&&($row.prev().append($children),$row.append($children.first()))}$row.children(":not(.new-col)").each(function(){var $col=$(this),originalClasses=$col.attr("data-original-class");
originalClasses&&$col.attr("class",originalClasses).removeAttr("data-original-class")}),$row.removeAttr("data-active")})};return droppableGridEditor}),define("taoQtiItem/qtiCreator/editor/gridEditor/draggable",["jquery","lodash","taoQtiItem/qtiCreator/helper/qtiElements","taoQtiItem/qtiCreator/editor/gridEditor/droppable","jqueryui"],function($,_,QtiElements,droppable){"use strict";var _insertableDefaultsOptions={helper:function(){return $(this).clone()}},createInsertable=function($el,$to,opts){var options=_.defaults(opts,_insertableDefaultsOptions);createDraggable($el,$to,{helper:options.helper,namespace:"insertable"})},createDraggable=function($el,$to,opts){
var options=_.defaults(opts,{distance:1,helper:"original"});$el.draggable({distance:parseInt(options.distance),helper:options.helper,appendTo:$(document.body),opacity:1,scroll:!1,cursor:"crosshair",cursorAt:{left:-5,bottom:-5},create:function(){$(this).addClass("grid-draggable")},start:function(e,ui){$to.trigger("beforedragoverstart.gridEdit"),"function"==typeof options.start&&options.start.call(this,e,ui),$(this).removeClass("grid-draggable-active");var qtiClass=$(this).data("qti-class");if(QtiElements.isInline(qtiClass))droppable.createDroppableInlines(qtiClass,$to,options);else{if(!QtiElements.isBlock(qtiClass))throw"undefined qti class";droppable.createDroppableBlocks(qtiClass,$to,options);
}$to.trigger("dragoverstart.gridEdit")},stop:function(e,ui){$("body").css("cursor","auto"),ui.helper.remove(),"function"==typeof options.stop&&options.stop.call(this,e,ui),$to.trigger("dragoverstop.gridEdit")}}),$el.on("mousedown.gridDraggable.gridEdit",function(){$(this).addClass("grid-draggable-active")}).on("mouseup.gridDraggable.gridEdit",function(){$(this).removeClass("grid-draggable-active")})},createMovable=function($el,$to){var $parent=$el.parent('[class^="col-"], [class*=" col-"]');createDraggable($el,$to,{distance:5,initialPosition:$el.parent(),namespace:"movable",start:function(e,ui){$el.hide(),$parent.data({"initial-position":!0,"initial-class":$parent.attr("class")
}).attr("class","new-col")},helper:function(){return $(this).clone().addClass("grid-draggable-helper").css({height:$(this).height(),width:$(this).width()})},stop:function(e,ui){$el.data("grid-element-dropped")||$parent.attr("class",$parent.data("initial-class")),$el.data("grid-element-dropped",!1),$el.show()},data:{widget:$el.data("widget")}})},_destroyDraggables=function($el){$el.draggable("destroy"),$el.removeClass("grid-draggable"),$el.off(".gridDraggable")};return{createInsertable:function($el,$to,opts){createInsertable($el,$to,opts)},createMovable:function($el,$to,opts){createMovable($el,$to,opts)},destroy:_destroyDraggables}}),define("taoQtiItem/qtiCreator/editor/jquery.gridEditor",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/helper","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/gridEditor/draggable","taoQtiItem/qtiCreator/editor/gridEditor/resizable"],function($,helper,contentHelper,draggable,resizable){
"use strict";function isCreated($elt){return"object"==typeof $elt.data("qti-grid-options")}function create($elt,options){$elt.data("qti-grid-options",options),$elt.find(".grid-row").each(function(){var totalUnits=0;$(this).children('[class*=" col-"], [class^="col-"]').each(function(){totalUnits+=helper.setUnitsFromClass($(this))})})}function destroy($elt){contentHelper.destroyGridWidgets($elt)}function getContent($el){return contentHelper.getContent($el)}$.fn.gridEditor=function(options){var opts={},method="",args=[],ret=void 0;return"object"==typeof options?opts=$.extend({},$.fn.gridEditor.defaults,options):void 0===options?opts=$.extend({},$.fn.gridEditor.defaults):"string"==typeof options&&"function"==typeof methods[options]&&(method=options,
args=Array.prototype.slice.call(arguments,1)),this.each(function(){var $this=$(this);method?isCreated($this)?ret=methods[method].apply($(this),args):$.error("call of method of gridEditor while it has not been initialized"):isCreated($this)||"object"!=typeof opts||create($this,opts)}),void 0===ret?this:ret},$.fn.gridEditor.defaults={elementClass:"itemBody"};var methods={addInsertables:function($elts,options){var $grid=$(this);$elts.each(function(){draggable.createInsertable($(this),$grid,options)})},createMovables:function($elts){var $grid=$(this);$elts.each(function(){draggable.createMovable($(this),$grid)})},destroy:function(){destroy($(this))},getContent:function(){
return getContent($(this))},setContent:function(content){content&&setContent($(this),content)},resizable:function(){resizable.create($(this))}}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/choiceSelector",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'multiple="multiple"'}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <option value="',(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" title="',
(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    "}function program4(depth0,data){return'selected="selected"';
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="choices-selector">\n    <select ',stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' placeholder="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enter choices",options):helperMissing.call(depth0,"__","Enter choices",options)))+'" data-has-search="false">\n    ',
stack1=helpers.each.call(depth0,depth0&&depth0.options,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n\n    </select>\n</div>\n"})}),define("taoQtiItem/qtiCreator/editor/response/choiceSelector",["jquery","lodash","i18n","ui/component","tpl!taoQtiItem/qtiCreator/tpl/toolbars/choiceSelector","select2"],function($,_,__,component,choiceSelectorTpl){"use strict";function formatOption(state){var title=$(state.element).attr("title");return title?'<span title="'+title+'">'+state.text+"</span>":state.text}function createOptionTitle(content,threshold){var fullText=$("<div>",{html:content}).text().trim().replace(/\s+/g," "),shortText=fullText.substr(0,threshold);
return fullText.length-shortText.length<=5?fullText:shortText+""}var _defaults={titleLength:0},init=function(){var selected=_.map(this.config.choices||[],function(c){return c.id()}),choices=this.config.interaction.getChoices(),response=this.config.interaction.getResponseDeclaration(),config=_.defaults(this.config||{},_defaults);config.multiple=response.isCardinality(["multiple","ordered"]),config.options=[],_.each(choices,function(choice){var id=choice.id(),choiceText="",option={value:id,label:id,selected:selected.indexOf(id)>-1};if(choice.is("containerChoice"))choiceText=choice.body();else{if(!choice.is("textVariableChoice"))return;choiceText=choice.val()}config.titleLength&&(option.title=createOptionTitle(choiceText,config.titleLength)),
config.options.push(option)})},destroy=function(){this.$component.find("select").select2("destroy")},render=function(){var self=this,$selectBox=this.$component.find("select");$selectBox.select2({dropdownAutoWidth:!0,placeholder:$selectBox.attr("placeholder"),minimumResultsForSearch:-1,formatResult:formatOption,formatSelection:formatOption}).on("change",function(){var selection=$selectBox.select2("val");self.setSelectedChoices(_.isArray(selection)?selection:[selection]),self.trigger("change",self.getSelectedChoices())})},choiceSelectorFactory=function(config){var _selectedChoices={},choices={};_.each(config.interaction.getChoices(),function(choice){choices[choice.id()]=choice;
});var choiceSelector={getSelectedChoices:function(){return _selectedChoices},setSelectedChoices:function(choicesId){_selectedChoices=_.map(choicesId,function(id){return choices[id]})}};return component(choiceSelector).on("init",init).on("destroy",destroy).on("render",render).setTemplate(choiceSelectorTpl).init(config)};return choiceSelectorFactory}),define("taoQtiItem/qtiCreator/editor/simpleContentEditableElement",["jquery","lodash"],function($,_){"use strict";function create($container,selector,callback){function _init($elt){$elt.attr("contenteditable",!0).addClass("simple-editable")}_init($container.find(selector)),$container.on("mouseenter.simpleeditable",selector,_.throttle(function(){
var $elt=$(this);$elt.attr("contenteditable")||_init($elt)},200)).on("keyup.simpleeditable",selector,_.throttle(function(e){callback($(this).text())},200)).on("keydown.simpleeditable",selector,function(e){13===e.which&&(e.preventDefault(),$(this).blur())})}function destroy($container){$container.find(".simple-editable").removeClass("simple-editable").removeAttr("contenteditable"),$container.off(".simpleeditable")}return{create:create,destroy:destroy}}),define("taoQtiItem/qtiCreator/helper/devTools",["lodash","jquery","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/model/helper/event"],function(_,$,xmlRenderer,event){"use strict";var tools={};
tools.listenStateChange=function(){$(document).on("afterStateInit.qti-widget",function(e,element,state){console.log("->state : "+state.name+" : "+element.serial)}).on("afterStateExit.qti-widget",function(e,element,state){console.log("<-state : "+state.name+" : "+element.serial)})},tools.getStates=function(item){var states={},elements=item.getComposingElements();return _.each(elements,function(element){var widget=element.data("widget");widget&&(states[element.getSerial()]=widget.getCurrentState().name)}),states},tools.liveXmlPreview=function(item,$destination){$(document).on(event.getList().join(" "),_.throttle(function(){var rawXml=xmlRenderer.render(item);_printXml(rawXml,$destination);
},200))};var _formatXml=function(xml){return vkbeautify.xml(xml,"	")},_printXml=function(rawXml,$destination){var $code=$(),xml=_formatXml(rawXml);xml=xml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),$destination.hasClass("language-markup")?$code=$destination:($code=$destination.find("code.language-markup"),$code.length||($code=$("<code>",{"class":"language-markup"}),$destination.addClass("line-numbers").html($code))),$code.length&&($code.html(xml),Prism.highlightElement($code[0]))};return tools}),define("taoQtiItem/qtiCreator/helper/dummyElement",["jquery","lodash"],function($,_){"use strict";var dummyElement=function(){
var types={maths:{icon:"maths",css:{width:40,height:22}},image:{icon:"image",css:{width:50,height:35}},video:{icon:"video",css:{width:200,height:150}},media:{icon:"media",css:{width:150,height:100}},include:{icon:"shared-file",css:{width:"100%",height:100}}},get=function(arg){var element,$element,$icon,css,finalOptions,options={element:"span","class":"dummy-element",css:{width:80,height:22}};return arg&&($.isPlainObject(arg)?(arg["class"]&&(options["class"]+=" "+arg["class"],delete arg["class"]),options=$.extend(!0,{},options,arg)):types[arg]&&(options=$.extend({},options,types[arg]))),$icon=options.icon?$("<span>",{"class":"icon-"+options.icon.replace("icon-","")
}):!1,element="<"+options.element+">",css=_.cloneDeep(options.css),css["font-size"]=css.height&&!css["font-size"]?.8*css.height:14,css["line-height"]=css["font-size"].toString()+"px",css.height>30&&(css["padding-top"]=(css.height-css["font-size"])/2*.9),css.height&&css.height>100&&(css["background-size"]="auto"),finalOptions=_.cloneDeep(options),delete finalOptions.icon,delete finalOptions.element,delete finalOptions.css,$element=$(element,finalOptions).css(css),$icon&&$element.append($icon),$element};return{get:get}}();return dummyElement}),define("taoQtiItem/qtiCreator/helper/uploadMime",["i18n"],function(__){"use strict";var uploadMime={getMimeTypes:function(){
return[{mime:"application/zip",label:__("ZIP archive")},{mime:"text/plain",label:__("Plain text")},{mime:"application/pdf",label:__("PDF file")},{mime:"image/jpeg",label:__("JPEG image")},{mime:"image/png",label:__("PNG image")},{mime:"image/gif",label:__("GIF image")},{mime:"image/svg+xml",label:__("SVG image")},{mime:"application/ogg",label:__("MPEG audio")},{mime:"audio/x-ms-wma",label:__("Windows Media audio")},{mime:"audio/x-wav",label:__("WAV audio")},{mime:"video/mpeg",label:__("MPEG video")},{mime:"video/mp4",label:__("MP4 video")},{mime:"video/quicktime",label:__("Quicktime video")},{mime:"video/x-ms-wmv",label:__("Windows Media video")},{mime:"video/x-flv",
label:__("Flash video")},{mime:"text/csv",label:__("CSV file")},{mime:"application/msword",label:__("Microsoft Word")},{mime:"application/vnd.ms-excel",label:__("Microsoft Excel")},{mime:"application/vnd.ms-powerpoint",label:__("Microsoft Powerpoint")}]}};return uploadMime}),define("taoQtiItem/qtiItem/core/Img",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Element,_,rendererConfig){var Img=Element.extend({qtiClass:"img",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};return defaultData.attributes={src:renderer.resolveUrl(this.attr("src"))
},this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return!this.attr("src")}});return Img}),define("taoQtiItem/qtiCreator/model/Img",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Img"],function(_,editable,Img){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{src:"",alt:""}},afterCreate:function(){this.data("responsive",!0)}}),Img.extend(methods)}),define("taoQtiItem/qtiItem/mixin/ContainerInline",["taoQtiItem/qtiItem/mixin/Mixin","taoQtiItem/qtiItem/mixin/Container","lodash"],function(Mixin,Container,_){
var methods={};return _.extend(methods,Container.methods),_.extend(methods,{initContainer:function(body){Container.methods.initContainer.call(this,body),this.bdy.contentModel="inlineStatic"}}),{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/mixin/NamespacedElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){var methods={getNamespace:function(){if(this.ns&&this.ns.name&&this.ns.uri)return _.clone(this.ns);var relatedItem=this.getRelatedItem();if(relatedItem){var namespaces=relatedItem.getNamespaces();for(var ns in namespaces)if(namespaces[ns].indexOf(this.nsUriFragment)>0)return{
name:ns,uri:namespaces[ns]};return relatedItem.namespaces[this.defaultNsName]=this.defaultNsUri,{name:this.defaultNsName,uri:this.defaultNsUri}}return{}},setNamespace:function(name,uri){this.ns={name:name,uri:uri}}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/Include",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline","taoQtiItem/qtiItem/mixin/NamespacedElement"],function(Element,Container,NamespacedElement){var Include=Element.extend({qtiClass:"include",defaultNsName:"xi",defaultNsUri:"http://www.w3.org/2001/XInclude",nsUriFragment:"XInclude",isEmpty:function(){
return!this.attr("href")||this.getBody().isEmpty()}});return Container.augment(Include),NamespacedElement.augment(Include),Include}),define("taoQtiItem/qtiCreator/model/Include",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Include"],function(_,editable,Include){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{}},afterCreate:function(){this.getNamespace()}}),Include.extend(methods)}),define("taoQtiItem/qtiItem/core/Math",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/mixin/NamespacedElement"],function($,_,Element,rendererConfig,NamespacedElement){
"use strict";function _stripMathTags(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":"")+"math[^>]*>","g");return mathML.replace(regex,"").replace(/^\s*[\r\n]/gm,"").replace(/\s*[\r\n]$/gm,"")}function _stripNamespace(mathML,nsName){var regex=new RegExp("<(/)?"+(nsName?nsName+":":""),"g");return mathML.replace(regex,"<$1")}function _isEmptyMathML(mathStr){var hasContent=!1;if(mathStr&&mathStr.trim()){var $math=$($.parseHTML(mathStr));hasContent=!!$math.text()}return!hasContent}var Math=Element.extend({qtiClass:"math",defaultNsName:"m",defaultNsUri:"http://www.w3.org/1998/Math/MathML",nsUriFragment:"MathML",init:function(serial,attributes){this._super(serial,attributes),
this.ns=null,this.mathML="",this.annotations={}},setAnnotation:function(encoding,value){this.annotations[encoding]=_.unescape(value)},getAnnotation:function(encoding){return this.annotations[encoding]},removeAnnotation:function(encoding){delete this.annotations[encoding]},setMathML:function(mathML){var ns=this.getNamespace(),nsName=ns.name&&ns.uri?ns.name:"";mathML=_stripMathTags(mathML,nsName),ns&&(mathML=_stripNamespace(mathML,nsName)),this.mathML=mathML},getMathML:function(){return this.mathML},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),tag=this.qtiClass,raw=this.mathML,body=raw,ns=this.getNamespace(),annotations="";
for(var encoding in this.annotations)annotations+='<annotation encoding="'+encoding+'">'+_.escape(this.annotations[encoding])+"</annotation>";annotations&&(raw=raw.indexOf("</semantics>")>0?raw.replace("</semantics>",annotations+"</semantics>"):"<semantics>"+raw+annotations+"</semantics>"),ns&&ns.name&&(body=raw.replace(/<(\/)?([^!<])/g,"<$1"+ns.name+":$2"),body=body.replace(/(>)([\W]+)(<\/)/g,function(match,p1,p2,p3){return[p1,_.escape(p2),p3].join("")}),tag=ns.name+":"+tag);var defaultData={block:"block"===this.attr("display")?!0:!1,body:body,raw:raw,tag:tag,ns:ns};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){
return _isEmptyMathML(this.mathML)&&(!this.annotations.latex||!this.annotations.latex.trim())}});return NamespacedElement.augment(Math),Math}),define("taoQtiItem/qtiCreator/model/Math",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Math"],function(_,editable,Math){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{}},afterCreate:function(){this.getNamespace()}}),Math.extend(methods)}),define("taoQtiItem/qtiItem/core/Object",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig,util){
var QtiObject=Element.extend({qtiClass:"object",getMediaType:function(){var type="undefined",mimetype=this.attr("type");return mimetype&&(type=0===mimetype.indexOf("video")?"video":0===mimetype.indexOf("audio")?"audio":0===mimetype.indexOf("image")?"image":0===mimetype.indexOf("text/html")?"html":"object"),type},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={};switch(this.getMediaType()){case"video":defaultData.video=!0;break;case"audio":defaultData.audio=!0;break;case"html":defaultData.html=!0;break;case"image":default:defaultData.object=!0}return defaultData.attributes={data:renderer.resolveUrl(this.attr("data"))
},defaultData.body=this._alt,this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},isEmpty:function(){return!this.attr("data")}});return QtiObject}),define("taoQtiItem/qtiCreator/model/Object",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/Object"],function(_,editable,Object){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{data:"",type:""}}}),Object.extend(methods)}),define("taoQtiItem/qtiCreator/model/helper/portableElement",["lodash","jquery","taoQtiItem/qtiItem/helper/util"],function(_,$,util){"use strict";function _addNsDir(typeIdentifier,file){
return file.match(/^\./)?typeIdentifier+"/"+file.replace(/^\.\//,""):file}function addNamespaceDirectory(typeIdentifier,file){return _.isString(file)?_addNsDir(typeIdentifier,file):_.isArray(file)?_.map(file,function(f){return _addNsDir(typeIdentifier,f)}):void 0}function getDefaultMethods(registry){return{getDefaultAttributes:function(){return{}},getDefaultProperties:function(){var creator=registry.getCreator(this.typeIdentifier);return _.isFunction(creator.getDefaultProperties)?creator.getDefaultProperties(this):{}},afterCreate:function(){var response,typeId=this.typeIdentifier,creator=registry.getCreator(typeId),manifest=registry.getManifest(typeId),item=this.getRelatedItem(),_this=this;
return registry.addRequiredResources(typeId,item.data("uri"),function(res){if(!res.success)throw"resource addition failed";$(document).trigger("resourceadded.qti-creator",[typeId,res.resources,_this])}),creator.getMarkupTemplate(),this.properties=creator.getDefaultProperties(),this.entryPoint=addNamespaceDirectory(typeId,manifest.entryPoint),_.isArray(manifest.libraries)&&(this.libraries=addNamespaceDirectory(typeId,manifest.libraries)),_.isArray(manifest.css)&&(this.css=addNamespaceDirectory(typeId,manifest.css),_.each(this.css,function(css){item.stylesheetExists(css)||item.createStyleSheet(css)})),manifest.response?(response=this.createResponse({cardinality:manifest.response.cardinality
}),manifest.response.baseType&&response.attr("baseType",manifest.response.baseType)):(this.attr("title",manifest.label),this.attr("id")||this.attr("id",util.buildId(this.getRelatedItem(),typeId))),this.markup=this.renderMarkup(),this.getNamespace(),_.isFunction(creator.afterCreate)?creator.afterCreate(this):void 0},renderMarkup:function(){var creator=registry.getCreator(this.typeIdentifier),markupTpl=creator.getMarkupTemplate(),markupData=this.getDefaultMarkupTemplateData();return _.isFunction(creator.getMarkupData)&&(markupData=creator.getMarkupData(this,markupData)),markupTpl(markupData)},updateMarkup:function(){this.markup=this.renderMarkup()}}}return{getDefaultMethods:getDefaultMethods
}}),define("taoQtiItem/qtiItem/mixin/CustomElement",["taoQtiItem/qtiItem/mixin/Mixin","lodash"],function(Mixin,_){var methods={prop:function(name,value){if(name)if(void 0!==value)this.properties[name]=value;else if("object"==typeof name)for(var prop in name)this.prop(prop,name[prop]);else if("string"==typeof name)return void 0===this.properties[name]?void 0:this.properties[name];return this},removeProp:function(propNames){var _this=this;return"string"==typeof propNames&&(propNames=[propNames]),_.each(propNames,function(propName){delete _this.attributes[propName]}),this},getProperties:function(){return _.clone(this.properties)},getMarkupNamespace:function(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);
var relatedItem=this.getRelatedItem();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function(name,uri){this.markupNs={name:name,uri:uri}}};return{augment:function(targetClass){Mixin.augment(targetClass,methods)},methods:methods}}),define("taoQtiItem/qtiItem/core/PortableInfoControl",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Element,CustomElement,NamespacedElement,rendererConfig){"use strict";
var PortableInfoControl=Element.extend({qtiClass:"infoControl",defaultNsName:"pic",defaultNsUri:"http://www.imsglobal.org/xsd/portableInfoControl",nsUriFragment:"portableInfoControl",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.readyStack=[]},is:function(qtiClass){return"infoControl"===qtiClass||this._super(qtiClass)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,
markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pic:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},getState:function(){var ret=null,renderer=this.getRenderer();return renderer&&_.isFunction(renderer.getState)&&(ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();renderer&&_.isFunction(renderer.getState)&&renderer.setState(this,state)},toArray:function(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,arr},onReady:function(cb){this.readyStack.push(cb),this.data("_ready")&&this.data("pic")&&this.triggerReady();
},triggerReady:function(){var self=this;_.forEach(this.readyStack,function(cb){cb.call(self,self.data("pic"))}),this.readyStack=[],this.data("_ready",!0)}});return CustomElement.augment(PortableInfoControl),NamespacedElement.augment(PortableInfoControl),PortableInfoControl}),define("taoQtiItem/qtiCreator/model/PortableInfoControl",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/helper/portableElement","taoQtiItem/qtiCreator/editor/infoControlRegistry","taoQtiItem/qtiItem/core/PortableInfoControl"],function(_,editable,portableElement,icRegistry,PortableInfoControl){"use strict";var methods={};return _.extend(methods,editable),
_.extend(methods,portableElement.getDefaultMethods(icRegistry)),_.extend(methods,{getDefaultMarkupTemplateData:function(){return{}}}),PortableInfoControl.extend(methods)}),define("taoQtiItem/qtiItem/core/RubricBlock",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/Container"],function(Element,Container){var RubricBlock=Element.extend({qtiClass:"rubricBlock"});return Container.augment(RubricBlock),RubricBlock}),define("taoQtiItem/qtiCreator/model/RubricBlock",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/RubricBlock"],function(_,editable,RubricBlock){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{
getDefaultAttributes:function(){return{view:["candidate"],use:""}}}),RubricBlock.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/Choice",["taoQtiItem/qtiItem/core/IdentifiedElement"],function(IdentifiedElement){var Choice=IdentifiedElement.extend({init:function(serial,attributes){this._super(serial,attributes)},is:function(qtiClass){return"choice"===qtiClass||this._super(qtiClass)},getInteraction:function(){var found,ret=null,item=this.getRelatedItem();return item&&(found=item.find(this.serial),found&&(ret=found.parent)),ret}});return Choice}),define("taoQtiItem/qtiItem/core/choices/Hotspot",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){
var QtiHotspot=QtiChoice.extend({});return QtiHotspot}),define("taoQtiItem/qtiItem/core/choices/AssociableHotspot",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){var QtiAssociableHotspot=QtiHotspot.extend({qtiClass:"associableHotspot"});return QtiAssociableHotspot}),define("taoQtiItem/qtiCreator/model/choices/AssociableHotspot",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/AssociableHotspot"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{matchMax:0,matchMin:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/Gap",["taoQtiItem/qtiItem/core/choices/Choice"],function(QtiChoice){
var QtiGap=QtiChoice.extend({qtiClass:"gap"});return QtiGap}),define("taoQtiItem/qtiCreator/model/choices/Gap",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/Gap"],function(_,editable,Gap){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{required:!1}}}),Gap.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/GapImg",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/core/Object"],function(QtiChoice,QtiObject){var QtiGapImg=QtiChoice.extend({qtiClass:"gapImg",initObject:function(object){this.object=object||new QtiObject},getObject:function(){
return this.object}});return QtiGapImg}),define("taoQtiItem/qtiCreator/model/choices/GapImg",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/GapImg"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{matchMin:0,matchMax:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/TextVariableChoice",["jquery","lodash","taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/helper/rendererConfig"],function($,_,QtiChoice,rendererConfig){var QtiTextVariableChoice=QtiChoice.extend({init:function(serial,attributes,text){
this._super(serial,attributes),this.val(text||"")},is:function(qtiClass){return"textVariableChoice"===qtiClass||this._super(qtiClass)},val:function(text){if("undefined"==typeof text)return this.text;if("string"!=typeof text)throw"text must be a string";return this.text=text,$(document).trigger("choiceTextChange",{choice:this,text:text}),this},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={body:this.text};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return QtiTextVariableChoice}),define("taoQtiItem/qtiItem/core/choices/GapText",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){
var QtiGapText=QtiTextVariableChoice.extend({qtiClass:"gapText"});return QtiGapText}),define("taoQtiItem/qtiCreator/model/choices/GapText",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/GapText"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{fixed:!1,matchMax:1,matchMin:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/HotspotChoice",["taoQtiItem/qtiItem/core/choices/Hotspot"],function(QtiHotspot){var QtiHotspotChoice=QtiHotspot.extend({qtiClass:"hotspotChoice"});return QtiHotspotChoice}),define("taoQtiItem/qtiCreator/model/choices/HotspotChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/HotspotChoice"],function(_,editable,Choice){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/Hottext",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Choice,Container){var Hottext=Choice.extend({qtiClass:"hottext"});return Container.augment(Hottext),Hottext}),define("taoQtiItem/qtiCreator/model/choices/Hottext",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/Hottext"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){
return{fixed:!1}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/InlineChoice",["taoQtiItem/qtiItem/core/choices/TextVariableChoice"],function(QtiTextVariableChoice){var QtiInlineChoice=QtiTextVariableChoice.extend({qtiClass:"inlineChoice"});return QtiInlineChoice}),define("taoQtiItem/qtiCreator/model/choices/InlineChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/InlineChoice"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{fixed:!1,showHide:"show"}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/ContainerChoice",["taoQtiItem/qtiItem/core/choices/Choice","taoQtiItem/qtiItem/mixin/Container"],function(Choice,Container){
var ContainerChoice=Choice.extend({init:function(serial,attributes){this._super(serial,attributes)},is:function(qtiClass){return"containerChoice"===qtiClass||this._super(qtiClass)}});return Container.augment(ContainerChoice),ContainerChoice}),define("taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){var QtiSimpleAssociableChoice=QtiContainerChoice.extend({qtiClass:"simpleAssociableChoice"});return QtiSimpleAssociableChoice}),define("taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice"],function(_,editable,Choice){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,{getDefaultAttributes:function(){return{fixed:!1,showHide:"show",matchMax:0,matchMin:0}}}),Choice.extend(methods)}),define("taoQtiItem/qtiItem/core/choices/SimpleChoice",["taoQtiItem/qtiItem/core/choices/ContainerChoice"],function(QtiContainerChoice){var QtiSimpleChoice=QtiContainerChoice.extend({qtiClass:"simpleChoice"});return QtiSimpleChoice}),define("taoQtiItem/qtiCreator/model/choices/SimpleChoice",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/choices/SimpleChoice"],function(_,editable,Choice){"use strict";var methods={};return _.extend(methods,editable),
_.extend(methods,{getDefaultAttributes:function(){return{fixed:!1,showHide:"show"}}}),Choice.extend(methods)}),define("taoQtiItem/qtiCreator/model/helper/response",["lodash"],function(_){"use strict";return{removeChoice:function(response,choice){var escapedIdentifier=choice.id().replace(/([.-])/g,"\\$1"),regex=new RegExp("([^a-z_-d.]*)("+escapedIdentifier+")([^a-z_-d.]*)");_.remove(response.correctResponse,function(entry){return entry.match(regex)});var mapEntries={};_.forIn(response.mapEntries,function(value,mapKey){mapKey.match(regex)||(mapEntries[mapKey]=value)}),response.mapEntries=mapEntries}}}),define("taoQtiItem/qtiItem/core/variables/ResponseDeclaration",["taoQtiItem/qtiItem/core/variables/VariableDeclaration","lodash"],function(VariableDeclaration,_){
"use strict";var ResponseDeclaration=VariableDeclaration.extend({qtiClass:"responseDeclaration",init:function(serial,attributes){this._super(serial,attributes),this.template="",this.mappingAttributes={},this.mapEntries={},this.correctResponse=null,this.feedbackRules={}},getFeedbackRules:function(){return _.values(this.feedbackRules)},getComposingElements:function(){var elts=this._super();return elts=_.extend(elts,this.feedbackRules)},toArray:function(){var arr=this._super();return arr.howMatch=this.template,arr.correctResponses=this.correctResponse,arr.mapping=this.mapEntries,arr.mappingAttributes=this.mappingAttributes,arr.feedbackRules=_.map(this.feedbackRules,function(rule){
return rule.toArray()}),arr},getInteraction:function(){var interaction=null,responseId=this.id(),item=this.getRelatedItem(),interactions=item.getInteractions();return _.each(interactions,function(i){return i.attributes.responseIdentifier===responseId?(interaction=i,!1):void 0}),interaction},isCardinality:function(cardinalities){var comparison;if(_.isArray(cardinalities))comparison=cardinalities;else{if(!_.isString(cardinalities))return!1;cardinalities=[cardinalities]}return _.indexOf(comparison,this.attr("cardinality"))>=0}});return ResponseDeclaration}),define("taoQtiItem/qtiItem/core/response/SimpleFeedbackRule",["taoQtiItem/qtiItem/core/Element","lodash"],function(Element,_){
"use strict";var SimpleFeedbackRule=Element.extend({qtiClass:"_simpleFeedbackRule",serial:"",relatedItem:null,init:function(serial,feedbackOutcome,feedbackThen,feedbackElse){this._super(serial,{}),this.condition="correct",this.comparedOutcome=null,this.comparedValue=0,this.feedbackOutcome=feedbackOutcome,Element.isA(feedbackThen,"feedback")?this.feedbackThen=feedbackThen:this.feedbackThen=null,Element.isA(feedbackElse,"feedback")?this.feedbackElse=feedbackThen:this.feedbackElse=null},setCondition:function(comparedOutcome,condition,comparedValue){var _comparedValues=[];if(!Element.isA(comparedOutcome,"variableDeclaration"))throw"invalid outcome type: must be a variableDeclaration";
switch(condition){case"correct":case"incorrect":if(!Element.isA(comparedOutcome,"responseDeclaration"))throw"invalid outcome type: must be a responseDeclaration";this.comparedOutcome=comparedOutcome,this.condition=condition;break;case"lt":case"lte":case"equal":case"gte":case"gt":if(null===comparedValue||void 0===comparedValue)throw"compared value must not be null";this.comparedOutcome=comparedOutcome,this.condition=condition,this.comparedValue=comparedValue;break;case"choices":if(!Element.isA(comparedOutcome,"responseDeclaration")||null===comparedValue||!_.isArray(comparedValue))throw"compared value must not be null";var choices=_.values(comparedOutcome.getInteraction().getChoices());
this.comparedOutcome=comparedOutcome,this.condition=condition,_.each(comparedValue,function(v){v instanceof Element?_comparedValues.push(v):_.isString(v)&&_.each(choices,function(c){return c.attr("identifier")===v?(_comparedValues.push(c),!1):void 0})}),this.comparedValue=_comparedValues;break;default:throw"unknown condition type : ".condition}return this},setFeedbackElse:function(feedback){Element.isA(feedback,"feedback")&&(this.feedbackElse=feedback)},toArray:function(){var val=this.comparedValue,_toString=function(v){return val instanceof Element?val.attr("identifier"):val+""};return val=_.isArray(val)?_.map(val,_toString):_toString(val),{condition:this.condition,
comparedOutcome:this.comparedOutcome.id(),comparedValue:val}}});return SimpleFeedbackRule}),define("taoQtiItem/qtiItem/helper/response",["lodash"],function(_){var _templateNames={MATCH_CORRECT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct",MAP_RESPONSE:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response",MAP_RESPONSE_POINT:"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point"};return{isUsingTemplate:function(response,tpl){return!_.isString(tpl)||tpl!==response.template&&_templateNames[tpl]!==response.template?!1:!0},isValidTemplateName:function(tplName){return!!this.getTemplateUriFromName(tplName);
},getTemplateUriFromName:function(tplName){return _templateNames[tplName]?_templateNames[tplName]:""},getTemplateNameFromUri:function(tplUri){var tplName="";return _.forIn(_templateNames,function(uri,name){return uri===tplUri?(tplName=name,!1):void 0}),tplName}}}),define("taoQtiItem/qtiCreator/model/variables/ResponseDeclaration",["jquery","lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/core/variables/ResponseDeclaration","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiItem/core/response/SimpleFeedbackRule","taoQtiItem/qtiItem/helper/response"],function($,_,Element,ResponseDeclaration,editable,SimpleFeedbackRule,responseHelper){"use strict";
var methods={};return _.extend(methods,editable),_.extend(methods,{setTemplate:function(template){var templateUri=responseHelper.getTemplateUriFromName(template);return templateUri&&this.template!==templateUri&&(this.template=templateUri,$(document).trigger("responseTemplateChange.qti-widget",{element:this,value:template})),this},getTemplate:function(){return this.template},resetCorrect:function(){return this.correctResponse=null,$(document).trigger("correctResponseChange.qti-widget",{element:this,value:null}),this},setCorrect:function(value){return _.isString(value)&&(value=[value]),this.correctResponse=value,$(document).trigger("correctResponseChange.qti-widget",{
element:this,value:value}),this},getCorrect:function(){return _.clone(this.correctResponse)},setMappingAttribute:function(name,value){this.mappingAttributes[name]=value,$(document).trigger("mappingAttributeChange.qti-widget",{element:this,key:name,value:value})},removeMappingAttribute:function(name){delete this.mappingAttributes[name],$(document).trigger("mappingAttributeChange.qti-widget",{element:this,key:name,value:null})},getMappingAttribute:function(name){return this.mappingAttributes[name]},setMapEntry:function(mapKey,mappedValue,caseSensitive){if(mappedValue=parseFloat(mappedValue),caseSensitive=caseSensitive?!0:!1,isNaN(mappedValue))throw"the mapped value is not a number";
if("multiple"===this.attr("cardinality")&&"pair"===this.attr("baseType")){var mapKeys=mapKey.split(" "),mapKeysReverse=mapKeys[1]+" "+mapKeys[0];this.mapEntries[mapKeysReverse]?this.mapEntries[mapKeysReverse]=mappedValue:this.mapEntries[mapKey]=mappedValue}else this.mapEntries[mapKey]=mappedValue;return $(document).trigger("mapEntryChange.qti-widget",{element:this,mapKey:mapKey,mappedValue:mappedValue,caseSensitive:caseSensitive}),this},removeMapEntry:function(mapKey,canBeEmpty){if("undefined"==typeof canBeEmpty&&(canBeEmpty=!1),mapKey||canBeEmpty){if("multiple"===this.attr("cardinality")&&"pair"===this.attr("baseType")){var mapKeys=mapKey.split(" "),mapKeysReverse=mapKeys[1]+" "+mapKeys[0];
delete this.mapEntries[mapKeysReverse]}delete this.mapEntries[mapKey],$(document).trigger("mapEntryRemove.qti-widget",{element:this,mapKey:mapKey})}return this},getMapEntries:function(){return _.clone(this.mapEntries)},removeMapEntries:function(){_(this.mapEntries).keys().forEach(this.removeMapEntry,this)},createFeedbackRule:function(){var item=this.getRelatedItem(),outcome=item.createOutcomeDeclaration({identifier:"FEEDBACK",cardinality:"single",baseType:"identifier"}),modalFeedback=item.createModalFeedback({identifier:"feedbackModal",outcomeIdentifier:outcome.id()},this),rule=new SimpleFeedbackRule("",outcome,modalFeedback);rule.setCondition(this,"correct"),
this.feedbackRules[rule.getSerial()]=rule;var renderer=this.getRenderer();return renderer&&(rule.setRenderer(renderer),modalFeedback.setRenderer(renderer)),$(document).trigger("feedbackRuleCreated.qti-widget",{element:this,rule:rule}),rule},getFeedbackRule:function(serial){return this.feedbackRules[serial]},getFeedbackRules:function(){return _.clone(this.feedbackRules)},setCondition:function(rule,condition,value){rule.setCondition(this,condition,value),$(document).trigger("feedbackRuleConditionChange.qti-widget",{element:this,rule:rule,condition:condition,value:value})},deleteFeedbackRule:function(rule){var ret,item=this.getRelatedItem();return item.remove("outcomes",rule.feedbackOutcome),
item.remove("modalFeedbacks",rule.feedbackThen),item.remove("modalFeedbacks",rule.feedbackElse||""),ret=this.remove("feedbackRules",rule),$(document).trigger("feedbackRuleRemoved.qti-widget",{element:this,rule:rule}),ret},createFeedbackElse:function(rule){var modalFeedback;if(Element.isA(rule,"_simpleFeedbackRule")){modalFeedback=this.getRelatedItem().createModalFeedback({identifier:"feedbackModal",outcomeIdentifier:rule.feedbackOutcome.id()},this),rule.setFeedbackElse(modalFeedback);var renderer=this.getRenderer();renderer&&modalFeedback.setRenderer(renderer),$(document).trigger("feedbackRuleElseCreated.qti-widget",{element:this,rule:rule,modalFeedback:modalFeedback
})}return modalFeedback},deleteFeedbackElse:function(rule){this.getRelatedItem().remove("modalFeedbacks",rule.feedbackElse),rule.feedbackElse=null,$(document).trigger("feedbackRuleElseRemoved.qti-widget",{element:this,rule:rule})},getDefaultAttributes:function(){return{}}}),ResponseDeclaration.extend(methods)}),define("taoQtiItem/qtiCreator/model/mixin/editableInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/variables/ResponseDeclaration","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,ResponseDeclaration,event,responseHelper){"use strict";var methods={removeChoice:function(choice){
var c,serial="";return"string"==typeof choice?serial=choice:Element.isA(choice,"choice")&&(serial=choice.getSerial()),this.choices[serial]&&(c=this.choices[serial],delete this.choices[serial],responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),this},createResponse:function(attrs,template){var response=new ResponseDeclaration;attrs&&response.attr(attrs),this.getRelatedItem().addResponseDeclaration(response),response.buildIdentifier("RESPONSE",!1),response.setTemplate(template||"MATCH_CORRECT"),this.attr("responseIdentifier",response.id()),response.mappingAttributes.defaultValue=0;var renderer=this.getRenderer();return renderer&&response.setRenderer(renderer),
response},deleteResponse:function(){var response=this.getResponseDeclaration();return response&&this.getRelatedItem().deleteResponseDeclaration(response),this.removeAttr("responseIdentifier"),this},beforeRemove:function(){var serial=this.serial,interactions=this.getRelatedItem().getInteractions();this.deleteResponse(),2===_.size(interactions)&&_.each(interactions,function(interaction){var response=interaction.getResponseDeclaration();response&&interaction.serial!==serial&&"endAttemptInteraction"!==interaction.qtiClass&&(interaction.attr("responseIdentifier","RESPONSE"),response.id("RESPONSE"))})}};return methods}),define("taoQtiItem/qtiItem/core/interactions/Interaction",["taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(Element,_,rendererConfig,util){
"use strict";var QtiInteraction=Element.extend({init:function(serial,attributes){this._super(serial,attributes),this.choices={}},is:function(qtiClass){return"interaction"===qtiClass||this._super(qtiClass)},addChoice:function(choice){return choice.setRelatedItem(this.getRelatedItem()||null),this.choices[choice.getSerial()]=choice,this},getChoices:function(){var choices={};for(var i in this.choices)choices[i]=this.choices[i];return choices},getChoice:function(serial){var ret=null;return this.choices[serial]&&(ret=this.choices[serial]),ret},getChoiceByIdentifier:function(identifier){for(var i in this.choices)if(this.choices[i].id()===identifier)return this.choices[i];
return null},getComposingElements:function(){var elts=this._super();for(var serial in this.choices)Element.isA(this.choices[serial],"choice")&&(elts[serial]=this.choices[serial],elts=_.extend(elts,this.choices[serial].getComposingElements()));return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,"choices",serial)),found},getResponseDeclaration:function(){var response=null,responseId=this.attr("responseIdentifier");if(responseId){var item=this.getRelatedItem();if(!item)throw"cannot get response of an interaction out of its item context";response=item.getResponseDeclaration(responseId)}return response},
render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={_type:this.qtiClass.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()}),choices:[],choiceShuffle:!0};if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;var choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices(),interactionData={interaction:{serial:this.serial,attributes:this.attributes}},_this=this;_.each(choices,function(choice){if(Element.isA(choice,"choice"))try{var renderedChoice=choice.render(_.clone(interactionData,!0),null,choice.qtiClass+"."+_this.qtiClass,renderer);
defaultData.choices.push(renderedChoice)}catch(e){}});var tplName=args.subclass?this.qtiClass+"."+args.subclass:this.qtiClass;return this._super(_.merge(defaultData,args.data),args.placeholder,tplName,renderer)},postRender:function(data,altClassName,renderer){var self=this;return renderer=renderer||this.getRenderer(),_(this.getChoices()).filter(function(elt){return Element.isA(elt,"choice")}).map(function(choice){return choice.postRender({},choice.qtiClass+"."+self.qtiClass,renderer)}).value().concat(this._super(data,altClassName,renderer))},setResponse:function(values){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;
return ret=renderer.setResponse(this,values)},getResponse:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return ret=renderer.getResponse(this)},resetResponse:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return ret=renderer.resetResponse(this)},getState:function(){var ret=null,renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;return _.isFunction(renderer.getState)&&(ret=renderer.getState(this)),ret},setState:function(state){var renderer=this.getRenderer();
if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;_.isFunction(renderer.setState)&&renderer.setState(this,state)},clear:function(){var renderer=this.getRenderer();if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;_.isFunction(renderer.destroy)&&renderer.destroy(this)},toArray:function(){var arr=this._super();arr.choices={};for(var serial in this.choices)Element.isA(this.choices[serial],"choice")&&(arr.choices[serial]=this.choices[serial].toArray());return arr}});return QtiInteraction}),define("taoQtiItem/qtiItem/core/interactions/Prompt",["taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiItem/mixin/ContainerInline"],function(Element,Container){
var Prompt=Element.extend({qtiClass:"prompt"});return Container.augment(Prompt),Prompt}),define("taoQtiItem/qtiItem/core/interactions/BlockInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/core/interactions/Prompt","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(Interaction,Prompt,_,rendererConfig){"use strict";var BlockInteraction=Interaction.extend({init:function(serial,attributes){this._super(serial,attributes),this.prompt=new Prompt("")},is:function(qtiClass){return"blockInteraction"===qtiClass||this._super(qtiClass)},getComposingElements:function(){var elts=this._super();return elts=_.extend(elts,this.prompt.getComposingElements()),
elts[this.prompt.getSerial()]=this.prompt,elts},find:function(serial){return this._super(serial)||this.prompt.find(serial)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={prompt:this.prompt.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),[].concat(this.prompt.postRender({},"",renderer)).concat(this._super(data,altClassName,renderer))},toArray:function(){var arr=this._super();return arr.prompt=this.prompt.toArray(),arr}});return BlockInteraction;
}),define("taoQtiItem/qtiItem/core/interactions/AssociateInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(BlockInteraction){var AssociateInteraction=BlockInteraction.extend({qtiClass:"associateInteraction"});return AssociateInteraction}),define("taoQtiItem/qtiCreator/model/interactions/AssociateInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/AssociateInteraction","taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice"],function($,_,editable,editableInteraction,Interaction,Choice){var methods={};return _.extend(methods,editable),
_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{shuffle:!1,maxAssociations:0,minAssociations:0}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createResponse({baseType:"pair",cardinality:"multiple"})},createChoice:function(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(BlockInteraction){
var ChoiceInteraction=BlockInteraction.extend({qtiClass:"choiceInteraction"});return ChoiceInteraction}),define("taoQtiItem/qtiCreator/model/interactions/ChoiceInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/model/choices/SimpleChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{shuffle:!1,maxChoices:0,minChoices:0,orientation:"vertical"
}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"multiple"})},createChoice:function(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/InlineInteraction",["taoQtiItem/qtiItem/core/interactions/Interaction"],function(Interaction){"use strict";return Interaction.extend({
is:function(qtiClass){return"inlineInteraction"===qtiClass||this._super(qtiClass)}})}),define("taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(InlineInteraction){return InlineInteraction.extend({qtiClass:"endAttemptInteraction"})}),define("taoQtiItem/qtiCreator/model/interactions/EndAttemptInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/EndAttemptInteraction","i18n"],function(_,editable,editableInteraction,Interaction,__){"use strict";var methods={};return _.extend(methods,editable),
_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{title:__("End Attempt")}},afterCreate:function(){this.createResponse({baseType:"boolean",cardinality:"single"})},createChoice:function(){throw new Error("end attempt interaction has no choice")}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(BlockInteraction,_,rendererConfig){var ExtendedTextInteraction=BlockInteraction.extend({qtiClass:"extendedTextInteraction",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={
multiple:!1,maxStringLoop:[]},response=this.getResponseDeclaration();if(this.attr("maxStrings")&&("multiple"===response.attr("cardinality")||"ordered"===response.attr("cardinality"))){defaultData.multiple=!0;for(var i=0;i<this.attr("maxStrings");i++)defaultData.maxStringLoop.push(i+"")}return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return ExtendedTextInteraction}),define("taoQtiItem/qtiCreator/model/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/ExtendedTextInteraction"],function(_,editable,editableInteraction,Interaction){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{format:"plain"}},afterCreate:function(){this.createResponse({baseType:"string",cardinality:"single"})},createChoice:function(){throw"extendedTextInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ContainerInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/mixin/Container"],function(BlockInteraction,Container){var ContainerInteraction=BlockInteraction.extend({});return Container.augment(ContainerInteraction),
ContainerInteraction}),define("taoQtiItem/qtiItem/core/interactions/GapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction"],function(ContainerInteraction){var GapMatchInteraction=ContainerInteraction.extend({qtiClass:"gapMatchInteraction",getGaps:function(){return this.getBody().getElements("gap")}});return GapMatchInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GapMatchInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GapMatchInteraction","taoQtiItem/qtiCreator/model/choices/GapText","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,editable,editableInteraction,Interaction,Choice,event,responseHelper){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{shuffle:!1}},afterCreate:function(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>"),this.createChoice(),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createChoice:function(text){var choice=new Choice;return this.addChoice(choice),choice.val(text||"choice #"+_.size(this.getChoices())).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},createGap:function(attr,body){var choice=new Choice("",attr);
return this.addChoice(choice),choice.buildIdentifier("gap"),choice.body(body),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},removeChoice:function(element){var c,serial="";return"string"==typeof element?serial=element:Element.isA(element,"gap")?serial=element.serial:Element.isA(element,"gapText")&&(serial=element.serial),(c=this.getBody().getElement(serial))?(this.getBody().removeElement(c),responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)):(c=this.getChoice(serial))&&(delete this.choices[serial],responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),
this}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/ObjectInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/Object"],function(QtiBlockInteraction,QtiObject){var QtiObjectInteraction=QtiBlockInteraction.extend({initObject:function(object){this.object=object||new QtiObject},getObject:function(){return this.object}});return QtiObjectInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicInteraction",["taoQtiItem/qtiItem/core/interactions/ObjectInteraction","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(QtiObjectInteraction,_,rendererConfig){var QtiGraphicInteraction=QtiObjectInteraction.extend({
render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={backgroundImage:this.object.getAttributes(),object:this.object.render(renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return QtiGraphicInteraction}),define("taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(GraphicInteraction){var GraphicAssociateInteraction=GraphicInteraction.extend({qtiClass:"graphicAssociateInteraction"});return GraphicAssociateInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GraphicAssociateInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/model/choices/AssociableHotspot"],function($,_,editable,editableInteraction,Interaction,AssociableHotspot){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{maxAssociations:0,minAssociations:0}},afterCreate:function(){var relatedItem=this.getRelatedItem(),isResponsive=relatedItem.data("responsive");isResponsive===!0&&this.addClass("responsive"),this.createResponse({baseType:"pair",cardinality:"multiple"})},createChoice:function(attr){var choice=new AssociableHotspot("",attr);return this.addChoice(choice),choice.buildIdentifier("associablehotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,
interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction","taoQtiItem/qtiItem/core/Element","lodash","taoQtiItem/qtiItem/helper/rendererConfig"],function(GraphicInteraction,Element,_,rendererConfig){var GraphicGapMatchInteraction=GraphicInteraction.extend({qtiClass:"graphicGapMatchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.gapImgs={}},addGapImg:function(gapImg){Element.isA(gapImg,"gapImg")&&(gapImg.setRelatedItem(this.getRelatedItem()||null),this.gapImgs[gapImg.getSerial()]=gapImg)},removeGapImg:function(gapImg){
var serial="";return"string"==typeof gapImg?serial=gapImg:Element.isA(gapImg,"gapImg")&&(serial=gapImg.getSerial()),delete this.gapImgs[serial],this},getGapImgs:function(){return _.clone(this.gapImgs)},getGapImg:function(serial){return this.gapImgs[serial]},getComposingElements:function(){var elts=this._super();for(var serial in this.gapImgs)elts[serial]=this.gapImgs[serial],elts=_.extend(elts,this.gapImgs[serial].getComposingElements());return elts},find:function(serial){var found=this._super(serial);return found||this.gapImgs[serial]&&(found={parent:this,element:this.gapImgs[serial]}),found},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={
gapImgs:[]},gapImgs=this.getGapImgs();for(var serial in gapImgs)Element.isA(gapImgs[serial],"choice")&&defaultData.gapImgs.push(gapImgs[serial].render({},null,"",renderer));return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var arr=this._super();arr.gapImgs={};var gapImgs=this.getGapImgs();for(var serial in gapImgs)arr.gapImgs[serial]=gapImgs[serial].toArray();return arr}});return GraphicGapMatchInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GraphicGapMatchInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/model/choices/GapImg","taoQtiItem/qtiCreator/model/choices/AssociableHotspot"],function($,_,editable,editableInteraction,Interaction,GapImg,AssociableHotspot){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{afterCreate:function(){var relatedItem=this.getRelatedItem(),isResponsive=relatedItem.data("responsive");isResponsive===!0&&this.addClass("responsive"),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createGapImg:function(object,label){var gapImg=new GapImg;return gapImg.object.attributes=object,label&&gapImg.attr("objectLabel",label),this.gapImgs||(this.gapImgs=[]),this.addGapImg(gapImg),gapImg.buildIdentifier("gapimg"),this.getRenderer()&&gapImg.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{
choice:gapImg,interaction:this}),gapImg},createChoice:function(attr){var choice=new AssociableHotspot("",attr);return this.addChoice(choice),choice.buildIdentifier("associablehotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(GraphicInteraction){var GraphicOrderInteraction=GraphicInteraction.extend({qtiClass:"graphicOrderInteraction"});return GraphicOrderInteraction}),define("taoQtiItem/qtiCreator/model/interactions/GraphicOrderInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/model/choices/HotspotChoice"],function($,_,editable,editableInteraction,Interaction,Choice){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{}},afterCreate:function(){var relatedItem=this.getRelatedItem(),isResponsive=relatedItem.data("responsive");isResponsive===!0&&this.addClass("responsive"),this.createResponse({baseType:"identifier",cardinality:"ordered"})},createChoice:function(attr){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("hotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods);
}),define("taoQtiItem/qtiItem/core/interactions/HotspotInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(GraphicInteraction){var HotspotInteraction=GraphicInteraction.extend({qtiClass:"hotspotInteraction"});return HotspotInteraction}),define("taoQtiItem/qtiCreator/model/interactions/HotspotInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/HotspotInteraction","taoQtiItem/qtiCreator/model/choices/HotspotChoice"],function($,_,editable,editableInteraction,Interaction,Choice){"use strict";var methods={};return _.extend(methods,editable),
_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{maxChoices:0,minChoices:0}},afterCreate:function(){var relatedItem=this.getRelatedItem(),isResponsive=relatedItem.data("responsive");isResponsive===!0&&this.addClass("responsive"),this.createResponse({baseType:"identifier",cardinality:"single"})},createChoice:function(attr){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("hotspot"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/HottextInteraction",["taoQtiItem/qtiItem/core/interactions/ContainerInteraction","taoQtiItem/qtiItem/core/Element"],function(ContainerInteraction,Element){
var HottextInteraction=ContainerInteraction.extend({qtiClass:"hottextInteraction",getChoices:function(){return this.getBody().getElements("hottext")},getChoice:function(serial){var element=this.getBody().getElement(serial);return Element.isA(element,"choice")?element:null}});return HottextInteraction}),define("taoQtiItem/qtiCreator/model/interactions/HottextInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/HottextInteraction","taoQtiItem/qtiCreator/model/choices/Hottext","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,editable,editableInteraction,Interaction,Choice,event,responseHelper){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{maxChoices:0,minChoices:0}},afterCreate:function(){this.body("<p>Lorem ipsum dolor sit amet, consectetur adipisicing ...</p>"),this.createResponse({baseType:"identifier",cardinality:"multiple"})},createChoice:function(attr,body){var choice=new Choice("",attr);return this.addChoice(choice),choice.buildIdentifier("hottext"),choice.body(body),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},removeChoice:function(hottext){var c,serial="";return"string"==typeof hottext?serial=hottext:Element.isA(hottext,"hottext")&&(serial=hottext.getSerial()),
c=this.getBody().getElement(serial),c&&(this.getBody().removeElement(c),responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),this}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(InlineInteraction){var InlineChoiceInteraction=InlineInteraction.extend({qtiClass:"inlineChoiceInteraction"});return InlineChoiceInteraction}),define("taoQtiItem/qtiCreator/model/interactions/InlineChoiceInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/model/choices/InlineChoice"],function($,_,editable,editableInteraction,Interaction,Choice){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{shuffle:!1,required:!1}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"single"})},createChoice:function(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.val("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods);
}),define("taoQtiItem/qtiItem/core/interactions/MatchInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction","taoQtiItem/qtiItem/core/choices/SimpleAssociableChoice","lodash","taoQtiItem/qtiItem/helper/rendererConfig","taoQtiItem/qtiItem/helper/util"],function(BlockInteraction,SimpleAssociableChoice,_,rendererConfig,util){"use strict";var MatchInteraction=BlockInteraction.extend({qtiClass:"matchInteraction",init:function(serial,attributes){this._super(serial,attributes),this.choices=[{},{}]},addChoice:function(choice,matchSet){matchSet=parseInt(matchSet),this.choices[matchSet]&&(choice.setRelatedItem(this.getRelatedItem()||null),this.choices[matchSet][choice.getSerial()]=choice);
},getChoices:function(matchSet){return matchSet=parseInt(matchSet),this.choices[matchSet]?_.clone(this.choices[matchSet]):_.clone(this.choices)},getChoice:function(serial){return this.choices[0][serial]||this.choices[1][serial]||null},getComposingElements:function(){for(var elts=this._super(),i=0;2>i;i++){var matchSet=this.getChoices(i);for(var serial in matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&(elts[serial]=matchSet[serial],elts=_.extend(elts,matchSet[serial].getComposingElements()))}return elts},find:function(serial){var found=this._super(serial);return found||(found=util.findInCollection(this,["choices.0","choices.1"],serial)),found},render:function(){
var choices,args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={matchSet1:[],matchSet2:[]},interactionData={interaction:{serial:this.serial,attributes:this.attributes}};if(!renderer)throw"no renderer found for the interaction "+this.qtiClass;choices=this.attr("shuffle")&&renderer.getOption("shuffleChoices")?renderer.getShuffledChoices(this):this.getChoices();for(var i=0;2>i;i++){var matchSet=choices[i];for(var serial in matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&defaultData["matchSet"+(i+1)].push(matchSet[serial].render(_.clone(interactionData,!0),null,"simpleAssociableChoice.matchInteraction",renderer));
}return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},postRender:function(data,altClassName,renderer){return renderer=renderer||this.getRenderer(),_(this.getChoices()).map(function(choices){return _(choices).filter(function(choice){return choice instanceof SimpleAssociableChoice}).map(function(choice){return choice.postRender({},"simpleAssociableChoice.matchInteraction",renderer)}).value()}).flatten(!0).value().concat(this._super(data,altClassName,renderer))},toArray:function(){var arr=this._super();arr.choices={0:{},1:{}};for(var i=0;2>i;i++){var matchSet=this.getChoices(i);for(var serial in matchSet)matchSet[serial]instanceof SimpleAssociableChoice&&(arr.choices[i][serial]=matchSet[serial].toArray());
}return arr}});return MatchInteraction}),define("taoQtiItem/qtiCreator/model/interactions/MatchInteraction",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/MatchInteraction","taoQtiItem/qtiCreator/model/choices/SimpleAssociableChoice","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/helper/response"],function(_,Element,editable,editableInteraction,Interaction,Choice,event,responseHelper){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{
getDefaultAttributes:function(){return{shuffle:!1,maxAssociations:0,minAssociations:0}},afterCreate:function(){this.createChoice(0),this.createChoice(0),this.createChoice(1),this.createChoice(1),this.createResponse({baseType:"directedPair",cardinality:"multiple"})},createChoice:function(matchSet,attr){var choice=new Choice("",attr);this.addChoice(choice,matchSet);var rank=_.size(this.getChoices(matchSet));return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),event.choiceCreated(choice,this),choice},removeChoice:function(choice){var c,serial="";return"string"==typeof choice?serial=choice:Element.isA(choice,"choice")&&(serial=choice.getSerial()),
c=this.choices[0][serial]||this.choices[1][serial]||null,c&&(delete this.choices[0][serial],delete this.choices[1][serial],responseHelper.removeChoice(this.getResponseDeclaration(),c),event.deleted(c,this)),this}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/MediaInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/ObjectInteraction","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,ObjectInteraction,rendererConfig){var MediaInteraction=ObjectInteraction.extend({qtiClass:"mediaInteraction",render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={
media:this.object.render({},null,"",renderer)};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)}});return MediaInteraction}),define("taoQtiItem/qtiCreator/model/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/MediaInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{autostart:!1,minPlays:0,maxPlays:0,loop:!1}},afterCreate:function(){
this.createResponse({baseType:"integer",cardinality:"single"})},createChoice:function(){throw"mediaInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/OrderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(BlockInteraction){var OrderInteraction=BlockInteraction.extend({qtiClass:"orderInteraction"});return OrderInteraction}),define("taoQtiItem/qtiCreator/model/interactions/OrderInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/OrderInteraction","taoQtiItem/qtiCreator/model/choices/SimpleChoice"],function($,_,editable,editableInteraction,Interaction,Choice){
"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{shuffle:!1,orientation:"vertical"}},afterCreate:function(){this.createChoice(),this.createChoice(),this.createChoice(),this.createResponse({baseType:"identifier",cardinality:"ordered"})},createChoice:function(){var choice=new Choice;this.addChoice(choice);var rank=_.size(this.getChoices());return choice.body("choice #"+rank).buildIdentifier("choice"),this.getRenderer()&&choice.setRenderer(this.getRenderer()),$(document).trigger("choiceCreated.qti-widget",{choice:choice,interaction:this}),choice}}),Interaction.extend(methods);
}),define("taoQtiItem/qtiItem/core/interactions/CustomInteraction",["lodash","taoQtiItem/qtiItem/core/interactions/Interaction","taoQtiItem/qtiItem/mixin/CustomElement","taoQtiItem/qtiItem/mixin/NamespacedElement","taoQtiItem/qtiItem/helper/rendererConfig"],function(_,Interaction,CustomElement,NamespacedElement,rendererConfig){var CustomInteraction=Interaction.extend({qtiClass:"customInteraction",defaultNsName:"pci",defaultNsUri:"http://www.imsglobal.org/xsd/portableCustomInteraction",nsUriFragment:"portableCustomInteraction",defaultMarkupNsName:"html5",defaultMarkupNsUri:"html5",init:function(serial,attributes){this._super(serial,attributes),this.typeIdentifier="",
this.markup="",this.properties={},this.libraries=[],this.entryPoint="",this.markupNs={},this.pciReadyCallbacks=[]},is:function(qtiClass){return"customInteraction"===qtiClass||this._super(qtiClass)},render:function(){var args=rendererConfig.getOptionsFromArguments(arguments),renderer=args.renderer||this.getRenderer(),defaultData={typeIdentifier:this.typeIdentifier,markup:this.markup,properties:this.properties,libraries:this.libraries,entryPoint:this.entryPoint,ns:{pci:this.getNamespace().name+":"}};return this._super(_.merge(defaultData,args.data),args.placeholder,args.subclass,renderer)},toArray:function(){var arr=this._super();return arr.markup=this.markup,arr.properties=this.properties,
arr},getMarkupNamespace:function(){if(this.markupNs&&this.markupNs.name&&this.markupNs.uri)return _.clone(this.markupNs);var relatedItem=this.getRelatedItem();return relatedItem?(relatedItem.namespaces[this.defaultMarkupNsName]=this.defaultMarkupNsUri,{name:this.defaultMarkupNsName,uri:this.defaultMarkupNsUri}):{}},setMarkupNamespace:function(name,uri){this.markupNs={name:name,uri:uri}},onPciReady:function(callback){this.pciReadyCallbacks.push(callback),this.data("pci")&&this.triggerPciReady()},triggerPciReady:function(){var _this=this,pci=this.data("pci");if(!pci)throw"cannot trigger pci ready when no pci is actually attached to the interaction";_.each(this.pciReadyCallbacks,function(fn){
fn.call(_this,pci)}),this.pciReadyCallbacks=[],this.data("pciReady",!0)},onPci:function(event,callback){return this.onPciReady(function(pci){if(!_.isFunction(pci.on))throw"the pci does not implement on() function";pci.on(event,callback)}),this},offPci:function(event){return this.onPciReady(function(pci){if(!_.isFunction(pci.off))throw"the pci does not implement off() function";pci.off(event)}),this},triggerPci:function(event,args){return this.onPciReady(function(pci){if(!_.isFunction(pci.off))throw"the pci does not implement off() function";pci.trigger(event,args)}),this}});return CustomElement.augment(CustomInteraction),NamespacedElement.augment(CustomInteraction),
CustomInteraction}),define("taoQtiItem/qtiCreator/model/interactions/PortableCustomInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiCreator/model/helper/portableElement","taoQtiItem/qtiCreator/editor/customInteractionRegistry","taoQtiItem/qtiItem/core/interactions/CustomInteraction"],function(_,editable,editableInteraction,portableElement,ciRegistry,Interaction){"use strict";var _throwMissingImplementationError=function(pci,fnName){throw fnName+" not available for pci of type "+pci.typeIdentifier},methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),
_.extend(methods,portableElement.getDefaultMethods(ciRegistry)),_.extend(methods,{createChoice:function(){var creator=ciRegistry.getCreator(this.typeIdentifier);return _.isFunction(creator.createChoice)?creator.createChoice(this):void _throwMissingImplementationError(this,"createChoice")},getDefaultMarkupTemplateData:function(){return{responseIdentifier:this.attr("responseIdentifier")}}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/SelectPointInteraction",["taoQtiItem/qtiItem/core/interactions/GraphicInteraction"],function(GraphicInteraction){var SelectPointInteraction=GraphicInteraction.extend({qtiClass:"selectPointInteraction"
});return SelectPointInteraction}),define("taoQtiItem/qtiCreator/model/interactions/SelectPointInteraction",["jquery","lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/SelectPointInteraction"],function($,_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{maxChoices:0,minChoices:0}},afterCreate:function(){var relatedItem=this.getRelatedItem(),isResponsive=relatedItem.data("responsive");isResponsive===!0&&this.addClass("responsive"),
this.createResponse({baseType:"point",cardinality:"multiple"},"MAP_RESPONSE_POINT")}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/SliderInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(BlockInteraction){var SliderInteraction=BlockInteraction.extend({qtiClass:"sliderInteraction"});return SliderInteraction}),define("taoQtiItem/qtiCreator/model/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/SliderInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";
var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{lowerBound:0,upperBound:100,orientation:"horizontal",reverse:!1,step:1,stepLabel:!1}},afterCreate:function(){this.createResponse({baseType:"integer",cardinality:"single"})},createChoice:function(){throw"sliderInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiItem/core/interactions/TextEntryInteraction",["taoQtiItem/qtiItem/core/interactions/InlineInteraction"],function(InlineInteraction){var TextEntryInteraction=InlineInteraction.extend({qtiClass:"textEntryInteraction"});return TextEntryInteraction;
}),define("taoQtiItem/qtiCreator/model/interactions/TextEntryInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/TextEntryInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{getDefaultAttributes:function(){return{base:10,placeholderText:""}},afterCreate:function(){this.createResponse({baseType:"string",cardinality:"single"})},createChoice:function(){throw new Error("text entry interaction has no choice")}}),Interaction.extend(methods);
}),define("taoQtiItem/qtiItem/core/interactions/UploadInteraction",["taoQtiItem/qtiItem/core/interactions/BlockInteraction"],function(InlineInteraction){var UploadInteraction=InlineInteraction.extend({qtiClass:"uploadInteraction"});return UploadInteraction}),define("taoQtiItem/qtiCreator/model/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCreator/model/mixin/editable","taoQtiItem/qtiCreator/model/mixin/editableInteraction","taoQtiItem/qtiItem/core/interactions/UploadInteraction"],function(_,editable,editableInteraction,Interaction){"use strict";var methods={};return _.extend(methods,editable),_.extend(methods,editableInteraction),_.extend(methods,{
getDefaultAttributes:function(){return{type:""}},afterCreate:function(){this.createResponse({baseType:"file",cardinality:"single"})},createChoice:function(){throw"uploadInteraction does not have any choices"}}),Interaction.extend(methods)}),define("taoQtiItem/qtiCreator/model/pciCreatorContext",["lodash"],function(_){"use strict";var _pciModels={},pciCreatorContext={register:function(pciModel){_pciModels[pciModel.getTypeIdentifier()]=pciModel},createPciInstance:function(pciTypeIdentifier){return _pciModels[pciTypeIdentifier]?_.cloneDeep(_pciModels[pciTypeIdentifier]):void 0}};return pciCreatorContext}),define("tpl!taoQtiItem/qtiCreator/tpl/container",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='<div data-html-editable="true">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>"}function program3(depth0,data){var stack1,helper,buffer="";return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),
buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,functionType="function",self=this,helperMissing=helpers.helperMissing;return helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data},stack1=helper?helper.call(depth0,depth0&&depth0.contentModel,"blockStatic",options):helperMissing.call(depth0,"equal",depth0&&depth0.contentModel,"blockStatic",options),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCreator/renderers/Container",["tpl!taoQtiItem/qtiCreator/tpl/container"],function(tpl){"use strict";
return{qtiClass:"_container",template:tpl}}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/img",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+='class="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program5(depth0,data){var stack1,buffer="";return buffer+='height="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.height,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" '}function program7(depth0,data){var stack1,buffer="";return buffer+='width="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.width,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<img \n    data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n    data-qti-class="img" \n    src="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.src,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n    alt="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.alt,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.height),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.width),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />"})}),define("taoQtiItem/qtiCommonRenderer/renderers/Img",["core/promise","ui/waitForMedia","tpl!taoQtiItem/qtiCommonRenderer/tpl/img","taoQtiItem/qtiCommonRenderer/helpers/container"],function(Promise,waitForMedia,tpl,containerHelper){"use strict";return{qtiClass:"img",template:tpl,getContainer:containerHelper.get,render:function(img,data){return new Promise(function(resolve,reject){containerHelper.get(img).waitForMedia(resolve)})}}}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){
var ImgStateSleep=stateFactory.extend(SleepState,function(){},function(){});return ImgStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/img",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label for="src">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n    <input type="text" name="src" value="',(helper=helpers.src)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.src,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+')"/>\n    <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n</div>\n\n<div class="panel">\n    <label for="alt">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Alt Text",options):helperMissing.call(depth0,"__","Alt Text",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The text to be displayed if the image is not available.",options):helperMissing.call(depth0,"__","The text to be displayed if the image is not available.",options)))+'</div>\n    <input type="text" name="alt" value="',(helper=helpers.alt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.alt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" placeholder="e.g. House with a garden"/>\n</div>\n\n<div class="change-alt-modal-feedback modal">\n    <div class="modal-body clearfix">\n        <p>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Would you like to replace the alt text",options):helperMissing.call(depth0,"__","Would you like to replace the alt text",options)))+'</p>\n        <p class="alt-text"></p>\n\n        <div class="rgt">\n            <button class="btn-regular small cancel" type="button">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No",options):helperMissing.call(depth0,"__","No",options)))+'</button>\n            <button class="btn-info small save" type="button">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Yes",options):helperMissing.call(depth0,"__","Yes",options)))+'</button>\n        </div>\n    </div>\n</div>\n\n<div data-role="advanced" style="display:none">\n    \n    <hr/>\n    \n<!--    <div class="panel">\n        <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Size and position",options):helperMissing.call(depth0,"__","Size and position",options)))+'</h3>\n\n        <p class="img-resizer-slider"></p>\n\n        <label for="height">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="width" value="',(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="align">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Alignment",options):helperMissing.call(depth0,"__","Alignment",options)))+'</label>\n        <select name="align" class="select2" data-has-search="false">\n            <option value="default">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"default",options):helperMissing.call(depth0,"__","default",options)))+'</option>\n            <option value="left">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"left",options):helperMissing.call(depth0,"__","left",options)))+'</option>\n            <option value="right">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"right",options):helperMissing.call(depth0,"__","right",options)))+"</option>\n        </select>\n    </div>-->\n    \n    <h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Size and position",options):helperMissing.call(depth0,"__","Size and position",options)))+'</h3>\n    <div class="panel img-resizer"></div>\n    \n</div>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/validators",["core/validator/validators","lodash","i18n","taoQtiItem/qtiItem/core/Element"],function(validators,_,__,Element){var _qtiIdPattern=/^[_a-zA-Z]{1}[a-zA-Z0-9\-._]{0,31}$/i,qtiValidators=[{name:"qtiIdentifier",message:__("invalid identifier"),validate:function(value,callback){"function"==typeof callback&&callback(_qtiIdPattern.test(value))}},{name:"availableIdentifier",message:__("this identifier is already in use"),
validate:function(value,callback,options){if(!options.serial)throw'missing required option "serial"';var element=Element.getElementBySerial(options.serial);if(element&&"function"==typeof callback){var ids=element.getRelatedItem().getUsedIdentifiers(),available=!ids[value]||ids[value].serial===element.serial;callback(available)}}}];return _.each(qtiValidators,function(rule){validators.register(rule.name,rule)}),validators}),function(global){"use strict";function addEventListener(elem,event,fn){return elem.addEventListener?elem.addEventListener(event,fn,!1):elem.attachEvent?elem.attachEvent("on"+event,fn):void 0}function inArray(arr,item){var i,len;for(i=0,len=arr.length;len>i;i++)if(arr[i]===item)return!0;
return!1}function moveCaret(elem,index){var range;elem.createTextRange?(range=elem.createTextRange(),range.move("character",index),range.select()):elem.selectionStart&&(elem.focus(),elem.setSelectionRange(index,index))}function changeType(elem,type){try{return elem.type=type,!0}catch(e){return!1}}global.Placeholders={Utils:{addEventListener:addEventListener,inArray:inArray,moveCaret:moveCaret,changeType:changeType}}}(this),function(global){"use strict";function noop(){}function safeActiveElement(){try{return document.activeElement}catch(err){}}function hidePlaceholder(elem,keydownValue){var type,maxLength,valueChanged=!!keydownValue&&elem.value!==keydownValue,isPlaceholderValue=elem.value===elem.getAttribute(ATTR_CURRENT_VAL);
return(valueChanged||isPlaceholderValue)&&"true"===elem.getAttribute(ATTR_ACTIVE)?(elem.removeAttribute(ATTR_ACTIVE),elem.value=elem.value.replace(elem.getAttribute(ATTR_CURRENT_VAL),""),elem.className=elem.className.replace(classNameRegExp,""),maxLength=elem.getAttribute(ATTR_MAXLENGTH),parseInt(maxLength,10)>=0&&(elem.setAttribute("maxLength",maxLength),elem.removeAttribute(ATTR_MAXLENGTH)),type=elem.getAttribute(ATTR_INPUT_TYPE),type&&(elem.type=type),!0):!1}function showPlaceholder(elem){var type,maxLength,val=elem.getAttribute(ATTR_CURRENT_VAL);return""===elem.value&&val?(elem.setAttribute(ATTR_ACTIVE,"true"),elem.value=val,elem.className+=" "+placeholderClassName,
maxLength=elem.getAttribute(ATTR_MAXLENGTH),maxLength||(elem.setAttribute(ATTR_MAXLENGTH,elem.maxLength),elem.removeAttribute("maxLength")),type=elem.getAttribute(ATTR_INPUT_TYPE),type?elem.type="text":"password"===elem.type&&Utils.changeType(elem,"text")&&elem.setAttribute(ATTR_INPUT_TYPE,"password"),!0):!1}function handleElem(node,callback){var handleInputsLength,handleTextareasLength,handleInputs,handleTextareas,elem,len,i;if(node&&node.getAttribute(ATTR_CURRENT_VAL))callback(node);else for(handleInputs=node?node.getElementsByTagName("input"):inputs,handleTextareas=node?node.getElementsByTagName("textarea"):textareas,handleInputsLength=handleInputs?handleInputs.length:0,
handleTextareasLength=handleTextareas?handleTextareas.length:0,i=0,len=handleInputsLength+handleTextareasLength;len>i;i++)elem=handleInputsLength>i?handleInputs[i]:handleTextareas[i-handleInputsLength],callback(elem)}function disablePlaceholders(node){handleElem(node,hidePlaceholder)}function enablePlaceholders(node){handleElem(node,showPlaceholder)}function makeFocusHandler(elem){return function(){hideOnInput&&elem.value===elem.getAttribute(ATTR_CURRENT_VAL)&&"true"===elem.getAttribute(ATTR_ACTIVE)?Utils.moveCaret(elem,0):hidePlaceholder(elem)}}function makeBlurHandler(elem){return function(){showPlaceholder(elem)}}function makeKeydownHandler(elem){return function(e){
return keydownVal=elem.value,"true"===elem.getAttribute(ATTR_ACTIVE)&&keydownVal===elem.getAttribute(ATTR_CURRENT_VAL)&&Utils.inArray(badKeys,e.keyCode)?(e.preventDefault&&e.preventDefault(),!1):void 0}}function makeKeyupHandler(elem){return function(){hidePlaceholder(elem,keydownVal),""===elem.value&&(elem.blur(),Utils.moveCaret(elem,0))}}function makeClickHandler(elem){return function(){elem===safeActiveElement()&&elem.value===elem.getAttribute(ATTR_CURRENT_VAL)&&"true"===elem.getAttribute(ATTR_ACTIVE)&&Utils.moveCaret(elem,0)}}function makeSubmitHandler(form){return function(){disablePlaceholders(form)}}function newElement(elem){elem.form&&(form=elem.form,
"string"==typeof form&&(form=document.getElementById(form)),form.getAttribute(ATTR_FORM_HANDLED)||(Utils.addEventListener(form,"submit",makeSubmitHandler(form)),form.setAttribute(ATTR_FORM_HANDLED,"true"))),Utils.addEventListener(elem,"focus",makeFocusHandler(elem)),Utils.addEventListener(elem,"blur",makeBlurHandler(elem)),hideOnInput&&(Utils.addEventListener(elem,"keydown",makeKeydownHandler(elem)),Utils.addEventListener(elem,"keyup",makeKeyupHandler(elem)),Utils.addEventListener(elem,"click",makeClickHandler(elem))),elem.setAttribute(ATTR_EVENTS_BOUND,"true"),elem.setAttribute(ATTR_CURRENT_VAL,placeholder),(hideOnInput||elem!==safeActiveElement())&&showPlaceholder(elem);
}var inputs,textareas,hideOnInput,liveUpdates,keydownVal,styleElem,styleRules,placeholder,timer,form,elem,len,i,validTypes=["text","search","url","tel","email","password","number","textarea"],badKeys=[27,33,34,35,36,37,38,39,40,8,46],placeholderStyleColor="#ccc",placeholderClassName="placeholdersjs",classNameRegExp=new RegExp("(?:^|\\s)"+placeholderClassName+"(?!\\S)"),ATTR_CURRENT_VAL="data-placeholder-value",ATTR_ACTIVE="data-placeholder-active",ATTR_INPUT_TYPE="data-placeholder-type",ATTR_FORM_HANDLED="data-placeholder-submit",ATTR_EVENTS_BOUND="data-placeholder-bound",ATTR_OPTION_FOCUS="data-placeholder-focus",ATTR_OPTION_LIVE="data-placeholder-live",ATTR_MAXLENGTH="data-placeholder-maxlength",test=document.createElement("input"),head=document.getElementsByTagName("head")[0],root=document.documentElement,Placeholders=global.Placeholders,Utils=Placeholders.Utils;
if(Placeholders.nativeSupport=void 0!==test.placeholder,!Placeholders.nativeSupport){for(inputs=document.getElementsByTagName("input"),textareas=document.getElementsByTagName("textarea"),hideOnInput="false"===root.getAttribute(ATTR_OPTION_FOCUS),liveUpdates="false"!==root.getAttribute(ATTR_OPTION_LIVE),styleElem=document.createElement("style"),styleElem.type="text/css",styleRules=document.createTextNode("."+placeholderClassName+" { color:"+placeholderStyleColor+"; }"),styleElem.styleSheet?styleElem.styleSheet.cssText=styleRules.nodeValue:styleElem.appendChild(styleRules),head.insertBefore(styleElem,head.firstChild),i=0,len=inputs.length+textareas.length;len>i;i++)elem=i<inputs.length?inputs[i]:textareas[i-inputs.length],
placeholder=elem.attributes.placeholder,placeholder&&(placeholder=placeholder.nodeValue,placeholder&&Utils.inArray(validTypes,elem.type)&&newElement(elem));timer=setInterval(function(){for(i=0,len=inputs.length+textareas.length;len>i;i++)elem=i<inputs.length?inputs[i]:textareas[i-inputs.length],placeholder=elem.attributes.placeholder,placeholder?(placeholder=placeholder.nodeValue,placeholder&&Utils.inArray(validTypes,elem.type)&&(elem.getAttribute(ATTR_EVENTS_BOUND)||newElement(elem),(placeholder!==elem.getAttribute(ATTR_CURRENT_VAL)||"password"===elem.type&&!elem.getAttribute(ATTR_INPUT_TYPE))&&("password"===elem.type&&!elem.getAttribute(ATTR_INPUT_TYPE)&&Utils.changeType(elem,"text")&&elem.setAttribute(ATTR_INPUT_TYPE,"password"),
elem.value===elem.getAttribute(ATTR_CURRENT_VAL)&&(elem.value=placeholder),elem.setAttribute(ATTR_CURRENT_VAL,placeholder)))):elem.getAttribute(ATTR_ACTIVE)&&(hidePlaceholder(elem),elem.removeAttribute(ATTR_CURRENT_VAL));liveUpdates||clearInterval(timer)},100)}Utils.addEventListener(global,"beforeunload",function(){Placeholders.disable()}),Placeholders.disable=Placeholders.nativeSupport?noop:disablePlaceholders,Placeholders.enable=Placeholders.nativeSupport?noop:enablePlaceholders}(this),define("polyfill/placeholders",function(){}),define("taoQtiItem/qtiCreator/widgets/helpers/formElement",["jquery","lodash","i18n","taoQtiItem/qtiItem/core/Element","util/dom","ui/incrementer","ui/tooltipster","ui/selecter","ui/inplacer","ui/groupvalidator","taoQtiItem/qtiCreator/widgets/helpers/validators","polyfill/placeholders"],function($,_,__,Element,dom,spinner,tooltip,select2){
"use strict";var formElement={initWidget:function($form){spinner($form),tooltip($form),select2($form)},setChangeCallbacks:function($form,element,attributes,options){attributes=attributes||{},options=_.defaults(options||{},{validateOnInit:!1,invalidate:!1});var _callbackCall=function(name,value,$elt){var cb=attributes[name];_.isFunction(cb)&&cb.call($elt[0],element,value,name)},callback={simple:function(){var $elt=$(this),name=$elt.attr("name");$elt.is(":checkbox")?_callbackCall(name,$elt.prop("checked"),$elt):_callbackCall(name,$elt.val(),$elt)},withValidation:function(e,valid,elt){if("group"===e.namespace){var $elt=$(elt),name=$elt.attr("name");_callbackCall(name,$elt.val(),$elt),
options.invalidate&&element.data("widget").isValid(name,valid)}}};$form.off(".databinding"),$form.on("change.databinding keyup.databinding",":checkbox, :radio, select, :text:not([data-validate]), :hidden:not([data-validate])",callback.simple),$form.on("keyup.databinding input.databinding propertychange.databinding","textarea",callback.simple),$form.on("validated.group.databinding",callback.withValidation),_.defer(function(){$form.groupValidator({validateOnInit:options.validateOnInit,events:["change","blur",{type:"keyup",length:0}],callback:_validationCallback})})},initTitle:function($form,element){var $title=$form.hasClass("qti-title")?$form:$form.find(".qti-title");
$title.inplacer({target:$("#qti-title")}).attr("title",__("Edit modal feedback title")).on("change",function(){element.attr("title",$(this).text())})},getAttributeChangeCallback:function(allowEmpty){return function(element,value,name){allowEmpty||""!==value?element.attr(name,value):element.removeAttr(name)}},getMinMaxAttributeCallbacks:function($form,attributeNameMin,attributeNameMax,options){var _defaults={allowNull:!1,updateCardinality:!0,attrMethodNames:{remove:"removeAttr",set:"attr"},callback:_.noop},$max=$form.find("input[name="+attributeNameMax+"]"),callbacks={};return options=_.defaults(options||{},_defaults),callbacks[attributeNameMin]=function(element,value,name){
var newOptions={min:0};value=parseInt(value);var isActualNumber=!isNaN(value);if(options.allowNull||0!==value&&isActualNumber){if(isActualNumber){element[options.attrMethodNames.set](name,value),newOptions.min=value;var max=parseInt($max.val());value>max&&(0!==max||$max.data("zero")!==!0)&&$max.val(value)}}else element[options.attrMethodNames.remove](name);$max.incrementer("options",newOptions).keyup(),options.callback(element,value,name)},callbacks[attributeNameMax]=function(element,value,name){value=parseInt(value)||0,element.is("interaction")&&_updateResponseDeclaration(element,value,options.updateCardinality),value||!element.is("orderInteraction")&&!element.is("graphicOrderInteraction")?element[options.attrMethodNames.set](name,value):element[options.attrMethodNames.remove](name),
options.callback(element,value,name)},callbacks}},_updateResponseDeclaration=function(interaction,maxChoice,updateCardinality){if(!Element.isA(interaction,"interaction"))throw new Error("the first argument must be an interaction, the current element is "+interaction.qtiClass);updateCardinality=void 0===updateCardinality?!0:!!updateCardinality;var responseDeclaration=interaction.getResponseDeclaration();if(updateCardinality&&responseDeclaration.attr("cardinality",1===maxChoice?"single":"multiple"),maxChoice){var correct=[];_.each(responseDeclaration.getCorrect(),function(c){return correct.length<maxChoice?void correct.push(c):!1}),responseDeclaration.setCorrect(correct);
}},_validationCallback=function(valid,results){var rule,$input=$(this);dom.contains($input)&&(_createTooltip($input),$input.tooltipster("hide"),valid||(rule=_.where(results,{type:"failure"})[0],rule&&rule.data.message&&($input.tooltipster("content",rule.data.message),$("#mediaManager").children(".opened").length||$input.tooltipster("show"))))},_createTooltip=function($input){$input.hasClass("tooltipstered")||$input.tooltipster({theme:"tao-error-tooltip",content:"",delay:350,trigger:"custom"})};return formElement}),define("taoQtiItem/qtiCreator/widgets/static/helpers/inline",["lodash","taoQtiItem/qtiCreator/helper/dummyElement","core/validator/validators"],function(_,dummyElement,validators){
var _qtiClassToDummies={math:"maths",img:"image",object:"media"},inlineHelper={checkFileExists:function(widget,fileSrcAttrName,baseUrl){var element=widget.element;validators.validators.fileExists.validate(element.attr(fileSrcAttrName),function(fileExists){fileExists||(element.attr(fileSrcAttrName,""),inlineHelper.togglePlaceholder(widget))},{baseUrl:baseUrl||""})},togglePlaceholder:function(widget,opts){var options=_.defaults(opts||{},{container:widget.$original,type:widget.element.qtiClass}),$container=options.container,$placeholder=$container.siblings(".dummy-element");if(widget.element.isEmpty()){$container.hide();var type=_qtiClassToDummies[options.type]||options.type;
$placeholder.length||($placeholder=dummyElement.get(type),$container.after($placeholder)),$placeholder.show()}else $container.show(),$placeholder.hide();widget.$container.trigger("contentChange.qti-widget")},positionFloat:function(widget,position){var $container=widget.$container,elt=widget.element;switch($container.removeClass("rgt lft"),elt.removeClass("rgt"),elt.removeClass("lft"),position){case"right":$container.addClass("rgt"),elt.addClass("rgt");break;case"left":$container.addClass("lft"),elt.addClass("lft")}}};return inlineHelper}),define("taoQtiItem/qtiCreator/widgets/static/img/states/Active",["jquery","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/img","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","taoQtiItem/qtiItem/helper/util","lodash","util/image","ui/mediasizer","ui/resourcemgr","nouislider"],function($,__,stateFactory,Active,formTpl,formElement,inlineHelper,itemUtil,_,imageUtil){
var ImgStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()}),_extractLabel=function(fileName){return fileName.replace(/\.[^.]+$/,"").replace(/^(.*)\//,"").replace(/\W/," ").substr(0,255)};ImgStateActive.prototype.initForm=function(){var _widget=this.widget,$img=_widget.$original,$form=_widget.$form,img=_widget.element,baseUrl=_widget.options.baseUrl,responsive=!0;$form.html(formTpl({baseUrl:baseUrl||"",src:img.attr("src"),alt:img.attr("alt"),height:img.attr("height"),width:img.attr("width"),responsive:responsive})),_initAdvanced(_widget),_initMediaSizer(_widget),_initAlign(_widget),_initUpload(_widget),formElement.initWidget($form),
formElement.setChangeCallbacks($form,img,{src:_.throttle(function(img,value){img.attr("src",value),$img.attr("src",_widget.getAssetManager().resolve(value)),$img.trigger("contentChange.qti-widget").change(),inlineHelper.togglePlaceholder(_widget),_initAdvanced(_widget),_initMediaSizer(_widget)},1e3),alt:function(img,value){img.attr("alt",value)},longdesc:formElement.getAttributeChangeCallback(),align:function(img,value){inlineHelper.positionFloat(_widget,value)}})};var _initAlign=function(widget){var align="default";widget.element.hasClass("rgt")?align="right":widget.element.hasClass("lft")&&(align="left"),inlineHelper.positionFloat(widget,align),widget.$form.find("select[name=align]").val(align);
},_initMediaSizer=function(widget){var img=widget.element,$src=widget.$form.find("input[name=src]"),$mediaResizer=widget.$form.find(".img-resizer"),$mediaSpan=widget.$container;$src.val()&&(void 0===img.data("responsive")&&(img.attr("width")&&!/[0-9]+%/.test(img.attr("width"))?img.data("responsive",!1):img.data("responsive",!0)),img.data("responsive")&&($mediaSpan.css("width",img.attr("width")),$mediaSpan.css("height","")),$mediaResizer.mediasizer({responsive:void 0!==img.data("responsive")?!!img.data("responsive"):!0,target:widget.$original,applyToMedium:!1}),$mediaResizer.off(".mediasizer").on("responsiveswitch.mediasizer",function(e,responsive){img.data("responsive",responsive);
}).on("sizechange.mediasizer",function(e,size){_(["width","height"]).each(function(sizeAttr){""===size[sizeAttr]||void 0===size[sizeAttr]||null===size[sizeAttr]?(img.removeAttr(sizeAttr),$mediaSpan.css(sizeAttr,"")):(img.attr(sizeAttr,size[sizeAttr]),$mediaSpan.css(sizeAttr,size[sizeAttr])),widget.$container.trigger("contentChange.qti-widget")})}))},_initAdvanced=function(widget){var $form=widget.$form,src=widget.element.attr("src");src?$form.find("[data-role=advanced]").show():$form.find("[data-role=advanced]").hide()},_initUpload=function(widget){var $form=widget.$form,options=widget.options,img=widget.element,$container=widget.$container,$uploadTrigger=$form.find('[data-role="upload-trigger"]'),$src=$form.find("input[name=src]"),$alt=$form.find("input[name=alt]"),_openResourceMgr=function(){
$uploadTrigger.resourcemgr({title:__('Please select an image file from the resource manager. You can add files from your computer with the button "Add file(s)".'),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:[{mime:"image/jpeg"},{mime:"image/png"},{mime:"image/gif"},{mime:"image/svg+xml"},{mime:"application/x-gzip",extension:"svgz"}]},pathParam:"path",
select:function(e,files){var file,alt;files&&files.length&&(file=files[0].file,alt=files[0].alt,imageUtil.getSize(options.baseUrl+file,function(size){if(size&&size.width>=0){var w=parseInt(size.width,10),maxW=$container.parents().innerWidth();w>=.95*maxW?img.attr("width","100%"):(w=parseInt(100*w/maxW),img.attr("width",w+"%")),img.removeAttr("height")}if(""===$.trim($alt.val()))""===alt&&(alt=_extractLabel(file)),img.attr("alt",alt),$alt.val(alt).trigger("change");else{var confirmBox=$(".change-alt-modal-feedback"),cancel=confirmBox.find(".cancel"),save=confirmBox.find(".save");confirmBox.find(".modal-close");$(".alt-text",confirmBox).html('"'+$alt.val()+'"<br>with<br>"'+alt+'" ?'),
confirmBox.modal({width:500}),save.off("click").on("click",function(){img.attr("alt",alt),$alt.val(alt).trigger("change"),confirmBox.modal("close")}),cancel.off("click").on("click",function(){confirmBox.modal("close")})}_.defer(function(){$src.val(file).trigger("change")})}))},open:function(){$src.hasClass("tooltipstered")&&$src.blur().tooltipster("hide")},close:function(){$src.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$src.val()||_openResourceMgr()};return ImgStateActive}),define("taoQtiItem/qtiCreator/widgets/static/img/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/img/states/Sleep","taoQtiItem/qtiCreator/widgets/static/img/states/Active"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/helpers/widget",["jquery","lodash"],function($,_){var helper={buildInlineContainer:function(widget){var float="";widget.element.hasClass("lft")?float=" lft":widget.element.hasClass("rgt")&&(float=" rgt");var $wrap=$("<span>",{"data-serial":widget.element.serial,"class":"widget-box widget-inline widget-"+widget.element.qtiClass+float,"data-qti-class":widget.element.qtiClass,contenteditable:"false"});if(widget.$container=widget.$original.wrap($wrap).parent(),widget.$container.length){var textNode=widget.$container[0].nextSibling;textNode&&(textNode.nodeValue=" "+textNode.nodeValue);
}},buildBlockContainer:function(widget){var $wrap=$("<div>",{"data-serial":widget.element.serial,"class":"widget-box widget-block widget-"+widget.element.qtiClass,"data-qti-class":widget.element.qtiClass});widget.$container=widget.$original.wrap($wrap).parent()},createToolbar:function(widget,toolbarTpl){if(!_.isFunction(toolbarTpl))throw"the toolbarTpl must be a handlebars function";var $tlb=$(toolbarTpl({serial:widget.serial,state:"active"}));widget.$container.append($tlb),$tlb.find('[data-role="delete"]').on("click.widget-box",function(e){e.stopPropagation(),widget.changeState("deleting")})}};return helper}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/media",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </span>\n</span>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/img/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/img/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,Widget,states,helper,toolbarTpl,inlineHelper){"use strict";var ImgWidget=Widget.clone();return ImgWidget.initCreator=function(options){
var self=this,img=this.element;this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this),inlineHelper.checkFileExists(this,"src",options.baseUrl),$("#item-editor-scope").on("filedelete.resourcemgr."+this.element.serial,function(e,src){self.getAssetManager().resolve(img.attr("src"))===self.getAssetManager().resolve(src)&&(img.attr("src",""),inlineHelper.togglePlaceholder(self))})},ImgWidget.destroy=function(){$("#item-editor-scope").off("."+this.element.serial)},ImgWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager","assetManager"]},ImgWidget.buildContainer=function(){return helper.buildInlineContainer(this),
this.$container.css({width:this.element.attr("width"),height:this.element.attr("height")}),this.$original[0].setAttribute("width","100%"),this.$original[0].setAttribute("height","100%"),this},ImgWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},ImgWidget}),define("taoQtiItem/qtiCreator/renderers/Img",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Img","taoQtiItem/qtiCreator/widgets/static/img/Widget"],function(_,Renderer,Widget){"use strict";var CreatorImg=_.clone(Renderer);return CreatorImg.render=function(img,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),
options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),Widget.build(img,Renderer.getContainer(img),this.getOption("bodyElementOptionForm"),options)},CreatorImg}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,functionType="function";return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Include",["tpl!taoQtiItem/qtiCommonRenderer/tpl/include"],function(tpl){"use strict";return{qtiClass:"include",template:tpl}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label for="href">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the shared stimulus.",options):helperMissing.call(depth0,"__","The file path to the shared stimulus.",options)))+'</div>\n    <input type="text" name="href" value="',(helper=helpers.href)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.href,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty;" readonly/>\n    <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select shared stimulus",options):helperMissing.call(depth0,"__","Select shared stimulus",options)))+"</button>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/static/include/states/Active",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/include","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/helper/xincludeRenderer","ui/resourcemgr"],function($,_,__,stateFactory,Active,formTpl,formElement,xincludeRenderer){
var IncludeStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()});IncludeStateActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,include=_widget.element,baseUrl=_widget.options.baseUrl;$form.html(formTpl({baseUrl:baseUrl||"",href:include.attr("href")})),_initUpload(_widget),formElement.initWidget($form)};var _initUpload=function(widget){var $form=widget.$form,options=widget.options,$uploadTrigger=$form.find('[data-role="upload-trigger"]'),$href=$form.find("input[name=href]"),_openResourceMgr=function(){$uploadTrigger.resourcemgr({title:__("Please select a shared stimulus file from the resource manager."),
appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl+"?exclude=local",browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,disableUpload:!0,params:{uri:options.uri,lang:options.lang,filters:"application/qti+xml"},pathParam:"path",select:function(e,files){var file;files&&files.length&&(file=files[0].file,xincludeRenderer.render(widget,options.baseUrl,file),_.defer(function(){$href.val(file).trigger("change")}))},open:function(){$href.hasClass("tooltipstered")&&$href.blur().tooltipster("hide");
},close:function(){$href.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$href.on("click",_openResourceMgr),$href.val()||_openResourceMgr()};return IncludeStateActive}),define("taoQtiItem/qtiCreator/widgets/static/include/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/include/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/include/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/include/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function($,Widget,states,helper,toolbarTpl,inlineHelper){
"use strict";var IncludeWidget=Widget.clone();return IncludeWidget.initCreator=function(options){var _this=this;_this.element;this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},IncludeWidget.destroy=function(){$("#item-editor-scope").off("."+this.element.serial)},IncludeWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},IncludeWidget.buildContainer=function(){return helper.buildBlockContainer(this),this.$container.css({width:this.element.attr("width"),height:this.element.attr("height")}),this.$original.removeAttr("data-serial"),this.$original[0].setAttribute("width","100%"),this.$original[0].setAttribute("height","100%"),
this},IncludeWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},IncludeWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="qti-include" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data
}):helper),buffer+=escapeExpression(stack1)+'">\n',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("taoQtiItem/qtiCreator/renderers/Include",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Include","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCreator/widgets/static/include/Widget","tpl!taoQtiItem/qtiCreator/tpl/include"],function(_,Renderer,containerHelper,Widget,tpl){"use strict";var CreatorXInclude=_.clone(Renderer);return CreatorXInclude.template=tpl,
CreatorXInclude.getContainer=containerHelper.get,CreatorXInclude.render=function(include,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),Widget.build(include,containerHelper.get(include),this.getOption("bodyElementOptionForm"),options)},CreatorXInclude}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=' id="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-item tao-scope runtime" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n    <div',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-itemBody ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</div>\n    <div id="modalFeedbacks"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler",["jquery","lodash"],function($,_){"use strict";var informLoaded=_.throttle(function(){$(document).trigger("customcssloaded.styleeditor")},10,{
leading:!1}),attach=function(stylesheets){var $head=$("head");$head.length||($head=$("body")),_(stylesheets).forEach(function(stylesheet){var sep,$link,href;stylesheet.attr("href")&&($link=$(stylesheet.render()),href=$link.attr("href"),/^data\:/.test(href)||(sep=href.indexOf("?")>-1?"&":"?",0===href.indexOf("/")&&(href=href.slice(1)),href+=sep+(new Date).getTime().toString()),$link.removeAttr("href").appendTo($head).attr("href",href),_.delay(informLoaded,10))})},detach=function(stylesheets){_(stylesheets).forEach(function(stylesheet){stylesheet.serial&&$('link[data-serial="'+stylesheet.serial+'"]').remove()})};return{attach:attach,detach:detach}}),define("taoQtiItem/qtiCommonRenderer/renderers/Item",["tpl!taoQtiItem/qtiCommonRenderer/tpl/item","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/itemStylesheetHandler"],function(tpl,containerHelper,itemStylesheetHandler){
"use strict";return{qtiClass:"assessmentItem",template:tpl,getContainer:containerHelper.get,render:function(item){containerHelper.targetBlank(containerHelper.get(item)),itemStylesheetHandler.attach(item.stylesheets)},destroy:function(item){containerHelper.clear(),item.stylesheets&&itemStylesheetHandler.detach(item.stylesheets)}}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;
return buffer+='<div class="panel">\n    <label for="">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",options):helperMissing.call(depth0,"__","The principle identifier of the item. This identifier must have a corresponding entry in the item's metadata.",options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. my-item_123456" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n    \n</div>\n\n<div class="panel">\n    <label for="">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Title",options):helperMissing.call(depth0,"__","Title",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The item of the qti item. It is currently used as a meta data only. It is required by the QTI standard.",options):helperMissing.call(depth0,"__","The item of the qti item. It is currently used as a meta data only. It is required by the QTI standard.",options)))+'</div>\n\n    <input type="text" \n           name="title" \n           value="',
(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. My Item A" \n           data-validate="$notEmpty;">\n    \n</div>\n\n<div class="panel">\n    <label>\n        <input name="timeDependent" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.timeDependent,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Time dependent",options):helperMissing.call(depth0,"__","Time dependent",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define whether the item should be time dependent on delivery.",options):helperMissing.call(depth0,"__","Define whether the item should be time dependent on delivery.",options)))+"\n    </span>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/item/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/item","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(stateFactory,Active,formTpl,formElement){
"use strict";var ItemStateActive=stateFactory.create(Active,function(){this.initForm()},function(){});return ItemStateActive.prototype.initForm=function(){var _widget=this.widget,item=_widget.element,$form=_widget.$form;$form.html(formTpl({serial:item.getSerial(),identifier:item.id(),title:item.attr("title"),timeDependent:!!item.attr("timeDependent")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,item,{identifier:formElement.getAttributeChangeCallback(),title:formElement.getAttributeChangeCallback(),timeDependent:formElement.getAttributeChangeCallback()})},ItemStateActive}),define("taoQtiItem/qtiCreator/widgets/item/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/item/states/Active"],function(factory){
return factory.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/item/Widget",["lodash","i18n","jquery","helpers","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/item/states/states","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/helper/devTools","taoQtiItem/qtiCreator/widgets/static/text/Widget","taoQtiItem/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/editor/editor","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","taoQtiItem/qtiCreator/editor/jquery.gridEditor"],function(_,__,$,helpers,Widget,states,Element,creatorRenderer,containerHelper,contentHelper,xmlRenderer,devTools,TextWidget,styleEditor,itemEditor,genericFeedbackPopup){
"use strict";var ItemWidget=Widget.clone();ItemWidget.initCreator=function(config){if(this.registerStates(states),Widget.initCreator.call(this),!config||!config.uri)throw new Error("missing required config parameter uri in item widget initialization");this.renderer=config.renderer,this.itemUri=config.uri,this.initUiComponents(),this.initTextWidgets(function(){this.initGridEditor(),this.debug({state:!1,xml:!1})})},ItemWidget.buildContainer=function(){this.$container=this.$original},ItemWidget.save=function(){return $.ajax({url:helpers._url("saveItem","QtiCreator","taoQtiItem",{uri:this.itemUri}),type:"POST",contentType:"text/xml",dataType:"json",data:xmlRenderer.render(this.element)
})},ItemWidget.initUiComponents=function(){var _widget=this,element=_widget.element,$saveBtn=$("#save-trigger"),$previewBtn=$(".preview-trigger");$saveBtn.on("click",function(e){var $saveButton=$(this);return $saveButton.trigger("beforesave.qti-creator"),$saveButton.hasClass("disabled")?void e.preventDefault():($saveButton.addClass("active"),void _.defer(function(){$.when(styleEditor.save(),_widget.save()).done(function(){var success=!0,feedbackArgs={message:__("Your item has been saved"),type:"success"},i=arguments.length;for($saveButton.removeClass("active");i--;)if("success"!==arguments[i][1].toLowerCase()){feedbackArgs={message:__("Failed to save item"),type:"error"
},success=!1;break}$saveButton.trigger("aftersave.qti-creator",[success]),_createInfoBox(feedbackArgs)})}))}),$previewBtn.on("click",function(){itemEditor.initPreview(_widget)}),_widget.on("metaChange",function(data){if(data.element.getSerial()===element.getSerial()&&"invalid"===data.key){var invalid=element.data("invalid");_.size(invalid)?$saveBtn.addClass("disabled"):$saveBtn.removeClass("disabled")}},!0)},ItemWidget.initGridEditor=function(){var _this=this,item=this.element,$itemBody=this.$container.find(".qti-itemBody"),$itemEditorPanel=$("#item-editor-panel");$itemBody.gridEditor(),$itemBody.gridEditor("resizable"),$itemBody.gridEditor("addInsertables",$(".tool-list > [data-qti-class]:not(.disabled)"),{
helper:function(){return $(this).find(".icon").clone().addClass("dragging")}}),$itemBody.on("beforedragoverstart.gridEdit",function(){$itemEditorPanel.addClass("dragging"),$itemBody.removeClass("hoverable").addClass("inserting")}).on("dragoverstop.gridEdit",function(){$itemEditorPanel.removeClass("dragging"),$itemBody.addClass("hoverable").removeClass("inserting")}).on("dropped.gridEdit.insertable",function(e,qtiClass,$placeholder){$placeholder.removeAttr("id"),"rubricBlock"===qtiClass&&($placeholder=$placeholder.parent(".col-12").parent(".grid-row")),$placeholder.addClass("widget-box"),$placeholder.attr({"data-new":!0,"data-qti-class":qtiClass});var $widget=$placeholder.parent().closest(".widget-box, .qti-item"),$editable=$placeholder.closest("[data-html-editable], .qti-itemBody"),widget=$widget.data("widget"),element=widget.element,container=Element.isA(element,"_container")?element:element.getBody();
if(!element||!$editable.length)throw new Error("cannot create new element");containerHelper.createElements(container,contentHelper.getContent($editable),function(newElts){creatorRenderer.get().load(function(){var self=this;_.forEach(newElts,function(elt,serial){var $widget,widget,$colParent=$placeholder.parent();elt.setRenderer(self),Element.isA(elt,"_container")?($colParent.empty(),$colParent.html(elt.render()),widget=_this.initTextWidget(elt,$colParent),$widget=widget.$container):(elt.render($placeholder),elt.postRender(),widget=elt.data("widget"),$widget=Element.isA(elt,"blockInteraction")?widget.$container:widget.$original),$widget.trigger("contentChange.gridEdit"),
$widget.trigger("resize.gridEdit"),Element.isA(elt,"interaction")?widget.changeState("question"):widget.changeState("active")})},this.getUsedClasses())})}).on("resizestop.gridEdit",function(){item.body($itemBody.gridEditor("getContent"))})},ItemWidget.initTextWidgets=function(callback){var _this=this,item=this.element,$originalContainer=this.$container,i=1,subContainers=[];callback=callback||_.noop,$originalContainer.find(".qti-itemBody > .grid-row").each(function(){var $row=$(this);$row.hasClass("widget-box")||$row.children().each(function(){var $col=$(this),isTextBlock=!1;$col.contents().each(function(){return 3===this.nodeType&&this.nodeValue&&this.nodeValue.trim()?(isTextBlock=!0,
!1):void 0});var $widget=$col.children();($widget.length>1||!$widget.hasClass("widget-blockInteraction"))&&($widget.hasClass("colrow")?$widget.each(function(){var $subElement=$(this),$subWidget=$subElement.children();($subWidget.length>1||!$subWidget.hasClass("widget-blockInteraction"))&&($subElement.attr("data-text-block-id","text-block-"+i),i++)}):isTextBlock=!0),isTextBlock&&($col.attr("data-text-block-id","text-block-"+i),i++)})});var $clonedContainer=$originalContainer.clone();$clonedContainer.find(".qti-itemBody > .grid-row [data-text-block-id]").each(function(){var $originalTextBlock=$(this),textBlockId=$originalTextBlock.data("text-block-id"),$subContainer=$originalTextBlock.clone(),subContainerElements=contentHelper.serializeElements($subContainer),subContainerBody=$subContainer.html();
$originalTextBlock.removeAttr("data-text-block-id").html("{{_container:new}}"),subContainers.push({body:subContainerBody,elements:subContainerElements,$original:$originalContainer.find('[data-text-block-id="'+textBlockId+'"]').removeAttr("data-text-block-id")})}),contentHelper.serializeElements($clonedContainer);var serializedItemBody=$clonedContainer.find(".qti-itemBody").html(),itemBody=item.getBody();subContainers.length?containerHelper.createElements(itemBody,serializedItemBody,function(newElts){if(_.size(newElts)!==subContainers.length)throw"number of sub-containers mismatch";_.each(newElts,function(container){var containerData=subContainers.shift(),containerElements=_detachElements(itemBody,containerData.elements);
container.setElements(containerElements,containerData.body),_this.initTextWidget(container,containerData.$original)}),_.defer(function(){callback.call(_this)})}):callback.call(_this)};var _detachElements=function(container,elements){var containerElements={};return _.each(elements,function(elementSerial){containerElements[elementSerial]=container.elements[elementSerial],delete container.elements[elementSerial]}),containerElements};ItemWidget.initTextWidget=function(container,$col){return TextWidget.build(container,$col,this.renderer.getOption("textOptionForm"),{})},ItemWidget.debug=function(options){if(options=options||{},options.state&&devTools.listenStateChange(),
options.xml){var $code=$("<code>",{"class":"language-markup"}),$pre=$("<pre>",{"class":"line-numbers"}).append($code);$("#item-editor-wrapper").append($pre),devTools.liveXmlPreview(this.element,$code)}};var _createInfoBox=function(data){var $messageBox=$(genericFeedbackPopup(data)),closeTrigger=$messageBox.find(".close-trigger");return $("body").append($messageBox),closeTrigger.on("click",function(){$messageBox.fadeOut(function(){$(this).remove()})}),setTimeout(function(){closeTrigger.trigger("click")},2e3),$messageBox};return ItemWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/item",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+=' id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<div class="tao-scope qti-item item-editor-item clearfix" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n    <div id="modalFeedbacks"></div>\n    <div',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},
inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-itemBody item-editor-drop-area hoverable',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/renderers/Item",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/Item","taoQtiItem/qtiCreator/widgets/item/Widget","tpl!taoQtiItem/qtiCreator/tpl/item"],function($,_,CommonRenderer,Widget,tpl){
"use strict";var CreatorItem=_.clone(CommonRenderer),_normalizeItemBody=function($itemBody){return $itemBody.children().each(function(){var $child=$(this);$child.hasClass("grid-row")||$child.hasClass("qti-infoControl")||$child.wrap('<div class="grid-row"><div class="col-12"></div></div>')}),$itemBody};return CreatorItem.template=tpl,CreatorItem.render=function(item,options){var $itemContainer=CommonRenderer.getContainer(item);_normalizeItemBody($itemContainer.find(".qti-itemBody")),options=options||{},options.state="active",options.renderer=this,Widget.build(item,$itemContainer,this.getOption("itemOptionForm"),options)},CreatorItem}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/math",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n<span data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="math">\n    <math display = "block">',(helper=helpers.raw)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.raw,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</math>\n</span>\n";
}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='\n<span data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="math">\n    <math>',(helper=helpers.raw)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.raw,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</math>\n</span>   \n"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;return stack1=helpers["if"].call(depth0,depth0&&depth0.block,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiCommonRenderer/renderers/Math",["lodash","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/math","taoQtiItem/qtiCommonRenderer/helpers/container","mathJax"],function(_,Promise,tpl,containerHelper,MathJax){"use strict";return{qtiClass:"math",template:tpl,getContainer:containerHelper.get,render:function(math,data){return new Promise(function(resolve,reject){
"undefined"!=typeof MathJax&&MathJax?(window.MathJax||(window.MathJax=MathJax),_.defer(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,containerHelper.get(math).parent()[0]]),MathJax.Hub.Queue(resolve)})):resolve()})}}}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var MathStateSleep=stateFactory.extend(SleepState,function(){},function(){});return MathStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/math",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n\n<div class="panel">\n    <label for="display" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Display",options):helperMissing.call(depth0,"__","Display",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"How the math expression should be displayed.",options):helperMissing.call(depth0,"__","How the math expression should be displayed.",options)))+'</div>\n\n    <select name="display" class="select2" data-has-search="false">\n        <option value="inline">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"inline",options):helperMissing.call(depth0,"__","inline",options)))+'</option>\n        <option value="block">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"block",options):helperMissing.call(depth0,"__","block",options)))+'</option>\n    </select>\n</div>\n\n<div class="panel">\n    <label for="editMode" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Editing Mode",options):helperMissing.call(depth0,"__","Editing Mode",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"How the math expression should be edited",options):helperMissing.call(depth0,"__","How the math expression should be edited",options)))+'.</div>\n\n    <select name="editMode" class="select2" data-has-search="false">\n        <option value="latex">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"LaTex",options):helperMissing.call(depth0,"__","LaTex",options)))+'</option>\n        <option value="mathml">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"MathML",options):helperMissing.call(depth0,"__","MathML",options)))+'</option>\n    </select>\n\n</div>\n\n<div class="panel" data-role="latex" style="display:none;">\n    <label for="sidebar-latex-field" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Latex",options):helperMissing.call(depth0,"__","Latex",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",options):helperMissing.call(depth0,"__","Edit math expression using LaTex type setting system, e.g. e^{i \\pi} = -1",options)))+'</div>\n\n    <input id="sidebar-latex-field" type="text" name="latex" value="',
(helper=helpers.latex)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.latex,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" placeholder="e.g. e^{i \\pi} = -1"/>\n    <a href="#" data-context="latex" class="sidebar-popup-trigger" data-popup="~ .math-editor-container">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Display larger editor",options):helperMissing.call(depth0,"__","Display larger editor",options)))+'</a>\n\n    <div class="sidebar-popup math-editor-container latex two-fifty">\n        <div class="sidebar-popup-title">\n            <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Latex",options):helperMissing.call(depth0,"__","Latex",options)))+'</h3>\n            <a class="closer" href="#" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close",options):helperMissing.call(depth0,"__","Close",options)))+'"></a>\n        </div>\n        <div class="sidebar-popup-content">\n            <input data-for="latex"/>\n        </div>\n    </div>\n</div>\n\n<div class="panel sidebar-popup-container-box" data-role="mathml" style="display:none;">\n    <label for="sidebar-mathml-field" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"MathML",options):helperMissing.call(depth0,"__","MathML",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Edit math expression using MathML",options):helperMissing.call(depth0,"__","Edit math expression using MathML",options)))+'</div>\n\n    <textarea id="sidebar-mathml-field" name="mathml">',(helper=helpers.mathml)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mathml,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</textarea>\n\n    <div class="math-buffer" style="visibility:hidden;"></div>\n    <a href="#" data-context="mathml" class="sidebar-popup-trigger" data-popup="~ .math-editor-container">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Display larger editor",options):helperMissing.call(depth0,"__","Display larger editor",options)))+'</a>\n\n    <div class="sidebar-popup math-editor-container mathml two-fifty">\n        <div class="sidebar-popup-title">\n            <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"MathML",options):helperMissing.call(depth0,"__","MathML",options)))+'</h3>\n            <a class="closer" href="#" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close",options):helperMissing.call(depth0,"__","Close",options)))+'"></a>\n        </div>\n        <div class="sidebar-popup-content">\n            <textarea data-for="mathml"></textarea>\n        </div>\n    </div>\n\n</div>\n\n'}function program3(depth0,data){var helper,options,buffer="";return buffer+='\n<div class="panel">\n    '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"MathJax is not installed.",options):helperMissing.call(depth0,"__","MathJax is not installed.",options)))+"\n</div>\n"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return stack1=helpers["if"].call(depth0,depth0&&depth0.mathjax,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"})}),define("taoQtiItem/qtiCreator/widgets/static/math/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/MathEditor","taoQtiItem/qtiCreator/helper/popup","tpl!taoQtiItem/qtiCreator/tpl/forms/static/math","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","lodash","i18n","mathJax"],function($,stateFactory,Active,MathEditor,popup,formTpl,formElement,inlineHelper,_,__,mathJax){
var _throttle=300,MathActive=stateFactory.extend(Active,function(){this.initForm()},function(){this.widget.$form.empty()});MathActive.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,math=_widget.element,mathML=math.mathML||"",tex=math.getAnnotation("latex")||"",display=math.attr("display")||"inline",editMode="latex";!tex.trim()&&mathML.trim()&&(editMode="mathml"),$form.html(formTpl({mathjax:!!mathJax,editMode:editMode,latex:tex,mathml:mathML})),mathJax&&($form.find("select[name=display]").val(display),$form.find("select[name=editMode]").val(editMode),$form.children('.panel[data-role="'+editMode+'"]').show(),_toggleMode($form,editMode),
formElement.initWidget($form),this.initFormChangeListener())},MathActive.prototype.initFormChangeListener=function(){var _widget=this.widget,$container=_widget.$container,$form=_widget.$form,math=_widget.element,mathML=math.mathML,tex=math.getAnnotation("latex"),display=math.attr("display")||"inline",$fields={mathml:$form.find("textarea[name=mathml]"),latex:$form.find("input[name=latex]")},$modeSelector=$form.find("select[name=editMode]");$form.find(".sidebar-popup-trigger").each(function(){var $trigger=$(this),context=$trigger.data("context");popup.init($trigger),$trigger.on("open.popup",function(e,params){var $largeField=params.popup.find(':input[data-for="'+context+'"]');
$largeField.val($fields[context].val()),$largeField.on("keyup",function(){$fields[context].val($(this).val()),$fields[context].trigger("keyup")}),$largeField.attr("placeholder",$fields[context].attr("placeholder")),$fields[context].prop("disabled",!0),$modeSelector.prop("disabled",!0)}),$trigger.on("close.popup",function(e,params){var $largeField=params.popup.find(':input[data-for="'+context+'"]');$fields[context].val($largeField.val()),$fields[context].prop("disabled",!1),$modeSelector.prop("disabled",!1)})});var mathEditor=new MathEditor({tex:tex,mathML:mathML,display:display,buffer:$form.find(".math-buffer"),target:_widget.$original});formElement.setChangeCallbacks($form,math,{
display:function(m,value){"block"===value?m.attr("display","block"):m.removeAttr("display"),_widget.rebuild({ready:function(widget){widget.changeState("active")}})},editMode:function(m,value){_toggleMode($form,value)},latex:_.throttle(function(m,value){mathEditor.setTex(value).renderFromTex(function(){m.setAnnotation("latex",value),$fields.mathml.html(mathEditor.mathML),m.setMathML(mathEditor.mathML),inlineHelper.togglePlaceholder(_widget),$container.change()})},_throttle),mathml:_.throttle(function(m,value){mathEditor.setMathML(value).renderFromMathML(function(){m.setMathML(mathEditor.mathML),$fields.latex.val(""),m.removeAnnotation("latex"),inlineHelper.togglePlaceholder(_widget),
$container.change()})},_throttle)})};var _toggleMode=function($form,mode){var $panels={mathml:$form.children('.panel[data-role="mathml"]'),latex:$form.children('.panel[data-role="latex"]')},$fields={mathml:$form.find("textarea[name=mathml]"),latex:$form.find("input[name=latex]")},$editMode=$form.find("select[name=editMode]");$panels.mathml.hide(),$panels.latex.hide(),"latex"===mode?$panels.latex.show():"mathml"===mode&&($panels.mathml.show(),$fields.latex.val()&&($fields.mathml.hasClass("tooltipstered")||_createWarningTooltip($fields.mathml),$fields.mathml.tooltipster("show"),$editMode.off("change.editMode").one("change.editMode",function(){$fields.mathml.tooltipster("hide");
})))},_createWarningTooltip=function($mathField){var $content=$("<span>").html(__("Currently conversion from MathML to LaTeX is not available. Editing MathML here will have the LaTex code discarded."));$mathField.tooltipster({theme:"tao-warning-tooltip",content:$content,delay:200,trigger:"custom"}),$mathField.on("focus.mathwarning",function(){$mathField.tooltipster("hide")}),setTimeout(function(){$mathField.tooltipster("hide")},3e3)};return MathActive}),define("taoQtiItem/qtiCreator/widgets/static/math/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/math/states/Sleep","taoQtiItem/qtiCreator/widgets/static/math/states/Active"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/math/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/math/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(Widget,states,helper,toolbarTpl,inlineHelper){var MathWidget=Widget.clone();return MathWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},MathWidget.buildContainer=function(){return"block"===this.element.attr("display")?helper.buildBlockContainer(this):helper.buildInlineContainer(this),
this},MathWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},MathWidget}),define("taoQtiItem/qtiCreator/renderers/Math",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Math","taoQtiItem/qtiCreator/widgets/static/math/Widget"],function(_,Renderer,Widget){"use strict";var CreatorMath=_.clone(Renderer);return CreatorMath.render=function(math,options){Renderer.render(math),Widget.build(math,Renderer.getContainer(math),this.getOption("bodyElementOptionForm"),options)},CreatorMath}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){return"modal "}function program3(depth0,data){var stack1,buffer="";return buffer+='<h2 class="qti-title modal-title">'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</h2>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div id="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" class="',stack1=helpers.unless.call(depth0,depth0&&depth0.inline,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-modalFeedback ",
(helper=helpers.feedbackStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.feedbackStyle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.title),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="modal-body">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},
data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>"})}),define("taoQtiItem/qtiItem/helper/container",["lodash","jquery"],function(_,$){"use strict";function _checkContainerType(element){if(_.isFunction(element.initContainer)&&_.isFunction(element.body))return!0;throw"the element is not of a container type"}function _getBodyDom(element){return _checkContainerType(element)?$("<div>").html(element.body()).find(".x-tao-wrapper"):void 0}function _setBodyDomClass(element,newClass,oldClass){if(_checkContainerType(element)&&(oldClass||newClass)){var $wrapper=$("<div>").html(element.body());_setDomClass($wrapper,newClass,oldClass),element.body($wrapper.html());
}}function _setDomClass($wrapper,newClass,oldClass){var $bodyDom=$wrapper.find(".x-tao-wrapper");$bodyDom.length||($wrapper.wrapInner('<div class="x-tao-wrapper">'),$bodyDom=$wrapper.find(".x-tao-wrapper")),oldClass&&$bodyDom.removeClass(oldClass),newClass&&$bodyDom.addClass(newClass)}function setEncodedDataToDom($wrapper,dataName,newValue,oldValue){_setDomClass($wrapper,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue))}function _getEncodedDataString(dataName,value){return dataName&&value?_prefix+dataName+"-"+value:""}function setEncodedData(element,dataName,newValue){var oldValue=getEncodedData(element,dataName);return _setBodyDomClass(element,_getEncodedDataString(dataName,newValue),_getEncodedDataString(dataName,oldValue));
}function removeEncodedData(element,dataName){var oldValue=getEncodedData(element,dataName);dataName&&oldValue&&_setBodyDomClass(element,"",_getEncodedDataString(dataName,oldValue))}function hasEncodedData(element,dataName,value){var $body=_getBodyDom(element);return $body&&$body.length&&dataName&&value?$body.hasClass(_getEncodedDataString(dataName,value)):!1}function getEncodedData(element,dataName){var regex,matches,$body=_getBodyDom(element);return dataName&&$body&&$body.length&&$body.attr("class")&&(regex=new RegExp(_prefix+dataName+"-([a-zA-Z0-9-._]*)"),matches=$body.attr("class").match(regex))?matches[1]:void 0}var _prefix="x-tao-";return{setEncodedData:setEncodedData,
hasEncodedData:hasEncodedData,getEncodedData:getEncodedData,removeEncodedData:removeEncodedData,setEncodedDataToDom:setEncodedDataToDom}}),define("taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/modalFeedback","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiItem/helper/container","ui/waitForMedia","ui/modal"],function(_,tpl,containerHelper,coreContainerHelper){"use strict";var modalFeedbackRenderer={qtiClass:"modalFeedback",template:tpl,getContainer:containerHelper.get,minHeight:200,width:600,getData:function(fb,data){var feedbackStyle=coreContainerHelper.getEncodedData(fb,"modalFeedback");return data.feedbackStyle=feedbackStyle,
data},render:function(modalFeedback,data){data=data||{};var $modal=containerHelper.get(modalFeedback);$modal.waitForMedia(function(){$modal.on("opened.modal",function(){var $itemBody=containerHelper.get(modalFeedback.getRelatedItem()).children(".qti-itemBody"),requiredHeight=$modal.outerHeight()+parseInt($modal.css("top"));requiredHeight>$itemBody.height()&&$itemBody.height(requiredHeight)}).on("closed.modal",function(){_.isFunction(data.callback)&&data.callback.call(this)}).modal({startClosed:!1,minHeight:modalFeedbackRenderer.minHeight,width:modalFeedbackRenderer.width})})}};return modalFeedbackRenderer}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,SleepState){
return stateFactory.create(SleepState,function(){},function(){})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    		<option value="',(helper=helpers.cssClass)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cssClass,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    	"}function program2(depth0,data){return'selected="selected"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the modal feedback. This identifier must not be used by any other modal feedback or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. modal-feedback_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n<div class="panel">\n    <label for="feedbackStyle" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Feedback Style",options):helperMissing.call(depth0,"__","Feedback Style",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select predefined feedback style from the list.",options):helperMissing.call(depth0,"__","Select predefined feedback style from the list.",options)))+'</span>\n    <select name="feedbackStyle" class="select2" data-has-search="false">\n    	',stack1=helpers.each.call(depth0,depth0&&depth0.feedbackStyles,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","tpl!taoQtiItem/qtiCreator/tpl/forms/static/modalFeedback","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/helper/container","lodash","i18n","jquery","ui/modal"],function(stateFactory,Active,commonRenderer,formTpl,formElement,containerHelper,_,__,$){function _prepareFeedbackStyles(widget){
var styles=[{cssClass:"",title:__("standard")},{cssClass:"positive",title:__("positive")},{cssClass:"negative",title:__("negative")}];return _(styles).filter(function(style){return void 0!==style.cssClass}).map(function(style){return containerHelper.hasEncodedData(widget.element,"modalFeedback",style.cssClass)&&(style.selected=!0),style}).value()}var indices=function(){var selector,selectors={sidebar:"#item-editor-item-widget-bar",cke:".cke",ckeBase:".cke_inner",ckeNose:".cke_nose",ckeToolbar:".cke_toolbar"},raised=!1,elements={};return{raise:function(baseIndex){var $elem,index;baseIndex=parseInt(baseIndex,10);for(selector in selectors)$elem=$(selectors[selector]),
index=parseInt($elem.css("z-index"),10),isNaN(index)&&(index=100),elements[selector]={element:$elem,index:index},$elem.css("z-index",elements[selector].index+baseIndex)},reset:function(){if(raised)for(selector in elements)elements[selector].element.css("z-index",elements[selector].index)}}}(),_ckeIsReady=function($editable){var dfd=new $.Deferred,iteration=0,poll=function(){var editor=$editable.data("editor");iteration>20||(editor?dfd.resolve():setTimeout(poll,200))};return poll(),dfd.promise()},ModalFeedbackStateActive=stateFactory.extend(Active,function(){var _widget=this.widget,$container=this.widget.$container,$editable=$container.find("[data-html-editable]");
$container.modal({startClosed:!0,width:commonRenderer.width}),$container.modal("open"),$container.css("height","auto"),$.when(_ckeIsReady($editable)).then(function(){indices.raise($container.css("z-index"))}),$container.on("closed.modal",function(){_widget.changeState("sleep")}),this.widget.offEvents("otherActive"),this.initForm(),this.widget.$form.show()},function(){var $container=this.widget.$container;$container.off("opened.modal").off(".active"),$container.modal("close"),indices.reset(),$container.find(".tlb-button.active[data-role=cke-launcher]").click(),this.widget.$form.empty().hide()});return ModalFeedbackStateActive.prototype.initForm=function(){var _widget=this.widget,$container=_widget.$container,feedbackStyles=_prepareFeedbackStyles(_widget);
_widget.$form.html(formTpl({serial:_widget.element.getSerial(),identifier:_widget.element.id(),feedbackStyles:feedbackStyles})),formElement.initWidget(_widget.$form),formElement.setChangeCallbacks(_widget.$form,_widget.element,{identifier:function(fb,value){fb.id(value)},feedbackStyle:function(fb,newValue){var oldValue=containerHelper.getEncodedData(_widget.element,"modalFeedback");containerHelper.setEncodedData(fb,"modalFeedback",newValue),oldValue&&$container.removeClass(oldValue),$container.addClass(newValue),containerHelper.setEncodedDataToDom($container.find(".cke_editable"),"modalFeedback",newValue,oldValue)}})},ModalFeedbackStateActive}),define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Sleep","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/Active"],function(factory,states){
return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<button class="btn-info small widget-ok" data-edit="active">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"done",options):helperMissing.call(depth0,"__","done",options)))+"</button>"})}),
define("taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/modalFeedback/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function($,Widget,states,toolbarTpl,okButtonTpl,formElement,htmlEditor,contentHelper){var ModalFeedbackWidget=Widget.clone();return ModalFeedbackWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states),
this.buildEditor(),this.createOkButton()},ModalFeedbackWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box")},ModalFeedbackWidget.createToolbar=function(){return this.$container.find(".modal-body").append(toolbarTpl({serial:this.serial,state:"active"})),this},ModalFeedbackWidget.buildEditor=function(){var _this=this,$editableContainer=_this.$container.find(".modal-body"),element=_this.element,container=element.getBody();$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:contentHelper.getChangeCallback(container),data:{container:container,
widget:_this}}),formElement.initTitle(this.$original.find(".qti-title"),element)},ModalFeedbackWidget.createOkButton=function(){var _this=this;this.$container.append($(okButtonTpl()).on("click.qti-widget",function(e){e.stopPropagation(),_this.changeState("sleep")}))},ModalFeedbackWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/modal",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"modal "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<div id="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" class="',
stack1=helpers.unless.call(depth0,depth0&&depth0.inline,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-modalFeedback ",(helper=helpers.feedbackStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.feedbackStyle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <h2 class="qti-title modal-title">'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,typeof stack1===functionType?stack1.apply(depth0):stack1))+'</h2>\n    <div class="modal-body">',
(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>"})}),define("taoQtiItem/qtiCreator/renderers/ModalFeedback",["lodash","taoQtiItem/qtiCommonRenderer/renderers/ModalFeedback","taoQtiItem/qtiCreator/widgets/static/modalFeedback/Widget","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/modal"],function(_,Renderer,Widget,modalTpl){"use strict";var ModalFeedback=_.clone(Renderer);return ModalFeedback.template=modalTpl,ModalFeedback.render=function(modalFeedback,options){options=options||{},
Widget.build(modalFeedback,Renderer.getContainer(modalFeedback),this.getOption("modalFeedbackOptionForm"),options)},ModalFeedback}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="qti-object-container" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" >\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/Object",["tpl!taoQtiItem/qtiCommonRenderer/tpl/object","taoQtiItem/qtiCommonRenderer/helpers/container","ui/previewer"],function(tpl,containerHelper,previewer){"use strict";return{qtiClass:"object",template:tpl,getContainer:containerHelper.get,render:function(obj){var $container=containerHelper.get(obj),previewOptions={url:obj.renderer.resolveUrl(obj.attr("data")),mime:obj.attr("type"),width:obj.attr("width")||"100%"};obj.attr("height")&&(previewOptions.height=obj.attr("height")),$container.previewer(previewOptions)}}}),define("taoQtiItem/qtiCreator/widgets/static/object/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){
var ObjectStateSleep=stateFactory.create(SleepState,function(){},function(){});return ObjectStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/object",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label for="src">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The file path to the media.",options):helperMissing.call(depth0,"__","The file path to the media.",options)))+'</div>\n    <input type="text" name="data" value="',(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+')"/>\n    <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select media",options):helperMissing.call(depth0,"__","Select media",options)))+'</button>\n</div>\n\n<div data-role="advanced" style="display:none">\n    <div class="panel">\n        <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Size and position",options):helperMissing.call(depth0,"__","Size and position",options)))+'</h3>\n\n        <!--not available yet-->\n        <!--    <label>\n        <input name="responsive" type="checkbox" />\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Adapt to item size",options):helperMissing.call(depth0,"__","Adapt to item size",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        Recommended.\n        Define whether the image size should automatically adapt to item size.\n        If this option is active, the image width and height will be a percentage of its text container.\n    </span>-->\n\n        <p class="img-resizer-slider"></p>\n\n        <label for="height">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Height (optional)",options):helperMissing.call(depth0,"__","Height (optional)",options)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Width (optional)",options):helperMissing.call(depth0,"__","Width (optional)",options)))+'</label>\n        <span id="item-editor-font-size-manual-input" class="item-editor-unit-input-box">\n            <input type="text" name="width" value="',(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$numeric" data-validate-option="$allowEmpty;"/>\n            <span class="unit-indicator">px</span>\n        </span>\n    </div>\n    <div class="panel">\n\n        <label for="align">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Alignment (optional)",options):helperMissing.call(depth0,"__","Alignment (optional)",options)))+'</label>\n        <select name="align" class="select2" data-has-search="false">\n            <option value="default">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"default",options):helperMissing.call(depth0,"__","default",options)))+'</option>\n            <option value="left">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"left",options):helperMissing.call(depth0,"__","left",options)))+'</option>\n            <option value="right">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"right",options):helperMissing.call(depth0,"__","right",options)))+"</option>\n        </select>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/static/object/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/object","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","lodash","util/image","helpers","ui/resourcemgr","nouislider"],function(stateFactory,Active,formTpl,formElement,inlineHelper,_,imageUtil,helpers){"use strict";var ObjectStateActive=stateFactory.extend(Active,function(){
this.widget.changeState("sleep")},function(){this.widget.$form.empty()}),_getImgSizeChangeCallback=function($media,propertyName){var _setAttr=_.debounce(function(media,value,name){media.attr(name,value)},1e3);return _.throttle(function(media,value,name){value?($media[propertyName](value),_setAttr(media,value,name)):($media[propertyName]("auto"),media.removeAttr(propertyName)),$media.trigger("contentChange.qti-widget")},100)};ObjectStateActive.prototype.initForm=function(){var _widget=this.widget,$media=_widget.$original,$form=_widget.$form,media=_widget.element,baseUrl=_widget.options.baseUrl,responsive=!0;$form.html(formTpl({baseUrl:baseUrl||"",data:media.attr("data"),
height:media.attr("height"),width:media.attr("width"),responsive:responsive})),_initAdvanced(_widget),_initSlider(_widget),_initAlign(_widget),_initUpload(_widget),formElement.initWidget($form),formElement.setChangeCallbacks($form,media,{data:function(media,value){media.attr("data",value),value.match(/^http/i)||(value=baseUrl+"/"+value),$media.attr("data",value),inlineHelper.togglePlaceholder(_widget),_initSlider(_widget),_initAdvanced(_widget)},alt:formElement.getAttributeChangeCallback(),longdesc:formElement.getAttributeChangeCallback(),align:function(media,value){inlineHelper.positionFloat(_widget,value)},height:_getImgSizeChangeCallback($media,"height"),width:_getImgSizeChangeCallback($media,"width")
})};var _initAlign=function(widget){var align="default";widget.element.hasClass("rgt")?align="right":widget.element.hasClass("lft")&&(align="left"),inlineHelper.positionFloat(widget,align),widget.$form.find("select[name=align]").val(align)},_initSlider=function(widget){var $container=widget.$container,$form=widget.$form,$slider=$form.find(".media-resizer-slider"),media=widget.element,$media=$container.find("media"),$height=$form.find("[name=height]"),$width=$form.find("[name=width]"),original={h:media.attr("height")||$media.height(),w:media.attr("width")||$media.width()};$slider.noUiSlider({range:{min:10,max:200},start:100},$slider.hasClass("noUi-target")),$slider.off("slide").on("slide",_.throttle(function(e,value){
var ratio=value/100,w=parseInt(ratio*original.w),h=parseInt(ratio*original.h);$width.val(w).change(),$height.val(h).change()},100))},_initAdvanced=function(widget){var $form=widget.$form,data=widget.element.attr("data");data?$form.find("[data-role=advanced]").show():$form.find("[data-role=advanced]").hide()},_initUpload=function(widget){var $form=widget.$form,options=widget.options,$uploadTrigger=$form.find('[data-role="upload-trigger"]'),$data=$form.find("input[name=data]"),$width=$form.find("input[name=width]"),$height=$form.find("input[name=height]");$uploadTrigger.on("click",function(){$uploadTrigger.resourcemgr({appendContainer:options.mediaManager.appendContainer,
mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:"audio/ogg,audio/mpeg,video/mpeg,video/mp4,video/ogg,video/ogv,video/webm"},pathParam:"path",select:function(e,files){var i,l=files.length;for(i=0;l>i;i++){console.log("file",files[i].file),imageUtil.getSize(options.baseUrl+files[i].file,function(size){size&&size.width>=0&&($width.val(size.width).trigger("change"),$height.val(size.height).trigger("change")),
$data.val(files[i].file).trigger("change")});break}}})})};return ObjectStateActive}),define("taoQtiItem/qtiCreator/widgets/static/object/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/object/states/Sleep","taoQtiItem/qtiCreator/widgets/static/object/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";
return buffer+='<span class="message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<span class="overlay">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.message,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n</span>"})}),define("taoQtiItem/qtiCreator/widgets/static/object/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/object/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay","i18n"],function(Widget,states,helper,toolbarTpl,inlineHelper,overlayTpl,__){var ObjectWidget=Widget.clone();return ObjectWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this),this.notAvailable();
},ObjectWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager"]},ObjectWidget.buildContainer=function(){return helper.buildBlockContainer(this),this},ObjectWidget.createToolbar=function(){return helper.createToolbar(this,toolbarTpl),this},ObjectWidget.notAvailable=function(){this.$container.append(overlayTpl({message:__("Editing this element is not supported currently.")})),this.$container.attr("contenteditable",!1),this.$container.css({cursor:"default"}),this.$container.on("click, mousedown",function(e){e.stopPropagation()})},ObjectWidget}),define("taoQtiItem/qtiCreator/renderers/Object",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Object","taoQtiItem/qtiCreator/widgets/static/object/Widget"],function(_,Renderer,Widget){
"use strict";var CreatorObject=_.clone(Renderer);return CreatorObject.render=function(object,options){Renderer.render(object),options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),Widget.build(object,Renderer.getContainer(object),this.getOption("bodyElementOptionForm"),options)},CreatorObject}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-infoControl',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/PortableElement",["jquery"],function($){"use strict";function fixMarkupMediaSources(html,renderer){return html=html||"",html.replace(imgSrcPattern,function(substr,$1,$2,$3){var resolved=renderer.resolveUrl($2)||$2;
return $1+resolved+$3})}var imgSrcPattern=/(<img[^>]*src=["'])([^"']+)(["'])/gi;return{fixMarkupMediaSources:fixMarkupMediaSources}}),define("qtiInfoControlContext",[],function(){window._picHooks=window._picHooks||{};var taoQtiInfoControlContext={register:function(picHook){window._picHooks[picHook.getTypeIdentifier()]=picHook},notifyReady:function(picInstance){},createPciInstance:function(typeIdentifier){if(window._picHooks[typeIdentifier]){var instance={},proto=window._picHooks[typeIdentifier];for(var name in proto)"function"==typeof proto[name]?instance[name]=proto[name]:null!==proto[name]&&"object"==typeof proto[name]?instance[name]=proto[name].constructor():instance[name]=proto[name];
return instance}throw"no portable info control hook found with the id "+typeIdentifier}};return taoQtiInfoControlContext}),define("taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl",["core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/infoControl","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","qtiInfoControlContext","taoQtiItem/qtiItem/helper/util"],function(Promise,tpl,containerHelper,PortableElement,qtiInfoControlContext,util){"use strict";var _getPic=function(infoControl){var typeIdentifier,pic=infoControl.data("pic")||void 0;if(!pic){if(typeIdentifier=infoControl.typeIdentifier,pic=qtiInfoControlContext.createPciInstance(typeIdentifier),
!pic)throw"no custom infoControl hook found for the type "+typeIdentifier;infoControl.data("pic",pic),pic._taoInfoControl=infoControl}return pic},render=function(infoControl,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var runtimeLocation,state={},localRequireConfig={paths:{}},id=infoControl.attr("id"),typeIdentifier=infoControl.typeIdentifier,runtimeLocations=options.runtimeLocations?options.runtimeLocations:self.getOption("runtimeLocations"),config=infoControl.properties,$dom=containerHelper.get(infoControl).children(),entryPoint=infoControl.entryPoint.replace(/\.js$/,"");runtimeLocation=runtimeLocations&&runtimeLocations[typeIdentifier]?runtimeLocations[typeIdentifier]:self.getAssetManager().resolveBy("portableElementLocation",typeIdentifier),
runtimeLocation&&(localRequireConfig.paths[typeIdentifier]=runtimeLocation,require.config(localRequireConfig)),require([entryPoint],function(){var pic=_getPic(infoControl);return pic&&$dom.length?(pic.initialize(id,$dom[0],config),pic.setSerializedState(state),resolve()):reject("Unable to initiliaze infoControl : "+id)},reject)})},destroy=function(infoControl){_getPic(infoControl).destroy()},setState=function(infoControl,state){_getPic(infoControl).setSerializedState(state)},getState=function(infoControl){return _getPic(infoControl).getSerializedState()};return{qtiClass:"infoControl",template:tpl,getData:function(infoControl,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),
markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},render:render,getContainer:containerHelper.get,destroy:destroy,getState:getState,setState:setState}}),define("taoQtiItem/qtiCreator/renderers/PortableInfoControl",["lodash","taoQtiItem/qtiCommonRenderer/renderers/PortableInfoControl","taoQtiItem/qtiCreator/editor/infoControlRegistry","taoQtiItem/qtiCreator/helper/commonRenderer"],function(_,Renderer,icRegistry,commonRenderer){"use strict";var CreatorPortableInfoControl=_.clone(Renderer);return CreatorPortableInfoControl.render=function(infoControl,options){var pciCreator=icRegistry.getCreator(infoControl.typeIdentifier),renderOptions={
runtimeLocations:{}};renderOptions.runtimeLocations[infoControl.typeIdentifier]=icRegistry.getBaseUrl(infoControl.typeIdentifier),Renderer.render.call(commonRenderer.get(),infoControl,renderOptions),pciCreator.getWidget().build(infoControl,Renderer.getContainer(infoControl),this.getOption("bodyElementOptionForm"),options)},CreatorPortableInfoControl}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;
return buffer+='<div class="grid-row qti-rubricBlock" data-use="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.use,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="rubricBlock">\n    <div class="col-12">\n        <div class="qti-rubricBlock-body">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiCommonRenderer/tpl/rubricBlock","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"rubricBlock",getContainer:containerHelper.get,template:tpl}}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Sleep"],function(stateFactory,SleepState){var RubriBlockStateSleep=stateFactory.extend(SleepState,function(){},function(){});
return RubriBlockStateSleep}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<!--currently only visible to the candidate-->\n<div class="panel">\n    <label for="view">Visible by</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",options):helperMissing.call(depth0,"__","A rubric block identifies part of an assessmentItem's itemBody that represents instructions to one or more of the actors that view the item. Although rubric blocks are defined as simpleBlocks they must not contain interactions.",options)))+'\n    </div>\n    <select name="view" class="select2" data-has-search="false">\n        <option value="author">author</option>\n        <option value="candidate">candidate</option>\n        <option value="proctor">proctor</option>\n        <option value="scorer">scorer</option>\n        <option value="testConstructor">test constructor</option>\n        <option value="tutor">tutor</option>\n    </select>\n</div>\n\n<div class="panel">\n    <label for="use">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Description",options):helperMissing.call(depth0,"__","Description",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",options):helperMissing.call(depth0,"__","The purpose for which the rubric is intended to be used. As a reading passage for multiple items, or instructions for a particular section, for example.",options)))+'</div>\n    <input type="text" name="use" value="',
(helper=helpers.use)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.use,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/forms/static/rubricBlock","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(stateFactory,Active,htmlEditor,content,formTpl,formElement){
var RubricBlockStateActive=stateFactory.extend(Active,function(){this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.widget.$form.empty()});return RubricBlockStateActive.prototype.buildEditor=function(){var widget=this.widget,$editableContainer=widget.$container,container=widget.element.getBody();$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:content.getChangeCallback(container),data:{widget:widget,container:container}})},RubricBlockStateActive.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},RubricBlockStateActive.prototype.initForm=function(){
var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({view:interaction.attr("view"),use:interaction.attr("use")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{view:formElement.getAttributeChangeCallback(),use:formElement.getAttributeChangeCallback()})},RubricBlockStateActive}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Sleep","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/Active"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoQtiItem/qtiCreator/widgets/static/rubricBlock/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function($,Widget,states,toolbarTpl){var RubricBlockWidget=Widget.clone();return RubricBlockWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box widget-rubricBlock")},RubricBlockWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},RubricBlockWidget.createToolbar=function(){var $tlb=$(toolbarTpl({serial:this.serial,
state:"active"})),_this=this;return this.$container.find(".qti-rubricBlock-body").append($tlb),$tlb.find('[data-role="delete"]').on("click.widget-box",function(e){e.stopPropagation(),_this.changeState("deleting")}),this},RubricBlockWidget}),define("taoQtiItem/qtiCreator/renderers/RubricBlock",["lodash","taoQtiItem/qtiCommonRenderer/renderers/RubricBlock","taoQtiItem/qtiCreator/widgets/static/rubricBlock/Widget"],function(_,Renderer,Widget){"use strict";var CreatorRubricBlock=_.clone(Renderer);return CreatorRubricBlock.render=function(rubricBlock,options){Widget.build(rubricBlock,Renderer.getContainer(rubricBlock),this.getOption("bodyElementOptionForm"),options);
},CreatorRubricBlock}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="qti-choice qti-gap" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\r\n    <span data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" class="gapmatch-content">&nbsp;</span>\r\n</span>'})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gap","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"gap",getContainer:containerHelper.get,
template:tpl}}),define("taoQtiItem/qtiCreator/widgets/choices/Widget",["taoQtiItem/qtiCreator/widgets/Widget"],function(Widget){var ChoiceWidget=Widget.clone();return ChoiceWidget.buildContainer=function(){this.$container=this.$original},ChoiceWidget.initCreator=function(){if(Widget.initCreator.call(this),this.interaction=this.element.getInteraction(),!this.interaction)throw new Error("cannot find related interaction");this.listenToInteractionStates()},ChoiceWidget.listenToInteractionStates=function(){var _this=this;this.beforeStateInit(function(e,element,state){if(element.is("interaction")&&element.getSerial()===_this.interaction.getSerial()&&state.name!==_this.getCurrentState().name)switch(state.name){
case"answer":case"sleep":case"question":_this.changeState(state.name);break;case"delete":_this.changeState("sleep")}}),this.beforeStateExit(function(e,element,state){element.is("interaction")&&element.getSerial()===_this.interaction.getSerial()&&"choice"===state.name&&_this.changeState("question")})},ChoiceWidget}),define("taoQtiItem/qtiCreator/widgets/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("answer",["active"],function(){throw new Error('state "answer" prototype init method must be implemented')},function(){throw new Error('state "answer" prototype exit method must be implemented')})}),
define("taoQtiItem/qtiCreator/widgets/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){"use strict";return stateFactory.create("choice",["question","active"],function(){throw new Error('state "choice" prototype init method must be implemented')},function(){throw new Error('state "choice" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("correct",["answer","active"],function(){throw new Error('state "correct" prototype init method must be implemented')},function(){throw new Error('state "correct" prototype exit method must be implemented');
})}),define("taoQtiItem/qtiCreator/widgets/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("map",["answer","active"],function(){throw new Error('state "map" prototype init method must be implemented')},function(){throw new Error('state "map" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("question",["active"],function(){throw new Error('state "question" prototype init method must be implemented')},function(){throw new Error('state "question" prototype exit method must be implemented');
})}),define("tpl!taoQtiItem/qtiCreator/tpl/notifications/invalidInfoBox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="feedback-warning popup" data-widget-component="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="icon-warning"></span>\n    ',
helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},stack1=helper?helper.call(depth0,"There is an incomplete element in your item: please click on it to complete it.",options):helperMissing.call(depth0,"__","There is an incomplete element in your item: please click on it to complete it.",options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/states/Invalid",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","tpl!taoQtiItem/qtiCreator/tpl/notifications/invalidInfoBox"],function($,stateFactory,invalidInfoBoxTpl){return stateFactory.create("invalid",["sleep"],function(){this.widget.$container.addClass("invalid"),
this.$messageBox=$(invalidInfoBoxTpl({serial:this.widget.serial})),$("body").append(this.$messageBox)},function(){this.widget.$container.removeClass("invalid"),this.$messageBox.remove()})}),define("taoQtiItem/qtiCreator/widgets/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/states/Deleting","taoQtiItem/qtiCreator/widgets/states/Inactive","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/states/Question","taoQtiItem/qtiCreator/widgets/states/Sleep","taoQtiItem/qtiCreator/widgets/states/Invalid"],function(factory){
return factory.createBundle(arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,Sleep){var ChoiceStateSleep=stateFactory.create(Sleep,function(){},function(){});return ChoiceStateSleep}),define("taoQtiItem/qtiCreator/widgets/choices/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active"],function(stateFactory,Active){var ChoiceStateActive=stateFactory.create(Active,function(){},function(){});return ChoiceStateActive}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="";return buffer}function program3(depth0,data){return"display:none;"}function program5(depth0,data){return"icon-pin"}function program7(depth0,data){return"icon-shuffle"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="mini-tlb" data-edit="question" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <div class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="shuffle-pin" title="Shuffle/Pin" style="',stack1=helpers["if"].call(depth0,depth0&&depth0.interactionShuffle,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n        <span class="',stack1=helpers["if"].call(depth0,depth0&&depth0.fixed,{hash:{},inverse:self.program(7,program7,data),fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='"></span>\n    </div>\n    <div class="rgt tlb-button" data-role="cke-launcher" title="Formatting options">\n        <span class="icon-font"></span>\n    </div>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/choices/helpers/formElement",["jquery"],function($){var formElementHelper={initShufflePinToggle:function(widget){var $container=widget.$container,choice=widget.element,interaction=choice.getInteraction(),$shuffleToggle=$container.find('[data-role="shuffle-pin"]');$shuffleToggle.off("mousedown").on("mousedown",function(e){e.stopPropagation();var $icon=$(this).children();0===$icon.length&&($icon=$(this)),$icon.hasClass("icon-shuffle")?($icon.removeClass("icon-shuffle").addClass("icon-pin"),
choice.attr("fixed",!0)):($icon.removeClass("icon-pin").addClass("icon-shuffle"),choice.attr("fixed",!1))});var _toggleVisibility=function(show){show?$shuffleToggle.show():$shuffleToggle.hide(),$(".qti-item").trigger("toolbarchange",{callee:"formElementHelper"})};_toggleVisibility(interaction.attr("shuffle")),widget.on("attributeChange",function(data){data.element.serial===interaction.serial&&"shuffle"===data.key&&_toggleVisibility(data.value)})},initDelete:function(widget){var $container=widget.$container;$container.find('[data-role="delete"]:not([data-html-editable] *)').on("mousedown",function(e){e.stopPropagation(),widget.changeState("deleting")})}};return formElementHelper;
}),define("taoQtiItem/qtiCreator/widgets/choices/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,contentToolbarTpl,formElement){var ChoiceStateQuestion=stateFactory.create(QuestionState,function(){var _widget=this.widget;_widget.$container.on("click.question",function(){_widget.changeState("choice")}).on("mouseenter.question",function(){$(this).addClass("hover")}).on("mouseleave.question",function(){$(this).removeClass("hover")}),
this.createToolbar().show()},function(){this.removeToolbar(),this.widget.$container.off(".question")});return ChoiceStateQuestion.prototype.createToolbar=function(){var interaction,_widget=this.widget,$container=_widget.$container,choice=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *");return $toolbar.length||(interaction=choice.getInteraction(),$toolbar=$(contentToolbarTpl({choiceSerial:choice.getSerial(),interactionSerial:interaction.getSerial(),fixed:choice.attr("fixed"),interactionShuffle:interaction.attr("shuffle")})),$container.append($toolbar),formElement.initShufflePinToggle(_widget),formElement.initDelete(_widget)),
$toolbar},ChoiceStateQuestion.prototype.removeToolbar=function(){this.widget.$container.find(".mini-tlb[data-edit=question]").remove()},ChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer"],function(stateFactory,Answer){var ChoiceStateAnswer=stateFactory.create(Answer,function(){},function(){});return ChoiceStateAnswer}),define("taoQtiItem/qtiCreator/widgets/choices/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/choices/states/Sleep","taoQtiItem/qtiCreator/widgets/choices/states/Active","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/states/Answer"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiItem/core/Element"],function(stateFactory,Choice,Element){var ChoiceStateChoice=stateFactory.create(Choice,function(){var _widget=this.widget;_widget.beforeStateInit(function(e,element,state){Element.isA(element,"choice")&&_widget.interaction.getChoice(element.serial)?"choice"===state.name&&element.serial!==_widget.serial?_widget.changeState("question"):"active"===state.name&&_widget.changeState("question"):(element.is("img")||element.is("math")||element.is("object"))&&"active"===state.name&&_widget.changeState("question");
},"otherActive"),this.initForm(),this.widget.$form.show()},function(){this.widget.$form.empty().hide(),this.widget.offEvents("otherActive")});return ChoiceStateChoice.prototype.initForm=function(){stateFactory.throwMissingRequiredImplementationError("initForm")},ChoiceStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;
return buffer+='<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n\n<div class="panel">\n    <label>\n        <input name="required" type="checkbox" ',
stack1=helpers["if"].call(depth0,depth0&&depth0.required,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"required",options):helperMissing.call(depth0,"__","required",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data
},helper?helper.call(depth0,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options):helperMissing.call(depth0,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options)))+"\n    </span>\n</div>\n\n<h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shape position",options):helperMissing.call(depth0,"__","Shape position",options)))+'</h3>\n\n<div class="panel">\n    <label for="x">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Left",options):helperMissing.call(depth0,"__","Left",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="x" value="',
(helper=helpers.x)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.x,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="y">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Top",options):helperMissing.call(depth0,"__","Top",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="y" value="',(helper=helpers.y)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.y,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="width" value="',
(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="height">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n'})}),define("taoQtiItem/qtiCreator/widgets/helpers/identifier",["lodash"],function(_){
var _updateChoiceIdentifierInResponse=function(response,oldId,newId){var escapedOldId=oldId.replace(/([.-])/g,"\\$1"),regex=new RegExp("([^\\s]*\\s+|^)("+escapedOldId+")(\\s+[^\\s]*|$)");for(var i in response.correctResponse)response.correctResponse[i]=response.correctResponse[i].replace(regex,"$1"+newId+"$3");var mapEntries={};_.forIn(response.mapEntries,function(value,mapKey){mapKey=mapKey.replace(regex,"$1"+newId+"$3"),mapEntries[mapKey]=value}),response.mapEntries=mapEntries},_updateChoiceIdentifier=_.throttle(function(choice,newId,response){var oldId=choice.id();if(oldId!==newId){_updateChoiceIdentifierInResponse(response,oldId,newId),choice.id(newId);var interaction=_get("interactionFromChoice",choice,function(){
return choice.getInteraction()});try{var $choiceContainer=choice.getContainer(null,choice.qtiClass+"."+interaction.qtiClass);$choiceContainer.attr("data-identifier",choice.id()),$choiceContainer.find("input").val(choice.id())}catch(ex){}}},500),_cache=[],_setCache=function(cache,element,value){_cache[cache]||(_cache[cache]={}),_cache[cache][element.getSerial()]=value},_getCache=function(cache,element){var serial=element.getSerial();return serial&&_cache[cache]&&_cache[cache][serial]?_cache[cache][serial]:null},_get=function(cache,element,callback){var ret=_getCache(cache,element);return ret||(ret=callback.call(element),_setCache(cache,element,ret)),ret};return{
updateChoiceIdentifier:function(choice,value){if(value=value.trim()){var response=_get("responseFromChoice",choice,function(){var interaction=_get("interactionFromChoice",choice,function(){return choice.getInteraction()});return interaction.getResponseDeclaration()});_updateChoiceIdentifier(choice,value,response)}},updateResponseIdentifier:function(response,value){throw"to be implemented"}}}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gap","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiItem/core/Element"],function(stateFactory,Choice,formTpl,formElement,identifierHelper,Element){
var GapStateChoice=stateFactory.extend(Choice,function(){var _widget=this.widget;_widget.beforeStateInit(function(e,element,state){Element.isA(element,"gap")&&_widget.interaction.getBody().getElement(element.serial)&&("choice"===state.name&&element.serial!==_widget.serial?_widget.changeState("question"):"active"===state.name&&_widget.changeState("question"))},"otherActive")},function(){this.widget.offEvents("otherActive")});return GapStateChoice.prototype.initForm=function(){var $form=this.widget.$form,interaction=this.widget.element;$form.html(formTpl({serial:interaction.getSerial(),identifier:interaction.id(),required:!!interaction.attr("required")})),formElement.initWidget($form),
formElement.setChangeCallbacks($form,interaction,{identifier:identifierHelper.updateChoiceIdentifier,required:formElement.getAttributeChangeCallback()})},GapStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="rgt tlb-button" title="Delete" data-role="delete">\n        <span class="icon-bin"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,gapTpl,formElement){
var GapStateQuestion=stateFactory.extend(QuestionState);return GapStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$container=_widget.$container,gap=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *");return $toolbar.length||($toolbar=$(gapTpl({serial:gap.getSerial(),state:"question"})),$container.append($toolbar),formElement.initDelete(_widget)),$toolbar},GapStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/gap/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/gap/states/Choice","taoQtiItem/qtiCreator/widgets/choices/gap/states/Question"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/gap/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/gap/states/states"],function(Widget,states){var GapWidget=Widget.clone();return GapWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},GapWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box"),this.$container.attr("contenteditable",!1)},GapWidget}),define("taoQtiItem/qtiCreator/renderers/choices/Gap",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/Gap","taoQtiItem/qtiCreator/widgets/choices/gap/Widget"],function(_,Gap,GapWidget){
"use strict";var CreatorGap=_.clone(Gap);return CreatorGap.render=function(choice,options){GapWidget.build(choice,Gap.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorGap}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<li class="qti-choice" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</li>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"gapText",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label for="">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n\n<div class="panel">\n    <h3 class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Allowed number of uses",options):helperMissing.call(depth0,"__","Allowed number of uses",options)))+'\n    </h3>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",options):helperMissing.call(depth0,"__","The maximum number of choices this choice may be associated with. If matchMax is 0 there is no restriction.",options)))+'\n    </span>\n\n    <!--not supported yet-->\n    <div style="display:none;">\n        <label for="matchMin" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+'</label>\n        <input name="matchMin" value="',(helper=helpers.matchMin)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMin,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n    </div>\n\n    <div>\n        <label for="matchMax" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+'</label>\n        <input name="matchMax" value="',
(helper=helpers.matchMax)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMax,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/simpleAssociableChoice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(stateFactory,Choice,formTpl,formElement,identifierHelper,htmlEditor,contentHelper){
var SimpleAssociableChoiceStateChoice=stateFactory.extend(Choice,function(){this.buildEditor()},function(){this.destroyEditor()});return SimpleAssociableChoiceStateChoice.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,choice=_widget.element;$form.html(formTpl({serial:choice.getSerial(),identifier:choice.id(),matchMin:choice.attr("matchMin"),matchMax:choice.attr("matchMax")})),formElement.initWidget($form);var callbacks=formElement.getMinMaxAttributeCallbacks(this.widget.$form,"matchMin","matchMax");callbacks.identifier=identifierHelper.updateChoiceIdentifier,formElement.setChangeCallbacks($form,choice,callbacks)},SimpleAssociableChoiceStateChoice.prototype.buildEditor=function(){
var _widget=this.widget,container=_widget.element.getBody(),$editableContainer=_widget.$container;$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget}})},SimpleAssociableChoiceStateChoice.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},SimpleAssociableChoiceStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/Choice",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice","taoQtiItem/qtiItem/core/Element","lodash"],function($,stateFactory,Choice,SimpleAssociableChoice,Element,_){
var GapTextStateChoice=stateFactory.extend(Choice,function(){var _widget=this.widget;_widget.beforeStateInit(function(e,element,state){Element.isA(element,"choice")&&_widget.interaction.getBody().getElement(element.serial)&&"choice"===state.name&&element.serial!==_widget.serial&&_widget.changeState("question")},"otherActive"),this.buildEditor()},function(){this.destroyEditor(),this.widget.offEvents("otherActive")});GapTextStateChoice.prototype.initForm=function(){SimpleAssociableChoice.prototype.initForm.call(this)},GapTextStateChoice.prototype.buildEditor=function(){var $editable,_widget=this.widget,$editableContainer=_widget.$container,$tlb=$editableContainer.find(".mini-tlb");
$tlb.detach(),$editableContainer.wrapInner($("<div>",{"class":"inner-wrapper"})),$editableContainer.append($tlb),$editable=$editableContainer.find(".inner-wrapper"),$editable.attr("contentEditable",!0),_focus($editable),$editable.on("keyup.qti-widget",_.throttle(function(){_widget.element.val(_.escape($(this).text()))},200)).on("keypress.qti-widget",function(e){13===e.which&&(e.preventDefault(),$(this).blur(),_widget.changeState("question"))})},GapTextStateChoice.prototype.destroyEditor=function(){var $container=this.widget.$container;$container.find("td").removeAttr("contentEditable"),$container.children("td:first").off("keyup.qti-widget")};var _focus=function($el){
var range,sel,el=$el[0];el.focus(),void 0!==window.getSelection&&void 0!==document.createRange?(range=document.createRange(),range.selectNodeContents(el),range.collapse(!1),sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(range)):void 0!==document.body.createTextRange&&(range=document.body.createTextRange(),range.moveToElementText(el),range.collapse(!1),range.select())};return GapTextStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/gapText/states/Choice"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/gapText/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/gapText/states/states"],function(Widget,states){var GapTextWidget=Widget.clone();return GapTextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},GapTextWidget}),define("taoQtiItem/qtiCreator/renderers/choices/GapText",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/GapText","taoQtiItem/qtiCreator/widgets/choices/gapText/Widget"],function(_,GapText,GapTextWidget){"use strict";var CreatorGapText=_.clone(GapText);return CreatorGapText.render=function(choice,options){
GapTextWidget.build(choice,GapText.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorGapText}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="qti-choice qti-hottext hottext" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\r\n    <label class="hottext-checkmark">\r\n        <input type="checkbox" value="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\r\n        <span class="icon-checkbox small"></span>\r\n    </label>\r\n    <span class="hottext-content">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>\r\n</span>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/hottext","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"hottext",getContainer:containerHelper.get,template:tpl}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Identifier",options):helperMissing.call(depth0,"__","Identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. my-choice_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content"],function(stateFactory,Choice,formTpl,formElement,identifierHelper,htmlEditor,contentHelper){
var SimpleChoiceStateChoice=stateFactory.extend(Choice,function(){this.buildEditor()},function(){this.destroyEditor()});return SimpleChoiceStateChoice.prototype.initForm=function(){var _widget=this.widget;_widget.$form.html(formTpl({serial:_widget.element.getSerial(),identifier:_widget.element.id()})),formElement.initWidget(_widget.$form),formElement.setChangeCallbacks(_widget.$form,_widget.element,{identifier:identifierHelper.updateChoiceIdentifier})},SimpleChoiceStateChoice.prototype.buildEditor=function(){var _widget=this.widget,container=_widget.element.getBody(),$editableContainer=_widget.$container;$editableContainer.attr("data-html-editable-container",!0),
htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget}})},SimpleChoiceStateChoice.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},SimpleChoiceStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(stateFactory,Choice,SimpleChoice){var HottextStateChoice=stateFactory.extend(Choice);return HottextStateChoice.prototype.initForm=function(){
SimpleChoice.prototype.initForm.call(this)},HottextStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="tlb-button" title="Restore" data-role="restore">\n        <span class="icon-undo"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,gapTpl,formElement){
var HottextStateQuestion=stateFactory.extend(QuestionState);return HottextStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$container=_widget.$container,hottext=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *");return $toolbar.length||($toolbar=$(gapTpl({serial:hottext.getSerial(),state:"question"})),$container.append($toolbar),$toolbar.find("[data-role=restore]").on("mousedown.question",function(){$container.replaceWith(hottext.body()),_widget.destroy(),hottext.remove()})),$toolbar},HottextStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/hottext/states/Choice","taoQtiItem/qtiCreator/widgets/choices/hottext/states/Question"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/hottext/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/hottext/states/states"],function(Widget,states){var HottextWidget=Widget.clone();return HottextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},HottextWidget.buildContainer=function(){this.$container=this.$original.addClass("widget-box"),this.$container.attr("contenteditable",!1),this.$original.find(".hottext-checkmark > input").prop("disabled","disabled")},HottextWidget}),define("taoQtiItem/qtiCreator/renderers/choices/Hottext",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/Hottext","taoQtiItem/qtiCreator/widgets/choices/hottext/Widget"],function(_,Hottext,HottextWidget){
"use strict";var CreatorHottext=_.clone(Hottext);return CreatorHottext.render=function(choice,options){HottextWidget.build(choice,Hottext.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorHottext}),define("taoQtiItem/qtiCreator/renderers/choices/InlineChoice",function(){}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleAssociableChoice.associateInteraction",getContainer:containerHelper.get,template:tpl}}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.content","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement"],function($,stateFactory,QuestionState,contentToolbarTpl,formElement){
var SimpleAssociableChoiceStateQuestion=stateFactory.extend(QuestionState,function(){},function(){});return SimpleAssociableChoiceStateQuestion.prototype.createToolbar=function(){var interaction,_widget=this.widget,$container=_widget.$container,choice=_widget.element,$toolbar=$container.find(".mini-tlb").not("[data-html-editable] *");return $toolbar.length||(interaction=choice.getInteraction(),$toolbar=$(contentToolbarTpl({choiceSerial:choice.getSerial(),interactionSerial:interaction.getSerial(),fixed:choice.attr("fixed"),interactionShuffle:interaction.attr("shuffle")})),$container.children(".inner-wrapper").append($toolbar),formElement.initShufflePinToggle(_widget),
formElement.initDelete(_widget)),$toolbar},SimpleAssociableChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/Choice"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget",["jquery","taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/states/states"],function($,Widget,states){
var SimpleAssociableChoiceWidget=Widget.clone();return SimpleAssociableChoiceWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),this.$container.wrapInner($("<div>",{"class":"inner-wrapper"})),this.$container.closest("table.matrix").find("input[type=checkbox]:enabled").prop("disabled","disabled")},SimpleAssociableChoiceWidget}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.AssociateInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(_,SimpleAssociableChoice,SimpleChoiceWidget){
"use strict";var CreatorSimpleChoice=_.clone(SimpleAssociableChoice);return CreatorSimpleChoice.render=function(choice,options){SimpleChoiceWidget.build(choice,SimpleAssociableChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleChoice}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<th class="qti-choice qti-associableChoice qti-simpleAssociableChoice" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</th>"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleAssociableChoice.matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"simpleAssociableChoice.matchInteraction",getContainer:containerHelper.get,template:tpl}}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleAssociableChoice.MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleAssociableChoice.MatchInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleAssociableChoice/Widget"],function(_,SimpleAssociableChoice,SimpleAssociableChoiceWidget){"use strict";var CreatorSimpleAssociableChoice=_.clone(SimpleAssociableChoice);return CreatorSimpleAssociableChoice.render=function(choice,options){SimpleAssociableChoiceWidget.build(choice,SimpleAssociableChoice.getContainer(choice),this.getOption("choiceOptionForm"),options);
},CreatorSimpleAssociableChoice}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='\n            <input type="radio" name="response-'+escapeExpression((stack1=depth0&&depth0.interaction,stack1=null==stack1||stack1===!1?stack1:stack1.serial,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" value="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="1">\n            <span class="icon-radio"></span>\n            ';
}function program3(depth0,data){var stack1,buffer="";return buffer+='\n            <input type="checkbox" name="response-'+escapeExpression((stack1=depth0&&depth0.interaction,stack1=null==stack1||stack1===!1?stack1:stack1.serial,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" value="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" tabindex="1">\n            <span class="icon-checkbox"></span>\n            '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<li class="qti-choice qti-simpleChoice" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <div class="pseudo-label-box">\n        <label class="real-label">\n            ',stack1=helpers["if"].call(depth0,depth0&&depth0.unique,{hash:{},inverse:self.program(3,program3,data),
fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </label>\n        <div class="label-box">\n            <div class="label-content clear" contenteditable="false">\n                ',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </div>\n        </div>\n    </div>\n</li>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/simpleChoice.choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){
"use strict";return{qtiClass:"simpleChoice.choiceInteraction",getContainer:containerHelper.get,getData:function(choice,data){return data.unique=1===parseInt(data.interaction.attributes.maxChoices),data},template:tpl}}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/Choice"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/states/states"],function(Widget,states){
var SimpleChoiceWidget=Widget.clone();return SimpleChoiceWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states);var $realLabel=this.$container.find(".real-label");$realLabel.children("input").attr("disabled","disabled")},SimpleChoiceWidget}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.ChoiceInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(_,SimpleChoice,SimpleChoiceWidget){"use strict";var CreatorSimpleChoice=_.clone(SimpleChoice);return CreatorSimpleChoice.render=function(choice,options){
SimpleChoiceWidget.build(choice,SimpleChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleChoice}),define("taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction",["tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/choice","taoQtiItem/qtiCommonRenderer/helpers/container"],function(tpl,containerHelper){"use strict";return{qtiClass:"simpleChoice.orderInteraction",getContainer:containerHelper.get,template:tpl}}),define("taoQtiItem/qtiCreator/renderers/choices/SimpleChoice.OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/choices/SimpleChoice.OrderInteraction","taoQtiItem/qtiCreator/widgets/choices/simpleChoice/Widget"],function(_,SimpleChoice,SimpleChoiceWidget){
"use strict";var CreatorSimpleChoice=_.clone(SimpleChoice);return CreatorSimpleChoice.render=function(choice,options){SimpleChoiceWidget.build(choice,SimpleChoice.getContainer(choice),this.getOption("choiceOptionForm"),options)},CreatorSimpleChoice}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){
var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-associateInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="associateInteraction">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <ul class="choice-area clearfix  none block-listing solid horizontal source" data-eyecatcher=">li">\n        ',
options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </ul>\n    <ul class="result-area none target clearfix">\n    </ul>\n    <div class="notification-container"></div>\n</div>\n'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"incomplete-pair"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",self=this;return buffer+='<li class="',stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n    <div class="target lft"></div>\n    <div class="target rgt"></div>\n</li>\n'})}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div id="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="small feedback-info item-instruction">\n    <span class="icon-info icon"></span><span class="instruction-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n</div>"})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction",["lodash","taoQtiItem/qtiItem/helper/util","tpl!taoQtiItem/qtiCommonRenderer/tpl/instruction"],function(_,util,instructionTpl){var _notificationLevels=["info","warning","error","success"],Instruction=function(interaction,message,callback){this.interaction=interaction,this.defaultMessage=message||"",this.currentMessage="",this.level="info",this.serial=util.buildSerial("instruction_"),this.callback=callback,this.$dom=null,this.state=!1};return Instruction.isValidLevel=function(level){return _.indexOf(_notificationLevels,level)>=0;
},Instruction.prototype.setState=function(state){this.state=state},Instruction.prototype.checkState=function(state){return this.state===state},Instruction.prototype.getId=function(){return this.serial},Instruction.prototype.create=function($container){$container.append(instructionTpl({message:this.defaultMessage,serial:this.serial})),this.$dom=$container.find("#"+this.serial)},Instruction.prototype.update=function(options){var level=options&&options.level?options.level:"",message=options&&options.message?options.message:"",timeout=options&&options.timeout?options.timeout:0,start=options&&"function"==typeof options.start?options.start:null,stop=options&&"function"==typeof options.stop?options.stop:null;
if(level&&Instruction.isValidLevel(level)&&(this.$dom.removeClass("feedback-"+this.level).addClass("feedback-"+level),this.$dom.find(".icon").removeClass("icon-"+this.level).addClass("icon-"+level),this.level=level),message&&(this.$dom.find(".instruction-message").html(message),this.currentMessage=message),timeout){var _this=this;start&&start.call(_this),_this.timer=setTimeout(function(){stop&&stop.call(_this),_this.timer=null},timeout)}},Instruction.prototype.setLevel=function(level,timeout){var options={level:level};timeout&&(options.timeout=parseInt(timeout),options.stop=function(){this.setLevel("info")}),this.update(options)},Instruction.prototype.getLevel=function(){
return this.level},Instruction.prototype.setMessage=function(message,timeout){this.update({message:message,timeout:timeout})},Instruction.prototype.reset=function(){this.update({level:"info",message:this.defaultMessage}),this.state=!1},Instruction.prototype.validate=function(data){"function"==typeof this.callback&&this.callback.call(this,data)},Instruction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/notification",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;
return buffer+='<div class="small feedback-',(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+' item-notification">\n    <span class="icon-',(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span><span class="feedback-message">',(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove Message",options):helperMissing.call(depth0,"__","Remove Message",options)))+'" class="icon-close close-trigger"></span>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager",["lodash","jquery","i18n","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/Instruction","tpl!taoQtiItem/qtiCommonRenderer/tpl/notification"],function(_,$,__,containerHelper,Instruction,notifTpl){
"use strict";var _instructions={},instructionManager={validateInstructions:function(element,data){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.validate(data||{})})},appendInstruction:function(element,message,validateCallback){var serial=element.getSerial(),instruction=new Instruction(element,message,validateCallback);return _instructions[serial]||(_instructions[serial]={}),_instructions[serial][instruction.getId()]=instruction,instruction.create($(".instruction-container",containerHelper.get(element))),instruction},removeInstructions:function(element){_instructions[element.getSerial()]={},
containerHelper.get(element).find(".instruction-container").empty()},resetInstructions:function(element){var serial=element.getSerial();_instructions[serial]&&_.each(_instructions[serial],function(instruction){instruction.reset()})},minMaxChoiceInstructions:function(interaction,options){var msg,self=this,min=options.min||0,max=options.max||0,getResponse=options.getResponse,onError=options.onError||_.noop(),choiceCount=options.choiceCount===!1?!1:_.size(interaction.getChoices()),minInstructionSet=!1;if(!_.isFunction(getResponse))throw"invalid parameter getResponse";max>0&&(choiceCount===!1||choiceCount>max)&&(max===min?(minInstructionSet=!0,msg=1>=max?__("You must select exactly %d choice",max):__("You must select exactly %d choices",max),
self.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function(){onError(data)},stop:function(){this.update({level:"success",message:msg})}}),this.setState("fulfilled")):this.reset()})):max>min&&(msg=1>=max?__("You can select maximum %d choice",max):__("You can select maximum %d choices",max),self.appendInstruction(interaction,msg,function(data){getResponse(interaction).length>=max?(this.setLevel("success"),this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({
level:"warning",timeout:2e3,start:function(){onError(data)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))),!minInstructionSet&&min>0&&(choiceCount===!1||choiceCount>min)&&(msg=1>=min?__("You must at least %d choice",min):__("You must select at least %d choices",max),self.appendInstruction(interaction,msg,function(){getResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},appendNotification:function(element,message,level){if(level=level||"info",Instruction.isValidLevel(level)){var $container=containerHelper.get(element);$container.find(".notification-container").prepend(notifTpl({level:level,message:message
}));var $notif=$container.find(".item-notification:first"),_remove=function(){$notif.fadeOut()};return $notif.find(".close-trigger").on("click",_remove),setTimeout(_remove,2e3),$notif}},removeNotifications:function(element){containerHelper.get(element).find(".item-notification").remove()}};return instructionManager}),define("taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint",["lodash"],function(_){"use strict";function printBase(value,withType){var print="",base=value.base;return withType="undefined"!=typeof withType?withType:!0,base?(_.forIn(_formatters,function(formatter,baseType){return void 0!==base[baseType]?(print+=withType?"("+baseType+") ":"",print+=formatter(base[baseType]),
!1):void 0}),print):void 0}function printList(value,withType){var print="",list=value.list;return withType="undefined"!=typeof withType?withType:!0,list?(_.forIn(_formatters,function(formatter,baseType){return void 0!==list[baseType]?(print+=withType?"("+baseType+") ":"",print+="[",_.each(list[baseType],function(value){print+=formatter(value)+", "}),_.size(list[baseType])&&(print=print.substring(0,print.length-2)),print+="]",!1):void 0}),print):void 0}function printRecord(value){return value&&value.record?"(record) "+JSON.stringify(value.record):""}var _formatters={"boolean":function(value){return value?"true":"false"},integer:function(value){return value},"float":function(value){
return value},string:function(value){return""===value?"NULL":'"'+value+'"'},point:function(value){return"["+value[0]+", "+value[1]+"]"},pair:function(value){return"["+value[0]+", "+value[1]+"]"},directedPair:function(value){return"["+value[0]+", "+value[1]+"]"},duration:function(value){return value},file:function(value){return"binary data"},uri:function(value){return value},intOrIdentifier:function(value){return value},identifier:function(value){return value}};return{printBase:printBase,printList:printList,printRecord:printRecord}}),define("taoQtiItem/qtiCommonRenderer/helpers/PciResponse",["lodash","taoQtiItem/qtiCommonRenderer/helpers/PciPrettyPrint"],function(_,pciPrettyPrint){
"use strict";var _qtiModelPciResponseCardinalities={single:"base",multiple:"list",ordered:"list",record:"record"};return{unserialize:function(response,interaction){var mappedCardinality,ret=[],responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality");if(!_qtiModelPciResponseCardinalities[cardinality])throw"unknown cardinality in the responseDeclaration of the interaction";mappedCardinality=_qtiModelPciResponseCardinalities[cardinality];var responseValues=response[mappedCardinality];if(null===responseValues)ret=[];else{if(!_.isObject(responseValues))throw"invalid response cardinality, expected "+cardinality+" ("+mappedCardinality+")";
if(void 0===responseValues[baseType])throw"invalid response baseType";ret=responseValues[baseType],ret=_.isArray(ret)?ret:[ret]}return ret},serialize:function(responseValues,interaction){if(!_.isArray(responseValues))throw"invalid argument : responseValues must be an Array";var mappedCardinality,response={},responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),cardinality=responseDeclaration.attr("cardinality");if(!_qtiModelPciResponseCardinalities[cardinality])throw"unknown cardinality in the responseDeclaration of the interaction";return mappedCardinality=_qtiModelPciResponseCardinalities[cardinality],"base"===mappedCardinality?0===responseValues.length?response.base=null:(response.base={},
response.base[baseType]=responseValues[0]):(response[mappedCardinality]={},response[mappedCardinality][baseType]=responseValues),response},isEmpty:function(response){return null===response||_.isEmpty(response)||null===response.base||_.isArray(response.list)&&_.isEmpty(response.list)||_.isArray(response.record)&&_.isEmpty(response.record)},prettyPrint:function(response){var print="";if("undefined"!=typeof response.base)print+=pciPrettyPrint.printBase(response,!0);else if("undefined"!=typeof response.list)print+=pciPrettyPrint.printList(response,!0);else{if("undefined"==typeof response.record)throw"Not a valid PCI JSON Response";print+=pciPrettyPrint.printRecord(response,!0);
}return print}}}),define("taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter",["jquery","lodash","util/adaptSize","ui/waitForMedia"],function($,_,adaptSize,waitForMedia){"use strict";return{adaptSize:function(target){var $elements,$container;switch(!0){case"undefined"!=typeof target.$container:$elements=target.$container.find(".add-option, .result-area .target, .choice-area .qti-choice"),$container=target.$container;break;default:$elements=target,$container=$($elements).first().parent()}$container.waitForMedia(function(){adaptSize.height($elements)})}}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/associateInteraction.pair","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function($,_,__,Promise,tpl,pairTpl,containerHelper,instructionMgr,pciResponse,sizeAdapter){
"use strict";var setChoice=function(interaction,$choice,$target){var $container=containerHelper.get(interaction),choiceSerial=$choice.data("serial"),usage=$choice.data("usage")||0,choice=interaction.getChoice(choiceSerial);if(!choiceSerial)throw"empty choice serial";usage++,$choice.data("usage",usage);var _setChoice=function(){$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&usage>=choice.attr("matchMax")&&$choice.addClass("deactivated")};if($target.siblings("div").hasClass("filled")){var $resultArea=$(".result-area",$container),$pair=$target.parent(),thisPairSerial=[$target.siblings("div").data("serial"),choiceSerial],$otherRepeatedPair=$();
$resultArea.children().not($pair).each(function(){var $otherPair=$(this).children(".filled");if(2===$otherPair.length){var otherPairSerial=[$($otherPair[0]).data("serial"),$($otherPair[1]).data("serial")];if(2===_.intersection(thisPairSerial,otherPairSerial).length)return $otherRepeatedPair=$otherPair,!1}}),0===$otherRepeatedPair.length?(_setChoice(),containerHelper.triggerResponseChangeEvent(interaction,{type:"added",$pair:$pair,choices:thisPairSerial}),instructionMgr.validateInstructions(interaction,{choice:$choice,target:$target}),(interaction.responseMappingMode||0===parseInt(interaction.attr("maxAssociations")))&&($pair.removeClass("incomplete-pair"),$resultArea.children(".incomplete-pair").length||($resultArea.append(pairTpl({
empty:!0})),$resultArea.children(".incomplete-pair").fadeIn(600,function(){$(this).show()})))):($otherRepeatedPair.css("border","1px solid orange"),$target.html(__("identical pair already exists")).css({color:"orange",border:"1px solid orange"}),setTimeout(function(){$otherRepeatedPair.removeAttr("style"),$target.empty().css({color:"",border:""})},2e3))}else _setChoice()},unsetChoice=function(interaction,$filledChoice,animate,triggerChange){var $container=containerHelper.get(interaction),choiceSerial=$filledChoice.data("serial"),$choice=$container.find(".choice-area [data-serial="+choiceSerial+"]"),usage=$choice.data("usage")||0,$parent=$filledChoice.parent();
usage--,$choice.data("usage",usage).removeClass("deactivated"),$filledChoice.removeClass("filled").removeData("serial").empty(),interaction.swapping||(triggerChange!==!1&&(containerHelper.triggerResponseChangeEvent(interaction,{type:"removed",$pair:$filledChoice.parent()}),instructionMgr.validateInstructions(interaction,{choice:$choice})),$choice.siblings("div").hasClass("filled")||0!==parseInt(interaction.attr("maxAssociations"))&&!interaction.responseMappingMode||$parent.hasClass("incomplete-pair")||(animate?$parent.addClass("removing").fadeOut(500,function(){$(this).remove()}):$parent.remove()))},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction),choice=interaction.getChoiceByIdentifier(identifier);
if(!choice)throw new Error("cannot find a choice with the identifier : "+identifier);return $(".choice-area [data-serial="+choice.getSerial()+"]",$container)},renderEmptyPairs=function(interaction){var $container=containerHelper.get(interaction),max=parseInt(interaction.attr("maxAssociations")),$resultArea=$(".result-area",$container);if(interaction.responseMappingMode||0===max)$resultArea.append(pairTpl({empty:!0})),$resultArea.children(".incomplete-pair").show();else for(var i=0;max>i;i++)$resultArea.append(pairTpl())},render=function(interaction){return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$activeChoice=null,_getChoice=function(serial){
return $choiceArea.find("[data-serial="+serial+"]")},_setChoice=function($choice,$target){setChoice(interaction,$choice,$target),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_resetSelection=function(){$activeChoice&&($resultArea.find(".remove-choice").remove(),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){unsetChoice(interaction,$choice,!0),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",containerHelper.get(interaction)))},_isInsertionMode=function(){return $activeChoice&&$activeChoice.data("identifier");
},_isModeEditing=function(){return $activeChoice&&!$activeChoice.data("identifier")};renderEmptyPairs(interaction),$container.on("mousedown.commonRenderer",function(e){_resetSelection()}),$choiceArea.on("mousedown.commonRenderer",">li",function(e){return e.stopPropagation(),$(this).hasClass("deactivated")?void e.preventDefault():void(_isModeEditing()?(interaction.swapping=!0,_unsetChoice($activeChoice),_setChoice($(this),$activeChoice),_resetSelection(),interaction.swapping=!1):$(this).hasClass("active")?_resetSelection():(_resetSelection(),$activeChoice=$(this),$(this).addClass("active"),$resultArea.find(">li>.target").addClass("empty")))}),$resultArea.on("mousedown.commonRenderer",">li>div",function(e){
var $target,choiceSerial,targetSerial;if(e.stopPropagation(),_isInsertionMode())$target=$(this),choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial"),targetSerial!==choiceSerial&&($target.hasClass("filled")&&(interaction.swapping=!0),targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target),interaction.swapping=!1),_resetSelection();else if(_isModeEditing())$target=$(this),choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial"),targetSerial!==choiceSerial&&(($target.hasClass("filled")||$activeChoice.siblings("div")[0]===$target[0])&&(interaction.swapping=!0),_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),
_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target),interaction.swapping=!1),_resetSelection();else if($(this).data("serial")){var serial=$(this).data("serial");$activeChoice=$(this),$activeChoice.addClass("active"),$resultArea.find(">li>.target").filter(function(){return $(this).data("serial")!==serial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $(this).data("serial")!==serial}).addClass("empty");var $bin=$("<span>",{"class":"icon-undo remove-choice",title:__("remove")});$bin.on("mousedown",function(e){e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection()}),$(this).append($bin);
}}),interaction.responseMappingMode||_setInstructions(interaction),sizeAdapter.adaptSize($(".result-area .target, .choice-area .qti-choice",$container)),resolve()})},_setInstructions=function(interaction){var min=parseInt(interaction.attr("minAssociations")),max=parseInt(interaction.attr("maxAssociations"));if(0===min)0===max&&instructionMgr.appendInstruction(interaction,__("You may make as many association pairs as you want."));else{0===max&&instructionMgr.appendInstruction(interaction,__("The maximum number of association is unlimited."));var msg=__("You need to make")+" ";msg+=min>1?__("at least")+" "+min+" "+__("association pairs"):__("one association pair"),
instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()})}},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$container.find(".result-area .active").mousedown(),$(".result-area>li>div",$container).each(function(){unsetChoice(interaction,$(this),!1,!1)}),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)},_setPairs=function(interaction,pairs){var $container=containerHelper.get(interaction),addedPairs=0,$emptyPair=$(".result-area>li:first",$container);return pairs&&"single"===interaction.getResponseDeclaration().attr("cardinality")&&pairs.length&&(pairs=[pairs]),
_.each(pairs,function(pair){if(!$emptyPair.length)return!1;var $divs=$emptyPair.children("div");setChoice(interaction,getChoice(interaction,pair[0]),$($divs[0])),setChoice(interaction,getChoice(interaction,pair[1]),$($divs[1])),addedPairs++,$emptyPair=$emptyPair.next("li")}),addedPairs},setResponse=function(interaction,response){_setPairs(interaction,pciResponse.unserialize(response,interaction))},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".result-area>li",$container).each(function(){var pair=[];$(this).find("div").each(function(){var serial=$(this).data("serial");serial&&pair.push(interaction.getChoice(serial).id());
}),2===pair.length&&response.push(pair)}),response},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);$(document).off(".commonRenderer"),$container.find(".choice-area, .result-area").andSelf().off(".commonRenderer"),instructionMgr.removeInstructions(interaction),$(".result-area",$container).empty(),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),
$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:bIndex>aIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"associateInteraction",template:tpl,render:render,
getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState,renderEmptyPairs:renderEmptyPairs}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="common-tlb" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="tlb-button" title="move" data-role="move">\n        <span class="icon-grip"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/helpers/movable",["jquery","taoQtiItem/qtiCreator/editor/gridEditor/draggable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/grip"],function($,draggable,gripTpl){var movable={create:function(widget){var $itemBody,item=widget.element.getRelatedItem(),$container=widget.$container,$grip=$(gripTpl({serial:widget.serial}));$container.append($grip),$grip.on("mouseenter.qti-widget",function(){
$itemBody&&$itemBody.length||($itemBody=item.data("widget").$container),draggable.createMovable($container,$itemBody)}).on("mouseleave.qti-widget",function(){draggable.destroy($container)})}};return movable}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+='\n        <div class="state-switcher">\n            <span class="selected" data-state="question">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Question",options):helperMissing.call(depth0,"__","Question",options)))+'</span>\n            <span class="separator"> | </span>\n            <span class="link" data-state="answer">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Response",options):helperMissing.call(depth0,"__","Response",options)))+"</span>\n        </div>\n        "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return buffer+='<div class="tlb-wrapper" style="" data-edit="active" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'">\n    <span class="tlb-title" title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <div class="tlb">\n        <div class="rgt tlb-button" data-role="delete" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={
hash:{},data:data},helper?helper.call(depth0,"delete",options):helperMissing.call(depth0,"__","delete",options)))+'">\n            <span class="icon-bin"></span>\n        </div>\n        ',stack1=helpers["if"].call(depth0,depth0&&depth0.switcher,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/Widget",["lodash","jquery","taoQtiItem/qtiCreator/widgets/Widget","taoQtiItem/qtiCreator/widgets/helpers/movable","tpl!taoQtiItem/qtiCreator/tpl/toolbars/interaction","tpl!taoQtiItem/qtiCreator/tpl/toolbars/okButton"],function(_,$,Widget,movable,toolbarTpl,okButtonTpl){
function _convertToTitle(str){return str=str.replace(/[A-Z]/g,function(match){return" "+match.toUpperCase()}),str.charAt(0).toUpperCase()+str.substr(1)}var InteractionWidget=Widget.clone();return InteractionWidget.init=function(element,$container,$form,$responseForm,options){return Widget.init.call(this,element,$container,$form,options),this.$responseForm=$responseForm,this},InteractionWidget.build=function(element,$container,$form,$responseForm,options){return this.clone().init(element,$container,$form,$responseForm,options)},InteractionWidget.initCreator=function(){Widget.initCreator.call(this),this.createToolbar({}),this.createOkButton(),this.listenToChoiceStates();
},InteractionWidget.buildContainer=function(){var $wrap=$("<div>",{"data-serial":this.element.serial,"class":"widget-box widget-blockInteraction clearfix","data-qti-class":this.element.qtiClass}),$interactionContainer=this.$original.wrap($wrap);return this.$container=$interactionContainer.parent(),this},InteractionWidget.createToolbar=function(options){options=_.defaults(options||{},{title:_convertToTitle(this.element.qtiClass)});var $toolbar,_this=this;return $toolbar=$(toolbarTpl({title:options.title,serial:this.element.serial,switcher:!!this.registeredStates.answer})),this.$container.append($toolbar),$toolbar.hide(),$toolbar.find('[data-role="delete"]').click(function(e){
e.stopPropagation(),_this.changeState("deleting")}),this.registeredStates.answer&&($toolbar.on("click",".link",function(){var $link=$(this),state=$link.data("state");$link.siblings(".selected").removeClass("selected").addClass("link"),$link.removeClass("link").addClass("selected"),_this.changeState(state)}),this.beforeStateInit(function(e,element,state){if(element.getSerial()===_this.serial){var $link=$toolbar.find('.link[data-state="'+state.name+'"]');$link.length&&($link.siblings(".selected").removeClass("selected").addClass("link"),$link.removeClass("link").addClass("selected"))}})),this},InteractionWidget.createOkButton=function(){var _this=this,$ok=$(okButtonTpl()).on("click.qti-widget",function(e){
e.stopPropagation(),_this.changeState("sleep")});this.$container.append($ok)},InteractionWidget.listenToChoiceStates=function(){var _this=this;this.afterStateInit(function(e,element,state){var currentState=_this.getCurrentState();if(element.is("choice")&&_this.element.getChoice(element.getSerial())&&currentState&&state.name!==currentState.name)switch(state.name){case"choice":_this.changeState(state.name)}})},InteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep"],function(stateFactory,SleepState){var InteractionStateSleep=stateFactory.extend(SleepState,function(){
var _widget=this.widget;_widget.$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),_widget.changeState("question")})},function(){var _widget=this.widget;_widget.$container.off(".sleep")});return InteractionStateSleep}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Active","lodash"],function(stateFactory,Active,_){var _containsInModalFeedbackElts=function(response,searchSerial){var found=!1,modalFeedbacks=[];return _.each(response.feedbackRules,function(rule){rule.feedbackThen&&"modalFeedback"===rule.feedbackThen.qtiClass&&modalFeedbacks.push(rule.feedbackThen),
rule.feedbackElse&&"modalFeedback"===rule.feedbackElse.qtiClass&&modalFeedbacks.push(rule.feedbackElse)}),_.each(modalFeedbacks,function(fb){var elt=fb.getBody().getElement(searchSerial);return elt?(found=!0,!1):void 0}),found},InteractionStateActive=stateFactory.extend(Active,function(){var _widget=this.widget,$container=_widget.$container,interaction=_widget.element,response=interaction.getResponseDeclaration();$container.attr("contenteditable",!1),_widget.beforeStateInit(function(e,element,state){var serial=element.getSerial();if("modalFeedback"===element.qtiClass)return!1;if("active"===state.name&&serial!==_widget.serial){var composingElts=interaction.getComposingElements(),inModalFeedback=_containsInModalFeedbackElts(response,serial);
composingElts[serial]||inModalFeedback||_widget.changeState("sleep")}},"otherActive"),$container.on("mouseenter.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseenter.sleep")}).on("click.active",function(e){e.stopPropagation()})},function(){this.widget.offEvents("otherActive")});return InteractionStateActive}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<li class="add-option" data-edit="question" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-role="add-option">\n    <span class="icon-add"></span>\n    ',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</li>";
})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/addChoice","i18n"],function($,stateFactory,Question,addChoiceTpl,__){var InteractionStateQuestion=stateFactory.create(Question,function(){this.initForm(),this.widget.$form.show(),this.addNewChoiceButton(this.widget)},function(){this.widget.$form.empty().hide()});return InteractionStateQuestion.prototype.addNewChoiceButton=function(){var widget=this.widget,$choiceArea=widget.$container.find(".choice-area"),interaction=widget.element;$choiceArea.length&&!$choiceArea.children(".add-option").length&&($choiceArea.append(addChoiceTpl({
serial:this.serial,text:__("Add choice")})),$choiceArea.children(".add-option").show().on("click.qti-widget",function(e){e.stopPropagation();var choice=interaction.createChoice(),$newChoicePlaceholder=$("<li>"),qtiChoiceClassName=choice.qtiClass+"."+interaction.qtiClass,tplData={interaction:{serial:interaction.serial,attributes:interaction.attributes}};$(this).before($newChoicePlaceholder),choice.render(tplData,$newChoicePlaceholder,qtiChoiceClassName),choice.postRender({ready:function(widget){widget.changeState("choice")}},qtiChoiceClassName)}))},InteractionStateQuestion.prototype.initForm=function(){stateFactory.throwMissingRequiredImplementationError("initForm");
},InteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Choice",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Choice","taoQtiItem/qtiCreator/widgets/helpers/content"],function($,stateFactory,Choice,contentHelper){var InteractionStateChoice=stateFactory.create(Choice,function(){var _widget=this.widget;_widget.$container.on("click.choice",function(e){$(e.target).closest(".qti-choice").length||_widget.changeState("question")}),contentHelper.changeInnerWidgetState(this.widget,"sleep")},function(){this.widget.$container.off(".choice")});return InteractionStateChoice}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='\n        <option value="'+escapeExpression((stack1=null==data||data===!1?data:data.key,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+"</option>\n        "}function program3(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n<hr/>\n\n<div class="panel" data-editx="map">\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Score range",options):helperMissing.call(depth0,"__","Score range",options)))+'\n    </h3>\n    <div>\n        <label for="lowerBound" class="spinner">Min</label>\n        <input name="lowerBound" value="',
(helper=helpers.lowerBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.lowerBound,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="score" type="text" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Minimal  score for this interaction.",options):helperMissing.call(depth0,"__","Minimal  score for this interaction.",options)))+'</span>\n    </div>\n    <div>\n        <label for="upperBound" class="spinner">Max</label>\n        <input name="upperBound" value="',
(helper=helpers.upperBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperBound,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="score" type="text" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Maximal score for this interaction.",options):helperMissing.call(depth0,"__","Maximal score for this interaction.",options)))+'</span>\n    </div>\n</div>\n\n<div class="panel" data-editx="map">\n    <label for="defaultValue" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Mapping default",options):helperMissing.call(depth0,"__","Mapping default",options)))+'</label>\n    <input name="defaultValue" value="',(helper=helpers.defaultValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.defaultValue,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="score" type="text" data-validate="$notEmpty; $numeric;" data-validate-option="$lazy; $event(type=keyup)" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The default value from the target set to be used when no explicit mapping for a source value is given.",options):helperMissing.call(depth0,"__","The default value from the target set to be used when no explicit mapping for a source value is given.",options)))+'</span>\n</div>\n\n<div class="panel" data-editx="map">\n    <label>\n        <input name="defineCorrect" type="checkbox" data-role="defineCorrect"',stack1=helpers["if"].call(depth0,depth0&&depth0.defineCorrect,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Define correct response",options):helperMissing.call(depth0,"__","Define correct response",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define the correct response.",options):helperMissing.call(depth0,"__","Define the correct response.",options)))+"</span>\n</div>\n"}function program4(depth0,data){return' checked="checked"'}function program6(depth0,data){return'\n<hr/>\n\n<div class="panel feedbackRule-panel"></div>\n';
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+='<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response identifier",options):helperMissing.call(depth0,"__","Response identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. RESPONSE" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n\n<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Response processing",options):helperMissing.call(depth0,"__","Response processing",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select the way the response of your interaction should be processed",options):helperMissing.call(depth0,"__","Select the way the response of your interaction should be processed",options)))+'</div>\n\n    <select name="template" class="select2" data-has-search="false">\n        ',
stack1=helpers.each.call(depth0,depth0&&depth0.templates,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.editMapping,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n",stack1=helpers["if"].call(depth0,depth0&&depth0.editFeedbacks,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"})}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data,depth1){var stack1,helper,options,buffer="";return buffer+='\n            <option value="',(helper=helpers.name)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.name,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" ',helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data},stack1=helper?helper.call(depth0,depth0&&depth0.name,depth1&&depth1.condition,options):helperMissing.call(depth0,"equal",depth0&&depth0.name,depth1&&depth1.condition,options),
(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n            "}function program2(depth0,data){return'selected="selected"'}function program4(depth0,data){return'style="display:none"'}function program6(depth0,data){var helper,options,buffer="";return buffer+='\n    <a title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add else feedback",options):helperMissing.call(depth0,"__","Add else feedback",options)))+'" href="#" class="adder feedbackRule-add-else">else</a>\n    ';
}function program8(depth0,data){var helper,options,buffer="";return buffer+='\n     <div class="feedbackRule-then-else">\n            <span class="feedbackRule-desc i">else</span>\n            <button class="btn-info small" type="button" data-feedback="else">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Feedback",options):helperMissing.call(depth0,"__","Feedback",options)))+'</button>\n            <span class="feedbackRule-button-delete icon-bin" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Delete else statement",options):helperMissing.call(depth0,"__","Delete else statement",options)))+'" data-role="else"></span>\n        </div>\n    ';
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="feedbackRule-container" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <div class="feedbackRule-rule-if">\n        <span class="feedbackRule-desc i">if</span>\n        <select class="feedbackRule-condition select2" data-has-search="false">\n            ',
stack1=helpers.each.call(depth0,depth0&&depth0.availableConditions,{hash:{},inverse:self.noop,fn:self.programWithDepth(1,program1,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </select>\n        <input class="feedbackRule-compared-value score" type="text" value="',(helper=helpers.comparedValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.comparedValue,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.hideScore,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),
(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n    </div>\n    <div class="feedbackRule-then-else">\n        <span class="feedbackRule-desc i">then</span>\n        <button class="btn-info small" type="button" data-feedback="then">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Feedback",options):helperMissing.call(depth0,"__","Feedback",options)))+"</button>\n    </div>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.addElse,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.feedbackElse,{
hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <span class="feedbackRule-button-delete icon-bin" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Delete this modal feedback",options):helperMissing.call(depth0,"__","Delete this modal feedback",options)))+'" data-role="rule"></span>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<h3 class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Modal Feedbacks",options):helperMissing.call(depth0,"__","Modal Feedbacks",options)))+'</h3>\n<span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n<span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Modal feedback is shown to the candidate directly following response processing.",options):helperMissing.call(depth0,"__","Modal feedback is shown to the candidate directly following response processing.",options)))+'</span>\n<div class="feedbackRules">\n    <p><i>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"None defined yet.",options):helperMissing.call(depth0,"__","None defined yet.",options)))+'</i></p>\n</div>\n<a href="#" class="adder feedbackRule-add">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add a modal feedback",options):helperMissing.call(depth0,"__","Add a modal feedback",options)))+"</a>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement",["jquery","lodash","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/core/Element","tooltipster"],function($,_,formElement,Element){var _scoreTooltipContent={
required:"this is required",invalid:"the score format is not numeric"},formElementHelper={init:function(widget){formElement.initWidget(widget.$form)},syncMaxChoices:function(widget,attributeNameMin,attributeNameMax,getMax){attributeNameMin=attributeNameMin||"minChoices",attributeNameMax=attributeNameMax||"maxChoices",getMax=getMax||_.size;var $min=widget.$form.find("input[name="+attributeNameMin+"]"),$max=widget.$form.find("input[name="+attributeNameMax+"]"),_syncMaxChoices=function(){var newOptions={max:getMax(widget.element.getChoices())};$min.incrementer("options",newOptions).keyup(),$max.incrementer("options",newOptions).keyup()};widget.on("choiceCreated",function(data){
data.interaction.serial===widget.element.serial&&_syncMaxChoices()}).on("deleted",function(data){data.parent.serial===widget.element.serial&&Element.isA(data.element,"choice")&&_syncMaxChoices()})},setScore:function($scoreInput,options){options=_.defaults(options||{},{required:!1,empty:function(){},set:function(){},key:function(){return $(this).attr("name")},tooltipContent:_scoreTooltipContent}),$scoreInput.hasClass("tooltipstered")||$scoreInput.tooltipster({theme:"tao-error-tooltip",content:options.tooltipContent.invalid,delay:350,trigger:"custom"});var value=$scoreInput.val(),score=parseFloat(value),key=options.key.call($scoreInput[0]);""===value?options.required?($scoreInput.tooltipster("content",options.tooltipContent.required),
$scoreInput.tooltipster("show")):($scoreInput.tooltipster("hide"),options.empty(key)):isNaN(score)?($scoreInput.tooltipster("content",options.tooltipContent.invalid),$scoreInput.tooltipster("show")):($scoreInput.tooltipster("hide"),options.set(key,score))}};return formElementHelper}),define("taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackConditions",["lodash","i18n","jquery","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/editor/response/choiceSelector"],function(_,__,$,formElement,choiceSelector){"use strict";function _resetScore(fbRule,$select){$select.siblings(".feedbackRule-compared-value").val("0")}function onSetScore(fbRule,$select){
var response=fbRule.comparedOutcome,condition=this.name,$comparedValue=$select.siblings(".feedbackRule-compared-value");formElement.setScore($comparedValue,{required:!0,set:function(key,value){response.setCondition(fbRule,condition,value)}})}function onUnsetCorrect(fbRule,$select){_resetScore(fbRule,$select)}function initCompare(fbRule,$select){var response=fbRule.comparedOutcome;$select.siblings(".feedbackRule-compared-value").show().off("keyup"+_ns).on("keyup"+_ns,".feedbackRule-compared-value",function(){var fbRule=response.getFeedbackRule($(this).parents(".feedbackRule-container").data("serial"));formElement.setScore($(this),{required:!0,set:function(key,value){
response.setCondition(fbRule,fbRule.condition,value)}})})}function hideScore(fbRule,$select){$select.siblings(".feedbackRule-compared-value").hide()}function getAvailableConditions(response){return _.filter(_availableConditions,function(condition){return _.isFunction(condition.filter)?condition.filter(response):!0})}var _ns=".modal-feedback-condition",_availableConditions=[{name:"correct",label:__("correct"),init:hideScore,onSet:onSetScore,onUnset:onUnsetCorrect},{name:"incorrect",label:__("incorrect"),init:hideScore,onSet:onSetScore,onUnset:onUnsetCorrect},{name:"choices",label:__("choices"),init:function(fbRule,$select){hideScore(fbRule,$select);var condition=this.name,response=fbRule.comparedOutcome,interaction=response.getInteraction(),$choiceSelectorContainer=$("<div>",{
"class":"choiceSelectorContainer"}).insertAfter($select),cSelector=choiceSelector({renderTo:$choiceSelectorContainer,interaction:interaction,choices:fbRule.comparedValue||[],titleLength:30});$choiceSelectorContainer.data("choice-selector",cSelector),cSelector.on("change",function(selectedChoices){response.setCondition(fbRule,condition,selectedChoices||[])})},onSet:function(fbRule,$select){var choice,response=fbRule.comparedOutcome,interaction=response.getInteraction(),intialValue=[];response.isCardinality(["multiple","ordered"])||(choice=_.head(_.values(interaction.getChoices())),choice&&(intialValue=[choice])),fbRule.comparedOutcome.setCondition(fbRule,this.name,intialValue);
},onUnset:function(fbRule,$select){_resetScore(fbRule,$select),this.destroy($select)},destroy:function($select){var $cContainer=$select.next(".choiceSelectorContainer"),choiceSelector=$cContainer.data("choice-selector");choiceSelector&&(choiceSelector.destroy(),$cContainer.remove())},filter:function(response){var interaction=response.getInteraction();return interaction.is("choiceInteraction")||interaction.is("inlineChoiceInteraction")}},{name:"lt",label:"<",init:initCompare,onSet:onSetScore},{name:"lte",label:"<=",init:initCompare,onSet:onSetScore},{name:"equal",label:"=",init:initCompare,onSet:onSetScore},{name:"gte",label:">=",init:initCompare,onSet:onSetScore
},{name:"gt",label:">",init:initCompare,onSet:onSetScore}];return{get:getAvailableConditions}}),define("taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule",["lodash","jquery","ui/selecter","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/rule","tpl!taoQtiItem/qtiCreator/tpl/modalFeedback/panel","taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackConditions"],function(_,$,selecter,ruleTpl,panelTpl,modalFeedbackConditions){"use strict";var _renderFeedbackRule=function(feedbackRule){var feedbackElseSerial,feedbackElse=feedbackRule.feedbackElse,addElse=!feedbackElse;feedbackElse&&(feedbackElseSerial=feedbackElse.serial);var availableConditions=modalFeedbackConditions.get(feedbackRule.comparedOutcome),rule=ruleTpl({
availableConditions:availableConditions,serial:feedbackRule.serial,condition:feedbackRule.condition,comparedValue:feedbackRule.comparedValue,feedbackThen:feedbackRule.feedbackThen.serial,feedbackElse:feedbackElseSerial,addElse:addElse,hideScore:"correct"===feedbackRule.condition||"incorrect"===feedbackRule.condition||"choices"===feedbackRule.condition}),$rule=$(rule);selecter($rule);var condition=_.find(availableConditions,{name:feedbackRule.condition});return condition.init(feedbackRule,$rule.find("select.feedbackRule-condition")),$rule},_initFeedbackEventListener=function($feedbacksPanel,response){var $feedbacks=$feedbacksPanel.find(".feedbackRules");$feedbacksPanel.on("click",".feedbackRule-add",function(e){
e.preventDefault();var feedbackRule=response.createFeedbackRule(),$lastRule=$feedbacks.children(".feedbackRule-container:last");$lastRule.length?$lastRule.after(_renderFeedbackRule(feedbackRule)):$feedbacks.html(_renderFeedbackRule(feedbackRule))}).on("click",".feedbackRule-add-else",function(e){e.preventDefault();var $fbContainer=$(this).parents(".feedbackRule-container"),fbSerial=$fbContainer.data("serial"),fbRule=response.getFeedbackRule(fbSerial);response.createFeedbackElse(fbRule);$fbContainer.replaceWith(_renderFeedbackRule(fbRule))}).on("click",".feedbackRule-button-delete",function(){var $deleteButton=$(this),$fbContainer=$deleteButton.parents(".feedbackRule-container"),fbSerial=$fbContainer.data("serial"),fbRule=response.getFeedbackRule(fbSerial);
switch($deleteButton.data("role")){case"rule":response.deleteFeedbackRule(fbRule),$fbContainer.remove();break;case"else":response.deleteFeedbackElse(fbRule),$fbContainer.replaceWith(_renderFeedbackRule(fbRule))}}).on("change",".feedbackRule-condition",function(){var $select=$(this),condition=$select.val(),availableConditions=modalFeedbackConditions.get(response),fbRule=response.getFeedbackRule($(this).parents(".feedbackRule-container").data("serial")),newCondition=_.find(availableConditions,{name:condition}),oldCondition=_.find(availableConditions,{name:fbRule.condition});oldCondition&&_.isFunction(oldCondition.onUnset)&&oldCondition.onUnset(fbRule,$select),newCondition&&_.isFunction(newCondition.onSet)&&newCondition.onSet(fbRule,$select),
newCondition.init(fbRule,$select)}).on("click","[data-feedback]",function(){var modalFeedback,modalFeedbackWidget,$btn=$(this),fbRule=response.getFeedbackRule($btn.parents(".feedbackRule-container").data("serial"));switch($btn.data("feedback")){case"then":modalFeedback=fbRule.feedbackThen;break;case"else":modalFeedback=fbRule.feedbackElse}modalFeedback&&(modalFeedbackWidget=_getModalFeedbackWidget(modalFeedback),modalFeedbackWidget.changeState("active"))})},_widgets={},_getModalFeedbackWidget=function(modalFeedback){var $feedbacksContainer=$("#modalFeedbacks");return _widgets[modalFeedback.serial]||($feedbacksContainer.append(modalFeedback.render()),modalFeedback.postRender(),
_widgets[modalFeedback.serial]=modalFeedback.data("widget")),_widgets[modalFeedback.serial]};return{initFeedbacksPanel:function($feedbacksPanel,response){$feedbacksPanel.html(panelTpl());var $feedbackRules=$feedbacksPanel.find(".feedbackRules"),feedbackRules=response.getFeedbackRules();feedbackRules&&_.size(feedbackRules)&&($feedbackRules.empty(),_.each(feedbackRules,function(feedbackRule){$feedbackRules.append(_renderFeedbackRule(feedbackRule))})),_initFeedbackEventListener($feedbacksPanel,response)},renderFeedbackRule:_renderFeedbackRule}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState",["jquery","lodash","taoQtiItem/qtiItem/helper/response","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/response/responseForm","taoQtiItem/qtiCreator/widgets/helpers/modalFeedbackRule"],function($,_,responseHelper,formElement,responseFormTpl,modalFeedbackRule){
var _saveCallbacks={mappingAttr:function(response,value,key){""===value?response.removeMappingAttribute(key):response.setMappingAttribute(key,value)}},answerStateHelper={forward:function(widget){var response=widget.element.getResponseDeclaration();responseHelper.isUsingTemplate(response,"MATCH_CORRECT")?widget.changeState("correct"):responseHelper.isUsingTemplate(response,"MAP_RESPONSE")||responseHelper.isUsingTemplate(response,"MAP_RESPONSE_POINT")?widget.changeState("map"):widget.changeState("custom")},defineCorrect:function(response,define){var defineCorrect=!1,template=responseHelper.getTemplateNameFromUri(response.template),corrects=response.getCorrect();
return void 0===define?"MAP_RESPONSE"===template||"MAP_RESPONSE_POINT"===template?void 0!==response.data("defineCorrect")?defineCorrect=!!response.data("defineCorrect"):(defineCorrect=corrects&&_.size(corrects),response.data("defineCorrect",defineCorrect)):"MATCH_CORRECT"===template&&(defineCorrect=!0):(define||(response.correctResponse=[]),response.data("defineCorrect",define)),defineCorrect},initResponseForm:function(widget){var interaction=widget.element,item=interaction.getRelatedItem(),rp=item.responseProcessing,response=interaction.getResponseDeclaration(),template=responseHelper.getTemplateNameFromUri(response.template),editMapping=_.indexOf(["MAP_RESPONSE","MAP_RESPONSE_POINT"],template)>=0,defineCorrect=answerStateHelper.defineCorrect(response);
if(!template){if("custom"!==rp.processingType)throw"invalid response template";template="CUSTOM"}widget.$responseForm.html(responseFormTpl({identifier:response.id(),serial:response.getSerial(),defineCorrect:defineCorrect,editMapping:editMapping,editFeedbacks:"CUSTOM"!==template,template:template,templates:_getAvailableRpTemplates(interaction),defaultValue:response.getMappingAttribute("defaultValue"),lowerBound:response.getMappingAttribute("lowerBound"),upperBound:response.getMappingAttribute("upperBound")})),widget.$responseForm.find("select[name=template]").val(template);var _toggleCorrectWidgets=function(show){var $correctWidgets=widget.$container.find("[data-edit=correct]");
show?$correctWidgets.show():$correctWidgets.hide()};editMapping&&_toggleCorrectWidgets(defineCorrect),formElement.setChangeCallbacks(widget.$responseForm,response,{identifier:function(response,value){response.id(value),interaction.attr("responseIdentifier",value)},defaultValue:_saveCallbacks.mappingAttr,lowerBound:_saveCallbacks.mappingAttr,upperBound:_saveCallbacks.mappingAttr,template:function(response,value){rp.setProcessingType("templateDriven"),response.setTemplate(value),answerStateHelper.forward(widget),answerStateHelper.initResponseForm(widget)},defineCorrect:function(response,value){_toggleCorrectWidgets(value),answerStateHelper.defineCorrect(response,!!value);
}}),modalFeedbackRule.initFeedbacksPanel($(".feedbackRule-panel",widget.$responseForm),response),formElement.initWidget(widget.$responseForm)},isCorrectDefined:function(widget){var response=widget.element.getResponseDeclaration();return!!_.size(response.getCorrect())}},_getAvailableRpTemplates=function(interaction){var templates={CUSTOM:"custom",MATCH_CORRECT:"match correct",MAP_RESPONSE:"map response",MAP_RESPONSE_POINT:"map response"},rp=interaction.getRelatedItem().responseProcessing;switch(interaction.qtiClass){case"orderInteraction":case"graphicOrderInteraction":case"extendedTextInteraction":delete templates.MAP_RESPONSE,delete templates.MAP_RESPONSE_POINT;
break;case"selectPointInteraction":case"extendedTextInteraction":delete templates.MATCH_CORRECT,delete templates.MAP_RESPONSE;break;case"sliderInteraction":delete templates.MAP_RESPONSE_POINT,delete templates.MAP_RESPONSE;break;default:delete templates.MAP_RESPONSE_POINT}return"templateDriven"===rp.processingType&&delete templates.CUSTOM,templates};return answerStateHelper}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/content"],function(stateFactory,Answer,answerStateHelper,contentHelper){
var InteractionStateAnswer=stateFactory.create(Answer,function(){this.widget.$container.addClass("runtime"),this.initResponseForm(),this.widget.$responseForm.show(),contentHelper.changeInnerWidgetState(this.widget,"inactive")},function(){this.widget.$container.removeClass("runtime"),this.widget.$responseForm.empty().hide(),contentHelper.changeInnerWidgetState(this.widget,"sleep")});return InteractionStateAnswer.prototype.initResponseForm=function(){var _widget=this.widget;answerStateHelper.initResponseForm(_widget),_widget.on("responseTemplateChange",function(){answerStateHelper.forward(_widget)})},InteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct"],function(stateFactory,Correct){
var InteractionStateCorrect=stateFactory.create(Correct,function(){},function(){});return InteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Map,answerState){var InteractionStateMap=stateFactory.create(Map,function(){var $correctWidgets=this.widget.$container.find('[data-edit="correct"]');answerState.isCorrectDefined(this.widget)?$correctWidgets.show():$correctWidgets.hide()},function(){this.widget.$container.find('[data-edit="correct"]').hide()});
return InteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory"],function(stateFactory){return stateFactory.create("custom",["answer","active"],function(){throw new Error('state "custom" prototype init method must be implemented')},function(){throw new Error('state "custom" prototype exit method must be implemented')})}),define("taoQtiItem/qtiCreator/widgets/interactions/states/Custom",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Custom","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay","i18n"],function(stateFactory,Custom,overlayTpl,__){var InteractionStateCustom=stateFactory.create(Custom,function(){
this.widget.$container.append(overlayTpl({message:__("Custom Response Processing Mode")}));this.widget.$container.find("[data-edit=map], [data-edit=correct]").hide()},function(){this.widget.$container.children(".overlay").remove()});return InteractionStateCustom}),define("taoQtiItem/qtiCreator/widgets/interactions/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/states","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/states/Active","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/states/Map","taoQtiItem/qtiCreator/widgets/interactions/states/Custom"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger","i18n"],function($,stateFactory,Question,htmlEditor,contentHelper,promptToolbarTpl,__){var BlockInteractionStateQuestion=stateFactory.extend(Question,function(){this.buildPromptEditor()},function(){this.destroyPromptEditor()});return BlockInteractionStateQuestion.prototype.buildPromptEditor=function(){
var _widget=this.widget,$editableContainer=_widget.$container.find(".qti-prompt-container"),$editable=$editableContainer.find(".qti-prompt"),container=_widget.element.prompt.getBody();if($editableContainer.attr("data-html-editable-container",!0),$editable.attr("data-html-editable",!0),!htmlEditor.hasEditor($editableContainer)){var $promptTlb=$(promptToolbarTpl({serial:_widget.serial,state:"question"}));$editableContainer.append($promptTlb),$promptTlb.show(),htmlEditor.buildEditor($editableContainer,{placeholder:__("define prompt"),change:contentHelper.getChangeCallback(container),data:{container:container,widget:_widget}})}},BlockInteractionStateQuestion.prototype.destroyPromptEditor=function(){
var $editableContainer=this.widget.$container.find(".qti-prompt-container");$editableContainer.find(".mini-tlb").remove(),htmlEditor.destroyEditor($editableContainer)},BlockInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question"],function(factory,states){return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be shuffled of fixed individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be shuffled of fixed individually.",options)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Number of associations",options):helperMissing.call(depth0,"__","Number of associations",options)))+'</h3>\n\n    <div>\n        <label for="minAssociations" class="spinner">Min</label>\n        <input name="minAssociations" value="',(helper=helpers.minAssociations)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minAssociations,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices that the candidate is required to select to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices that the candidate is required to select to form a valid response.",options)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxAssociations" class="spinner">Max</label>\n        <input name="maxAssociations" value="',(helper=helpers.maxAssociations)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxAssociations,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="100" type="text" />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices that the candidate is allowed to select to form a valid response.",options):helperMissing.call(depth0,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",options)))+"\n        </span>\n    </div>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/associate","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(stateFactory,Question,formElement,formTpl,sizeAdapter){
"use strict";var AssociateInteractionStateQuestion=stateFactory.extend(Question);return AssociateInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({shuffle:!!interaction.attr("shuffle"),minAssociations:parseInt(interaction.attr("minAssociations")),maxAssociations:parseInt(interaction.attr("maxAssociations"))})),formElement.initWidget($form);var callbacks=formElement.getMinMaxAttributeCallbacks(this.widget.$form,"minAssociations","maxAssociations");callbacks.shuffle=formElement.getAttributeChangeCallback(),formElement.setChangeCallbacks($form,interaction,callbacks),
sizeAdapter.adaptSize(_widget),_widget.on("choiceCreated",function(){sizeAdapter.adaptSize(_widget)})},AssociateInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(stateFactory,Choice,sizeAdapter){"use strict";var AssociateInteractionStateChoice=stateFactory.extend(Choice,function(){var widget=this.widget;widget.on("containerBodyChange contentChange choiceCreated",function(){sizeAdapter.adaptSize(widget)})},function(){});return AssociateInteractionStateChoice;
}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var AssociateInteractionStateAnswer=stateFactory.extend(Answer,function(){answerStateHelper.forward(this.widget)},function(){});return AssociateInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget",["lodash","i18n","taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function(_,__,commonRenderer,sizeAdapter,instructionMgr){
"use strict";var ResponseWidget={create:function(widget,responseMappingMode){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),responseMappingMode?(instructionMgr.appendInstruction(widget.element,__("Please define association pairs and their scores below.")),interaction.responseMappingMode=!0):instructionMgr.appendInstruction(widget.element,__("Please define the correct association pairs below.")),commonRenderer.render(interaction),sizeAdapter.adaptSize(widget)},setResponse:function(interaction,response){var responseDeclaration=interaction.getResponseDeclaration();commonRenderer.setResponse(interaction,ResponseWidget.formatResponse(response,responseDeclaration.attr("cardinality"))),
sizeAdapter.adaptSize(interaction.data("widget"))},destroy:function(widget){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),delete interaction.responseMappingMode,commonRenderer.renderEmptyPairs(interaction),sizeAdapter.adaptSize(widget)},getResponseSummary:function(responseDeclaration){var pairs=[],correctResponse=_.values(responseDeclaration.getCorrect()),mapEntries=responseDeclaration.getMapEntries();return _.each(correctResponse,function(pair){var sortedIdPair=pair.split(" ").sort(),sortedIdPairKey=sortedIdPair.join(" ");pairs[sortedIdPairKey]={pair:sortedIdPair,correct:!0,score:void 0}}),_.forIn(mapEntries,function(score,pair){
var sortedIdPair=pair.split(" ").sort(),sortedIdPairKey=sortedIdPair.join(" ");pairs[sortedIdPairKey]?pairs[sortedIdPairKey].score=score:pairs[sortedIdPairKey]={pair:sortedIdPair,correct:!1,score:score}}),pairs},formatResponse:function(response,cardinality){var formatedRes;return formatedRes="single"===cardinality?{base:{pair:[]}}:{list:{pair:[]}},_.each(response,function(pairString){var pair=pairString.split(" ");"single"===cardinality?formatedRes.base.pair=pair:formatedRes.list.pair.push(pair)}),formatedRes},unformatResponse:function(formatedResponse){var res=[];return formatedResponse.list&&formatedResponse.list.pair?_.each(formatedResponse.list.pair,function(pair){
res.push(pair.join(" "))}):formatedResponse.base&&formatedResponse.base.pair&&res.push(formatedResponse.base.pair.join(" ")),res}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var AssociateInteractionStateCorrect=stateFactory.create(Correct,function(){var interaction=this.widget.element,response=interaction.getResponseDeclaration();responseWidget.create(this.widget,!1),
responseWidget.setResponse(interaction,_.values(response.getCorrect())),this.widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(responseWidget.unformatResponse(data.response))})},function(){this.widget.$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget)});return AssociateInteractionStateCorrect}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="mini-tlb" data-edit="answer" data-for="',(helper=helpers.choiceSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceSerial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <label class="tlb-button right" title="This answer is correct" data-edit="correct">\n        <input \n            type="checkbox" \n            data-role="correct"\n            name="correct_',(helper=helpers.interactionSerial)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.interactionSerial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'[]" \n            value="',(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n            ',stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n    </label>\n    <label class="tlb-button right" title="Score of this answer" data-edit="map">\n        <input value="',
(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" data-role="score" data-for="',(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" name="score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n    </label>\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/ResponseWidget","lodash","tpl!taoQtiItem/qtiCreator/tpl/toolbars/associableChoice.answer"],function($,stateFactory,Map,responseWidget,_,responseToolbarTpl){
"use strict";var AssociateInteractionStateCorrect=stateFactory.create(Map,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget,!0),this.bindResponseChangeListener(),responseWidget.setResponse(interaction,_.keys(responseWidget.getResponseSummary(response)))},function(){this.widget.$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget),this.widget.$container.find(".mini-tlb").remove()});return AssociateInteractionStateCorrect.prototype.bindResponseChangeListener=function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration(),_defaultMappingValue=0,_saveCorrect=function(){
var correct=[];$('input[name="correct_'+_widget.serial+'[]"]:checked').each(function(){correct.push($(this).data("pairIdentifier"))}),response.setCorrect(correct)};_widget.$container.on("responseChange.qti-widget",function(e,data,extraData){var $miniToolbar;if("added"===extraData.type){var pair=[],pairs=[],$filled=extraData.$pair.children(".filled");if(2===$filled.length){pairs=responseWidget.getResponseSummary(response),$filled.each(function(){var serial=$(this).data("serial"),choice=interaction.getChoice(serial);pair.push(choice.id())}),pair.sort();var pairIdentifier=pair.join(" ");$miniToolbar=extraData.$pair.children(".mini-tlb"),$miniToolbar.length||(extraData.$pair.append(responseToolbarTpl({
interactionSerial:interaction.getSerial(),choiceSerial:"n/a",choiceIdentifier:"n/a"})),$miniToolbar=extraData.$pair.children(".mini-tlb")),$miniToolbar.show(),$miniToolbar.data("pairIdentifier",pairIdentifier);var $correct=$miniToolbar.find("[data-role=correct]").data("pairIdentifier",pairIdentifier);pairs[pairIdentifier]&&pairs[pairIdentifier].correct?$correct.prop("checked",!0):$correct.prop("checked",!1);var $score=$miniToolbar.find("[data-role=score]").data("pairIdentifier",pairIdentifier);pairs[pairIdentifier]&&pairs[pairIdentifier].score?$score.val(pairs[pairIdentifier].score):$score.val(_defaultMappingValue)}}else $miniToolbar=extraData.$pair.children(".mini-tlb"),
$miniToolbar.hide(),response.removeMapEntry($miniToolbar.data("pairIdentifier")),$miniToolbar.removeData("pairIdentifier"),$miniToolbar.find("[data-role=correct]").prop("checked",!1).removeData("pairIdentifier"),$miniToolbar.find("[data-role=score]").val(_defaultMappingValue).removeData("pairIdentifier"),_saveCorrect()}),_widget.$container.find(".result-area").on("change","[data-role=correct]",_saveCorrect).on("keyup","[data-role=score]",function(){var $score=$(this);response.setMapEntry($score.data("pairIdentifier"),$score.val())})},AssociateInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Map"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(Widget,states,sizeAdapter){"use strict";var AssociateInteractionWidget=Widget.clone();return AssociateInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),sizeAdapter.adaptSize(this)},AssociateInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/AssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/AssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/Widget"],function(_,AssociateInteraction,AssociateInteractionWidget){
"use strict";var CreatorAssociateInteraction=_.clone(AssociateInteraction);return CreatorAssociateInteraction.render=function(interaction,options){AssociateInteraction.renderEmptyPairs(interaction),AssociateInteractionWidget.build(interaction,AssociateInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorAssociateInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0,data){return" horizontal";
}function program9(depth0,data){var stack1,helper;return(helper=helpers.listStyle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.listStyle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program11(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-choiceInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="choiceInteraction">\n  ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <ol class="plain block-listing solid choice-area',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" ",stack1=helpers["if"].call(depth0,depth0&&depth0.listStyle,{
hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n      ',options={hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  </ol>\n  <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/choiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(_,$,__,tpl,containerHelper,instructionMgr,pciResponse,sizeAdapter){
"use strict";var KEY_CODE_SPACE=32,KEY_CODE_ENTER=13,KEY_CODE_UP=38,KEY_CODE_DOWN=40,KEY_CODE_TAB=9,_pseudoLabel=function(interaction,$container){$container.off(".commonRenderer");var $choiceInputs=$container.find(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled");$choiceInputs.on("keydown.commonRenderer",function(e){var keyCode=e.keyCode?e.keyCode:e.charCode;keyCode!==KEY_CODE_TAB&&e.preventDefault(),(keyCode===KEY_CODE_SPACE||keyCode===KEY_CODE_ENTER)&&_triggerInput($(this).closest(".qti-choice"));var $nextInput=$(this).closest(".qti-choice").next(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled"),$prevInput=$(this).closest(".qti-choice").prev(".qti-choice").find("input:radio,input:checkbox").not("[disabled]").not(".disabled");
keyCode===KEY_CODE_UP?$prevInput.focus():keyCode===KEY_CODE_DOWN&&$nextInput.focus()}),$container.on("click.commonRenderer",".qti-choice",function(e){var $choiceBox=$(this);e.preventDefault(),e.stopPropagation(),_triggerInput($choiceBox),instructionMgr.validateInstructions(interaction,{choice:$choiceBox}),containerHelper.triggerResponseChangeEvent(interaction)})},_triggerInput=function($choiceBox){var $input=$choiceBox.find("input:radio,input:checkbox").not("[disabled]").not(".disabled");$input.length&&($input.prop("checked",!$input.prop("checked")),$input.trigger("change"))},render=function(interaction){var $container=containerHelper.get(interaction);_pseudoLabel(interaction,$container),
_setInstructions(interaction),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize($(".add-option, .result-area .target, .choice-area .qti-choice",$container))},_setInstructions=function(interaction){var msg,min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),choiceCount=_.size(interaction.getChoices()),minInstructionSet=!1;if(max>1&&choiceCount>max){var highlightInvalidInput=function($choice){var $input=$choice.find(".real-label > input"),$li=$choice.css("color","#BA122B"),$icon=$choice.find(".real-label > span").css("color","#BA122B").addClass("cross error"),timeout=interaction.data("__instructionTimeout");timeout&&clearTimeout(timeout),
timeout=setTimeout(function(){$input.prop("checked",!1),$li.removeAttr("style"),$icon.removeAttr("style").removeClass("cross"),containerHelper.triggerResponseChangeEvent(interaction)},150),interaction.data("__instructionTimeout",timeout)};max===min?(minInstructionSet=!0,msg=__("You must select exactly %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setLevel("success"),this.checkState("fulfilled")&&this.update({level:"warning",message:__("Maximum choices reached"),timeout:2e3,start:function(){data&&data.choice&&highlightInvalidInput(data.choice)},stop:function(){this.update({level:"success",
message:msg})}}),this.setState("fulfilled")):this.reset()})):max>min&&(msg=1===max?__("You can select maximum of 1 choice"):__("You can select maximum of %s choices",max),instructionMgr.appendInstruction(interaction,msg,function(data){_getRawResponse(interaction).length>=max?(this.setMessage(__("Maximum choices reached")),this.checkState("fulfilled")&&this.update({level:"warning",timeout:2e3,start:function(){data&&data.choice&&highlightInvalidInput(data.choice)},stop:function(){this.setLevel("info")}}),this.setState("fulfilled")):this.reset()}))}!minInstructionSet&&min>0&&choiceCount>min&&(msg=1===min?__("You must select at least 1 choice"):__("You must select at least %s choices",min),
instructionMgr.appendInstruction(interaction,msg,function(){_getRawResponse(interaction).length>=min?this.setLevel("success"):this.reset()}))},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$(".real-label > input",$container).prop("checked",!1)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction);try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$container.find(".real-label > input[value="+identifier+"]").prop("checked",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},_getRawResponse=function(interaction){
var values=[],$container=containerHelper.get(interaction);return $(".real-label > input[name=response-"+interaction.getSerial()+"]:checked",$container).each(function(){values.push($(this).val())}),values},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},getCustomData=function(interaction,data){var listStyles=(interaction.attr("class")||"").match(/\blist-style-[\w-]+/)||[];return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation"),listStyle:listStyles.pop()})},destroy=function(interaction){var $container=containerHelper.get(interaction),timeout=interaction.data("__instructionTimeout");
timeout&&clearTimeout(timeout),$container.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".qti-simpleChoice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:bIndex>aIndex?-1:0;
}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".qti-simpleChoice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"choiceInteraction",template:tpl,getData:getCustomData,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}function program3(depth0,data){return"checked"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',options):helperMissing.call(depth0,"__",'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',options)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+'</h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(helper=helpers.minChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices that the candidate is required to select to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices that the candidate is required to select to form a valid response.",options)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">Max</label>\n        <input name="maxChoices" value="',
(helper=helpers.maxChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-zero="true" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices that the candidate is allowed to select to form a valid response.",options):helperMissing.call(depth0,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",options)))+'\n        </span>\n    </div>\n</div>\n\n\n\n<div class="panel">\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"List Style",options):helperMissing.call(depth0,"__","List Style",options)))+'</h3>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Use this if you want the list of choices to be prefixed (e.g. 1,2,3 a,b,c)",options):helperMissing.call(depth0,"__","Use this if you want the list of choices to be prefixed (e.g. 1,2,3 a,b,c)",options)))+'\n        </span>\n\n    <select data-list-style/>\n</div>\n\n\n<div class="panel">\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Orientation",options):helperMissing.call(depth0,"__","Orientation",options)))+'</h3>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Display the choices either horizontaly or verticaly",options):helperMissing.call(depth0,"__","Display the choices either horizontaly or verticaly",options)))+'\n        </span>\n    <div>\n        <label class="smaller-prompt">\n            <input type="radio" name="orientation" value="vertical" ',stack1=helpers.unless.call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\n            <span class="icon-radio"></span>\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},
data:data},helper?helper.call(depth0,"Vertical",options):helperMissing.call(depth0,"__","Vertical",options)))+'\n        </label>\n        <br>\n        <label class="smaller-prompt">\n            <input type="radio" name="orientation" value="horizontal" ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\n            <span class="icon-radio"></span>\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Horizontal",options):helperMissing.call(depth0,"__","Horizontal",options)))+"\n        </label>\n    </div>\n</div>\n";
})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/choice","lodash","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","ui/liststyler"],function(stateFactory,Question,formElement,interactionFormElement,formTpl,_,sizeAdapter){"use strict";function getListStyle(interaction){var className=interaction.attr("class")||"",listStyle=className.match(/\blist-style-[\w-]+/);
return _.isNull(listStyle)?null:listStyle.pop().replace(listStylePrefix,"")}var ChoiceInteractionStateQuestion=stateFactory.extend(Question),listStylePrefix="list-style-";return ChoiceInteractionStateQuestion.prototype.initForm=function(updateCardinality){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element,currListStyle=getListStyle(interaction),$choiceArea=_widget.$container.find(".choice-area");$form.html(formTpl({shuffle:!!interaction.attr("shuffle"),maxChoices:parseInt(interaction.attr("maxChoices")),minChoices:parseInt(interaction.attr("minChoices")),choicesCount:_.size(_widget.element.getChoices()),horizontal:"horizontal"===interaction.attr("orientation")
})),$form.find("[data-list-style]").liststyler({selected:currListStyle}).on("stylechange.liststyler",function(e,data){interaction.removeClass(listStylePrefix+data.oldStyle),$choiceArea.removeClass(listStylePrefix+data.oldStyle),"none"!==data.newStyle&&(interaction.addClass(listStylePrefix+data.newStyle),$choiceArea.addClass(listStylePrefix+data.newStyle))}),formElement.initWidget($form);var callbacks=formElement.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices",{updateCardinality:updateCardinality});callbacks.shuffle=formElement.getAttributeChangeCallback(),callbacks.orientation=function(interaction,value){interaction.attr("orientation",value),
"horizontal"===value?$choiceArea.addClass("horizontal"):$choiceArea.removeClass("horizontal")},formElement.setChangeCallbacks($form,interaction,callbacks),interactionFormElement.syncMaxChoices(_widget),_widget.on("attributeChange",function(data){var $checkboxIcons=_widget.$container.find(".real-label > span");data.element.serial===interaction.serial&&"maxChoices"===data.key&&(1===parseInt(data.value)?$checkboxIcons.removeClass("icon-checkbox").addClass("icon-radio"):$checkboxIcons.removeClass("icon-radio").addClass("icon-checkbox"))}),"horizontal"===_widget.element.attr("orientation")&&sizeAdapter.adaptSize(_widget),_widget.on("choiceCreated",function(){"horizontal"===_widget.element.attr("orientation")&&sizeAdapter.adaptSize(_widget);
})},ChoiceInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Choice","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(stateFactory,Choice,sizeAdapter){"use strict";var ChoiceInteractionStateChoice=stateFactory.extend(Choice,function(){var widget=this.widget;widget.on("containerBodyChange contentChange choiceCreated",function(){"horizontal"===widget.element.attr("orientation")&&sizeAdapter.adaptSize(widget)})},function(){});return ChoiceInteractionStateChoice}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){
var ChoiceInteractionStateAnswer=stateFactory.extend(Answer,function(){answerStateHelper.forward(this.widget)},function(){});return ChoiceInteractionStateAnswer}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="mini-tlb" data-edit="answer" data-for="',(helper=helpers.choiceSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceSerial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <label class="tlb-button right" title="Score of this answer" data-edit="map">\n        <input value="',(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n       title="Score of this answer" \n       type="text" \n       data-for="',(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n       name="score" \n       class="score" \n       placeholder = "',(helper=helpers.placeholder)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholder,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n       data-validate="$numeric" \n       data-validate-option="$allowEmpty; $event(type=keyup)" />\n    </label>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
return'style="display:block;"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",self=this,functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="mini-tlb-label" data-edit="answer" ',stack1=helpers["if"].call(depth0,depth0&&depth0.show,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n    <label class="right">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+"</label>\n</div>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.score","tpl!taoQtiItem/qtiCreator/tpl/toolbars/simpleChoice.label","polyfill/placeholders"],function($,_,__,commonRenderer,instructionMgr,pciResponse,formElement,answerStateHelper,sizeAdapter,scoreTpl,labelTpl){
"use strict";var _fixInputs=function(widget){1===widget.element.attr("maxChoices")?widget.$container.find(".real-label > :checkbox").replaceWith(function(){var $checkbox=$(this);return $("<input>",{type:"radio",value:$checkbox.attr("value"),name:$checkbox.attr("name")})}):widget.$container.find(".real-label > :radio").replaceWith(function(){var $radio=$(this);return $("<input>",{type:"checkbox",value:$radio.attr("value"),name:$radio.attr("name")})})},ResponseWidget={create:function(widget,responseMappingMode){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),_fixInputs(widget),responseMappingMode?(instructionMgr.appendInstruction(widget.element,__("Please define the correct response and the score below.")),
interaction.data("responseMappingMode",!0),ResponseWidget.createScoreWidgets(widget),ResponseWidget.createCorrectWidgets(widget)):(instructionMgr.appendInstruction(widget.element,__("Please define the correct response below.")),ResponseWidget.createCorrectWidgets(widget)),commonRenderer.render(interaction),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget)},setResponse:function(interaction,response){commonRenderer.setResponse(interaction,pciResponse.serialize(_.values(response),interaction)),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(interaction.data("widget"))},destroy:function(widget){var interaction=widget.element;
commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.removeData("responseMappingMode"),widget.$container.off("responseChange.qti-widget"),widget.$container.find(".real-label > input").attr("disabled","disabled"),widget.$container.find(".mini-tlb-label[data-edit=answer], .mini-tlb[data-edit=answer]").remove(),"horizontal"===interaction.attr("orientation")&&sizeAdapter.adaptSize(widget)},createScoreWidgets:function(widget){var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),defaultValue=response.getMappingAttribute("defaultValue"),$label=$(labelTpl({
label:__("score"),show:!0})).css({right:3,left:"auto"});$container.find(".qti-choice:first .pseudo-label-box").append($label),$container.find(".qti-choice").each(function(){var $score,$choice=$(this),id=$choice.data("identifier"),serial=$choice.data("serial");$score=$(scoreTpl({serial:interaction.getSerial(),choiceSerial:serial,choiceIdentifier:id,score:mapEntries[id]?mapEntries[id]:"",placeholder:defaultValue})),$choice.find(".pseudo-label-box").append($score),$score.show().on("click",function(e){e.stopPropagation(),e.preventDefault()})});var $scores=$container.find(".score");widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&$scores.attr("placeholder",data.value);
}),formElement.setChangeCallbacks($container,response,{score:function(response,value){var key=$(this).data("for");""===value?response.removeMapEntry(key):response.setMapEntry(key,value,!0)}})},createCorrectWidgets:function(widget){var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),$corrects=$container.find(".real-label > input");$container.find(".qti-choice:first .pseudo-label-box").append(labelTpl({label:__("correct"),show:!1})),$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(pciResponse.unserialize(data.response,interaction))});var _toggleCorrectInputs=function(show){show?$corrects.removeAttr("disabled"):$corrects.attr("disabled","disabled").prop("checked",!1);
};_toggleCorrectInputs(answerStateHelper.defineCorrect(response)),widget.on("metaChange",function(data){data.element.serial===response.serial&&"defineCorrect"===data.key&&_toggleCorrectInputs(data.value)})},formatResponse:function(response){return pciResponse.serialize(_.values(response))},unformatResponse:function(formatedResponse){return pciResponse.unserialize(formatedResponse)}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){
var ChoiceInteractionStateCorrect=stateFactory.create(Correct,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget),responseWidget.setResponse(interaction,_.values(response.getCorrect()))},function(){responseWidget.destroy(this.widget)});return ChoiceInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/ResponseWidget","lodash"],function(stateFactory,Map,responseWidget,_){
"use strict";var ChoiceInteractionStateMap=stateFactory.create(Map,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget,!0),responseWidget.setResponse(interaction,_.values(response.getCorrect()))},function(){responseWidget.destroy(this.widget)});return ChoiceInteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Choice","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Map"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function(Widget,states,sizeAdapter){"use strict";var ChoiceInteractionWidget=Widget.clone();return ChoiceInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),"horizontal"===this.element.attr("orientation")&&sizeAdapter.adaptSize(this)},ChoiceInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/ChoiceInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/Widget"],function(_,ChoiceInteraction,ChoiceInteractionWidget){
"use strict";var CreatorChoiceInteraction=_.clone(ChoiceInteraction);return CreatorChoiceInteraction.render=function(interaction,options){ChoiceInteractionWidget.build(interaction,ChoiceInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorChoiceInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;
return buffer+='<a class="qti-interaction qti-inlineInteraction qti-endAttemptInteraction btn small btn-info"\n        data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n        data-qti-class="endAttemptInteraction"\n        value="false"\n        tabindex="0">\n        '+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,typeof stack1===functionType?stack1.apply(depth0):stack1))+"\n</a>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction",["lodash","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/endAttemptInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","i18n"],function(_,tpl,containerHelper,pciResponse,__){
"use strict";var render=function(interaction,options){var $container=containerHelper.get(interaction);$container.on("click.commonRenderer",function(){$container.val(!0),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("endattempt",[interaction.attr("responseIdentifier")])})},setResponse=function(interaction,response){_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},getResponse=function(interaction){var val=containerHelper.get(interaction).val();return val=val&&"false"!==val&&"0"!==val,pciResponse.serialize([val],interaction)},resetResponse=function(interaction){_setVal(interaction,!1)},_setVal=function(interaction,val){
containerHelper.get(interaction).val(val).change()},destroy=function(interaction){containerHelper.get(interaction).off(".commonRenderer")},getCustomData=function(interaction,data){return data.attributes.title||(data.attributes.title=__("End Attempt")),data};return{qtiClass:"endAttemptInteraction",template:tpl,getData:getCustomData,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy}}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget"],function(Widget){var InlineInteractionWidget=Widget.clone();return InlineInteractionWidget.destroy=function(){
this.$original.off(".qti-widget"),this.$container.remove(),this.offEvents()},InlineInteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){var InlineInteractionStateSleep=stateFactory.create(SleepState,function(){var _widget=this.widget,$container=this.widget.$original;$container.on("click.qti-widget.sleep",function(e){e.stopPropagation(),_widget.changeState("question")}),$container.on("mouseenter.sleep",function(e){$container.addClass("hover"),$container.parent().trigger("mouseleave.sleep");
}).on("mouseleave.sleep",function(){$container.removeClass("hover"),$container.parent().trigger("mouseenter.sleep")})},function(){this.widget.$original.removeClass("hover").off(".sleep")});return InlineInteractionStateSleep}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Active"],function($,_,stateFactory,Active){var InteractionStateActive=stateFactory.extend(Active,function(){var _this=this;$(window).on("resize.active",_.throttle(function(){_this.positionWidget()},200)),this.positionWidget()},function(){$(window).off(".active"),
this.widget.$container.hide()});return InteractionStateActive.prototype.positionWidget=function(){var _widget=this.widget,itemOffset=_widget.$itemContainer.offset(),originalOffset=_widget.$original.offset();_widget.$container.show().css({position:"absolute",top:originalOffset.top-itemOffset.top-22,left:originalOffset.left-itemOffset.left-32})},InteractionStateActive}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/Active"],function(factory,states){
return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/endAttempt",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n<div class="panel">\n    <label for="restrictedIdentifier" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Response identifier",options):helperMissing.call(depth0,"__","Response identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Select a response identifier from the list.",options):helperMissing.call(depth0,"__","Select a response identifier from the list.",options)))+'</span>\n    <select name="restrictedIdentifier" class="select2" data-has-search="false">\n    	',stack1=helpers.each.call(depth0,depth0&&depth0.restrictedIdentifiers,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n"}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='\n    		<option value="'+escapeExpression((stack1=null==data||data===!1?data:data.key,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    	"}function program3(depth0,data){return'selected="selected"'}function program5(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Response identifier",options):helperMissing.call(depth0,"__","Response identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the response identifier. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the response identifier. This identifier must not be used by any other response or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="responseIdentifier" \n           value="',
(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. END_ATTEMPT" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.responseSerial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseSerial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return stack1=helpers["if"].call(depth0,depth0&&depth0.hasRestrictedIdentifier,{hash:{},inverse:self.program(5,program5,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n\n<div class="panel">\n    <label for="" class="has-icon">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Label",options):helperMissing.call(depth0,"__","Label",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The button label.",options):helperMissing.call(depth0,"__","The button label.",options)))+'</div>\n\n    <input type="text" \n           name="title" \n           value="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. End Attempt" \n           data-validate="$notEmpty;">\n</div>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/Question",["lodash","jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/endAttempt"],function(_,$,stateFactory,Question,formElement,formTpl){
"use strict";function _prepareRestrictedIdentifier(widget){var ret={},interaction=widget.element,response=interaction.getResponseDeclaration(),responseIdentifier=interaction.attr("responseIdentifier"),config=widget.options.config,defaultIdentifier="",isset="",i=0;return config&&config.responseIdentifiers&&(_.forIn(config.responseIdentifiers,function(title,identifier){i||(defaultIdentifier=identifier);var selected=responseIdentifier.match(new RegExp("^("+identifier+")(_[0-9]*)?$"));ret[identifier]={identifier:identifier,title:title,selected:selected},selected&&(isset=!0),i++}),isset||(response.buildIdentifier(defaultIdentifier,!1),interaction.attr("responseIdentifier",response.id()))),
ret}var EndAttemptInteractionStateQuestion=stateFactory.extend(Question,function(){var $mainOption=this.widget.$container.find(".main-option"),$original=this.widget.$original;$(document).on("choiceTextChange.qti-widget.question",function(){$original.width($mainOption.width())})},function(){$(document).off(".qti-widget.question")});return EndAttemptInteractionStateQuestion.prototype.addNewChoiceButton=function(){},EndAttemptInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,$title=_widget.$container.find(".endAttemptInteraction-placeholder"),interaction=_widget.element,response=interaction.getResponseDeclaration(),restrictedIdentifiers=_prepareRestrictedIdentifier(_widget),hasRestrictedIdentifier=!!_.size(restrictedIdentifiers);
$form.html(formTpl({hasRestrictedIdentifier:hasRestrictedIdentifier,restrictedIdentifiers:restrictedIdentifiers,responseSerial:response.serial,responseIdentifier:interaction.attr("responseIdentifier"),title:interaction.attr("title")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{title:function(interaction,title){interaction.attr("title",title),$title.html(title),_widget.$original.html(title)},responseIdentifier:function(interaction,identifier){response.id(identifier),interaction.attr("responseIdentifier",identifier)},restrictedIdentifier:function(interaction,identifier){response.buildIdentifier(identifier,!1),interaction.attr("responseIdentifier",response.id());
}})},EndAttemptInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/Question"],function(factory,states){"use strict";return factory.createBundle(states,arguments,["answer","correct","map"])}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="widget-box widget-inline widget-endAttemptInteraction qti-interaction" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-edit="active">\r\n    <span class="btn small btn-info endAttemptInteraction-placeholder">\r\n        '+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,typeof stack1===functionType?stack1.apply(depth0):stack1))+"\r\n    </span>\r\n</div>";
})}),define("taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/Widget",["lodash","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction"],function(_,InteractionWidget,states,interactionTpl){"use strict";var EndAttemptInteractionWidget=InteractionWidget.clone();return EndAttemptInteractionWidget.initCreator=function(){this.registerStates(states),InteractionWidget.initCreator.call(this),this.$container.find(".tlb-title").remove()},EndAttemptInteractionWidget.renderInteraction=function(){
var interaction=this.element,tplData={tag:interaction.qtiClass,serial:interaction.serial,attributes:interaction.attributes};return interactionTpl(tplData)},EndAttemptInteractionWidget.buildContainer=function(){var previous,next;this.$original.length&&(previous=this.$original[0].previousSibling,next=this.$original[0].nextSibling,(!previous||3===previous.nodeType&&""===previous.nodeValue||3!==previous.nodeType)&&this.$original.before("&nbsp;"),(!next||3===next.nodeType&&""===next.nodeValue||3!==next.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-endAttemptInteraction[data-serial="+this.element.getSerial()+"]");
},EndAttemptInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction.placeholder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="widget-box btn small btn-info endAttemptInteraction-placeholder" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="endAttemptInteraction">\n    '+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.title,typeof stack1===functionType?stack1.apply(depth0):stack1))+"\n</span>"})}),define("taoQtiItem/qtiCreator/renderers/interactions/EndAttemptInteraction",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/EndAttemptInteraction","taoQtiItem/qtiCreator/widgets/interactions/endAttemptInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/endAttemptInteraction.placeholder"],function($,_,EndAttemptInteraction,EndAttemptInteractionWidget,tpl){
"use strict";var CreatorEndAttemptInteraction=_.clone(EndAttemptInteraction);return CreatorEndAttemptInteraction.template=tpl,CreatorEndAttemptInteraction.render=function(interaction,options){options=options||{};var interactionsConfig=this.getOption("interactions");interactionsConfig.endAttempt&&(options.config=interactionsConfig.endAttempt),EndAttemptInteractionWidget.build(interaction,$('.endAttemptInteraction-placeholder[data-serial="'+interaction.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorEndAttemptInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n        ",helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(12,program12,data),fn:self.program(8,program8,data),data:data},stack1=helper?helper.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),"xhtml",options):helperMissing.call(depth0,"equal",(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),"xhtml",options),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n        {!-- If there's an expected length or a max length --}}\n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.expectedLength),{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(18,program18,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data
}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program8(depth0,data){var stack1,buffer="";return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program9(depth0,data){var stack1,buffer="";return buffer+='\n                <div class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" name="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+"_"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'" contenteditable></div>\n            '}function program10(depth0,data){return" attributes.class"}function program12(depth0,data){var stack1,buffer="";return buffer+="\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.maxStringLoop,{
hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program13(depth0,data){var stack1,buffer="";return buffer+='\n                <textarea class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" name="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+"_"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'" ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.patternMask),{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n            "}function program14(depth0,data){var stack1,buffer="";return buffer+='pattern="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.patternMask,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"';
}function program16(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.expectedLength,typeof stack1===functionType?stack1.apply(depth0):stack1))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"recommanded",options):helperMissing.call(depth0,"__","recommanded",options)))+".\n            </div>\n        "}function program18(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",(helper=helpers.maxLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxLength,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        "}function program20(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-words">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" ",(helper=helpers.maxWords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxWords,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"words",options):helperMissing.call(depth0,"__","words",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"maximum",options):helperMissing.call(depth0,"__","maximum",options)))+".\n            </div>\n        ";
}function program22(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n        ",helper=helpers.equal||depth0&&depth0.equal,options={hash:{},inverse:self.program(25,program25,data),fn:self.program(23,program23,data),data:data},stack1=helper?helper.call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),depth0&&depth0.xhtml,options):helperMissing.call(depth0,"equal",(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.format),depth0&&depth0.xhtml,options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.expectedLength),{hash:{},inverse:self.noop,fn:self.program(27,program27,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(18,program18,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        \n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(20,program20,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program23(depth0,data){var stack1,buffer="";return buffer+='\n            <div class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" contenteditable></div>\n        '}function program25(depth0,data){var stack1,buffer="";return buffer+='\n            <textarea class="text-container text-'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.format,typeof stack1===functionType?stack1.apply(depth0):stack1))+" solid",
stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.patternMask),{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="></textarea>\n        "}function program27(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n            <div class="text-counter">\n                <span class="count-chars">0</span> '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.expectedLength,typeof stack1===functionType?stack1.apply(depth0):stack1))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"chars",options):helperMissing.call(depth0,"__","chars",options)))+" "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"recommended",options):helperMissing.call(depth0,"__","recommended",options)))+".\n            </div>\n        ";
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-extendedTextInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{
hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="extendedTextInteraction">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{
hash:{},inverse:self.program(22,program22,data),fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator",["ui/ckeditor/ckConfigurator"],function(ckConfigurator){"use strict";var getConfig=function(editor,toolbarType,options){return options=options||{},options.underline=!0,ckConfigurator.getConfig(editor,toolbarType,options)};return{getConfig:getConfig}}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/extendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","ckeditor","taoQtiItem/qtiCommonRenderer/helpers/ckConfigurator","polyfill/placeholders"],function($,_,__,Promise,tpl,containerHelper,instructionMgr,ckEditor,ckConfigurator){
"use strict";var render=function(interaction){return new Promise(function(resolve,reject){var $el,expectedLength,minStrings,patternMask,placeholderType,editor,$container=containerHelper.get(interaction),multiple=(interaction.getResponseDeclaration(),_isMultiple(interaction)),limiter=inputLimiter(interaction),placeholderText=interaction.attr("placeholderText"),toolbarType="extendedText",ckOptions={extraPlugins:"onchange",language:"en",defaultLanguage:"en",resize_enabled:!0,secure:"https:"==location.protocol,forceCustomDomain:!0};if(multiple){if($el=$container.find("input"),minStrings=interaction.attr("minStrings"),expectedLength=interaction.attr("expectedLength"),
patternMask=interaction.attr("patternMask"),minStrings){var _getNumStrings=function($element){var num=0;return $element.each(function(){""!==$(this).val()&&num++}),num};minStrings=parseInt(minStrings,10),minStrings>0&&$el.on("blur.commonRenderer",function(){setTimeout(function(){!$el.is(":focus")&&_getNumStrings($el)<minStrings&&instructionMgr.appendNotification(interaction,__("The minimum number of answers is ")+" : "+minStrings,"warning")},100)})}expectedLength&&(expectedLength=parseInt(expectedLength,10),expectedLength>0&&$el.each(function(){$(this).css("width",expectedLength+"em")})),patternMask&&$el.each(function(){_setPattern($(this),patternMask)}),placeholderText&&(placeholderType="first",
"multiple"===placeholderType?$el.each(function(){$(this).attr("placeholder",placeholderText)}):"first"===placeholderType&&$el.first().attr("placeholder",placeholderText)),resolve()}else $el=$container.find("textarea"),placeholderText&&$el.attr("placeholder",placeholderText),"xhtml"===_getFormat(interaction)?(editor=_setUpCKEditor(interaction,ckOptions),editor||reject("Unable to instantiate ckEditor"),editor.on("loaded",function(){_.delay(resolve,300)}),("ready"===editor.status||"loaded"===editor.status)&&_.defer(resolve),editor.on("configLoaded",function(e){editor.config=ckConfigurator.getConfig(editor,toolbarType,ckOptions),limiter.enabled&&limiter.listenKeyPress();
}),editor.on("change",function(e){containerHelper.triggerResponseChangeEvent(interaction,{})})):($el.on("keyup.commonRenderer change.commonRenderer",function(e){containerHelper.triggerResponseChangeEvent(interaction,{})}),limiter.enabled&&limiter.listenKeyPress(),resolve())})},resetResponse=function(interaction){"xhtml"===_getFormat(interaction)?_getCKEditor(interaction).setData(""):containerHelper.get(interaction).find("input, textarea").val("")},setResponse=function(interaction,response){var _setMultipleVal=function(identifier,value){interaction.getContainer().find("#"+identifier).val(value)},baseType=interaction.getResponseDeclaration().attr("baseType");if(response.base&&void 0!==response.base[baseType])setText(interaction,response.base[baseType]);else{
if(!response.list||!response.list[baseType])throw new Error("wrong response format in argument.");for(var i in response.list[baseType]){var serial=void 0===response.list.serial?"":response.list.serial[i];_setMultipleVal(serial+"_"+i,response.list[baseType][i])}}},getResponse=function(interaction){var $container=containerHelper.get(interaction),attributes=interaction.getAttributes(),responseDeclaration=interaction.getResponseDeclaration(),baseType=responseDeclaration.attr("baseType"),numericBase=attributes.base||10,multiple=!(!attributes.maxStrings||"multiple"!==responseDeclaration.attr("cardinality")&&"ordered"!==responseDeclaration.attr("cardinality")),ret=multiple?{
list:{}}:{base:{}};if(multiple){var values=[];$container.find("input").each(function(i){var $el=$(this);attributes.placeholderText&&$el.val()===attributes.placeholderText?values[i]="":"integer"===baseType?(values[i]=parseInt($el.val(),numericBase),values[i]=isNaN(values[i])?"":values[i]):"float"===baseType?(values[i]=parseFloat($el.val()),values[i]=isNaN(values[i])?"":values[i]):"string"===baseType&&(values[i]=$el.val())}),ret.list[baseType]=values}else{var value="";attributes.placeholderText&&_getTextareaValue(interaction)===attributes.placeholderText?value="":"integer"===baseType?value=parseInt(_getTextareaValue(interaction),numericBase):"float"===baseType?value=parseFloat(_getTextareaValue(interaction)):"string"===baseType&&(value=_getTextareaValue(interaction,!0)),
ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value}return ret},inputLimiter=function(interaction){var $textarea,$charsCounter,$wordsCounter,maxWords,maxLength,$container=containerHelper.get(interaction),expectedLength=interaction.attr("expectedLength"),expectedLines=interaction.attr("expectedLines"),patternMask=interaction.attr("patternMask"),enabled=!1;(expectedLength||expectedLines||patternMask)&&(enabled=!0,$textarea=$(".text-container",$container),$charsCounter=$(".count-chars",$container),$wordsCounter=$(".count-words",$container),""!==patternMask&&(maxWords=_parsePattern(patternMask,"words"),maxLength=_parsePattern(patternMask,"chars"),maxWords=_.isNaN(maxWords)?void 0:maxWords,
maxLength=_.isNaN(maxLength)?void 0:maxLength));var limiter={enabled:enabled,listenKeyPress:function(){var self=this,ignoreKeyCodes=[8,222832,1114120,1114177,1114202,1114200],triggerKeyCodes=[32,13,2228237],limitHandler=function(e){var keyCode=e&&e.data?e.data.keyCode:e.which;return!_.contains(ignoreKeyCodes,keyCode)&&maxWords&&self.getWordsCount()>=maxWords&&_.contains(triggerKeyCodes,keyCode)||maxLength&&self.getCharsCount()>=maxLength?(e.cancel?e.cancel():(e.preventDefault(),e.stopImmediatePropagation()),setText(interaction,_getTextareaValue(interaction,!0))):void _.defer(function(){self.updateCounter()})};"xhtml"===_getFormat(interaction)?_getCKEditor(interaction).on("key",limitHandler):$textarea.on("keydown.commonRenderer",limitHandler);
},getWordsCount:function(){var value=_getTextareaValue(interaction)||"";return _.isEmpty(value)?0:value.replace(/\s+/gi," ").split(" ").length},getCharsCount:function(){var value=_getTextareaValue(interaction)||"";return value.length},updateCounter:function(){$charsCounter.text(this.getCharsCount()),$wordsCounter.text(this.getWordsCount())}};return limiter},_getTextareaValue=function(interaction,raw){return"xhtml"===_getFormat(interaction)?_ckEditorData(interaction,raw):containerHelper.get(interaction).find("textarea").val()},_setPattern=function($element,pattern){var patt=new RegExp("^"+pattern+"$");$element.on("keyup.commonRenderer",function(){$element.removeClass("field-error"),
patt.test($element.val())||$element.addClass("field-error")})},_isMultiple=function(interaction){var attributes=interaction.getAttributes(),response=interaction.getResponseDeclaration();return!(!attributes.maxStrings||"multiple"!==response.attr("cardinality")&&"ordered"!==response.attr("cardinality"))},_setUpCKEditor=function(interaction,options){var $container=containerHelper.get(interaction),editor=ckEditor.replace($container.find(".text-container")[0],options||{});return editor?($container.data("editor",editor.name),editor):void 0},_destroyCkEditor=function(interaction){var editor,$container=containerHelper.get(interaction),name=$container.data("editor");name&&(editor=ckEditor.instances[name]),
editor&&(editor.destroy(),$container.removeData("editor"))},_getCKEditor=function(interaction){var $container=containerHelper.get(interaction),name=$container.data("editor");return ckEditor.instances[name]},_ckEditorData=function(interaction,raw){var editor=_getCKEditor(interaction),data=editor&&editor.getData()||"";return raw||(data=_stripTags(data)),data},_stripTags=function(str){var tempNode=document.createElement("div");return tempNode.innerHTML=str,tempNode.textContent},_getFormat=function(interaction){var format=interaction.attr("format");return _.contains(["plain","xhtml","preformatted"],format)?format:"plain"},_parsePattern=function(pattern,type){if(void 0===pattern)return null;
var result,regexChar=/\^\[\\s\\S\]\{\d+\,(\d+)\}\$/,regexWords=/\^\(\?\:\(\?\:\[\^\\s\\:\\!\\\?\\\;\\\\\\\]\+\)\[\\s\\:\\!\\\?\\;\\\\\\\]\*\)\{\d+\,(\d+)\}\$/;return"words"===type?(result=pattern.match(regexWords),null!==result&&result.length>1?parseInt(result[1],10):null):"chars"===type?(result=pattern.match(regexChar),null!==result&&result.length>1?parseInt(result[1],10):null):null},enable=function(interaction){var editor,$container=containerHelper.get(interaction);$container.find("input, textarea").removeAttr("disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction),editor&&("ready"===editor.status?editor.setReadOnly(!1):editor.readOnly=!1));
},disable=function(interaction){var editor,$container=containerHelper.get(interaction);$container.find("input, textarea").attr("disabled","disabled"),"xhtml"===_getFormat(interaction)&&(editor=_getCKEditor(interaction),editor&&("ready"===editor.status?editor.setReadOnly(!0):editor.readOnly=!0))},clearText=function(interaction){setText(interaction,"")},setText=function(interaction,text){var limiter=inputLimiter(interaction);if("xhtml"===_getFormat(interaction))try{_getCKEditor(interaction).setData(text,function(){limiter.enabled&&limiter.updateCounter()})}catch(e){console.error("setText error",e)}else containerHelper.get(interaction).find("textarea").val(text),
limiter.enabled&&limiter.updateCounter()},destroy=function(interaction){var $container=containerHelper.get(interaction),$el=$container.find("input, textarea");"xhtml"===_getFormat(interaction)&&_destroyCkEditor(interaction),$el.off(".commonRenderer"),$(document).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){if(_.isObject(state)&&state.response)try{interaction.setResponse(state.response)}catch(e){throw interaction.resetResponse(),e}},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},getCustomData=function(interaction,data){
var pattern=interaction.attr("patternMask"),maxWords=parseInt(_parsePattern(pattern,"words")),maxLength=parseInt(_parsePattern(pattern,"chars")),expectedLength=parseInt(interaction.attr("expectedLines"),10);return _.merge(data||{},{maxWords:isNaN(maxWords)?void 0:maxWords,maxLength:isNaN(maxLength)?void 0:maxLength,attributes:isNaN(expectedLength)?void 0:{expectedLength:72*expectedLength}})};return{qtiClass:"extendedTextInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,getData:getCustomData,resetResponse:resetResponse,destroy:destroy,getState:getState,setState:setState,enable:enable,disable:disable,
clearText:clearText,setText:setText}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    		<option value="'+escapeExpression((stack1=null==data||data===!1?data:data.key,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    	"}function program2(depth0,data){return'selected="selected"'}function program4(depth0,data){var stack1,helper,buffer="";return buffer+='\n            <option value="'+escapeExpression((stack1=null==data||data===!1?data:data.key,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n        "}function program6(depth0,data){return'style="display:none"'}function program8(depth0,data){var stack1,helper;return(helper=helpers.patternMask)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.patternMask,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}function program10(depth0,data){var stack1,helper,buffer="";return buffer+='value="',(helper=helpers.maxLength)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.maxLength,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"'}function program12(depth0,data){var stack1,helper,buffer="";return buffer+='value="',(helper=helpers.maxWords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxWords,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"'}function program14(depth0,data){var stack1,helper;return(helper=helpers.expectedLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expectedLength,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),escapeExpression(stack1)}function program16(depth0,data){var stack1,helper;return(helper=helpers.expectedLines)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expectedLines,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),escapeExpression(stack1)}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="panel">\n    <label for="format" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Format",options):helperMissing.call(depth0,"__","Format",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Used to control the format of the text entered by the candidate.",options):helperMissing.call(depth0,"__","Used to control the format of the text entered by the candidate.",options)))+'</span>\n    <select name="format" class="select2" data-has-search="false">\n    	',stack1=helpers.each.call(depth0,depth0&&depth0.formats,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </select>\n</div>\n<hr>\n<div class="panel">\n    <h3 class="full-width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Contraints",options):helperMissing.call(depth0,"__","Contraints",options)))+'</h3>\n    <select name="constraint" class="select2" data-has-search="false">\n        ',stack1=helpers.each.call(depth0,depth0&&depth0.constraints,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </select>\n</div>\n<div class="panel extendedText">\n    \n    <div id="constraint-pattern" ',
stack1=helpers.unless.call(depth0,(stack1=depth0&&depth0.constraints,stack1=null==stack1||stack1===!1?stack1:stack1.pattern,null==stack1||stack1===!1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        <label>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"pattern",options):helperMissing.call(depth0,"__","pattern",options)))+'\n        </label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid",options):helperMissing.call(depth0,"__","If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid",options)))+'</span>\n        <input type="text" name="patternMask" value="',stack1=helpers["if"].call(depth0,depth0&&depth0.patternMask,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"/>\n    </div>\n    \n    <div id="constraint-maxLength" ',
stack1=helpers.unless.call(depth0,(stack1=depth0&&depth0.constraints,stack1=null==stack1||stack1===!1?stack1:stack1.maxLength,null==stack1||stack1===!1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n        <label class="spinner">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max length",options):helperMissing.call(depth0,"__","Max length",options)))+'\n        </label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"We will use the patternMask to do this, to be compliant with the IMS standard",options):helperMissing.call(depth0,"__","We will use the patternMask to do this, to be compliant with the IMS standard",options)))+'</span>\n        <input type="text" data-min="0" data-increment="1" class="incrementer" name="maxLength" ',stack1=helpers["if"].call(depth0,depth0&&depth0.maxLength,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\n    </div>\n    \n    <div id="constraint-maxWords" ',stack1=helpers.unless.call(depth0,(stack1=depth0&&depth0.constraints,
stack1=null==stack1||stack1===!1?stack1:stack1.maxWords,null==stack1||stack1===!1?stack1:stack1.selected),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n        <label class="spinner">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max words",options):helperMissing.call(depth0,"__","Max words",options)))+'\n        </label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"We will use the patternMask to do this, to be compliant with the IMS standard",options):helperMissing.call(depth0,"__","We will use the patternMask to do this, to be compliant with the IMS standard",options)))+'</span>\n        <input type="text" data-min="0" data-increment="1" class="incrementer" name="maxWords" ',stack1=helpers["if"].call(depth0,depth0&&depth0.maxWords,{hash:{},inverse:self.noop,fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n    </div>\n</div>\n<hr>\n<div class="panel extendedText">\n    <h3 class="full-width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Recommendations",options):helperMissing.call(depth0,"__","Recommendations",options)))+'</h3>\n    <label class="spinner">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Length",options):helperMissing.call(depth0,"__","Length",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters.",options):helperMissing.call(depth0,"__","Provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters.",options)))+'</span>\n    <input type="text" data-min="0" data-increment="1" class="incrementer" name="expectedLength" value="',
stack1=helpers["if"].call(depth0,depth0&&depth0.expectedLength,{hash:{},inverse:self.noop,fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"/>\n    <label for="" class="spinner">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Lines",options):helperMissing.call(depth0,"__","Lines",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Provides a hint to the candidate as to the expected number of lines of input required. A line is expected to have about 72 characters.",options):helperMissing.call(depth0,"__","Provides a hint to the candidate as to the expected number of lines of input required. A line is expected to have about 72 characters.",options)))+'</span>\n    <input type="text" class="incrementer" data-min="0" data-increment="1" name="expectedLines" value="',
stack1=helpers["if"].call(depth0,depth0&&depth0.expectedLines,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/extendedText"],function($,_,__,stateFactory,Question,formElement,renderer,formTpl){
"use strict";function parsePattern(pattern,type){if(void 0===pattern||null===pattern)return null;if("words"===type){var result=pattern.match(regexWords);return null!==result&&result.length>1?result[1]:null}if("chars"===type){var result=pattern.match(regexChar);return null!==result&&result.length>1?result[1]:null}return null}var initState=function(){renderer.disable(this.widget.element)},exitState=function(){renderer.enable(this.widget.element)},regexChar=/\^\[\\s\\S\]\{\d+\,(\d+)\}\$/,regexWords=/\^\(\?\:\(\?\:\[\^\\s\\:\\!\\\?\\\;\\\\\\\]\+\)\[\\s\\:\\!\\\?\\;\\\\\\\]\*\)\{\d+\,(\d+)\}\$/,ExtendedTextInteractionStateQuestion=stateFactory.extend(Question,initState,exitState);
return ExtendedTextInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element,format=interaction.attr("format"),patternMask=interaction.attr("patternMask"),expectedLength=parseInt(interaction.attr("expectedLength"),10),expectedLines=parseInt(interaction.attr("expectedLines"),10),maxWords=parseInt(parsePattern(patternMask,"words"),10),maxChars=parseInt(parsePattern(patternMask,"chars"),10),formats={plain:{label:__("Plain text"),selected:!1},preformatted:{label:__("Pre-formatted text"),selected:!1},xhtml:{label:__("XHTML"),selected:!1}},constraints={none:{label:__("None"),selected:!0},maxLength:{
label:__("Max Length"),selected:!1},maxWords:{label:__("Max Words"),selected:!1},pattern:{label:__("Pattern"),selected:!1}};!isNaN(maxWords)&&maxWords>0?(constraints.none.selected=!1,constraints.maxWords.selected=!0):!isNaN(maxChars)&&maxChars>0?(constraints.none.selected=!1,constraints.maxLength.selected=!0):null!==patternMask&&void 0!==patternMask&&""!==patternMask&&(constraints.none.selected=!1,constraints.pattern.selected=!0),formats[format]&&(formats[format].selected=!0),$form.html(formTpl({formats:formats,patternMask:patternMask,maxWords:maxWords,maxLength:maxChars,expectedLength:expectedLength,expectedLines:expectedLines,constraints:constraints})),formElement.initWidget($form);
var callbacks={};callbacks.format=function(interaction,attrValue){var response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect()),previousFormat=interaction.attr("format");renderer.destroy(interaction),interaction.attr("format",attrValue),renderer.render(interaction),"xhtml"===previousFormat&&"undefined"!=typeof correctResponse[0]&&response.setCorrect($("<p>"+correctResponse[0]+"</p>").text())},callbacks.constraint=function(interaction,attrValue){$('[id|="constraint"]').hide("500"),$("#constraint-"+attrValue).show("1000"),"none"===attrValue&&(interaction.attr("patternMask",null),$('[name="maxWords"]').val(""),$('[name="maxLength"]').val(""));
},callbacks.maxWords=function(interaction,attrValue){$('[name="maxLength"]').val(""),$('[name="patternMask"]').val("");var newValue=parseInt(attrValue,10);if(!isNaN(newValue)){var newPattern="/^(?:(?:[^\\s\\:\\!\\?\\;\\\\]+)[\\s\\:\\!\\?\\;\\\\]*){0,"+newValue.toString()+"}$/";interaction.attr("patternMask",newPattern)}},callbacks.maxLength=function(interaction,attrValue){$('[name="maxWords"]').val(""),$('[name="patternMask"]').val("");var newValue=parseInt(attrValue,10);if(!isNaN(newValue)){var newPattern="/^[\\s\\S]{0,"+newValue.toString()+"}$/";interaction.attr("patternMask",newPattern)}},callbacks.patternMask=function(interaction,attrValue){interaction.attr("patternMask",attrValue),
$('[name="maxWords"]').val(""),$('[name="maxLength"]').val("")},callbacks.expectedLength=function(interaction,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)?interaction.attr("expectedLength",-1):interaction.attr("expectedLength",attrValue)},callbacks.expectedLines=function(interactions,attrValue){var newValue=parseInt(attrValue,10);isNaN(newValue)?interaction.attr("expectedLines",-1):interaction.attr("expectedLines",attrValue)},formElement.setChangeCallbacks($form,interaction,callbacks)},ExtendedTextInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){
"use strict";var ExtendedTextInteractionStateAnswer=stateFactory.extend(Answer,function(){this.widget.changeState("correct")},function(){});return ExtendedTextInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function(_,__,stateFactory,Correct,renderer,instructionMgr){var ExtendedTextInteractionStateCorrect=stateFactory.create(Correct,function(){
_createResponseWidget(this.widget)},function(){_destroyResponseWidget(this.widget)}),_createResponseWidget=function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect());renderer.enable(interaction),renderer.setText(interaction,correctResponse[0]),instructionMgr.appendInstruction(interaction,__("Please type the correct response below.")),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect([renderer.getResponse(interaction).base.string])})},_destroyResponseWidget=function(widget){var interaction=widget.element;renderer.clearText(interaction),instructionMgr.removeInstructions(widget.element),
widget.$container.off("responseChange.qti-widget")};return ExtendedTextInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction"],function(stateFactory,Sleep,renderer){"use strict";var ExtendedTextInteractionStateSleep=stateFactory.extend(Sleep,function(){renderer.disable(this.widget.element)},function(){});return ExtendedTextInteractionStateSleep}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/Sleep"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/states/states"],function(Widget,states){"use strict";var ExtendedTextInteractionWidget=Widget.clone();return ExtendedTextInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},ExtendedTextInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/ExtendedTextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/ExtendedTextInteraction","taoQtiItem/qtiCreator/widgets/interactions/extendedTextInteraction/Widget"],function(_,ExtendedTextInteraction,ExtendedTextInteractionWidget){
"use strict";var CreatorExtendedTextInteraction=_.clone(ExtendedTextInteraction);return CreatorExtendedTextInteraction.render=function(interaction,options){ExtendedTextInteraction.render(interaction),ExtendedTextInteractionWidget.build(interaction,ExtendedTextInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorExtendedTextInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,
stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-gapMatchInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="gapMatchInteraction">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <ul class="choice-area none block-listing solid horizontal source" data-eyecatcher=">li">\n        ',
options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </ul>\n    <div class="instruction-container"></div>\n    <div class="qti-flow-container">',(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction",["lodash","i18n","jquery","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/gapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,$,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var _choiceUsages={},setChoice=function(interaction,$choice,$target){var choiceSerial=$choice.data("serial"),choice=interaction.getChoice(choiceSerial);
_choiceUsages[choiceSerial]||(_choiceUsages[choiceSerial]=0),_choiceUsages[choiceSerial]++,$target.data("serial",choiceSerial).html($choice.html()).addClass("filled"),!interaction.responseMappingMode&&choice.attr("matchMax")&&_choiceUsages[choiceSerial]>=choice.attr("matchMax")&&$choice.attr("class","deactivated"),containerHelper.triggerResponseChangeEvent(interaction)},unsetChoice=function(interaction,$choice,animate){var serial=$choice.data("serial"),$container=containerHelper.get(interaction);$container.find(".choice-area [data-serial="+serial+"]").removeClass().addClass("qti-choice"),_choiceUsages[serial]--,$choice.removeClass("filled").removeData("serial").empty(),
interaction.swapping||containerHelper.triggerResponseChangeEvent(interaction)},getChoice=function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".choice-area [data-identifier="+identifier+"]",$container)},getGap=function(interaction,identifier){var $container=containerHelper.get(interaction);return $(".qti-flow-container [data-identifier="+identifier+"]",$container)},render=function(interaction){var $container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$flowContainer=$container.find(".qti-flow-container"),$activeChoice=null,_getChoice=function(serial){return $choiceArea.find("[data-serial="+serial+"]");
},_setChoice=function($choice,$target){return setChoice(interaction,$choice,$target)},_resetSelection=function(){$activeChoice&&($flowContainer.find(".remove-choice").remove(),$activeChoice.removeClass("deactivated active"),$container.find(".empty").removeClass("empty"),$activeChoice=null)},_unsetChoice=function($choice){return unsetChoice(interaction,$choice)},_isInsertionMode=function(){return $activeChoice&&!$activeChoice.hasClass("filled")},_isModeEditing=function(){return $activeChoice&&$activeChoice.hasClass("filled")};$container.on("mousedown.commonRenderer",function(e){_resetSelection()}),$choiceArea.on("mousedown.commonRenderer",">li",function(e){return e.stopPropagation(),
$activeChoice&&$(this).hasClass("active")||$(this).hasClass("deactivated")?void e.preventDefault():(_resetSelection(),$activeChoice=$(this).addClass("active"),void $flowContainer.find(".gapmatch-content").addClass("empty"))}),$flowContainer.on("mousedown.commonRenderer",".gapmatch-content",function(e){if(e.stopPropagation(),_isInsertionMode()){var $target=$(this),choiceSerial=$activeChoice.data("serial"),targetSerial=$target.data("serial");targetSerial!==choiceSerial&&(targetSerial&&_unsetChoice($target),_setChoice($activeChoice,$target)),$activeChoice.removeClass("active"),$container.find(".empty").removeClass("empty"),$activeChoice=null}else if(_isModeEditing()){
var $target=$(this),targetSerial=$target.data("serial"),choiceSerial=$activeChoice.data("serial");targetSerial!==choiceSerial&&(_unsetChoice($activeChoice),targetSerial&&(_unsetChoice($target),_setChoice(_getChoice(targetSerial),$activeChoice)),_setChoice(_getChoice(choiceSerial),$target)),_resetSelection()}else if($(this).data("serial")&&$(this).hasClass("filled")){var serial=$(this).data("serial");$activeChoice=$(this),$activeChoice.addClass("active"),$flowContainer.find(">li>div").filter(function(){return $(this).data("serial")!==serial}).addClass("empty"),$choiceArea.find(">li:not(.deactivated)").filter(function(){return $(this).data("serial")!==serial}).addClass("empty");
var $bin=$("<span>",{"class":"icon-undo remove-choice",title:__("remove")});$bin.on("mousedown",function(e){e.stopPropagation(),_unsetChoice($activeChoice),_resetSelection()}),$(this).append($bin)}})},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$(".gapmatch-content .active",$container).trigger("mousedown.commonRenderer"),$(".gapmatch-content",$container).each(function(){unsetChoice(interaction,$(this))})},_setPairs=function(interaction,pairs){_.each(pairs,function(pair){pair&&setChoice(interaction,getChoice(interaction,pair[0]),getGap(interaction,pair[1]).find(".gapmatch-content"))})},setResponse=function(interaction,response){
resetResponse(interaction),_setPairs(interaction,pciResponse.unserialize(response,interaction))},_getRawResponse=function(interaction){var response=[],$container=containerHelper.get(interaction);return $(".gapmatch-content",$container).each(function(){var choiceSerial=$(this).data("serial"),pair=[];choiceSerial&&pair.push(interaction.getChoice(choiceSerial).attr("identifier")),pair.push($(this).data("identifier")),2===pair.length&&response.push(pair)}),response},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);$(document).off(".commonRenderer"),
$container.off(".commonRenderer"),$container.find(".choice-area").off(".commonRenderer"),$container.find(".qti-flow-container").off(".commonRenderer"),$container.find(".gapmatch-content").empty(),$container.find(".active").removeClass("active"),$container.find(".remove-choice").remove(),$container.find(".empty").removeClass("empty"),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){
var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:bIndex>aIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"gapMatchInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,
getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("taoQtiItem/qtiCreator/widgets/helpers/textWrapper",["jquery"],function($){function getSelection(){var selection;return window.getSelection?selection=window.getSelection():document.selection&&(selection=document.selection.createRange()),selection}function containElement(selection,range){if(1===range.commonAncestorContainer.nodeType)for(var selectedChildNodes=range.cloneContents().childNodes,i=0;i<selectedChildNodes.length;i++)if(selectedChildNodes[i].className&&selectedChildNodes[i].className.indexOf("qti-choice")>-1)return!0;return!1}function wrapSelection(wrap){
var sel=getSelection();if(sel.rangeCount){var range=sel.getRangeAt(0).cloneRange();if(range.startOffset!==range.endOffset&&range.toString().trim()&&!containElement(sel,range))return range.surroundContents(wrap),sel.removeAllRanges(),sel.addRange(range),!0}return!1}function unwrapSelection($editable){$editable.trigger("beforeunwrap"),$editable.find("#selection-wrapper").replaceWith(function(){return $(this).html()}),$editable.trigger("unwrapped")}var textWrapper={create:function($editable){textWrapper.destroy($editable),$editable.on("mouseup.textwrapper",function(e){var $target=$(e.target);if(!$target.hasClass("html-editable-shield")&&!$target.hasClass("widget-box")){
var $wrapper=$("<span>",{id:"selection-wrapper","class":"inline-text-wrapper"});if(wrapSelection($wrapper[0])){var wrappedText=$wrapper.text().trim();$editable.trigger("wrapped",[$wrapper,wrappedText])}}}).on("mousedown.textwrapper",function(){unwrapSelection($editable)})},destroy:function($editable){unwrapSelection($editable),$editable.off(".textwrapper")},unwrap:function($editable){unwrapSelection($editable)}};return textWrapper}),define("taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question",["lodash","jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/textWrapper","tpl!taoQtiItem/qtiCreator/tpl/toolbars/htmlEditorTrigger"],function(_,$,stateFactory,Question,htmlEditor,gridContentHelper,htmlContentHelper,textWrapper,toolbarTpl){
"use strict";var ContainerInteractionStateQuestion=stateFactory.extend(Question,function(){this.buildEditor()},function(){this.destroyTextWrapper(),this.destroyEditor()});return ContainerInteractionStateQuestion.prototype.buildEditor=function(){var _this=this,_widget=this.widget,container=_widget.element.getBody(),$container=_widget.$container,$editableContainer=$container.find(".qti-flow-container");if($editableContainer.attr("data-html-editable-container",!0),!htmlEditor.hasEditor($editableContainer)){var $bodyTlb=$(toolbarTpl({serial:_widget.serial,state:"question"}));$editableContainer.append($bodyTlb),$bodyTlb.show(),_this.initTextWrapper(),$container.find(".gapmatch-content").html("..."),
htmlEditor.buildEditor($editableContainer,{shieldInnerContent:!1,change:gridContentHelper.getChangeCallbackForBlockStatic(container),markupChange:function(){textWrapper.unwrap(this)},data:{container:container,widget:_widget}}),$container.find(".gapmatch-content").empty()}},ContainerInteractionStateQuestion.prototype.destroyEditor=function(){var $container=this.widget.$container,$flowContainer=$container.find(".qti-flow-container");$container.find(".gapmatch-content").html("..."),htmlEditor.destroyEditor($flowContainer),$container.find(".gapmatch-content").empty(),$flowContainer.find(".mini-tlb[data-role=cke-launcher-tlb]").remove()},ContainerInteractionStateQuestion.prototype.initTextWrapper=function(){
var widget=this.widget,interaction=widget.element,$editable=widget.$container.find(".qti-flow-container [data-html-editable]"),gapModel=this.getGapModel(),$gapTlb=$(gapModel.toolbarTpl()).show();$gapTlb.on("mousedown",function(e){e.stopPropagation();var $wrapper=$gapTlb.parent(),text=$wrapper.text().trim();$gapTlb.detach(),$wrapper.removeAttr("id").addClass("widget-box").attr("data-new",!0).attr("data-qti-class",gapModel.qtiClass),textWrapper.destroy($editable),htmlContentHelper.createElements(interaction.getBody(),$editable,htmlEditor.getData($editable),function(newGapWidget){newGapWidget.changeState("question"),textWrapper.create($editable),gapModel.afterCreate(widget,newGapWidget,_.escape(text));
})}).on("mouseup",function(e){e.stopPropagation()}),$editable.on("editorready.wrapper",function(){textWrapper.create($(this))}).on("wrapped.wrapper",function(e,$wrapper){$wrapper.append($gapTlb)}).on("beforeunwrap.wrapper",function(){$gapTlb.detach()})},ContainerInteractionStateQuestion.prototype.destroyTextWrapper=function(){var $editable=this.widget.$container.find(".qti-flow-container [data-html-editable]");textWrapper.destroy($editable),$editable.off(".wrapper")},ContainerInteractionStateQuestion.prototype.getGapModel=function(){this.throwMissingRequiredImplementationError("getModel")},ContainerInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question"],function(factory,states){
return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/gapMatch",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',options):helperMissing.call(depth0,"__",'If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be "shuffled" of "fixed" individually.',options)))+"\n    </span>\n</div>";
})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap-create",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<span class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-role="create-gap-tlb">\n    <span class="rgt tlb-button" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Create gap",options):helperMissing.call(depth0,"__","Create gap",options)))+'" data-role="create-gap">\n        <span class="icon-magicwand"></span>\n    </span>\n</span>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/gapMatch","tpl!taoQtiItem/qtiCreator/tpl/toolbars/gap-create","lodash"],function(stateFactory,Question,formElement,formTpl,gapTpl,_){
"use strict";var GapMatchInteractionStateQuestion=stateFactory.extend(Question,function(){this.syncCardinality(),this.preventSingleChoiceDeletion()},function(){this.widget.offEvents("question")});return GapMatchInteractionStateQuestion.prototype.syncCardinality=function(){var interaction=this.widget.element,response=interaction.getResponseDeclaration(),updateCardinality=function(data){var cardinality,choice=data.element||data.choice;"gap"===choice.qtiClass&&(cardinality=1===_.size(interaction.getGaps())?"single":"multiple",response.attr("cardinality",cardinality))};this.widget.on("elementCreated",updateCardinality).on("deleted",updateCardinality)},GapMatchInteractionStateQuestion.prototype.initForm=function(){
var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({shuffle:!!interaction.attr("shuffle")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{shuffle:formElement.getAttributeChangeCallback()})},GapMatchInteractionStateQuestion.prototype.getGapModel=function(){return{toolbarTpl:gapTpl,qtiClass:"gap",afterCreate:function(interactionWidget,newGapWidget,text){var choice,choiceWidget;choice=interactionWidget.element.createChoice(text),interactionWidget.$container.find(".choice-area .add-option").before(choice.render()),choice.postRender(),choiceWidget=choice.data("widget"),choiceWidget.changeState("question"),
newGapWidget.changeState("choice")}}},GapMatchInteractionStateQuestion.prototype.preventSingleChoiceDeletion=function(){var interaction=this.widget.element,$container=this.widget.$container,_toggleDeleteButtonVisibility=function(){var choiceCount=0,$deleteButtons=$container.find(".choice-area .qti-choice [data-role=delete]");_.each(interaction.getChoices(),function(choice){choice.data("deleting")||choiceCount++}),1>=choiceCount?$deleteButtons.hide():$deleteButtons.show()};_toggleDeleteButtonVisibility(),this.widget.on("deleted",_toggleDeleteButtonVisibility).on("choiceCreated",_toggleDeleteButtonVisibility),this.widget.afterStateInit(function(e,element,state){
"deleting"===state.name&&element.is("gapText")&&_toggleDeleteButtonVisibility()},"question"),this.widget.afterStateExit(function(e,element,state){"deleting"===state.name&&element.is("gapText")&&_toggleDeleteButtonVisibility()},"question")},GapMatchInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var GapMatchInteractionStateAnswer=stateFactory.extend(Answer,function(){answerStateHelper.forward(this.widget);
},function(){});return GapMatchInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){var GapMatchInteractionStateCorrect=stateFactory.create(Correct,function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());
commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please fill the gap with the correct choices.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.invoke(corrects,String.prototype.split," "),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list";data.response&&data.response[type]&&("base"===type?response.setCorrect(data.response.base.directedPair.join(" ")):response.setCorrect(_.map(data.response.list.directedPair,function(pair){
return pair.join(" ")})))})},function(){var widget=this.widget,interaction=this.widget.element;widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction)});return GapMatchInteractionStateCorrect}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreMappingForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n                    <option value="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</option> \n                    "}function program3(depth0,data){return'style="display:block"'}function program5(depth0,data){var stack1,buffer="";return buffer+="\n            ",stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+='    <div class="form-container">\n        <h1>',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</h1>\n\n        <hr />\n        <div class="panel grid-row">\n            <h2>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add new pairs",options):helperMissing.call(depth0,"__","Add new pairs",options)))+':</h2>\n        </div> \n        <div class="panel grid-row">\n            <div class="col-4">\n                <select class="select2 new-pair-left" data-placeholder="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Select a ",options):helperMissing.call(depth0,"__","Select a ",options))),(helper=helpers.leftTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.leftTitle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                    <option></option>\n                    ',stack1=helpers.each.call(depth0,depth0&&depth0.pairLeft,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                </select>\n             </div>\n             <div class="col-4">\n                <select class="select2 new-pair-right"  data-placeholder="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Select a ",options):helperMissing.call(depth0,"__","Select a ",options))),(helper=helpers.rightTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.rightTitle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                    <option></option>\n                    ',stack1=helpers.each.call(depth0,depth0&&depth0.pairRight,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                </select>\n             </div>\n             <div class="col-1">\n                &nbsp;\n            </div>\n             <div class="col-2">\n                <button class="pair-adder btn-info small"><span class="icon-add"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Add",options):helperMissing.call(depth0,"__","Add",options)))+'</button>\n            </div> \n        </div>\n        <hr />\n        <div class="panel grid-row heading">\n             <div class="col-4">',(helper=helpers.leftTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.leftTitle,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</div>\n             <div class="col-3">',(helper=helpers.rightTitle)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.rightTitle,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</div>\n            \n            <div class="col-2" data-edit="correct" ',stack1=helpers["if"].call(depth0,depth0&&depth0.defineCorrect,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n                <span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Correct",options):helperMissing.call(depth0,"__","Correct",options)))+'</span>\n                <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n                <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Is this pair the correct response?",options):helperMissing.call(depth0,"__","Is this pair the correct response?",options)))+'</span>\n            </div>\n\n            <div class="col-2">\n                <span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Score",options):helperMissing.call(depth0,"__","Score",options)))+'</span>\n                <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n                <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Set the score for this response",options):helperMissing.call(depth0,"__","Set the score for this response",options)))+'</span>\n            </div>\n            <div class="col-1"></div>\n        </div>\n\n        <div class="panel pairs">\n        ',stack1=helpers.each.call(depth0,depth0&&depth0.pairs,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </div>\n\n        <hr />\n\n        <span class="arrow"></span>\n        <span class="arrow-cover"></span>\n    </div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreForm",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'style="display:block"'}function program3(depth0,data){return' checked="checked"'}function program5(depth0,data){return'data-default="true"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",self=this,escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="grid-row">\n    <div class="col-4">\n       ',(helper=helpers.left)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.left,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </div>\n    <div class="col-3">\n       ',(helper=helpers.right)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.right,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    </div>\n    \n    <div class="col-2" data-edit="correct" ',stack1=helpers["if"].call(depth0,depth0&&depth0.defineCorrect,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='>\n        <label>\n            <input name="',(helper=helpers.id)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-correct" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\n            <span class="icon-checkbox"></span>\n        </label>\n    </div>\n\n    <div class="col-2">\n        <input type="text" \n               value="',(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n               name="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-score" \n               class="score" \n               ',stack1=helpers["if"].call(depth0,depth0&&depth0.defaultScore,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='  \n               data-validate="$numeric" \n               data-validate-option="$allowEmpty; $event(type=keyup)" \n        />\n    </div>\n    <div class="col-1">\n        <a href="#" class="pair-deleter" id="',
(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'-delete" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove pair",options):helperMissing.call(depth0,"__","Remove pair",options)))+'"><span class="icon-bin"></span></a>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreMappingForm","tpl!taoQtiItem/qtiCreator/tpl/forms/response/pairScoreForm","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/tooltipster","ui/selecter"],function($,_,__,formTpl,pairTpl,answerStateHelper,formElementHelper,tooltipster,selecter){
function createPopup($container){var $element=$('<div class="mapping-editor arrow-top-left"></div>'),width=$container.innerWidth(),height=$container.innerHeight();return $(".mapping-editor",$container).remove(),$element.css({top:height-30,width:width-100}).appendTo($container),$element}var separator={html:"::",qti:" "};return function(widget,options){function adder($container){var $adder=($(".panel-new-pair",$container),$(".pair-adder",$container)),$left=$(".new-pair-left",$container),$right=$(".new-pair-right",$container),$options=$(".select2 > option",$container);$left.on("change",function(){var currentLeft=$left.select2("val"),currentRight=$right.select2("val");
$options.removeProp("disabled"),_(pairs).where({leftId:currentLeft}).forEach(function(pair){$right.find('option[value="'+pair.rightId+'"]').prop("disabled",!0)}),_(pairs).where({rightId:currentRight}).forEach(function(pair){$left.find('option[value="'+pair.leftId+'"]').prop("disabled",!0)}),"pair"===options.type&&_(pairs).where({rightId:currentLeft}).forEach(function(pair){$right.find('option[value="'+pair.leftId+'"]').prop("disabled",!0)})}),$right.on("change",function(){var currentRight=$right.select2("val"),currentLeft=$left.select2("val");$options.removeProp("disabled"),_(pairs).where({rightId:currentRight}).forEach(function(pair){$left.find('option[value="'+pair.leftId+'"]').prop("disabled",!0);
}),_(pairs).where({leftId:currentLeft}).forEach(function(pair){$right.find('option[value="'+pair.rightId+'"]').prop("disabled",!0)}),"pair"===options.type&&_(pairs).where({leftId:currentRight}).forEach(function(pair){$left.find('option[value="'+pair.rightId+'"]').prop("disabled",!0)})}),$adder.on("click",function(e){$options.removeProp("disabled"),e.preventDefault();var key,lval=$left.select2("val"),rval=$right.select2("val");lval&&rval&&(key=lval+separator.qti+rval,pairScoringForm.addPair(key),$left.select2("val",""),$right.select2("val",""))})}function deleter($container){$container.off("click",".pair-deleter").on("click",".pair-deleter",function(e){e.preventDefault();
var $elt=$(this),key=$elt.attr("id").replace(/-delete$/,"").replace(separator.html,separator.qti);pairScoringForm.removePair(key),$elt.closest(".grid-row").remove()})}function preparePairs(entries){var defaultScore=parseFloat(response.mappingAttributes.defaultValue);return _.map(entries,function(value,key){return formatPair(value,key,parseFloat(value)===defaultScore)})}function formatPair(score,key,defaultScore){var pair=key.split(separator.qti);return{id:key.replace(separator.qti,separator.html),score:score,defaultScore:!!defaultScore,leftId:pair[0],rightId:pair[1],left:_.isFunction(options.formatLeft)?options.formatLeft(pair[0]):pair[0],right:_.isFunction(options.formatRight)?options.formatRight(pair[1]):pair[1],
defineCorrect:answerStateHelper.defineCorrect(response),correct:_.contains(_.values(response.getCorrect()),key)}}function updateFormBindings(){var callbacks={},corrects=_.values(response.getCorrect());$form.length&&(widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&_.forEach(pairs,function(pair){var $score=$('[name="'+pair.id+'-score"]',$form);$score.data("default")&&($score.val(data.value),response.setMapEntry(pair.id.replace(separator.html,separator.qti),data.value))})}),_.forEach(pairs,function(pair){var id=pair.id.replace(separator.html,separator.qti);callbacks[pair.id+"-score"]=function(response,value){$('[name="'+pair.id+'-score"]',$form).removeAttr("data-default").removeData("default"),
response.setMapEntry(id,value)},callbacks[pair.id+"-correct"]=function(response,value){value===!0?_.contains(corrects,id)||corrects.push(id):corrects=_.without(corrects,id),response.setCorrect(corrects)}}),formElementHelper.setChangeCallbacks($form,response,callbacks))}var $form,$container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),$popup=[],pairs=[],pairScoringForm={load:function(){var mapEntries=(_.values(response.getCorrect()),response.getMapEntries());return $popup.length?$popup.empty():$popup=createPopup($container),options&&(options.entries?(pairs=preparePairs(options.entries),response.removeMapEntries(),_.forEach(pairs,function(pair){
("undefined"==typeof pair.score||null===pair.score)&&(pair.score=response.mappingAttributes.defaultValue||0),response.setMapEntry(pair.id.replace(separator.html,separator.qti),pair.score)})):pairs=preparePairs(mapEntries),$form=$(formTpl({title:options.title||__("Pair scoring"),leftTitle:options.leftTitle||__("Choices"),rightTitle:options.rightTitle||__("Gaps"),defineCorrect:answerStateHelper.defineCorrect(response),scoreMin:response.getMappingAttribute("lowerBound"),scoreMax:response.getMappingAttribute("upperBound"),pairs:_.map(pairs,pairTpl),pairLeft:_.isFunction(options.pairLeft)?options.pairLeft():_.values(interaction.getChoices()),pairRight:_.isFunction(options.pairRight)?options.pairRight():_.values(interaction.getChoices())
})),updateFormBindings(),$popup.append($form),selecter($popup),tooltipster($popup),deleter($popup),adder($popup)),this},addPair:function(key){var score=response.mappingAttributes.defaultValue,pair=formatPair(score,key,!0);return pairs.push(pair),response.setMapEntry(key,score),$(".pairs",$popup).append(pairTpl(pair)),updateFormBindings(),_.isFunction(options.add)&&options.add(key),this},removePair:function(key){return _.remove(pairs,{id:key.replace(separator.qti,separator.html)}),response.removeMapEntry(key),_.isFunction(options.remove)&&options.remove(key),this},destroy:function(){$popup.length&&$popup.remove(),$("#item-editor-panel").css("overflow","")}};return pairScoringForm.load();
}}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,PciResponse,scoringFormFactory){function initMapState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());
0===_.size(response.getMapEntries())?corrects:_.keys(response.getMapEntries());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please fill the gap with the texts below, then edit the score for each pair.")),interaction.responseMappingMode=!0,commonRenderer.render.call(interaction.getRenderer(),interaction),displayGaps(widget.$container),0===_.size(response.getMapEntries())?updateForm(widget,corrects):updateForm(widget),widget.$container.on("responseChange.qti-widget",function(e,data){var pairs,entries,type="single"===response.attr("cardinality")?"base":"list";data&&data.response&&data.response[type]&&(pairs=_.invoke(data.response[type].directedPair,Array.prototype.join," "),
entries=_.keys(response.getMapEntries()),_(pairs).difference(entries).forEach(interaction.pairScoringForm.addPair,interaction.pairScoringForm)),displayGaps(widget.$container)})}function exitMapState(){var widget=this.widget,interaction=widget.element;widget.$container.off("responseChange.qti-widget"),interaction.pairScoringForm&&interaction.pairScoringForm.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction)}function displayGaps($container){$(".gapmatch-content",$container).removeClass("filled").addClass("gap-info").each(function(){var $elt=$(this);$elt.text($elt.data("identifier"));
})}function updateForm(widget,entries){var interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),formatedChoices=_.transform(interaction.getChoices(),function(acc,choice){acc[choice.id()]=choice.val()},{}),options={leftTitle:__("Choice"),rightTitle:__("Gap"),type:"directedPair",pairLeft:function(){return _.map(interaction.getChoices(),function(choice){return{id:choice.id(),value:choice.val()}})},pairRight:function(){return _.map(interaction.getGaps(),function(gap){return{id:gap.id(),value:gap.id()}})},formatLeft:function(value){return formatedChoices[value]||value}};entries&&(options.entries=_.transform(entries,function(result,value){
result[value]=void 0!==mapEntries[value]?mapEntries[value]:response.mappingAttributes.defaultValue},{})),interaction.pairScoringForm=scoringFormFactory(widget,options)}return stateFactory.create(Map,initMapState,exitMapState)}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/Map"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/states/states"],function(Widget,states){var GapMatchInteractionWidget=Widget.clone();return GapMatchInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},GapMatchInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/gapMatchInteraction/Widget"],function(_,GapMatchInteraction,GapMatchInteractionWidget){
"use strict";var CreatorGapMatchInteraction=_.clone(GapMatchInteraction);return CreatorGapMatchInteraction.render=function(interaction,options){GapMatchInteractionWidget.build(interaction,GapMatchInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGapMatchInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicAssociateInteraction clearfix',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n';
})}),define("json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json",function(){return{basic:{stroke:"#8D949E","stroke-width":2,"stroke-dasharray":"","stroke-linejoin":"round",fill:"#cccccc","fill-opacity":.5,cursor:"pointer"},hover:{stroke:"#3E7DA7",fill:"#0E5D91","fill-opacity":.3},selectable:{"stroke-dasharray":"-",stroke:"#3E7DA7",fill:"#cccccc","fill-opacity":.5},active:{stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91","fill-opacity":.5},error:{stroke:"#C74155","stroke-dasharray":"","fill-opacity":.5,fill:"#661728"},success:{stroke:"#C74155","stroke-dasharray":"",fill:"#0E914B","fill-opacity":.5},layer:{fill:"#ffffff",opacity:0,cursor:"pointer"
},creator:{"fill-opacity":.5,stroke:"#3E7DA7","stroke-dasharray":"",fill:"#0E5D91",cursor:"pointer"},"imageset-rect-stroke":{fill:"#ffffff",stroke:"#666666","stroke-width":1,"stroke-linejoin":"round",cursor:"pointer"},"imageset-rect-no-stroke":{fill:"#ffffff",stroke:"#ffffff","stroke-width":2,"stroke-linejoin":"round",cursor:"pointer"},"imageset-img":{cursor:"pointer"},"order-text":{fill:"#ffffff",stroke:"#000000","stroke-width":.7,"font-family":"sans-serif","font-weight":"bold","font-size":22,cursor:"pointer"},"score-text-default":{stroke:"#444444","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"score-text":{
stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":20,cursor:"pointer"},"small-text":{stroke:"#000000","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":16,cursor:"pointer"},"layer-pos-text":{stroke:"#333","stroke-width":.5,"font-family":"sans-serif","font-weight":"normal","font-size":14},target:{path:"m 18,8.4143672 -1.882582,0 C 15.801891,4.9747852 13.071059,2.2344961 9.63508,1.9026738 L 9.63508,0 8.2305176,0 l 0,1.9026387 C 4.7947148,2.2343027 2.0637246,4.9746621 1.7481973,8.4143672 l -1.7481973,0 0,1.4045625 1.754877,0 c 0.3460429,3.4066753 3.0632871,6.1119843 6.4756406,6.4413813 l 0,1.739689 1.4045624,0 0,-1.739725 c 3.412547,-0.329537 6.129633,-3.034793 6.475641,-6.4413453 l 1.889279,0 z m -8.36492,6.5188648 0,-4.064673 -1.4045624,0 0,4.063882 C 5.5511016,14.612555 3.4232695,12.494619 3.0864551,9.8189297 l 4.0449512,0 0,-1.4045625 -4.0546368,0 C 3.3788672,5.6984941 5.5228887,3.5393379 8.2305176,3.2161113 l 0,3.9153125 1.4045624,0 0,-3.9160859 c 2.711162,0.3203965 4.858576,2.4808887 5.160955,5.1990293 l -3.927441,0 0,1.4045625 3.917773,0 C 14.449289,12.496957 12.318363,14.616158 9.63508,14.933232 z",
fill:"#0E914B",width:1,"stroke-width":0,cursor:"pointer"},"target-hover":{fill:"#3E7DA7","fill-opacity":1},"target-success":{fill:"#0E914B","fill-opacity":1},assoc:{"stroke-width":2,"stroke-linecap":"round",cursor:"pointer"},"assoc-layer":{"stroke-width":12,cursor:"pointer","stroke-opacity":0},"assoc-bullet":{fill:"#000000"},close:{path:"m 8.9997236,18.000001 c -4.9703918,0 -8.99972284217367,-4.02901 -8.99972284217367,-9 C 7.5782633e-7,4.029011 4.0293108,9.8531742e-7 8.9997236,9.8531742e-7 13.970691,9.8531742e-7 18.000001,4.029011 18.000001,9.000001 c 0,4.97099 -4.02931,9 -9.0002774,9 z m 0.0045,-16.37151 c -4.06191,0 -7.35492,3.29635 -7.35492,7.36251 0,4.06562 3.292989,7.36255 7.35492,7.36255 4.0630384,0 7.3554334,-3.29693 7.3554334,-7.36255 0,-4.06614 -3.292969,-7.36251 -7.3554334,-7.36251 v 0 z m 3.1314894,9.31167 -1.953823,-1.94014 1.953843,-1.94018 c 0.08964,-0.089 0.134622,-0.19099 0.135073,-0.30584 4.31e-4,-0.11488 -0.04383,-0.21712 -0.132838,-0.30681 l -0.54267,-0.54685 c -0.08898,-0.0897 -0.190903,-0.13473 -0.305719,-0.13514 -0.114837,-4.4e-4 -0.217064,0.0439 -0.306703,0.1329 l -1.9623724,1.94865 -1.962395,-1.94865 c -0.08964,-0.089 -0.191845,-0.13336 -0.306702,-0.1329 -0.114837,4.3e-4 -0.216736,0.0455 -0.305719,0.13514 l -0.54265,0.54685 c -0.08902,0.0897 -0.133269,0.19193 -0.132838,0.30681 4.3e-4,0.11485 0.04543,0.21681 0.135073,0.30584 l 1.953823,1.94018 -1.953782,1.94014 c -0.0896,0.089 -0.134684,0.19094 -0.135114,0.3058 -4.31e-4,0.11486 0.04386,0.21716 0.132838,0.30681 l 0.542671,0.54687 c 0.08896,0.0897 0.190923,0.13467 0.305718,0.13516 0.114857,3.9e-4 0.217105,-0.0439 0.306724,-0.13288 l 1.962332,-1.94863 1.9623324,1.94863 c 0.08962,0.089 0.191886,0.13323 0.306744,0.13288 0.114836,-4.5e-4 0.216736,-0.0455 0.305698,-0.13516 l 0.542691,-0.54687 c 0.089,-0.0897 0.133227,-0.19193 0.132838,-0.30681 -3.9e-4,-0.1149 -0.0455,-0.21683 -0.135073,-0.3058 z",
fill:"#0E5D91",width:1,opacity:0,"stroke-width":0,cursor:"pointer"},"close-bg":{fill:"#ffffff",stroke:"none",cursor:"pointer",opacity:0},"touch-circle":{fill:"none",stroke:"#3E7DA7","stroke-width":2}}}),define("taoQtiItem/qtiCommonRenderer/helpers/Graphic",["jquery","lodash","raphael","scale.raphael","json!taoQtiItem/qtiCommonRenderer/renderers/graphic-style.json"],function($,_,raphael,scaleRaphael,gstyle){"use strict";var shapeMap={"default":"rect",poly:"path"},coordsValidator={rect:4,ellipse:4,circle:3,poly:6,"default":0},qti2raphCoordsMapper={rect:function(coords){return[coords[0],coords[1],coords[2]-coords[0],coords[3]-coords[1]]},"default":function(paper){
return[0,0,paper.width,paper.height]},poly:function(coords){var a,size=coords.length;for(coords[0]!==coords[size-2]&&coords[1]!==coords[size-1]&&(coords.push(coords[0]),coords.push(coords[1])),coords[0]="M"+coords[0],a=1;size>a;a++)a%2===0&&(coords[a]="L"+coords[a]);return[coords.join(" ")]}},raph2qtiCoordsMapper={rect:function(attr){return[attr.x,attr.y,attr.x+attr.width,attr.y+attr.height]},circle:function(attr){return[attr.cx,attr.cy,attr.r]},ellipse:function(attr){return[attr.cx,attr.cy,attr.rx,attr.ry]},"default":function(attr){return this.rect(attr)},path:function(attr){var i,poly=[];if(_.isArray(attr.path))for(i=1;i<attr.path.length;i++)3===attr.path[i].length&&(poly.push(attr.path[i][1]),
poly.push(attr.path[i][2]));return poly}},GraphicHelper={_style:gstyle,setStyle:function(element,name){element&&gstyle[name]&&element.attr(gstyle[name])},responsivePaper:function(id,serial,options){function resizePaper(e,givenWidth){e&&e.stopPropagation();var factor=1,diff=$editor.outerWidth()-$editor.width()+($container.outerWidth()-$container.width())+1,maxWidth=$body.width(),containerWidth=$container.innerWidth();(containerWidth>0||givenWidth>0)&&(containerWidth>givenWidth&&maxWidth>givenWidth?containerWidth=givenWidth-diff:containerWidth>maxWidth?containerWidth=maxWidth-diff:containerWidth-=diff,$container.hasClass("responsive")?(factor=containerWidth/width,
paper.changeSize(containerWidth,height*factor,!1,!1),paper.scaleAll(factor)):paper.changeSize(containerWidth,height,!1,!1),"function"==typeof options.resize&&options.resize(containerWidth,factor),$container.trigger("resized.qti-widget"))}var paper,image,$container=options.container||$("#"+id).parent(),$editor=$(".image-editor",$container),$body=$container.closest(".qti-itemBody"),factory="SVG"===raphael.type?scaleRaphael:raphael,width=options.width||$container.innerWidth(),height=options.height||$container.innerHeight(),resizer=_.throttle(resizePaper,10);return paper=factory.call(null,id,width,height),image=paper.image(options.img,0,0,width,height),options.imgId&&(image.id=options.imgId),
$(image.node).attr("externalResourcesRequired","true").on("load",function(){resizePaper()}),"SVG"===raphael.type?(resizePaper(),$(window).on("resize.qti-widget."+serial,resizer),$(document).on("customcssloaded.styleeditor",function(){_.delay(resizer,200)}),$container.on("resize.qti-widget."+serial,function(e,givenWidth){resizer(e,givenWidth)})):(paper.canvas.setAttribute("viewBox","0 0 "+width+" "+height),$container.find(".main-image-box").width(width),"function"==typeof options.resize&&options.resize(width,1)),paper},createElement:function(paper,type,coords,options){var element,self=this,shaper=shapeMap[type]?paper[shapeMap[type]]:paper[type],shapeCoords=options.qtiCoords!==!1?self.raphaelCoords(paper,type,coords):coords;
if("function"!=typeof shaper)throw new Error("Unable to find method "+type+" on paper");return element=shaper.apply(paper,shapeCoords),element&&(options.id&&(element.id=options.id),options.title&&element.attr("title",options.title),element.attr(gstyle[options.style||"basic"]).toFront(),$(element.node).removeAttr("stroke-dasharray"),options.hover!==!1&&element.hover(function(){element.flashing||self.updateElementState(this,"hover")},function(){element.flashing||self.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")}),options.touchEffect!==!1&&element.touchstart(function(){self.createTouchCircle(paper,element.getBBox())})),element;
},createTarget:function(paper,options){var self=this;options=options||{};var tBBox,point=options.point||{x:0,y:0},baseSize=18,factor=paper.w&&paper.width?paper.width/paper.w:1,size=1!==factor?Math.floor(18/factor)+1:baseSize,half=size/2,x=point.x>=half?point.x-half:0,y=point.y>=half?point.y-half:0,hover="undefined"==typeof options.hover?!0:!!options.hover,target=paper.path(gstyle.target.path).transform("T"+x+","+y+"s"+size/baseSize).attr(gstyle.target).attr("title",_("Click again to remove"));if(options.id)target.id=options.id;else{var count=0;paper.forEach(function(element){element.data("target")&&count++}),target.id="target-"+count}tBBox=target.getBBox();var layer=paper.rect(tBBox.x,tBBox.y,tBBox.width,tBBox.height).attr(gstyle.layer).click(function(){
var id=target.id,point=this.data("point");_.isFunction(options.select)&&options.select(target,point,this),_.isFunction(options.remove)&&(this.remove(),target.remove(),options.remove(id,point))});return hover&&layer.hover(function(){target.flashing||self.setStyle(target,"target-hover")},function(){target.flashing||self.setStyle(target,"target-success")}),layer.id="layer-"+target.id,layer.data("point",point),target.data("target",point),_.isFunction(options.create)&&options.create(target),target},raphaelCoords:function(paper,type,coords){var shapeCoords;if(_.isString(coords)&&(coords=_.map(coords.split(","),function(coord){return parseInt(coord,10)})),!_.isArray(coords)||coords.length<coordsValidator[type])throw new Error("Invalid coords "+JSON.stringify(coords)+"  for type "+type);
switch(type){case"rect":shapeCoords=qti2raphCoordsMapper.rect(coords);break;case"default":shapeCoords=qti2raphCoordsMapper["default"].call(null,paper);break;case"poly":shapeCoords=qti2raphCoordsMapper.poly(coords);break;default:shapeCoords=coords}return shapeCoords},qtiCoords:function(element){var mapper=raph2qtiCoordsMapper[element.type],result="";return _.isFunction(mapper)&&(result=_.map(mapper.call(raph2qtiCoordsMapper,element.attr()),function(coord){return _.parseInt(coord)}).join(",")),result},createTouchCircle:function(paper,bbox){var radius=bbox.width>bbox.height?bbox.width:bbox.height,tCircle=paper.circle(bbox.x+bbox.width/2,bbox.y+bbox.height/2,radius);
tCircle.attr(gstyle["touch-circle"]),_.defer(function(){tCircle.animate({r:radius+5,opacity:.7},300,function(){tCircle.remove()})})},createText:function(paper,options){var fontSize,scaledFontSize,top=options.top||0,left=options.left||0,content=options.content||"",style=options.style||"small-text",title=options.title||"",factor=1;paper.width&&paper.w&&(factor=paper.width/paper.w);var text=paper.text(left,top,content).toFront();return options.id&&(text.id=options.id),options.hide&&text.hide(),text.attr(gstyle[style]),"undefined"!=typeof factor&&1!==factor&&(fontSize=parseInt(text.attr("font-size"),10),scaledFontSize=Math.floor(fontSize/factor)+1,text.attr("font-size",scaledFontSize)),
title&&this.updateTitle(text,title),text},createShapeText:function(paper,shape,options){var self=this,bbox=shape.getBBox(),text=this.createText(paper,_.merge({left:bbox.x+bbox.width/2,top:bbox.y+bbox.height/2},options));return options.shapeClick&&text.click(function(){self.trigger(shape,"click")}),text},createBorderedImage:function(paper,options){var padding=options.padding>=0?options.padding:6,halfPad=padding/2,rx=options.left,ry=options.top,rw=options.width+padding,rh=options.height+padding,ix=options.left+halfPad,iy=options.top+halfPad,iw=options.width,ih=options.height,set=paper.set(),rect=paper.rect(rx,ry,rw,rh).attr(options.border?gstyle["imageset-rect-stroke"]:gstyle["imageset-rect-no-stroke"]),image=paper.image(options.url,ix,iy,iw,ih).attr(gstyle["imageset-img"]);
return options.shadow&&set.push(rect.glow({width:2,offsetx:1,offsety:1})),set.push(rect,image),set.move=function(x,y,duration){var animation=raphael.animation({x:x,y:y},duration||400),elt=rect.animate(animation);return image.animateWith(elt,animation,{x:x+halfPad,y:y+halfPad},duration||400),set},set},updateElementState:function(element,state,title){element&&element.animate&&(element.animate(gstyle[state],200,"linear",function(){element.attr(gstyle[state]),$(element.node).removeAttr("stroke-dasharray")}),title&&this.updateTitle(element,title))},updateTitle:function(element,title){element&&element.node&&(_.forEach(element.node.children,function(child){"title"===child.nodeName.toLowerCase()&&element.node.removeChild(child);
}),element.attr("title",title))},highlightError:function(element,restoredState){var self=this;element&&(element.flashing=!0,self.updateElementState(element,"error"),_.delay(function(){self.updateElementState(element,restoredState||"basic"),element.flashing=!1},800))},trigger:function(element,event){var evt=_.where(element.events,{name:event});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.apply(element,Array.prototype.slice.call(arguments,2))},getPoint:function(event,paper,$container,isResponsive){var rwidth,rheight,wfactor,point=this.clickPoint($container,event);return paper.w&&paper.w!==paper.width&&(isResponsive?(wfactor=paper.w/paper.width,point.x=Math.round(point.x*wfactor),
point.y=Math.round(point.y*wfactor)):paper.width>paper.w?(rwidth=(paper.width-paper.w)/2,point.x=Math.round(point.x-rwidth)):(wfactor=paper.w/paper.width,point.x=Math.round(point.x*wfactor),rheight=(paper.height-paper.height*(2-wfactor))/2,point.y=Math.round(point.y*wfactor-rheight))),point},position:function($container,paper){var pw=parseInt(paper.w||paper.width,10),cw=parseInt($container.width(),10),ph=parseInt(paper.w||paper.width,10),ch=parseInt($container.height(),10);return{left:(cw-pw)/2,top:(ch-ph)/2}},clickPoint:function($container,event){var x,y,offset=$container.offset();return event.pageX||event.pageY?(x=event.pageX-offset.left,y=event.pageY-offset.top):(event.clientX||event.clientY)&&(x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-offset.left,
y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop-offset.top),{x:x,y:y}}};return GraphicHelper}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){"use strict";var render=function(interaction){
var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$(".main-image-box",$container);interaction._vsets=[],$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_paperUnSelect(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{
min:interaction.attr("minAssociations"),max:interaction.attr("maxAssociations"),getResponse:_getRawResponse,onError:function(data){data&&data.target&&graphic.highlightError(data.target)}})})},_renderChoice=function(interaction,choice){var shape=choice.attr("shape"),coords=choice.attr("coords"),maxAssociations=interaction.attr("maxAssociations");graphic.createElement(interaction.paper,shape,coords,{id:choice.serial,title:__("Select this area to start an association")}).data("max",choice.attr("matchMax")).data("matching",0).removeData("assocs").click(function(){var active,assocs,self=this;return maxAssociations>0&&_getRawResponse(interaction).length>=maxAssociations?(_shapesUnSelectable(interaction),
void instructionMgr.validateInstructions(interaction,{choice:choice,target:this})):(this.selectable?(active=_getActiveElement(interaction),active&&(active.data("matching",active.data("matching")+1),this.data("matching",this.data("matching")+1),assocs=active.data("assocs")||[],assocs.push(choice.id()),active.data("assocs",assocs),_createPath(interaction,active,this,function(){active.data("matching",active.data("matching")-1),self.data("matching",self.data("matching")-1),active.data("assocs",_.remove(active.data("assocs")||[],choice.id())),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:self
})})),_shapesUnSelectable(interaction)):this.active?(graphic.updateElementState(this,"basic",__("Select another area to complete the association")),this.active=!1,_shapesUnSelectable(interaction)):_isMatchable(this)&&(graphic.updateElementState(this,"active",__("Select this area to start an association")),this.active=!0,_shapesSelectable(interaction,this)),containerHelper.triggerResponseChangeEvent(interaction),void instructionMgr.validateInstructions(interaction,{choice:choice,target:this}))})},_paperUnSelect=function(interaction){var $container=containerHelper.get(interaction),image=interaction.paper.getById("bg-image-"+interaction.serial);image&&image.click(function(){
_shapesUnSelectable(interaction),$container.trigger("unselect.graphicassociate")})},_getActiveElement=function(interaction){var active;return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);return element&&element.active===!0?(active=element,!1):void 0}),active},_createPath=function(interaction,srcElement,destElement,onRemove){function showCloser(){closerBg.toFront().animate({opacity:.8},300).click(removeSet),closer.toFront().animate({opacity:1},300).click(removeSet)}function hideCloser(){closerBg&&closerBg.type&&(closerBg.animate({opacity:0},300,function(){closerBg.toBack()}).unclick(),closer.animate({
opacity:0},300,function(){closer.toBack()}).unclick())}function removeSet(){_.invoke(vset,"remove"),interaction._vsets=_.without(interaction._vsets,vset),"function"==typeof onRemove&&onRemove()}var $container=containerHelper.get(interaction),vset=[],src=srcElement.getBBox(),sx=src.x+src.width/2,sy=src.y+src.height/2,dest=destElement.getBBox(),dx=dest.x+dest.width/2,dy=dest.y+dest.height/2,srcBullet=interaction.paper.circle(sx,sy,3).attr(graphic._style["assoc-bullet"]),destBullet=interaction.paper.circle(dx,dy,3).attr(graphic._style["assoc-bullet"]),path=interaction.paper.path("M"+sx+","+sy+"L"+sx+","+sy).attr(graphic._style.assoc).animate({path:"M"+sx+","+sy+"L"+dx+","+dy
},300),layer=interaction.paper.path("M"+sx+","+sy+"L"+dx+","+dy).attr(graphic._style["assoc-layer"]),midPath=layer.getPointAtLength(layer.getTotalLength()/2),closerBg=interaction.paper.circle(midPath.x,midPath.y,9).attr(graphic._style["close-bg"]).toBack(),closer=interaction.paper.path(graphic._style.close.path).attr(graphic._style.close).transform("T"+(midPath.x-9)+","+(midPath.y-9)).attr("title",_("Click again to remove")).toBack();srcElement.toFront(),destElement.toFront(),vset=[srcBullet,path,destBullet,layer,closerBg,closer],interaction._vsets.push(vset),_.invoke(vset,"data","assoc-path",!0),layer.click(function(){0===closer.attrs.opacity?showCloser():hideCloser();
}),$container.on("unselect.graphicassociate",function(){hideCloser()})},_shapesSelectable=function(interaction,active){var assocs=active.data("assocs")||[];_.forEach(interaction.getChoices(),function(choice){var element;_.contains(assocs,choice.id())||(element=interaction.paper.getById(choice.serial),!element.active&&element.id!==active.id&&_isMatchable(element,active)&&(element.selectable=!0,graphic.updateElementState(element,"selectable")))})},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,element.active=!1,graphic.updateElementState(element,"basic"));
})},_isMatchable=function(element){var matching,matchMax,matchable=!1;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||0,matchable=0===matchMax||matchMax>matching),matchable},_getRawResponse=function(interaction){var responses=[];return _.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial),assocs=element.data("assocs");element&&assocs&&(responses=responses.concat(_.map(assocs,function(id){return[choice.id(),id]})))}),responses},setResponse=function(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction);
}catch(e){}if(_.isArray(responseValues)){var map=_.transform(interaction.getChoices(),function(res,choice){res[choice.id()]=interaction.paper.getById(choice.serial)});_.forEach(responseValues,function(responseValue){var el1,el2;_.isArray(responseValue)&&2===responseValue.length&&(el1=map[responseValue[0]],el2=map[responseValue[1]],el1&&el2&&(graphic.trigger(el1,"click"),graphic.trigger(el2,"click")))})}}},resetResponse=function(interaction){var toRemove=[];_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&element.data({max:choice.attr("matchMax"),matching:0,assocs:[]})}),interaction.paper.forEach(function(elt){
elt.data("assoc-path")&&toRemove.push(elt)}),_.invoke(toRemove,"remove")},getResponse=function(interaction){var response=(_getRawResponse(interaction),pciResponse.serialize(_getRawResponse(interaction),interaction));return response},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$container.off(".graphicassociate"),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),
$("ul",$container).empty()),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"graphicAssociateInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/helper/dummyElement"],function($,_,__,graphic,dummyElement){
"use strict";var GraphicInteractionWidget={createPaper:function(resize){var paper,$container=this.$original,$item=$container.parents(".qti-item"),background=this.element.object.attributes,serial=this.element.serial;return background.data?(paper=graphic.responsivePaper("graphic-paper-"+serial,serial,{width:background.width,height:background.height,img:this.options.assetManager.resolve(background.data),imgId:"bg-image-"+serial,container:$container,resize:function(){var $blocks=$(".image-editor.solid, .block-listing.source",$container),minWidth=arguments[0];"function"==typeof resize&&resize.call(this,arguments),$container.hasClass("responsive")||$blocks.each(function(){
parseInt(this.style.minWidth)||(this.style.minWidth=minWidth.toString()+"px")})}}),$item.on("resize.gridEdit."+serial,function(){$container.trigger("resize.qti-widget."+serial)})):this._createPlaceholder(),paper},_createPlaceholder:function(){var self=this,$container=this.$original,$imageBox=$container.find(".main-image-box"),$editor=$container.find(".image-editor"),diff=$editor.outerWidth()-$editor.width()+($container.outerWidth()-$container.width())+1;dummyElement.get({icon:"image",css:{width:$container.innerWidth()-diff,height:200},title:__("Select an image first.")}).click(function(){var $upload=$('[data-role="upload-trigger"]',self.$form);$upload.length&&$upload.trigger("click");
}).appendTo($imageBox)},createChoices:function(){_.forEach(this.element.getChoices(),this._currentChoices,this)},_currentChoices:function(choice){graphic.createElement(this.element.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,touchEffect:!1})}};return GraphicInteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){"use strict";var initSleepState=function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(data.value===!0?interaction.addClass("responsive"):interaction.removeClass("responsive"),
widget.rebuild())})},exitSleepState=function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)};return stateFactory.extend(SleepState,initSleepState,exitSleepState)}),define("tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var helper,options,buffer="";return buffer+='\n        <li class="separator"></li>\n        <li data-type="target"><span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Drop the target to select a point",options):helperMissing.call(depth0,"__","Drop the target to select a point",options)))+'" class="icon-target"></span></li>\n        ';
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="image-sidebar">\n    <ul class="none forms">\n        <li data-type="rect"><span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw a rectangle on the image",options):helperMissing.call(depth0,"__","Draw a rectangle on the image",options)))+'" class="icon-rectangle"></span></li>\n        <li data-type="circle"><span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Draw a circle on the image",options):helperMissing.call(depth0,"__","Draw a circle on the image",options)))+'" class="icon-circle"></span></li>\n        <li data-type="ellipse"><span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw an ellipsis on the image",options):helperMissing.call(depth0,"__","Draw an ellipsis on the image",options)))+'" class="icon-ellipsis"></span></li>\n        <li data-type="path"><span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Draw a free form on the image",options):helperMissing.call(depth0,"__","Draw a free form on the image",options)))+'" class="icon-free-form"></span></li>\n    \n        ',
stack1=helpers["if"].call(depth0,depth0&&depth0.showTarget,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n\n        <li class="separator"></li>\n        <li class="bin disabled"><span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Remove the selected shape",options):helperMissing.call(depth0,"__","Remove the selected shape",options)))+'" class="icon-bin"></span></li>\n    </ul>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar",["jquery","lodash","tpl!taoQtiItem/qtiCreator/tpl/graphicInteraction/sidebar"],function($,_,sidebarTmpl){
"use strict";var shapeSideBar={create:function($container,showTarget){var $imageEditor=$container.find(".image-editor"),serial=$container.data("serial"),$sideBar=$(sidebarTmpl({showTarget:!!showTarget}));$imageEditor.prepend($sideBar);var $forms=$("li[data-type]",$sideBar),$bin=$("li.bin",$sideBar),activate=function($form){$forms.filter(".active").each(function(){deactivate($(this))}),$form.addClass("active"),$sideBar.trigger("shapeactive.qti-widget",[$form,$form.data("type")])},deactivate=function($form){$form.removeClass("active"),$sideBar.trigger("shapedeactive.qti-widget",[$form,$form.data("type")])};return $sideBar.on("enablebin.qti-widget",function(){$bin.removeClass("disabled").on("click",function(e){
e.preventDefault(),$sideBar.trigger("bin.qti-widget")})}),$sideBar.on("disablebin.qti-widget",function(){$bin.addClass("disabled").off("click")}),$forms.click(function(e){e.preventDefault();var $form=$(this);$form.hasClass("active")?deactivate($form):activate($form)}),$container.trigger("resize.qti-widget."+serial),$sideBar},remove:function($container){var $sideBar=$(".image-sidebar",$container);$sideBar.length&&($sideBar.remove(),$container.off("resize.qti-widget.sidebar"),$container.trigger("resize.qti-widget"))}};return shapeSideBar}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers",["jquery","lodash","raphael"],function($,_,Raphael){
var shapeHandlers=function(paper,element){var getCoords=function(element){var coords,scaleFactor=paper.w<paper.width?1:paper.w/paper.width,bbox=element.getBBox(),size=(bbox.width>25?6:4)*scaleFactor,half=size/2,halfWidth=bbox.width/2,halfHeight=bbox.height/2;switch(element.type){case"circle":coords={midTop:[bbox.x+halfWidth-half,bbox.y-size,size,size],midRight:[bbox.x+bbox.width,bbox.y+halfHeight-half,size,size],midBot:[bbox.x+halfWidth-half,bbox.y+bbox.height,size,size],midLeft:[bbox.x-size,bbox.y+halfHeight-half,size,size]};break;case"path":coords={},_.forEach(Raphael.parsePathString(element.attr("path")),function(segment,index){3===segment.length&&(coords["point"+index]=segment.slice(1).concat(half));
});break;case"rect":case"ellipse":coords={topLeft:[bbox.x-size,bbox.y-size,size,size],midTop:[bbox.x+halfWidth-half,bbox.y-size,size,size],topRight:[bbox.x+bbox.width,bbox.y-size,size,size],midRight:[bbox.x+bbox.width,bbox.y+halfHeight-half,size,size],botRight:[bbox.x+bbox.width,bbox.y+bbox.height,size,size],midBot:[bbox.x+halfWidth-half,bbox.y+bbox.height,size,size],botLeft:[bbox.x-size,bbox.y+bbox.height,size,size],midLeft:[bbox.x-size,bbox.y+halfHeight-half,size,size]}}return coords};return _.map(getCoords(element),function(handlerCoords,name){var cursor,constraints,hshape;if("path"===element.type)cursor="move",hshape="circle";else switch(hshape="rect",name){
case"topLeft":cursor="nw-resize",constraints={ix:!0,iy:!0};break;case"midTop":cursor="ns-resize",constraints={iy:!0};break;case"topRight":cursor="ne-resize",constraints={x:!0,iy:!0};break;case"midRight":cursor="ew-resize",constraints={x:!0};break;case"botRight":cursor="se-resize";break;case"midBot":cursor="ns-resize",constraints={y:!0};break;case"botLeft":cursor="sw-resize",constraints={ix:!0,y:!0};break;case"midLeft":cursor="ew-resize",constraints={ix:!0}}return paper[hshape].apply(paper,handlerCoords).attr({fill:"#eeeeee",cursor:cursor}).data("constraints",constraints)})};return shapeHandlers}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function($,_,commonGraphicHelper){
var resize=function(element,options){function getStartPoint(){var startPoint;switch(element.type){case"circle":startPoint={x:element.attrs.cx,y:element.attrs.cy};break;case"ellipse":case"rect":startPoint=element.getBBox()}return startPoint}var resizer;element&&element.type&&options.stop&&(resizer=_.bind(shapeResizer[element.type],shapeResizer),options.start||(options.start=getStartPoint(element)),_.isFunction(resizer)&&(element.attr(resizer(options)),_.isFunction(options.resized)&&options.resized.call(element)))},shapeResizer={rect:function(options){var start=options.start,stop=options.stop,constraints=options.constraints,dest={};return(!constraints||constraints.x)&&(dest.width=stop.x-start.x,
dest.width<0&&(dest.x=stop.x,dest.width=-1*dest.width)),(!constraints||constraints.y)&&(dest.height=stop.y-start.y,dest.height<0&&(dest.y=stop.y,dest.height=-1*dest.height)),constraints&&constraints.ix&&(dest.x=stop.x,dest.width=start.width-(stop.x-start.x),dest.width<0&&(dest.x=stop.x,dest.width=-1*dest.width)),constraints&&constraints.iy&&(dest.y=stop.y,dest.height=start.height-(stop.y-start.y),dest.height<0&&(dest.y=stop.y,dest.height=-1*dest.height)),dest.width<10&&(dest.width=10),dest.height<10&&(dest.height=10),dest},circle:function(options){var start=options.start,stop=options.stop,rw=stop.x>start.x?stop.x-start.x:start.x-stop.x,rh=stop.y>start.y?stop.y-start.y:start.y-stop.y,r=Math.floor(Math.sqrt(Math.pow(rw,2)+Math.pow(rh,2)));
return{r:5>r?5:r}},ellipse:function(options){var dest={},boxDest=this.rect(options);return boxDest.x&&(dest.x=boxDest.x),boxDest.y&&(dest.y=boxDest.y),boxDest.width&&(dest.rx=boxDest.width/2),boxDest.height&&(dest.ry=boxDest.height/2),dest},path:function(options){var dest={};return options.path&&options.start&&(dest.path="",_.forEach(options.path,function(point,index){dest.path+=point[0],3===point.length&&(index===options.pointIndex||0===options.pointIndex&&1===index?dest.path+=options.stop.x+" "+options.stop.y:dest.path+=point[1]+" "+point[2])})),dest}};return resize}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover",["jquery","lodash"],function($,_){
var move=function(element,start,stop){var mover;element&&element.type&&(mover=_.bind(shapeMover[element.type],shapeMover),_.isFunction(mover)&&element.animate(mover(start,stop)))},shapeMover={rect:function(start,stop){return{x:stop.x-start.x,y:stop.y-start.y}},circle:function(start,stop){return{cx:stop.x,cy:stop.y}},ellipse:function(start,stop){return{cx:stop.x,cy:stop.y}},path:function(start,stop){var dest={path:""};return _.forEach(start.path,function(point){dest.path+=point[0],3===point.length&&(dest.path+=point[1]+stop.x-start.x+","+(point[2]+stop.y-start.y))}),dest}};return move}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function($,_,graphicHelper){
var pathBuilder=function(paper){var path={_path:null,closed:!1,set:null,points:[],getPath:function(){return this._path},start:function(point){return this.points=[],this.add(point)},add:function(point){var stop,self=this,scaleFactor=paper.w<paper.width?1:paper.w/paper.width,pointSize=3*scaleFactor;return stop=paper.circle(point.x,point.y,pointSize).attr({stroke:"black","stroke-width":1,fill:"white",opacity:.7,cursor:"pointer"}).click(function(e){e.preventDefault(),e.stopPropagation(),self.points.length>2&&(this.attr("fill","green"),self.close())}),0===this.points.length&&(stop.attr("fill","red"),this.set=paper.set(),this._path=paper.path("M"+point.x+","+point.y).attr(graphicHelper._style.active).attr("opacity",.3),
this.set.push(this._path)),this.points.push(point),this.set.push(stop),this._path.animate({path:this._path.attr("path")+"L"+point.x+","+point.y}),this},close:function(){return this._path.attr({path:this._path.attr("path")+"Z"}).attr(graphicHelper._style.active).attr("opacity",1),this.set.forEach(function(elt){"circle"===elt.type&&elt.remove()}),this.closed=!0,_.isFunction(this.closeCb)&&this.closeCb(),this},onClose:function(closeCb){return this.closeCb=closeCb,this}};return path};return pathBuilder}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function($,_,graphicHelper,shapeHandlers,shapeResizer,shapeMover,pathBuilder){
var shapeFactory=function(options){var paper=options.paper,background=options.background,$container=options.$container,isResponsive=options.isResponsive||!1,type=options.type||"rect",creator={states:{drawing:!1},_events:{},on:function(eventName,cb){_.isFunction(cb)&&(this._events[eventName]=cb)},is:function(state){return this.states[state]===!0},setState:function(state,value){this.states[state]=value},start:function(){switch(type){case"path":this.startDrawingPath();break;case"target":this.startPositionTarget();break;default:this.startWithMouse()}},startPositionTarget:function(){var self=this;self.setState("drawing",!0),background.click(function(e){e.preventDefault(),
e.stopPropagation();var point=graphicHelper.getPoint(e,paper,$container,isResponsive);graphicHelper.createTarget(paper,{point:point,create:function(target){self.setState("drawing",!1),background.unclick(),self._events["created.qti-widget"]&&self._events["created.qti-widget"].call(this,target)},remove:!1,hover:!1})})},startDrawingPath:function(){function created(){self.setState("drawing",!1),background.unclick(),self._events["created.qti-widget"]&&self._events["created.qti-widget"].call(this,builder.getPath())}var self=this,builder=pathBuilder(paper);self.setState("drawing",!0),builder.onClose(created),background.click(function(e){e.preventDefault(),e.stopPropagation(),
self.is("drawing")&&builder.add(graphicHelper.getPoint(e,paper,$container,isResponsive))})},startWithMouse:function(){function created(){self.setState("drawing",!1),background.unmousedown().unmousemove().unmouseup(),shape.unmousedown().unmouseup().unmousemove(),self._events["created.qti-widget"]&&self._events["created.qti-widget"].call(this,shape)}function resize(event){self.is("drawing")&&shapeResizer(shape,{start:startPoint,stop:graphicHelper.getPoint(event,paper,$container,isResponsive)})}var startPoint,shape,self=this,smoothResize=_.throttle(resize,10);background.mousedown(function(event){event.preventDefault(),self.is("drawing")||(self.setState("drawing",!0),
startPoint=graphicHelper.getPoint(event,paper,$container,isResponsive),shape=graphicHelper.createElement(paper,type,[startPoint.x,startPoint.y,25,25],{style:"creator",hover:!1,touchEffect:!1,qtiCoords:!1}),shape.mouseup(created),background.mouseup(created),shape.mousemove(smoothResize),background.mousemove(smoothResize))})},stop:function(){background.unmousedown().unmousemove().unmouseup().unclick()}};return creator};return shapeFactory}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeHandlers","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeResizer","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeMover","taoQtiItem/qtiCreator/widgets/interactions/helpers/pathBuilder"],function($,_,graphicHelper,shapeHandlers,shapeResizer,shapeMover,pathBuilder){
var shapeEditor=function(shape,options){var paper=options.paper,background=options.background,$container=options.$container,isResponsive=options.isResponsive||!1,editor={shape:null,handlers:[],states:{drawing:!1,handling:!1,resizing:!1,moving:!1},_events:{},on:function(eventName,cb){return _.isFunction(cb)&&(this._events[eventName]=cb),this},trigger:function(eventName){return _.isFunction(this._events[eventName])&&this._events[eventName].apply(this,Array.prototype.slice.call(arguments,1)),this},is:function(state){return this.states[state]===!0},setState:function(state,value){return this.states[state]=value,this},_init:function(shape){var self=this;return shape&&shape.type&&(self.shape=shape,
background.click(function(){!self.is("resizing")&&self.is("handling")&&self.quitHandling()}),self.shape.click(function(){self.is("resizing")||(self.is("handling")?self.quitHandling():self.enterHandling())})),this},enterHandling:function(){function startResize(){var bbox,handler=this;self.setState("resizing",!0).trigger("shapechanging.qti-widget"),self.layer=self.shape.clone(),self.layer.attr(graphicHelper._style.basic),self.layer.attr("cursor",handler.attrs.cursor),bbox=self.layer.getBBox(),self.layerTxt=graphicHelper.createShapeText(paper,self.layer,{style:"layer-pos-text",content:parseInt(bbox.width,10)+" x "+parseInt(bbox.height,10)}),"path"===self.shape.type&&_.forEach(self.shape.attr("path"),function(point,index){
return 3===point.length&&point[1]===this.attr("cx")&&point[2]===this.attr("cy")?(this.pointIndex=index,!1):void 0},handler),_.invoke(_.reject(_.clone(self.handlers),function(elt){return elt===handler}),"hide")}function resize(dx,dy,x,y,event){var stopPoint,options;self.is("resizing")&&(stopPoint=graphicHelper.getPoint(event,paper,$container,isResponsive),options={stop:stopPoint,constraints:this.data("constraints"),resized:_.throttle(function(){var bbox=this.getBBox();self.layerTxt.attr("text",parseInt(bbox.width,10)+" x "+parseInt(bbox.height,10))},100)},"path"===self.shape.type&&(options.start=_.pick(this.attrs,["cx","cy"]),options.path=self.layer.attr("path"),
options.pointIndex=this.pointIndex),shapeResizer(self.layer,options),"circle"===this.type?this.animate({cx:stopPoint.x,cy:stopPoint.y}):this.animate(stopPoint))}function resized(){self.shape.animate(_.pick(self.layer.attrs,["x","y","cx","cy","r","rx","ry","width","height","path"]),200,function(){self.setState("resizing",!1).trigger("shapechange.qti-widget")}),self.layer.remove(),self.layerTxt.remove(),_.invoke(self.handlers,"remove"),self.handlers=[]}function keyResize(code){var attr,stop,start;if(!self.is("moving")){switch(self.setState("moving",!0),_.invoke(self.handlers,"remove"),attr=shape.attr(),self.shape.type){case"rect":start={x:0,y:0},stop={x:39===code?attr.x+1:37===code?attr.x-1:attr.x,
y:40===code?attr.y+1:38===code?attr.y-1:attr.y};break;case"ellipse":case"circle":start={x:0,y:0},stop={x:39===code?attr.cx+1:37===code?attr.cx-1:attr.cx,y:40===code?attr.cy+1:38===code?attr.cy-1:attr.cy};break;case"path":start={path:attr.path},stop={}}shapeMover(self.shape,start,stop),self.setState("moving",!1).trigger("shapechange.qti-widget")}}function startMove(x,y,event){self.setState("moving",!0).trigger("shapechanging.qti-widget");var mousePoint=graphicHelper.getPoint(event,paper,$container,isResponsive);this.startPoint={x:mousePoint.x-this.attr("x"),y:mousePoint.y-this.attr("y")},"path"===this.type&&(this.startPoint.path=this.attr("path")),self.shape.attr("cursor","move"),
background.attr("cursor","move"),_.invoke(self.handlers,"remove")}function move(dx,dy,x,y,event){self.is("moving")&&shapeMover(this,this.startPoint,graphicHelper.getPoint(event,paper,$container,isResponsive))}function moved(){delete this.startPoint,self.shape.attr("cursor","pointer"),background.attr("cursor","default"),self.setState("moving",!1).trigger("shapechange.qti-widget")}var self=this;if(self.setState("handling",!0).trigger("enterhandling.qti-widget"),"set"!==self.shape.type){self.handlers=shapeHandlers(paper,self.shape),_.forEach(self.handlers,function(handler){handler.drag(resize,startResize,resized)}),self.shape.drag(move,startMove,moved);var keyResizer=_.throttle(keyResize,20);
return $(document).on("keydown.qti-widget",function(e){var code=e.which;code>=37&&40>=code&&(e.preventDefault(),keyResizer(code))}),this}},quitHandling:function(){return $(document).off("keydown.qti-widget"),this.shape.undrag(),_.invoke(this.handlers,"remove"),this.handlers=[],this.setState("moving",!1).setState("resizing",!1).setState("handling",!1).trigger("quithandling.qti-widget"),this},removeShape:function(){var id,data;return this.shape&&(this.quitHandling(),id=this.shape.id,data=this.shape.data,this.shape.remove(),this.trigger("remove.qti-widget",id,data)),this},destroy:function(){return this.is("handling")&&this.quitHandling(),this.shape&&(this.shape.unclick(),
background.unclick()),this.shape=null,this.handlers=[],this._events={},this}};return editor._init(shape)};return shapeEditor}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeSideBar","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeFactory","taoQtiItem/qtiCreator/widgets/interactions/helpers/shapeEditor"],function($,_,GraphicHelper,shapeSideBar,shapeFactory,shapeEditor){return function(widget,options){var interactionShapeEditor={editors:[],create:function(){function editShape(shape,enterHandling){
var editor=shapeEditor(shape,shapeOptions);editor.on("enterhandling.qti-widget",function(){_.invoke(_.reject(editors,editor),"quitHandling"),$sideBar.trigger("enablebin.qti-widget").on("bin.qti-widget",function(){editor.removeShape(),editor.destroy(),editors=_.reject(editors,editor),editor=void 0}),_.isFunction(options.enterHandling)&&options.enterHandling(shape)}).on("shapechanging.qti-widget",function(){_.isFunction(options.shapeChanging)&&options.shapeChanging(shape)}).on("shapechange.qti-widget",function(){_.isFunction(options.shapeChange)&&options.shapeChange(shape)}).on("quithandling.qti-widget",function(){_.isFunction(options.quitHandling)&&options.quitHandling(shape),
$sideBar.trigger("disablebin.qti-widget").off("click").off("bin.qti-widget")}).on("remove.qti-widget",function(id,data){_.isFunction(options.shapeRemoved)&&options.shapeRemoved(id,data),_.remove(currents,id)}),editors.push(editor),enterHandling&&editor.enterHandling()}function createShape(type,created){var factory=factories[type];factories[type]||(factory=shapeFactory(_.merge({type:type},shapeOptions)),factories[type]=factory),factory.on("created.qti-widget",created),factory.start()}function editCreatedShape(type,shape,enterHandling){var layer,set;"target"!==type?editShape(shape,enterHandling):(layer=paper.getById("layer-"+shape.id),set=paper.set(shape,layer),
set.id=shape.id,set.data=shape.data(),editShape(set,enterHandling))}var editors=this.editors,factories={},$container=widget.$container,$original=widget.$original,interaction=widget.element,paper=interaction.paper,image=paper.getById("bg-image-"+interaction.serial),currents=options.currents||_.pluck(interaction.getChoices(),"serial"),shapeOptions={paper:interaction.paper,background:image,$container:$container.find(".main-image-box"),isResponsive:$original.hasClass("responsive")},$sideBar=shapeSideBar.create($original,!!options.target);$sideBar.on("shapeactive.qti-widget",function(e,$form,type){createShape(type,function(shape){_.isFunction(options.shapeCreated)&&options.shapeCreated(shape,type),
$form.removeClass("active"),editCreatedShape(type,shape)})}),$sideBar.on("shapedeactive.qti-widget",function(e,$form,type){factories&&factories[type]&&factories[type].stop()}),_.forEach(currents,function(id){var element=paper.getById(id);element&&(element.attr(GraphicHelper._style.creator).unmouseover().unmouseout(),/^target/.test(element.id)?editCreatedShape("target",element):editCreatedShape(element.type,element,!1))})},destroy:function(){var $container=widget.$original,interaction=widget.element,paper=interaction.paper,currents=options.currents||_.pluck(interaction.getChoices(),"serial");shapeSideBar.remove($container),_.invoke(this.editors,"destroy"),_.forEach(currents,function(id){
var element=paper.getById(id);element&&element.attr(GraphicHelper._style.basic).hover(function(){element.flashing||GraphicHelper.updateElementState(this,"hover")},function(){element.flashing||GraphicHelper.updateElementState(this,this.active?"active":this.selectable?"selectable":"basic")})})}};return interactionShapeEditor}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager",["jquery","lodash","i18n","util/image","ui/resourcemgr"],function($,_,__,imageUtil){"use strict";var ns="upload";return function($element,options){$element.resourcemgr({title:options.title,appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,
browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:"image/jpeg,image/png,image/gif"},pathParam:"path",select:function(e,files){var selected;files.length>0&&(selected=files[0],imageUtil.getSize(options.baseUrl+encodeURIComponent(files[0].file),function(size){$element.trigger("selected."+ns,{selected:selected,size:size})}))}})}}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector",["jquery","lodash","i18n","util/image","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","ui/resourcemgr"],function($,_,__,imageUtil,resourceManager){
"use strict";return function($form,options){var _ns=".imageSelector",$upload=$('[data-role="upload-trigger"]',$form),$src=$("input[name=data]",$form),$width=$("input[name=width]",$form),$height=$("input[name=height]",$form),$type=$("input[name=type]",$form);options.title=options.title?options.title:__('Please select a background picture for your interaction from the resource manager.                      You can add new files from your computer with the button "Add file(s)".');var _openResourceMgr=function(){$upload.on("selected.upload",function(e,args){args.size&&args.size.width>=0&&($width.val(args.size.width).trigger("change"),$height.val(args.size.height).trigger("change")),
$type.val(args.selected.mime).trigger("change"),_.defer(function(){$src.val(args.selected.file).trigger("change")})}).on("open",function(){$src.trigger("open."+_ns),$src.hasClass("tooltipstered")&&$src.blur().tooltipster("hide")}).on("close",function(){$src.trigger("close."+_ns)}),resourceManager($upload,options)};$upload.on("click",_openResourceMgr),$src.val()||_openResourceMgr()}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";
return buffer+='<div class="panel">\n\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n        <input type="text" name="data" value="',(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n    </div>\n\n    <div class="panel media-sizer-panel">\n        <!-- media sizer goes here -->\n    </div>\n    <input name="width" value="',(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n    <input name="height" value="',
(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n\n\n    <input name="type" value="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" readonly />\n\n    <hr />\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed associations",options):helperMissing.call(depth0,"__","Allowed associations",options)))+'</h3>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of associations that the candidate is required to make to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of associations that the candidate is required to make to form a valid response.",options)))+"<br>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of associations that the candidate is allowed to make.",options):helperMissing.call(depth0,"__","The maximum number of associations that the candidate is allowed to make.",options)))+'\n        </span>\n\n\n    <div class="panel">\n        <div>\n            <label for="minAssociations" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+'</label>\n        <input name="minAssociations" value="',(helper=helpers.minAssociations)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minAssociations,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    </div>\n        <div>\n            <label for="maxAssociations" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+'</label>\n        <input name="maxAssociations" value="',(helper=helpers.maxAssociations)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxAssociations,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n        </div>\n    </div>\n</div>\n';
})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='\n<div class="panel">\n    <label for="">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"identifier",options):helperMissing.call(depth0,"__","identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. my-hotspot_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n\n<h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},
data:data},helper?helper.call(depth0,"Allowed number of matches",options):helperMissing.call(depth0,"__","Allowed number of matches",options)))+'\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices this choice must be associated with to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices this choice must be associated with to form a valid response.",options)))+"<br>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices this choice may be associated with.",options):helperMissing.call(depth0,"__","The maximum number of choices this choice may be associated with.",options)))+'\n    </span>\n</h3>\n\n<div>\n    <label for="matchMin" class="spinner">Min</label>\n    <input name="matchMin" value="',(helper=helpers.matchMin)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMin,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n</div>\n<div>\n    <label for="matchMax" class="spinner">Max</label>\n    <input name="matchMax" value="',(helper=helpers.matchMax)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMax,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n</div>\n\n<h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shape position",options):helperMissing.call(depth0,"__","Shape position",options)))+'</h3>\n\n<div class="panel">\n    <label for="x">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Left",options):helperMissing.call(depth0,"__","Left",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="x" value="',(helper=helpers.x)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.x,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="y">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Top",options):helperMissing.call(depth0,"__","Top",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="y" value="',
(helper=helpers.y)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.y,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="width" value="',(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="height">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="height" value="',
(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage",["util/url","ui/mediasizer"],function(url){"use strict";function handleOversizedImages(widget){var viewBox,$svg=widget.$original.find(".svggroup svg"),$bgImage=$svg.find("image"),trueSize=$bgImage[0].getBoundingClientRect(),imgWidth=parseInt(trueSize.width,10),imgHeight=parseInt(trueSize.height,10);imgWidth>=Number(widget.element.object.attr("width"))||(widget.element.object.attr("width",imgWidth),
widget.element.object.attr("height",imgHeight),$bgImage[0].setAttribute("width",imgWidth),$bgImage[0].setAttribute("height",imgHeight),viewBox=$svg[0].getAttribute("viewBox").split(" "),viewBox[2]=imgWidth,viewBox[3]=imgHeight,$svg[0].setAttribute("viewBox",viewBox.join(" ")),$svg[0].setAttribute("width",imgWidth),$svg[0].setAttribute("height",imgHeight),$svg.parents(".main-image-box").css({height:imgHeight,width:imgWidth}),widget.$original.trigger("resize.qti-widget."+widget.serial,[imgWidth,imgHeight]))}function setupImage(widget){var $bgImage=widget.$original.find(".svggroup svg image");widget.$original.hasClass("responsive")||$bgImage.length&&(handleOversizedImages(widget),
setupMediaSizer(widget))}function setupMediaSizer(widget){var $mediaSizer=widget.$form.find(".media-sizer-panel");return $mediaSizer.empty().mediasizer({target:widget.$original.find(".svggroup svg image"),showResponsiveToggle:!1,showSync:!1,responsive:!1,parentSelector:widget.$original.attr("id"),applyToMedium:!1,maxWidth:parseInt(widget.element.object.attr("width"),10)}),$mediaSizer.on("sizechange.mediasizer",function(e,params){var width=parseInt(params.width,10),height=parseInt(params.height,10);widget.element.object.attr("width",width),widget.element.object.attr("height",height),widget.$original.trigger("resize.qti-widget."+widget.serial,[width,height])}),
$mediaSizer}function setChangeCallbacks(widget,formElement,callbacks){callbacks=callbacks||{},callbacks.data=function(interaction,value){interaction.object.attr("data",url.encodeAsXmlAttr(value)),widget.rebuild({ready:function(widget){widget.changeState("question")}})},callbacks.width=function(interaction,value){interaction.object.attr("width",parseInt(value,10))},callbacks.height=function(interaction,value){interaction.object.attr("height",parseInt(value,10))},callbacks.type=function(interaction,value){value&&""!==value?interaction.object.attr("type",value):interaction.object.removeAttr("type")},formElement.setChangeCallbacks(widget.$form,widget.element,callbacks,{
validateOnInit:!1})}return{setupImage:setupImage,setChangeCallbacks:setChangeCallbacks}}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicAssociate","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","taoQtiItem/qtiCreator/helper/dummyElement","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,__,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,interactionFormElement,identifierHelper,formTpl,choiceFormTpl,dummyElement,panel,resourceManager,bgImage){
"use strict";var initQuestionState=function(){function enterChoiceForm(serial){var element,bbox,choice=interaction.getChoice(serial);if(choice){element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,matchMin:choice.attr("matchMin"),matchMax:choice.attr("matchMax"),choicesCount:_.size(interaction.getChoices()),x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),formElement.initWidget($choiceForm);var callbacks=formElement.getMinMaxAttributeCallbacks($choiceForm,"matchMin","matchMax");callbacks.identifier=identifierHelper.updateChoiceIdentifier,
callbacks.fixed=formElement.getAttributeChangeCallback(),formElement.setChangeCallbacks($choiceForm,choice,callbacks),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm)}}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}var widget=this.widget,interaction=widget.element,paper=interaction.paper;
if(paper){var $left,$top,$width,$height,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar");widget._editor=shapeEditor(widget,{shapeCreated:function(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function(id){interaction.removeChoice(id)},enterHandling:function(shape){enterChoiceForm(shape.id)},quitHandling:function(){leaveChoiceForm()},shapeChange:function(shape){var bbox,choice=interaction.getChoice(shape.id);choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),
$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create()}},exitQuestionState=function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("graphicAssociateInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0))},GraphicAssociateInteractionStateQuestion=stateFactory.extend(Question,initQuestionState,exitQuestionState);
return GraphicAssociateInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form,getMaxPairs=function(choices){var pairs=0;return choices>0?Math.round(choices*(choices-1)/2):pairs};$form.html(formTpl({baseUrl:options.baseUrl,maxAssociations:parseInt(interaction.attr("maxAssociations"),10),minAssociations:parseInt(interaction.attr("minAssociations"),10),choicesCount:getMaxPairs(_.size(interaction.getChoices())),data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),imageSelector($form,options),
formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks($form,"minAssociations","maxAssociations")),interactionFormElement.syncMaxChoices(widget,"minAssociations","maxAssociations")},GraphicAssociateInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){"use strict";function initAnswerState(){
answerStateHelper.forward(this.widget)}function exitAnswerState(){}return stateFactory.extend(Answer,initAnswerState,exitAnswerState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){"use strict";function initCorrectState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());
commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please set the correct associations by linking the choices.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.invoke(corrects,String.prototype.split," "),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){data.response&&data.response.list&&response.setCorrect(_.map(data.response.list.pair,function(pair){return pair.join(" ")}))}))}function exitCorrectState(){var widget=this.widget,interaction=widget.element;
interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())}return stateFactory.create(Correct,initCorrectState,exitCorrectState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,scoringFormFactory){
"use strict";function initMapState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());0===_.size(response.getMapEntries())?corrects:_.keys(response.getMapEntries());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Create assocations and fill the score in the form below")),interaction.responseMappingMode=!0,commonRenderer.render.call(interaction.getRenderer(),interaction),showChoicesId(interaction),0===_.size(response.getMapEntries())?updateForm(widget,corrects):updateForm(widget),
widget.$container.on("responseChange.qti-widget",function(e,data){var pairs,entries,type="single"===response.attr("cardinality")?"base":"list";data&&data.response&&data.response[type]&&(pairs=_.invoke(data.response[type].pair,Array.prototype.join," "),entries=_.keys(response.getMapEntries()),_(pairs).difference(entries).forEach(interaction.pairScoringForm.addPair,interaction.pairScoringForm),removePaths(interaction))}))}function removePaths(interaction){_.delay(function(){_.forEach(interaction._vsets,function(vset){_.invoke(vset,"remove")}),interaction._vsets=[]},500)}function exitMapState(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),
interaction.pairScoringForm&&interaction.pairScoringForm.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())}function showChoicesId(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&graphicHelper.createShapeText(interaction.paper,element,{shapeClick:!0,content:choice.id()}).transform("t0,-10").toFront()})}function updateForm(widget,entries){var interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),getPairValues=function(){
return _.map(interaction.getChoices(),function(choice){return{id:choice.id(),value:choice.id()}})},options={leftTitle:__("left"),rightTitle:__("right"),type:"pair",pairLeft:getPairValues,pairRight:getPairValues};entries&&(options.entries=_.transform(entries,function(result,value){result[value]=void 0!==mapEntries[value]?mapEntries[value]:response.mappingAttributes.defaultValue},{})),interaction.pairScoringForm=scoringFormFactory(widget,options)}return stateFactory.create(Map,initMapState,exitMapState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/Map"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/states/states"],function($,_,__,Widget,GraphicWidget,states){"use strict";var GraphicAssociateInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),
paper=this.createPaper(),paper&&(this.element.paper=paper,this.createChoices())},destroy:function(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)}});return GraphicAssociateInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicAssociateInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicAssociateInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicAssociateInteraction/Widget"],function(_,GraphicAssociateInteraction,GraphicAssociateInteractionWidget){
"use strict";var CreatorGraphicAssociateInteraction=_.clone(GraphicAssociateInteraction);return CreatorGraphicAssociateInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),GraphicAssociateInteractionWidget.build(interaction,GraphicAssociateInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGraphicAssociateInteraction;
}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){
var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicGapMatchInteraction clearfix',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing horizontal source">\n            ',
options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.gapImgs)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.gapImgs,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.gapImgs||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),$gapList=$("ul.source",$container),background=($(".main-image-box",$container),interaction.object.attributes);interaction.gapFillers=[],$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container,resize:function(newSize,factor){$gapList.css("max-width",newSize+"px"),
1!==factor&&$gapList.find("img").each(function(){var $img=$(this);$img.width($img.attr("width")*factor),$img.height($img.attr("height")*factor)})}}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),_renderGapList(interaction,$gapList),_paperUnSelect(interaction)})},_renderChoice=function(interaction,choice){graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select an image first"),hover:!1}).data("max",choice.attr("matchMax")).data("matching",[]).click(function(){_isMatchable(this)&&this.selectable===!0&&_selectShape(interaction,this)})},_renderGapList=function(interaction,$gapList){
$gapList.children("li").click(function(e){e.preventDefault();var $elt=$(this);$elt.hasClass("disabled")||($elt.hasClass("active")?($elt.removeClass("active"),_shapesUnSelectable(interaction)):($gapList.children("li").removeClass("active"),$elt.addClass("active"),_shapesSelectable(interaction)))})},_paperUnSelect=function(interaction){var $container=containerHelper.get(interaction),$gapImages=$("ul > li",$container),image=interaction.paper.getById("bg-image-"+interaction.serial);image&&image.click(function(){_shapesUnSelectable(interaction),$gapImages.removeClass("active")})},_selectShape=function(interaction,element,trackResponse){var $img,$clone,gapFiller,id,bbox,shapeOffset,activeOffset,matching,currentCount;
"undefined"==typeof trackResponse&&(trackResponse=!0);var $container=containerHelper.get(interaction),$gapList=$("ul",$container),$active=$gapList.find(".active:first"),$imageBox=$(".main-image-box",$container),boxOffset=$imageBox.offset();$active.length&&(id=$active.data("identifier"),matching=element.data("matching")||[],matching.push(id),element.data("matching",matching),currentCount=matching.length,$img=$active.find("img"),_shapesUnSelectable(interaction),$gapList.children().removeClass("active"),$clone=$img.clone(),shapeOffset=$(element.node).offset(),activeOffset=$active.offset(),$clone.css({position:"absolute",display:"block","z-index":1e4,opacity:.8,top:activeOffset.top-boxOffset.top,
left:activeOffset.left-boxOffset.left}),$clone.appendTo($imageBox),$clone.animate({top:shapeOffset.top-boxOffset.top,left:shapeOffset.left-boxOffset.left},400,function(){$clone.remove(),bbox=element.getBBox(),gapFiller=graphic.createBorderedImage(interaction.paper,{url:$img.attr("src"),left:bbox.x+3*(currentCount-1),top:bbox.y+3*(currentCount-1),width:parseInt($img.attr("width"),10),height:parseInt($img.attr("height"),10),padding:0,border:!1,shadow:!0}).data("identifier",id).toFront().unclick().click(function(e){e.preventDefault(),e.stopPropagation(),$gapList.find(".active").length>0?graphic.trigger(element,"click"):(element.data("matching",_.without(element.data("matching")||[],this.data("identifier"))),
interaction.gapFillers=_.without(interaction.gapFillers,gapFiller),gapFiller.remove(),containerHelper.triggerResponseChangeEvent(interaction))}),interaction.gapFillers.push(gapFiller),containerHelper.triggerResponseChangeEvent(interaction)}))},_shapesSelectable=function(interaction){var tooltip=__("Select the area to add an image");_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);_isMatchable(element)&&(element.selectable=!0,graphic.updateElementState(element,"selectable",tooltip))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){graphic.updateTitle(element,tooltip);
})})},_shapesUnSelectable=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.selectable=!1,graphic.updateElementState(element,"basic",__("Select an image first")))}),_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.forEach(function(element){graphic.updateTitle(element,__("Remove"))})})},_isMatchable=function(element){var matching,matchMax,matchable=!1;return element&&(matchMax=element.data("max")||0,matching=element.data("matching")||[],matchable=0===matchMax||matchMax>matching.length),matchable},_getRawResponse=function(interaction){var pairs=[];return _.forEach(interaction.getChoices(),function(choice){
var element=interaction.paper.getById(choice.serial);element&&_.isArray(element.data("matching"))&&_.forEach(element.data("matching"),function(match){pairs.push([choice.id(),match])})}),pairs},setResponse=function(interaction,response){var responseValues,$container=containerHelper.get(interaction);if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_.forEach(responseValues,function(pair){var index=_.indexOf(pair,choice.id());index>-1&&2===pair.length&&($("[data-identifier="+pair[0===index?1:0]+"]",$container).addClass("active"),
_selectShape(interaction,element,!1))})})}},resetResponse=function(interaction){containerHelper.get(interaction);_shapesUnSelectable(interaction),_.forEach(interaction.gapFillers,function(gapFiller){graphic.trigger(gapFiller.items[0],"click")})},getResponse=function(interaction){var response=(_getRawResponse(interaction),pciResponse.serialize(_getRawResponse(interaction),interaction));return response},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),
$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"graphicGapMatchInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState
}}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){"use strict";var initSleepState=function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(data.value===!0?interaction.addClass("responsive"):interaction.removeClass("responsive"),widget.rebuild())})},exitSleepState=function(){var widget=this.widget;$(".image-editor.solid, .block-listing.source",widget.$container).css("min-width",0)};return stateFactory.extend(SleepState,initSleepState,exitSleepState);
}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n        <input type="text" name="data" value="',(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n    </div>\n\n    <div class="panel media-sizer-panel">\n        <!-- media sizer goes here -->\n    </div>\n<input name="width" value="',
(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n<input name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n\n    <input type="hidden" name="type" value="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n</div>\n'})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n\n    <div class="panel">\n        <label for="">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"identifier",options):helperMissing.call(depth0,"__","identifier",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n        <input type="text" \n               name="identifier" \n               value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n               placeholder="e.g. my-hotspot_1" \n               data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n    </div>\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Choice Image",options):helperMissing.call(depth0,"__","Choice Image",options)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n        <input type="text" name="data" value="',
(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n    </div>\n\n    <div class="panel media-sizer-panel">\n        <!-- media sizer goes here -->\n    </div>\n\n    <input name="type" type="hidden" value="',
(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n\n    <hr/>\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max. number of matches",options):helperMissing.call(depth0,"__","Max. number of matches",options)))+' </h3>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices this choice may be associated with.",options):helperMissing.call(depth0,"__","The maximum number of choices this choice may be associated with.",options)))+"<br>\n        "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices this choice must be associated with to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices this choice must be associated with to form a valid response.",options)))+'\n    </span>\n\n    <div>\n        <label for="matchMin" class="spinner">Min</label>\n        <input name="matchMin" value="',
(helper=helpers.matchMin)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.matchMin,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    </div>\n    <div>\n        <label for="matchMax" class="spinner">Max</label>\n        <input name="matchMax" value="',(helper=helpers.matchMax)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.matchMax,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicGapMatch","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/associableHotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/gapImg","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/helper/dummyElement","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,__,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,identifierHelper,formTpl,choiceFormTpl,gapImgFormTpl,mediaTlbTpl,dummyElement,panel,resourceManager,bgImage){
"use strict";function applyMediasizerValues(params,factor){factor=factor||1,params.$target.css({width:params.width*factor,height:params.height*factor}).attr("width",params.width*factor).attr("height",params.height*factor)}var initQuestionState=function(){function createGapImgAddOption(){var $gapList=$("ul.source",widget.$original),$addOption=$('<li class="empty add-option"><div><span class="icon-add"></span></div></li>');$addOption.on("click",function(){var gapImgObj=interaction.createGapImg({});gapImgObj.object.removeAttr("type"),$addOption.on("selected.upload",function(e,args){$addOption.off("selected.upload"),gapImgObj.object.attr("data",args.selected.file),
gapImgObj.object.attr("type",args.selected.mime),gapImgObj.object.attr("width",args.size.width),gapImgObj.object.attr("height",args.size.height),setUpGapImg(gapImgObj)}),resourceManager($addOption,gapImgSelectorOptions)}),$addOption.appendTo($gapList)}function setUpGapImg(gapImgObj){var $gapList=$("ul.source",widget.$original),$addOption=$(".empty",$gapList),$gapImgBox=$('[data-serial="'+gapImgObj.serial+'"]',$gapList),$deleteBtn=$(mediaTlbTpl());$gapImgBox.length||($gapImgBox=$(gapImgObj.render()).insertBefore($addOption)),$deleteBtn.appendTo($gapImgBox).show().click(function(e){e.preventDefault(),e.stopPropagation(),$gapImgBox.remove(),interaction.removeGapImg(gapImgObj);
}),enterGapImgForm(gapImgObj.serial),$gapImgBox.off("click").on("click",function(){$gapImgBox.hasClass("active")?($gapImgBox.removeClass("active"),leaveChoiceForm()):($(".active",$gapList).removeClass("active"),$gapImgBox.addClass("active"),enterGapImgForm(gapImgObj.serial))})}function enterChoiceForm(serial){var element,bbox,choice=interaction.getChoice(serial);if(choice){element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,matchMin:choice.attr("matchMin"),matchMax:choice.attr("matchMax"),choicesCount:_.size(interaction.getChoices()),x:parseInt(bbox.x,10),
y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),formElement.initWidget($choiceForm);var callbacks=formElement.getMinMaxAttributeCallbacks($choiceForm,"matchMin","matchMax");callbacks.identifier=identifierHelper.updateChoiceIdentifier,callbacks.fixed=formElement.getAttributeChangeCallback(),formElement.setChangeCallbacks($choiceForm,choice,callbacks),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm);
}}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}function enterGapImgForm(serial){var callbacks,$gapImgBox,$gapImgElem,$mediaSizer,gapImg=interaction.getGapImg(serial);gapImg&&($choiceForm.empty().html(gapImgFormTpl({identifier:gapImg.id(),fixed:gapImg.attr("fixed"),serial:serial,matchMin:gapImg.attr("matchMin"),matchMax:gapImg.attr("matchMax"),choicesCount:_.size(interaction.getChoices()),baseUrl:options.baseUrl,data:gapImg.object.attr("data"),width:gapImg.object.attr("width"),height:gapImg.object.attr("height"),type:gapImg.object.attr("type")
})),$gapImgBox=$('li[data-serial="'+gapImg.serial+'"]'),$gapImgElem=$gapImgBox.find("img"),$mediaSizer=$choiceForm.find(".media-sizer-panel").on("create.mediasizer",function(e,params){applyMediasizerValues(params,widget.$original.data("factor"))}),$mediaSizer.empty().mediasizer({target:$gapImgElem,showResponsiveToggle:!1,showSync:!1,responsive:!1,parentSelector:$gapImgBox,applyToMedium:!1,maxWidth:interaction.object.attr("width")}),imageSelector($choiceForm,gapImgSelectorOptions),formElement.initWidget($choiceForm),callbacks=formElement.getMinMaxAttributeCallbacks($choiceForm,"matchMin","matchMax"),callbacks.identifier=identifierHelper.updateChoiceIdentifier,
callbacks.fixed=formElement.getAttributeChangeCallback(),callbacks.data=function(element,value){gapImg.object.attr("data",value),setUpGapImg(gapImg)},$mediaSizer.on("sizechange.mediasizer",function(e,params){applyMediasizerValues(params,widget.$original.data("factor")),gapImg.object.attr("width",params.width),gapImg.object.attr("height",params.height)}),callbacks.type=function(element,value){value&&""!==value?gapImg.object.attr("type",value):interaction.object.removeAttr("type")},formElement.setChangeCallbacks($choiceForm,gapImg,callbacks),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),panel.closeSections($formInteractionPanel.children("section")),
"function"==typeof window.scroll&&window.scroll(0,$choiceForm.offset().top))}var widget=this.widget,interaction=widget.element,options=widget.options,paper=interaction.paper,gapImgSelectorOptions=_.clone(options);if(gapImgSelectorOptions.title=gapImgSelectorOptions.title?gapImgSelectorOptions.title:__('Please select a choice picture for your interaction from the resource manager.                   You can add new files from your computer with the button "Add file(s)".'),paper){var $left,$top,$width,$height,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar");widget._editor=shapeEditor(widget,{
shapeCreated:function(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function(id){interaction.removeChoice(id)},enterHandling:function(shape){enterChoiceForm(shape.id)},quitHandling:function(){leaveChoiceForm()},shapeChange:function(shape){var bbox,choice=interaction.getChoice(shape.id);choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create(),
_.forEach(interaction.getGapImgs(),setUpGapImg),createGapImgAddOption(),$(window).on("resize.changestate",function(){widget.changeState("sleep")})}},exitQuestionState=function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("graphicGapMatchInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$("ul.source .empty",widget.$original).remove(),widget.$container.find(".qti-gapImg").removeClass("active").find(".mini-tlb").remove(),$(".image-editor.solid, .block-listing.source",widget.$container).css("min-width",0));
},GraphicGapMatchInteractionStateQuestion=stateFactory.extend(Question,initQuestionState,exitQuestionState);return GraphicGapMatchInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form,$container=widget.$original;$container.hasClass("responsive");$form.html(formTpl({baseUrl:options.baseUrl,data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement);
},GraphicGapMatchInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){"use strict";function initAnswerState(){answerStateHelper.forward(this.widget)}function exitAnswerState(){}return stateFactory.extend(Answer,initAnswerState,exitAnswerState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){
"use strict";function initCorrectState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please fill the gap with the correct choices below.")),widget.createGapImgs(),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.invoke(corrects,String.prototype.split," "),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){data.response&&data.response.list&&response.setCorrect(_.map(data.response.list.directedPair,function(pair){
return pair.join(" ")}))}))}function exitCorrectState(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(_.bind(widget.scaleGapList,widget)),widget.createChoices(),widget.createGapImgs())}return stateFactory.create(Correct,initCorrectState,exitCorrectState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/pairScoringForm"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,scoringFormFactory){
"use strict";function initMapState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());0===_.size(response.getMapEntries())?corrects:_.keys(response.getMapEntries());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please fill the gap with the images below, then edit the score for each gap/image pair.")),interaction.responseMappingMode=!0,widget.createGapImgs(),commonRenderer.render.call(interaction.getRenderer(),interaction),showChoicesId(interaction),0===_.size(response.getMapEntries())?updateForm(widget,corrects):updateForm(widget),
widget.$container.on("responseChange.qti-widget",function(e,data){var pairs,entries,type="single"===response.attr("cardinality")?"base":"list";data&&data.response&&data.response[type]&&(pairs=_.invoke(data.response[type].directedPair,Array.prototype.join," "),entries=_.keys(response.getMapEntries()),_(pairs).difference(entries).forEach(interaction.pairScoringForm.addPair,interaction.pairScoringForm)),removeGapFillers(interaction)}))}function exitMapState(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),interaction.pairScoringForm&&interaction.pairScoringForm.destroy(),commonRenderer.resetResponse(interaction),
commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(_.bind(widget.scaleGapList,widget)),widget.createChoices(),widget.createGapImgs())}function removeGapFillers(interaction){_.forEach(interaction.gapFillers,function(gapFiller){gapFiller.remove()}),interaction.gapFillers=[]}function showChoicesId(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&graphicHelper.createShapeText(interaction.paper,element,{shapeClick:!0,content:choice.id()})})}function updateForm(widget,entries){var interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),gapSrcs={};
_.forEach(interaction.getGapImgs(),function(gapImg){gapImg.object&&gapImg.object.attr("data")&&(gapSrcs[gapImg.id()]=widget.options.baseUrl+gapImg.object.attr("data"))});var options={leftTitle:__("Choice"),rightTitle:__("Gap"),type:"directedPair",pairLeft:function(){return _.map(interaction.getChoices(),function(choice){return{id:choice.id(),value:choice.id()}})},pairRight:function(){return _.map(interaction.getGapImgs(),function(gap){return{id:gap.id(),value:gap.id()}})},formatRight:function(id){var formated=id;return gapSrcs[id]&&(formated+="<br><img height='24px' src='"+gapSrcs[id]+"' />"),formated}};entries&&(options.entries=_.transform(entries,function(result,value){
result[value]=void 0!==mapEntries[value]?mapEntries[value]:response.mappingAttributes.defaultValue},{})),interaction.pairScoringForm=scoringFormFactory(widget,options)}return stateFactory.create(Map,initMapState,exitMapState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/Map"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='alt="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.objetLabel,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<li class="qti-choice qti-gapImg selectable" data-identifier="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.identifier,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <img src="'+escapeExpression((stack1=depth0&&depth0.object,stack1=null==stack1||stack1===!1?stack1:stack1.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.data,typeof stack1===functionType?stack1.apply(depth0):stack1))+'" \n         width="'+escapeExpression((stack1=depth0&&depth0.object,stack1=null==stack1||stack1===!1?stack1:stack1.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.width,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"\n         height="'+escapeExpression((stack1=depth0&&depth0.object,stack1=null==stack1||stack1===!1?stack1:stack1.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.height,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"\n         ',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.objectLabel),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    />\n</li>"})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/states/states","tpl!taoQtiItem/qtiCommonRenderer/tpl/choices/gapImg"],function($,_,__,Widget,GraphicWidget,states,gapImgTpl){
"use strict";var GraphicGapMatchInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(_.bind(this.scaleGapList,this)),paper&&(this.element.paper=paper,this.createChoices(),this.createGapImgs())},destroy:function(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)},scaleGapList:function(newSize,factor){
var $container=this.$original,$gapList=$("ul.source",$container);$gapList.css("max-width",newSize+"px"),factor&&1!==factor&&($gapList.find("img").each(function(){var $img=$(this);$img.width($img.attr("width")*factor),$img.height($img.attr("height")*factor)}),$container.data("factor",factor))},createGapImgs:function(){var interaction=this.element,$container=this.$original,$gapList=$("ul.source",$container);$gapList.empty(),_.forEach(interaction.gapImgs,function(gapImg){$gapList.append(gapImg.render())})}});return GraphicGapMatchInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicGapMatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicGapMatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicGapMatchInteraction/Widget"],function(_,GraphicGapMatchInteraction,GraphicGapMatchInteractionWidget){
"use strict";var CreatorGraphicGapMatchInteraction=_.clone(GraphicGapMatchInteraction);return CreatorGraphicGapMatchInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),GraphicGapMatchInteractionWidget.build(interaction,GraphicGapMatchInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGraphicGapMatchInteraction;
}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){
var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-graphicOrderInteraction clearfix',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,
fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n        <div class="clearfix"></div>\n        <ul class="none block-listing horizontal ordinals"></ul>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/graphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),$orderList=$("ul",$container),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_renderOrderList(interaction,$orderList),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction,$orderList)),
instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){graphic.highlightError(data.target)}})})},_renderChoice=function(interaction,$orderList,choice){graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(){this.active?_unselectShape(interaction.paper,this,$orderList):_selectShape(interaction.paper,this,$orderList),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice})})},_renderOrderList=function(interaction,$orderList){
var $orderers,size=_.size(interaction.getChoices()),min=interaction.attr("minChoices"),max=interaction.attr("maxChoices");max>0&&size>max?size=max:min>0&&size>min&&(size=min),_.times(size,function(index){var position=index+1,$orderer=$('<li class="selectable" data-number="'+position+'">'+position+"</li>");0===index&&$orderer.addClass("active"),$orderList.append($orderer)}),_createTexts(interaction.paper,size,$orderList),$orderers=$orderList.children("li"),$orderers.click(function(e){e.preventDefault();var $orderer=$(this);$orderer.hasClass("active")||$orderer.hasClass("disabled")||($orderers.removeClass("active"),$orderer.addClass("active"))})},_selectShape=function(paper,element,$orderList){
var $active=$orderList.find(".active:first");$active.length&&$active.data("number")>0&&(element.data("number",$active.data("number")),element.active=!0,_showText(paper,element),graphic.updateElementState(element,"active"),$active.toggleClass("active disabled").siblings(":not(.disabled)").first().toggleClass("active"))},_unselectShape=function(paper,element,$orderList){var number=element.data("number");element.active=!1,_hideText(paper,element),element.removeData("number"),graphic.updateElementState(element,"basic"),$orderList.children().removeClass("active").filter("[data-number="+number+"]").removeClass("disabled").addClass("active")},_createTexts=function(paper,size){
var texts=[];return _.times(size,function(index){var number=index+1,text=graphic.createText(paper,{id:"text-"+number,content:number,title:__("Remove"),style:"order-text",hide:!0});text.click(function(){paper.forEach(function(element){if(element.data("number")===number&&element.events){var evt=_.where(element.events,{name:"click"});evt.length&&evt[0]&&"function"==typeof evt[0].f&&evt[0].f.call(element)}})}),texts.push(text)}),texts},_showText=function(paper,element){var transf,bbox=element.getBBox(),text=paper.getById("text-"+element.data("number"));text&&(transf="T"+(bbox.x+bbox.width/2)+","+(bbox.y+bbox.height/2),text.transform(transf).show().toFront())},_hideText=function(paper,element){
var text=paper.getById("text-"+element.data("number"));text&&text.hide()},_getRawResponse=function(interaction){var response=[];return _.forEach(interaction.getChoices(),function(choice){var elt=interaction.paper.getById(choice.serial);elt&&elt.data("number")&&response.push({index:elt.data("number"),id:choice.id()})}),_(response).sortBy("index").map("id").value()},setResponse=function(interaction,response){var responseValues,$container=containerHelper.get(interaction),$orderList=$("ul",$container);if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(responseValues,function(responseValue,index){
var element,number=index+1,choice=_(interaction.getChoices()).where({attributes:{identifier:responseValue}}).first();choice&&(element=interaction.paper.getById(choice.serial),element&&($orderList.children("[data-number="+number+"]").addClass("active"),_selectShape(interaction.paper,element,$orderList)))})}},resetResponse=function(interaction){var $container=containerHelper.get(interaction),$orderList=$("ul",$container);_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&_unselectShape(interaction.paper,element,$orderList)}),$orderList.children("li").removeClass("active disabled").first().addClass("active");
},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style"),$("ul",$container).empty()),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),
interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"graphicOrderInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function($,stateFactory,SleepState){"use strict";var initSleepState=function(){
var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(data.value===!0?interaction.addClass("responsive"):interaction.removeClass("responsive"),widget.rebuild())})},exitSleepState=function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)};return stateFactory.extend(SleepState,initSleepState,exitSleepState)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};
var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n        <input type="text" name="data" value="',(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n    </div>\n\n    <div class="panel media-sizer-panel">\n        <!-- media sizer goes here -->\n    </div>\n    <input name="width" value="',(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n    <input name="height" value="',
(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n\n\n    <input name="type" value="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" readonly />\n\n    <hr>\n\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+'</h3>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices that the candidate is required to select to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices that the candidate is required to select to form a valid response.",options)))+"<br>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices that the candidate is allowed to select.",options):helperMissing.call(depth0,"__","The maximum number of choices that the candidate is allowed to select.",options)))+'\n        </span>\n\n\n    <div class="panel">\n        <div>\n            <label for="minChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+'</label>\n        <input name="minChoices" value="',(helper=helpers.minChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    </div>\n        <div>\n            <label for="maxChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+'</label>\n        <input name="maxChoices" value="',(helper=helpers.maxChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n        </div>\n    </div>\n\n</div>\n';
})}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='\n<div class="panel">\n    <label for="">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"identifier",options):helperMissing.call(depth0,"__","identifier",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options):helperMissing.call(depth0,"__",'The identifier of the choice. This identifier must not be used by any other choice or item variable. An identifier is a string of characters that must start with a Letter or an underscore ("_") and contain only Letters, underscores, hyphens ("-"), period (".", a.k.a. full-stop), Digits, CombiningChars and Extenders.',options)))+'</div>\n\n    <input type="text" \n           name="identifier" \n           value="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n           placeholder="e.g. my-hotspot_1" \n           data-validate="$notEmpty; $qtiIdentifier; $availableIdentifier(serial=',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+');">\n</div>\n\n<h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},
data:data},helper?helper.call(depth0,"Shape position",options):helperMissing.call(depth0,"__","Shape position",options)))+'</h3>\n\n<div class="panel">\n    <label for="x">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Left",options):helperMissing.call(depth0,"__","Left",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The left position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="x" value="',
(helper=helpers.x)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.x,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="y">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Top",options):helperMissing.call(depth0,"__","Top",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The top position of the shape relative to the top left corner of the background in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="y" value="',(helper=helpers.y)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.y,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="width">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Width",options):helperMissing.call(depth0,"__","Width",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape width in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="width" value="',
(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n\n<div class="panel">\n    <label for="height">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Height",options):helperMissing.call(depth0,"__","Height",options)))+'</label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options):helperMissing.call(depth0,"__","The shape height in pixels. This value may be scaled when the background image size is adapted to it's container",options)))+'</div>\n    <input name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" readonly />\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/graphicOrder","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,interactionFormElement,identifierHelper,formTpl,choiceFormTpl,panel,resourceManager,bgImage){
"use strict";var initQuestionState=function(){function enterChoiceForm(serial){var element,bbox,choice=interaction.getChoice(serial);choice&&(element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),formElement.initWidget($choiceForm),formElement.setChangeCallbacks($choiceForm,choice,{identifier:identifierHelper.updateChoiceIdentifier,fixed:formElement.getAttributeChangeCallback()}),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),
panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm))}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}var widget=this.widget,interaction=widget.element,paper=interaction.paper;if(paper){var $left,$top,$width,$height,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar");widget._editor=shapeEditor(widget,{
shapeCreated:function(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function(id){interaction.removeChoice(id)},enterHandling:function(shape){enterChoiceForm(shape.id)},quitHandling:function(){leaveChoiceForm()},shapeChange:function(shape){var bbox,choice=interaction.getChoice(shape.id);choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create(),
$(window).on("resize.changestate",function(){widget.changeState("sleep")}),widget.on("attributeChange",function(data){"maxChoices"===data.key&&widget.renderOrderList()})}},exitQuestionState=function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("graphicOrderInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0))},GraphicOrderInteractionStateQuestion=stateFactory.extend(Question,initQuestionState,exitQuestionState);
return GraphicOrderInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;$form.html(formTpl({baseUrl:options.baseUrl,maxChoices:parseInt(interaction.attr("maxChoices")),minChoices:parseInt(interaction.attr("minChoices")),choicesCount:_.size(interaction.getChoices()),data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices",{
updateCardinality:!1})),interactionFormElement.syncMaxChoices(widget)},GraphicOrderInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){"use strict";function initAnswerState(){answerStateHelper.forward(this.widget)}function exitAnswerState(){}return stateFactory.extend(Answer,initAnswerState,exitAnswerState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){
"use strict";function initCorrectState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please order the choices below to set the correct answer")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(PciResponse.unserialize(data.response,interaction))}))}function exitCorrectState(){
var widget=this.widget,interaction=widget.element;interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(_.bind(widget.scaleOrderList,widget)),widget.createChoices(),widget.renderOrderList())}return stateFactory.create(Correct,initCorrectState,exitCorrectState)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/Correct"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/states/states"],function($,_,__,Widget,GraphicWidget,states){var GraphicOrderInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(_.bind(this.scaleOrderList,this)),
paper&&(this.element.paper=paper,this.createChoices(),this.renderOrderList())},destroy:function(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)},scaleOrderList:function(newSize){$("ul.block-listing",this.$original).css("max-width",newSize+"px")},renderOrderList:function(){var interaction=this.element,size=_.size(interaction.getChoices()),min=interaction.attr("minChoices"),max=interaction.attr("maxChoices"),$orderList=$("ul.block-listing",this.$original);
max>0&&size>max?size=max:min>0&&size>min&&(size=min),$orderList.empty(),_.times(size,function(index){var position=index+1,$orderer=$('<li class="selectable" data-number="'+position+'">'+position+"</li>");0===index&&$orderer.addClass("active"),$orderList.append($orderer)})}});return GraphicOrderInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/GraphicOrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/GraphicOrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/graphicOrderInteraction/Widget"],function(_,GraphicOrderInteraction,GraphicOrderInteractionWidget){"use strict";var CreatorGraphicOrderInteraction=_.clone(GraphicOrderInteraction);
return CreatorGraphicOrderInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),GraphicOrderInteractionWidget.build(interaction,GraphicOrderInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorGraphicOrderInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-hotspotInteraction clearfix',
stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),container:$container}),_.forEach(interaction.getChoices(),_.partial(_renderChoice,interaction)),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),
getResponse:_getRawResponse,onError:function(data){data.target.active&&(data.target.active=!1,graphic.updateElementState(this,"basic",__("Select this area")),graphic.highlightError(data.target),containerHelper.triggerResponseChangeEvent(interaction),$container.trigger("inactiveChoice.qti-widget",[data.choice,data.target]))}})})},_renderChoice=function(interaction,choice){var $container=containerHelper.get(interaction);graphic.createElement(interaction.paper,choice.attr("shape"),choice.attr("coords"),{id:choice.serial,title:__("Select this area")}).click(function(){this.active?(graphic.updateElementState(this,"basic",__("Select this area")),this.active=!1,$container.trigger("inactiveChoice.qti-widget",[choice,this])):(graphic.updateElementState(this,"active",__("Click again to remove")),
this.active=!0,$container.trigger("activeChoice.qti-widget",[choice,this])),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:choice,target:this})})},_getRawResponse=function(interaction){return _(interaction.getChoices()).map(function(choice){var rElement=interaction.paper.getById(choice.serial);return rElement&&rElement.active===!0?choice.id():!1}).filter(_.isString).value()},setResponse=function(interaction,response){var responseValues;if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_.forEach(interaction.getChoices(),function(choice){
var rElement;_.contains(responseValues,choice.attributes.identifier)&&(rElement=interaction.paper.getById(choice.serial),rElement&&(rElement.active=!0,graphic.updateElementState(rElement,"active",__("Click again to remove")),instructionMgr.validateInstructions(interaction,{choice:choice,target:rElement})))})}},resetResponse=function(interaction){_.forEach(interaction.getChoices(),function(choice){var element=interaction.paper.getById(choice.serial);element&&(element.active=!1,graphic.updateElementState(element,"basic"))}),instructionMgr.resetInstructions(interaction)},getResponse=function(interaction){var response=(_getRawResponse(interaction),pciResponse.serialize(_getRawResponse(interaction),interaction));
return response},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();
return response&&(state.response=response),state};return{qtiClass:"hotspotInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function($,stateFactory,SleepState){"use strict";var initSleepState=function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(data.value===!0?interaction.addClass("responsive"):interaction.removeClass("responsive"),
widget.rebuild())})},exitSleepState=function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)};return stateFactory.extend(SleepState,initSleepState,exitSleepState)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n        <input type="text" name="data" value="',
(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n    </div>\n\n    <div class="panel media-sizer-panel">\n        <!-- media sizer goes here -->\n    </div>\n    <input name="width" value="',
(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n    <input name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n\n\n        <input name="type" value="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" readonly />\n\n    <hr>\n\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+'</h3>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices that the candidate is required to select to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices that the candidate is required to select to form a valid response.",options)))+"<br>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices that the candidate is allowed to select.",options):helperMissing.call(depth0,"__","The maximum number of choices that the candidate is allowed to select.",options)))+'\n        </span>\n\n    <div class="panel">\n        <div>\n            <label for="minChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+'</label>\n        <input name="minChoices" value="',(helper=helpers.minChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minChoices,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    </div>\n        <div>\n            <label for="maxChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+'</label>\n        <input name="maxChoices" value="',
(helper=helpers.maxChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    </div>\n    </div>\n\n\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hotspot","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/hotspot","taoQtiItem/qtiCreator/helper/panel","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,GraphicHelper,stateFactory,Question,shapeEditor,imageSelector,formElement,interactionFormElement,identifierHelper,formTpl,choiceFormTpl,panel,resourceManager,bgImage){
"use strict";var initQuestionState=function(){function enterChoiceForm(serial){var element,bbox,choice=interaction.getChoice(serial);choice&&(element=interaction.paper.getById(serial),bbox=element.getBBox(),$choiceForm.empty().html(choiceFormTpl({identifier:choice.id(),fixed:choice.attr("fixed"),serial:serial,x:parseInt(bbox.x,10),y:parseInt(bbox.y,10),width:parseInt(bbox.width,10),height:parseInt(bbox.height,10)})),formElement.initWidget($choiceForm),formElement.setChangeCallbacks($choiceForm,choice,{identifier:identifierHelper.updateChoiceIdentifier,fixed:formElement.getAttributeChangeCallback()}),$formChoicePanel.show(),panel.openSections($formChoicePanel.children("section")),
panel.closeSections($formInteractionPanel.children("section")),$left=$("input[name=x]",$choiceForm),$top=$("input[name=y]",$choiceForm),$width=$("input[name=width]",$choiceForm),$height=$("input[name=height]",$choiceForm))}function leaveChoiceForm(){"none"!==$formChoicePanel.css("display")&&(panel.openSections($formInteractionPanel.children("section")),$formChoicePanel.hide(),$choiceForm.empty())}var widget=this.widget,interaction=widget.element,paper=interaction.paper;if(paper){var $left,$top,$width,$height,$choiceForm=widget.choiceForm,$formInteractionPanel=$("#item-editor-interaction-property-bar"),$formChoicePanel=$("#item-editor-choice-property-bar");widget._editor=shapeEditor(widget,{
shapeCreated:function(shape,type){var newChoice=interaction.createChoice({shape:"path"===type?"poly":type,coords:GraphicHelper.qtiCoords(shape)});shape.id=newChoice.serial},shapeRemoved:function(id){interaction.removeChoice(id)},enterHandling:function(shape){enterChoiceForm(shape.id)},quitHandling:function(){leaveChoiceForm()},shapeChange:function(shape){var bbox,choice=interaction.getChoice(shape.id);choice&&(choice.attr("coords",GraphicHelper.qtiCoords(shape)),$left&&$left.length&&(bbox=shape.getBBox(),$left.val(parseInt(bbox.x,10)),$top.val(parseInt(bbox.y,10)),$width.val(parseInt(bbox.width,10)),$height.val(parseInt(bbox.height,10))))}}),widget._editor.create(),
$(window).on("resize.changestate",function(){widget.changeState("sleep")})}},exitQuestionState=function(){var widget=this.widget,interaction=widget.element,paper=interaction.paper,valid=!!interaction.object.attr("data")&&!_.isEmpty(interaction.choices);widget.isValid("hotspotInteraction",valid),paper&&($(window).off("resize.changestate"),widget._editor&&widget._editor.destroy(),$(".image-editor.solid, .block-listing.source",widget.$container).css("min-width",0))},HotspotInteractionStateQuestion=stateFactory.extend(Question,initQuestionState,exitQuestionState);return HotspotInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;
$form.html(formTpl({baseUrl:options.baseUrl,maxChoices:parseInt(interaction.attr("maxChoices")),minChoices:parseInt(interaction.attr("minChoices")),choicesCount:_.size(interaction.getChoices()),data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks(this.widget.$form,"minChoices","maxChoices")),interactionFormElement.syncMaxChoices(widget)},HotspotInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){
"use strict";var initAnswerState=function(){answerStateHelper.forward(this.widget)},exitAnswerState=function(){};return stateFactory.extend(Answer,initAnswerState,exitAnswerState)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){"use strict";var initCorrectState=function(){
var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please select the correct hotspot choices below.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(PciResponse.unserialize(data.response,interaction))}))},exitCorrectState=function(){var widget=this.widget,interaction=widget.element;
interaction.paper&&(widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())};return stateFactory.create(Correct,initCorrectState,exitCorrectState)}),define("taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup",["jquery","lodash"],function($,_){return function(paper,shape,$container,isResponsive){var wfactor,margin=10,$shape=$(shape.node),$element=$('<div class="mapping-editor arrow-left-top"></div>'),boxOffset=$container.offset(),offset=$shape.offset(),bbox=shape.getBBox(),width=bbox.width;
return isResponsive&&(wfactor=paper.w/paper.width,width=Math.round(width*(2-wfactor))),$element.css({top:offset.top-boxOffset.top-margin,left:offset.left-boxOffset.left+width+margin}).appendTo($container),$element}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n        <div class="panel" data-edit="correct">\n            <label>\n                '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Correct",options):helperMissing.call(depth0,"__","Correct",options)))+'\n                <input name="correct" type="checkbox" ',
stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\n                <span class="icon-checkbox"></span>\n            </label>\n            <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Is this choice the correct response?",options):helperMissing.call(depth0,"__","Is this choice the correct response?",options)))+"</span>\n        </div>\n";
}function program2(depth0,data){return' checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,functionType="function";return buffer+='    <a class="closer" href="#" data-close=":parent .mapping-editor"></a>\n    <div class="form-container">\n        <h2>',(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h2>\n\n",
stack1=helpers.unless.call(depth0,depth0&&depth0.noCorrect,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        <div class="panel">\n            <label for="score">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Score",options):helperMissing.call(depth0,"__","Score",options)))+'</label>\n            <input value="',(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" data-for="',
(helper=helpers.identifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.identifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" name="score" class="score" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)" />\n            <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Set the score for this response",options):helperMissing.call(depth0,"__","Set the score for this response",options)))+'</span>\n        </div>\n        <span class="arrow"></span>\n        <span class="arrow-cover"></span>\n    </div>\n';
})}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/deleter","ui/tooltipster"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,answerStateHelper,grahicScorePopup,mappingFormTpl,formElement,deleter,tooltipster){
"use strict";function initResponseMapping(widget){var scoreTexts={},interaction=widget.element,$container=widget.$original,isResponsive=$container.hasClass("responsive"),$imageBox=$(".main-image-box",$container),response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),corrects=_.values(response.getCorrect());_.forEach(interaction.getChoices(),function(choice){var shape=interaction.paper.getById(choice.serial),$popup=grahicScorePopup(interaction.paper,shape,$imageBox,isResponsive),score=mapEntries[choice.id()]||response.mappingAttributes.defaultValue||"0";scoreTexts[choice.serial]=graphicHelper.createShapeText(interaction.paper,shape,{
id:"score-"+choice.serial,content:score,style:"score-text-default",shapeClick:!0}).data("default",!0);var $form=$(mappingFormTpl({identifier:choice.id(),correctDefined:answerStateHelper.isCorrectDefined(widget),correct:_.contains(response.getCorrect(),choice.id()),score:score,scoreMin:response.getMappingAttribute("lowerBound"),scoreMax:response.getMappingAttribute("upperBound")}));formElement.setChangeCallbacks($form,response,{score:function(response,value){var scoreText=scoreTexts[choice.serial];""===value?(response.removeMapEntry(choice.id()),scoreText.attr({text:response.mappingAttributes.defaultValue}).data("default",!0)):(response.setMapEntry(choice.id(),value,!0),
scoreText.attr({text:value}).data("default",!1))},correct:function(response,value){value===!0?_.contains(corrects,choice.id())||(corrects.push(choice.id()),shape.active=!0,graphicHelper.updateElementState(shape,"active")):(corrects=_.without(corrects,choice.id()),shape.active=!1,graphicHelper.updateElementState(shape,"basic")),response.setCorrect(corrects)}}),shape.click(function(){$(".mapping-editor",$container).hide(),$popup.show()}),$popup.append($form)}),deleter($container),tooltipster($container),interaction.paper.getById("bg-image-"+interaction.serial).click(function(){$(".mapping-editor",$container).hide()}),$(".mapping-editor",$container).on("click",".closer",function(){
$(this).parent(".mapping-editor").hide()}),widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&_.forEach(scoreTexts,function(scoreText){scoreText.data("default")===!0&&scoreText.attr({text:data.value})})})}var initMapState=function(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),interaction.paper&&(instructionMgr.appendInstruction(interaction,__("Please the score of each hotspot choice.")),interaction.responseMappingMode=!0,interaction.paper=widget.createPaper(),widget.createChoices(),initResponseMapping(widget),
commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)))},exitMapState=function(){var widget=this.widget,interaction=widget.element;interaction.paper&&(commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=widget.createPaper(),widget.createChoices())};return stateFactory.create(Map,initMapState,exitMapState)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/Map"],function(factory,states){
"use strict";return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/states/states"],function($,_,__,Widget,GraphicWidget,states){"use strict";var HotspotInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),Widget.initCreator.call(this),paper=this.createPaper(),
paper&&(this.element.paper=paper,this.createChoices())},destroy:function(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)}});return HotspotInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/HotspotInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HotspotInteraction","taoQtiItem/qtiCreator/widgets/interactions/hotspotInteraction/Widget"],function(_,HotspotInteraction,HotspotInteractionWidget){"use strict";var CreatorHotspotInteraction=_.clone(HotspotInteraction);
return CreatorHotspotInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),HotspotInteractionWidget.build(interaction,HotspotInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorHotspotInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-hottextInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{
hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="hottextInteraction">\n  ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <div class="qti-flow-container">',(helper=helpers.body)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/hottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var pseudoLabel=function(interaction){var $container=containerHelper.get(interaction),setChoice=function($choice,interaction){
var $inupt=$choice.find("input");if($inupt.prop("checked")||$inupt.hasClass("disabled"))$inupt.prop("checked",!1);else{var maxChoices=parseInt(interaction.attr("maxChoices")),currentChoices=_.values(_getRawResponse(interaction)).length;(maxChoices>currentChoices||0===maxChoices)&&$inupt.prop("checked",!0)}containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{choice:$choice})};$(".hottext",$container).on("click",function(e){e.preventDefault(),setChoice($(this),interaction)})},render=function(interaction){pseudoLabel(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),
max:interaction.attr("maxChoices"),getResponse:_getRawResponse,onError:function(data){var $input,$choice,$icon;data.choice&&data.choice.length&&($choice=data.choice.addClass("error"),$input=$choice.find("input"),$icon=$choice.find(" > label > span").addClass("error cross"),setTimeout(function(){$input.prop("checked",!1),$choice.removeClass("error"),$icon.removeClass("error cross")},350))}})},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$("input",$container).prop("checked",!1)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction);try{_.each(pciResponse.unserialize(response,interaction),function(identifier){
$container.find("input[value="+identifier+"]").prop("checked",!0)}),instructionMgr.validateInstructions(interaction)}catch(e){throw new Error("wrong response format in argument : "+e)}},_getRawResponse=function(interaction){var values=[],$container=containerHelper.get(interaction);return $("input:checked",$container).each(function(){values.push($(this).val())}),values},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);$container.find(".hottext").off("click"),containerHelper.reset(interaction)},setState=function(interaction,state){
_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"hottextInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hottext",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+'</h3>\n\n    <div>\n        <label for="minChoices" class="spinner">Min</label>\n        <input name="minChoices" value="',(helper=helpers.minChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minChoices,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices that the candidate is required to select to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices that the candidate is required to select to form a valid response.",options)))+'\n        </span>\n    </div>\n    <div>\n        <label for="maxChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+'</label>\n        <input name="maxChoices" value="',(helper=helpers.maxChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',(helper=helpers.choicesCount)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choicesCount,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n            <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices that the candidate is allowed to select to form a valid response.",options):helperMissing.call(depth0,"__","The maximum number of choices that the candidate is allowed to select to form a valid response.",options)))+"\n        </span>\n    </div>\n</div>\n"})}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext-create",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;
return buffer+='<span class="mini-tlb" data-edit="',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-role="create-hottext-tlb">\n    <span class="rgt tlb-button" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Create hottext",options):helperMissing.call(depth0,"__","Create hottext",options)))+'" data-role="create-hottext">\n        <span class="icon-magicwand"></span>\n    </span>\n</span>';
})}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Question",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/hottext","tpl!taoQtiItem/qtiCreator/tpl/toolbars/hottext-create"],function(_,stateFactory,Question,formElement,interactionFormElement,formTpl,hottextTpl){var HottextInteractionStateQuestion=stateFactory.extend(Question);return HottextInteractionStateQuestion.prototype.initForm=function(){
var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({maxChoices:interaction.attr("maxChoices"),minChoices:interaction.attr("minChoices"),choicesCount:_.size(interaction.getChoices())})),formElement.initWidget($form);var callbacks=formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices");formElement.setChangeCallbacks($form,interaction,callbacks),interactionFormElement.syncMaxChoices(_widget)},HottextInteractionStateQuestion.prototype.getGapModel=function(){return{toolbarTpl:hottextTpl,qtiClass:"hottext",afterCreate:function(interactionWidget,newHottextWidget,text){newHottextWidget.element.body(text),newHottextWidget.$container.find(".hottext-content").html(text),
newHottextWidget.changeState("choice")}}},HottextInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var HottextInteractionStateAnswer=stateFactory.extend(Answer,function(){this.widget.$original.find(".hottext-checkmark > input").removeProp("disabled"),answerStateHelper.forward(this.widget)},function(){this.widget.$original.find(".hottext-checkmark > input").prop("disabled","disabled");
});return HottextInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Correct",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,__,stateFactory,Correct,commonRenderer,instructionMgr,PciResponse){function initCorrectState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration();commonRenderer.resetResponse(interaction),
commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please select the correct hottext choices below.")),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(_.values(response.getCorrect()),interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(PciResponse.unserialize(data.response,interaction))})}function exitCorrectState(){var widget=this.widget,interaction=widget.element;widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction);
}return stateFactory.create(Correct,initCorrectState,exitCorrectState)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,stateFactory,Map,commonRenderer,answerStateHelper,instructionMgr,formElement,PciResponse){
function initMapState(){var widget=this.widget,interaction=widget.element,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please enter the score for the given hottexts.")),interaction.responseMappingMode=!0,createScoreForm(interaction,widget.$container),commonRenderer.render.call(interaction.getRenderer(),interaction),commonRenderer.setResponse(interaction,PciResponse.serialize(corrects,interaction)),widget.$container.on("responseChange.qti-widget",function(e,data){var type="single"===response.attr("cardinality")?"base":"list";
data&&data.response&&data.response[type]&&response.setCorrect(data.response[type].identifier)}),widget.on("metaChange",function(meta){"defineCorrect"===meta.key&&(toggleCorrectState(widget.$container,meta.value),meta.value===!1&&response.setCorrect([]))}),toggleCorrectState(widget.$container,answerStateHelper.defineCorrect(response))}function exitMapState(){var widget=this.widget,interaction=widget.element,$container=widget.$container;$container.off("responseChange.qti-widget"),$(".score",$container).remove(),toggleCorrectState($container,!0),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction);
}function toggleCorrectState($container,enable){enable?$(".hottext-checkmark > input",$container).removeProp("disabled").removeClass("disabled"):$(".hottext-checkmark > input",$container).prop("disabled",!0).prop("checked",!1).addClass("disabled")}function createScoreForm(interaction,$container){var callbacks={},response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries();$(".hottext",$container).on("click",function(e){($(e.target).hasClass("score")||answerStateHelper.defineCorrect(response)===!1)&&(e.preventDefault(),e.stopImmediatePropagation())}),_.forEach(interaction.getChoices(),function(choice){var $score,id=choice.serial+"-score",$hottext=$('[data-serial="'+choice.serial+'"]',$container);
$hottext.length&&($score=$("<input type='text' name='"+id+"' class='score' title='"+__("Score value")+"' data-validate='$numeric' data-validate-option='$allowEmpty; $event(type=keyup)' />"),$score.val(void 0!==mapEntries[choice.id()]?mapEntries[choice.id()]:response.mappingAttributes.defaultValue),$hottext.append($score),callbacks[id]=function(response,value){""===value?response.removeMapEntry(choice.id()):response.setMapEntry(choice.id(),value,!0)})}),formElement.setChangeCallbacks($container,response,callbacks)}return stateFactory.create(Map,initMapState,exitMapState)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/containerInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/Map"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/states/states"],function(Widget,states){var HottextInteractionWidget=Widget.clone();return HottextInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},HottextInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/HottextInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/HottextInteraction","taoQtiItem/qtiCreator/widgets/interactions/hottextInteraction/Widget"],function(_,HottextInteraction,HottextInteractionWidget){
"use strict";var CreatorHottextInteraction=_.clone(HottextInteraction);return CreatorHottextInteraction.render=function(interaction,options){HottextInteractionWidget.build(interaction,HottextInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorHottextInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<select ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-inlineInteraction qti-inlineChoiceInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"\n        data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n        data-qti-class="inlineChoiceInteraction"\n        data-has-search="false">\n    <option></option>                \n    <option value="empty"></option>\n    ',options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n</select>\n"})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/inlineChoiceInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","select2","tooltipster"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var _emptyValue="empty",_defaultOptions={allowEmpty:!0,placeholderText:__("select a choice")},render=function(interaction,options){var opts=_.clone(_defaultOptions),required=!!interaction.attr("required");
_.extend(opts,options);var $container=containerHelper.get(interaction);opts.allowEmpty&&!required?$container.find("option[value="+_emptyValue+"]").text("--- "+__("leave empty")+" ---"):$container.find("option[value="+_emptyValue+"]").remove(),$container.select2({width:"element",placeholder:opts.placeholderText,minimumResultsForSearch:-1,dropdownCssClass:"qti-inlineChoiceInteraction-dropdown"});var $el=$container.select2("container");_setInstructions(interaction),$container.on("change",function(){required&&""!==$container.val()&&$el.tooltipster("hide"),containerHelper.triggerResponseChangeEvent(interaction)}).on("select2-open",function(){required&&$el.tooltipster("hide");
}).on("select2-close",function(){required&&""===$container.val()&&$el.tooltipster("show")})},_setInstructions=function(interaction){var required=!!interaction.attr("required"),$container=interaction.getContainer(),$el=$container.select2("container");required&&($el.tooltipster({theme:"tao-warning-tooltip",content:__("A choice must be selected"),delay:250,trigger:"custom"}),""===$container.val()&&$el.tooltipster("show"))},resetResponse=function(interaction){_setVal(interaction,_emptyValue)},_setVal=function(interaction,choiceIdentifier){containerHelper.get(interaction).val(choiceIdentifier).select2("val",choiceIdentifier)},setResponse=function(interaction,response){
_setVal(interaction,pciResponse.unserialize(response,interaction)[0])},_getRawResponse=function(interaction){var value=containerHelper.get(interaction).val();return value&&value!==_emptyValue?[value]:[]},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},destroy=function(interaction){var $container=containerHelper.get(interaction);$(document).off(".commonRenderer"),$container.select2("destroy"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),
_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$container.select2("disable").select2("close"),$("option[data-identifier]",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));return aIndex>bIndex?1:bIndex>aIndex?-1:0}).detach().appendTo($container),$container.select2("enable")))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],
$("option[data-identifier]",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"inlineChoiceInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Question","taoQtiItem/qtiCreator/widgets/choices/helpers/formElement","lodash"],function($,stateFactory,QuestionState,formElement,_){var ChoiceStateQuestion=stateFactory.extend(QuestionState,function(){
this.buildEditor()},function(){this.destroyEditor()});return ChoiceStateQuestion.prototype.createToolbar=function(){var _widget=this.widget,$toolbar=_widget.$container.find("td:last");return formElement.initShufflePinToggle(_widget),formElement.initDelete(_widget),$toolbar},ChoiceStateQuestion.prototype.buildEditor=function(){var _widget=this.widget,$editableContainer=_widget.$container.children("td:first");$editableContainer.attr("contentEditable",!0),$editableContainer.on("keyup.qti-widget",_.throttle(function(){_widget.element.val(_.escape($(this).text())),_widget.$original.width($(this).width())},200)).on("focus.qti-widget",function(){_widget.changeState("choice");
}).on("keypress.qti-widget",function(e){13===e.which&&(e.preventDefault(),$(this).blur(),_widget.changeState("question"))})},ChoiceStateQuestion.prototype.destroyEditor=function(){var $container=this.widget.$container;$container.find("td").removeAttr("contentEditable"),$container.children("td:first").off("keyup.qti-widget")},ChoiceStateQuestion}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/Choice","tpl!taoQtiItem/qtiCreator/tpl/forms/choices/choice","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/helpers/identifier"],function(stateFactory,Choice,formTpl,formElement,identifierHelper){
var InlineChoiceStateChoice=stateFactory.extend(Choice);return InlineChoiceStateChoice.prototype.initForm=function(){var _widget=this.widget;_widget.$form.html(formTpl({serial:_widget.element.getSerial(),identifier:_widget.element.id()})),formElement.setChangeCallbacks(_widget.$form,_widget.element,{identifier:identifierHelper.updateChoiceIdentifier})},InlineChoiceStateChoice}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/choices/states/states","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Question","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/Choice"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget",["taoQtiItem/qtiCreator/widgets/choices/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/states/states"],function(Widget,states){var InlineChoiceWidget=Widget.clone();return InlineChoiceWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},InlineChoiceWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",self=this,helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div class="panel">\n    <label>\n        <input name="shuffle" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.shuffle,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Shuffle choices",options):helperMissing.call(depth0,"__","Shuffle choices",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be shuffled of fixed individually.",options):helperMissing.call(depth0,"__","If the shuffle attribute is true then the delivery engine will randomize the order in which the choices are initially presented.\n        However each choice may be shuffled of fixed individually.",options)))+'\n    </span>\n</div>\n<div class="panel">\n    <label>\n        <input name="required" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.required,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"required",options):helperMissing.call(depth0,"__","required",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options):helperMissing.call(depth0,"__","Define whether a choice must be selected by the candidate in order to form a valid response to the interaction.",options)))+"\n    </span>\n</div>\n";
})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/inlineChoice"],function($,stateFactory,Question,formElement,formTpl){var InlineChoiceInteractionStateQuestion=stateFactory.extend(Question,function(){var $mainOption=this.widget.$container.find(".main-option"),$original=this.widget.$original;$(document).on("choiceTextChange.qti-widget.question",function(){$original.width($mainOption.width())})},function(){
$(document).off(".qti-widget.question")});return InlineChoiceInteractionStateQuestion.prototype.addNewChoiceButton=function(){var _widget=this.widget,$addChoice=_widget.$container.find(".add-option"),interaction=_widget.element;$addChoice.data("initialized")||($addChoice.on("click.qti-widget",function(e){e.stopPropagation();var choice=interaction.createChoice();$(this).closest("tr").before(_widget.renderChoice(choice)),_widget.buildChoice(choice,{ready:function(widget){widget.changeState("question")}})}),$addChoice.data("initialized",!0))},InlineChoiceInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;
$form.html(formTpl({shuffle:!!interaction.attr("shuffle"),required:!!interaction.attr("required")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{shuffle:formElement.getAttributeChangeCallback(),required:formElement.getAttributeChangeCallback()})},InlineChoiceInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var InlineChoiceInteractionStateAnswer=stateFactory.extend(Answer,function(){
answerStateHelper.forward(this.widget)},function(){});return InlineChoiceInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget",["jquery","lodash","i18n","taoQtiItem/qtiCommonRenderer/renderers/Renderer"],function($,_,__,CommonRenderer){"use strict";var ResponseWidget={create:function(widget,callback){var self=this,interaction=widget.element,$placeholder=$("<select>"),$responseWidget=widget.$container.find(".widget-response").append($placeholder);this.commonRenderer=new CommonRenderer({shuffleChoices:!1,themes:!1}),this.commonRenderer.load(function(){interaction.render({},$placeholder,"",this),interaction.postRender({
allowEmpty:!1,placeholderText:__("select correct choice")},"",this),callback.call(self,this),$responseWidget.siblings(".padding").width($responseWidget.width()+50)},["inlineChoice","inlineChoiceInteraction"])},setResponse:function(widget,response){this.commonRenderer.setResponse(widget.element,this.formatResponse(response))},destroy:function(widget){widget.$container.find(".widget-response").empty(),widget.$container.find(".padding").removeAttr("style")},formatResponse:function(response){return _.isString(response)||(response=_.values(response),response&&response.length&&(response=response[0])),{base:{identifier:response}}},unformatResponse:function(formatedResponse){
var response=[];return formatedResponse.base&&formatedResponse.base.identifier&&response.push(formatedResponse.base.identifier),response}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var InlineChoiceInteractionStateCorrect=stateFactory.create(Correct,function(){var _widget=this.widget,response=this.widget.element.getResponseDeclaration();_widget.$container.find("table").hide(),
responseWidget.create(_widget,function(){responseWidget.setResponse(_widget,_.values(response.getCorrect())),_widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(responseWidget.unformatResponse(data.response))})})},function(){var $container=this.widget.$container;$container.find("table").show(),$container.off("responseChange.qti-widget"),responseWidget.destroy(this.widget)});return InlineChoiceInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiItem/helper/interactionHelper","lodash"],function($,stateFactory,Map,formElement,interactionHelper,_){
var AssociateInteractionStateCorrect=stateFactory.create(Map,function(){var _widget=this.widget,$container=_widget.$container,interaction=_widget.element,response=interaction.getResponseDeclaration();$container.find("[data-edit=map]").show();var correct=_.values(response.getCorrect());if(correct.length){var selectedChoice=interaction.getChoiceByIdentifier(correct.pop());selectedChoice&&$container.find('input[name=correct][value="'+selectedChoice.serial+'"]').prop("checked",!0)}formElement.setChangeCallbacks($container,response,{correct:function(response,value){response.setCorrect(interactionHelper.serialToIdentifier(interaction,value))},score:function(response,value){
var score=parseFloat(value);isNaN(score)||response.setMapEntry(interactionHelper.serialToIdentifier(interaction,$(this).data("for")),score)}})},function(){});return AssociateInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/Map"],function(factory,states){
return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+='<div class="widget-box widget-inline widget-inlineChoiceInteraction" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-edit="active">\n    <div class="qti-interaction qti-inlineChoiceInteraction">\n        <table>\n            <colgroup>\n                <col class="text">\n                <col class="icon">\n                <col class="icon">\n            </colgroup>\n            <tbody>\n                <tr>\n                    <td class="main-option"><div>-- '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"edit choices",options):helperMissing.call(depth0,"__","edit choices",options)))+' --<span class="icon-down"></span></div></td>\n                    <td class="icon-title" data-edit="map">correct</td>\n                    <td class="icon-title" data-edit="map">score</td>\n                </tr>\n                ',
options={hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                <tr data-edit="question">\n                    <td>\n                        <div class="add-option">\n                            <span class="icon-add"></span>\n                            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Add choice",options):helperMissing.call(depth0,"__","Add choice",options)))+'\n                        </div>\n                    </td>\n                    <td colspan="2"></td>\n                </tr>\n            </tbody>\n        </table>\n        <div>\n            <div class="widget-response" data-edit="correct"></div>\n            <div class="padding"></div>\n        </div>\n    </div>\n</div>'})}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"pin";
}function program3(depth0,data){return"shuffle"}function program5(depth0,data){var buffer="";return buffer}function program7(depth0,data){return"display:none;"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<tr class="widget-box widget-inlineChoice qti-choice" data-edit="active" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <td class="option"><div contenteditable="true">',
(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</div></td>\n    <td class="mini-tlb">\n        <span data-edit="question" class="tlb-button">\n            <span  class="icon-',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.fixed),{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-role="shuffle-pin" style="',stack1=helpers["if"].call(depth0,depth0&&depth0.interactionShuffle,{
hash:{},inverse:self.program(7,program7,data),fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"></span>\n        </span>\n        <label data-edit="map">\n            <input name="correct" type="radio" value="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <span class="icon-radio"></span>\n        </label>\n    </td>\n    <td class="mini-tlb">\n        <span data-edit="question" class="icon-bin" data-role="delete"></span>\n        <input class="score" name="score" data-edit="map" value="',
(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)"/>\n    </td>\n</tr>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget",["lodash","taoQtiItem/qtiItem/core/Element","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/choices/inlineChoice/Widget","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoice"],function(_,Element,InteractionWidget,ChoiceWidget,states,inlineChoiceInteractionTpl,inlineChoiceTpl){
var InlineChoiceInteractionWidget=InteractionWidget.clone();return InlineChoiceInteractionWidget.initCreator=function(options){var _this=this;this.registerStates(states),InteractionWidget.initCreator.call(this),this.$choiceOptionForm=options.choiceOptionForm,_.each(this.element.getChoices(),function(choice){_this.buildChoice(choice)}),this.$container.find(".tlb-title").remove()},InlineChoiceInteractionWidget.renderChoice=function(choice,shuffleChoice){var tplData={tag:choice.qtiClass,serial:choice.serial,attributes:choice.attributes,body:_.unescape(choice.text),interactionShuffle:shuffleChoice};return inlineChoiceTpl(tplData)},InlineChoiceInteractionWidget.renderInteraction=function(){
var _this=this,interaction=this.element,shuffleChoice=interaction.attr("shuffle"),tplData={tag:interaction.qtiClass,serial:interaction.serial,attributes:interaction.attributes,choices:[]};return _.each(interaction.getChoices(),function(choice){Element.isA(choice,"choice")&&tplData.choices.push(_this.renderChoice(choice,shuffleChoice))}),inlineChoiceInteractionTpl(tplData)},InlineChoiceInteractionWidget.buildChoice=function(choice,options){ChoiceWidget.build(choice,this.$container.find('.widget-inlineChoice[data-serial="'+choice.serial+'"]'),this.$choiceOptionForm,options)},InlineChoiceInteractionWidget.buildContainer=function(){var previous,next;this.$original.length&&(previous=this.$original[0].previousSibling,
next=this.$original[0].nextSibling,(!previous||3===previous.nodeType&&""===previous.nodeValue||3!==previous.nodeType)&&this.$original.before("&nbsp;"),(!next||3===next.nodeType&&""===next.nodeValue||3!==next.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-inlineChoiceInteraction[data-serial="+this.element.getSerial()+"]")},InlineChoiceInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<span class="widget-box inlineChoiceInteraction-placeholder" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="inlineChoiceInteraction">\n    <label>-- '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},
data:data},helper?helper.call(depth0,"edit choices",options):helperMissing.call(depth0,"__","edit choices",options)))+' --</label>\n    <span class="icon-down"></span>\n</span>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/InlineChoiceInteraction",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/InlineChoiceInteraction","taoQtiItem/qtiCreator/widgets/interactions/inlineChoiceInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/inlineChoiceInteraction.placeholder"],function($,_,InlineChoiceInteraction,InlineChoiceInteractionWidget,tpl){"use strict";var CreatorInlineChoiceInteraction=_.clone(InlineChoiceInteraction);
return CreatorInlineChoiceInteraction.template=tpl,CreatorInlineChoiceInteraction.render=function(interaction,options){options=options||{},options.choiceOptionForm=this.getOption("choiceOptionForm"),InlineChoiceInteractionWidget.build(interaction,$('.inlineChoiceInteraction-placeholder[data-serial="'+interaction.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorInlineChoiceInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";
return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:"";
}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program9(depth0,data,depth1){var stack1,buffer="";return buffer+="\n      <tr>\n        ",stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.each.call(depth0,depth1&&depth1.matchSet1,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      "}function program10(depth0,data){return'\n        <td>\n          <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n          </label>\n        </td>\n        ';
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-matchInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{
hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="matchInteraction">\n  ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n  <div class="instruction-container"></div>\n  <div class="match-interaction-area">\n    <table class="matrix">\n      <thead>\n      <tr>\n        <th> </th>\n        ',
options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.matchSet1)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet1,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.matchSet1||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n      </tr>\n      </thead>\n      <tbody>\n      ",options={hash:{},inverse:self.noop,fn:self.programWithDepth(9,program9,data,depth0),data:data},(helper=helpers.matchSet2)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet2,
stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.matchSet2||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.programWithDepth(9,program9,data,depth0),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n      </tbody>\n    </table>\n  </div>\n  <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/matchInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){
"use strict";var inWarning=!1,render=function(interaction){var $container=containerHelper.get(interaction);_setInstructions(interaction),$container.on("click.commonRenderer","input[type=checkbox]",function(e){_onCheckboxSelected(interaction,e)}),instructionMgr.validateInstructions(interaction)},setResponse=function(interaction,response){response=_filterResponse(response),"undefined"!=typeof response.list&&"undefined"!=typeof response.list.directedPair&&_(response.list.directedPair).forEach(function(directedPair){var x=$("th[data-identifier="+directedPair[0]+"]").index()-1,y=$("th[data-identifier="+directedPair[1]+"]").parent().index();$(".matrix > tbody tr").eq(y).find("input[type=checkbox]").eq(x).attr("checked",!0);
}),instructionMgr.validateInstructions(interaction)},getResponse=function(interaction){var response=pciResponse.serialize(_getRawResponse(interaction),interaction);return response},resetResponse=function(interaction){var $container=containerHelper.get(interaction);$("input[type=checkbox]:checked",$container).each(function(){$(this).prop("checked",!1)}),instructionMgr.validateInstructions(interaction)},_filterResponse=function(response){if("undefined"==typeof response.list){if("undefined"==typeof response.base)throw"The given response is not compliant with PCI JSON representation.";if(null===response.base)return{list:{directedPair:[]}};if("undefined"==typeof response.base.directedPair)throw"The matchInteraction only accepts directedPair values as responses.";
return{list:{directedPair:[response.base.directedPair]}}}if("undefined"==typeof response.list.directedPair)throw"The matchInteraction only accept directedPair values as responses.";return response},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),values=[];return $container.find("input[type=checkbox]:checked").each(function(){values.push(_inferValue(this))}),values},_inferValue=function(element){var $element=$(element),y=$element.closest("tr").index(),x=$element.closest("td").index(),firstId=$(".matrix > thead th").eq(x).data("identifier"),secondId=$(".matrix > tbody th").eq(y).data("identifier");return[firstId,secondId]},_onCheckboxSelected=function(interaction,e){
var choice,currentResponse=_getRawResponse(interaction),maxAssociations=(interaction.attr("minAssociations"),interaction.attr("maxAssociations"));0===maxAssociations&&(maxAssociations=_countChoices(interaction)),_.size(currentResponse)>maxAssociations?(e.preventDefault(),instructionMgr.validateInstructions(interaction)):(choice=_maxMatchReached(interaction,e.target))!==!1?(e.preventDefault(),instructionMgr.validateInstructions(interaction,choice)):(containerHelper.triggerResponseChangeEvent(interaction,{}),instructionMgr.validateInstructions(interaction))},_maxMatchReached=function(interaction,input){var association=_inferValue(input),overflow=!1;return _(association).forEach(function(identifier){
var choice=_getChoiceDefinitionByIdentifier(interaction,identifier),matchMax=(choice.attributes.matchMin,choice.attributes.matchMax),assoc=_countAssociations(interaction,choice);matchMax>0&&assoc>matchMax&&(overflow=choice)}),overflow},_countAssociations=function(interaction,choice){var rawResponse=_getRawResponse(interaction),count=0;return _(rawResponse).forEach(function(response){(response[0]===choice.attributes.identifier||response[1]===choice.attributes.identifier)&&count++}),count},_countChoices=function(interaction){var $container=containerHelper.get(interaction);return $container.find("input[type=checkbox]").length},_getChoiceDefinitionByIdentifier=function(interaction,identifier){
var rawChoices=_getRawChoices(interaction);return rawChoices[identifier]},_getRawChoices=function(interaction){var rawChoices={};return _(interaction.choices).forEach(function(matchset){_(matchset).forEach(function(choice){rawChoices[choice.attributes.identifier]=choice})}),rawChoices},_setInstructions=function(interaction){var msg,minAssociations=interaction.attr("minAssociations"),maxAssociations=interaction.attr("maxAssociations"),choiceCount=_countChoices(interaction),superClosure=function(){var onMaxChoicesReached=function(report,msg){inWarning===!1&&(inWarning=!0,report.update({level:"warning",message:__("Maximum number of choices reached."),timeout:2e3,
stop:function(){report.update({level:"success",message:msg}),inWarning=!1}}))},onMatchMaxReached=function(interaction,choice,report,msg,level){var $container=containerHelper.get(interaction);if(inWarning===!1){inWarning=!0;var $choice=$container.find('.qti-simpleAssociableChoice[data-identifier="'+choice.attributes.identifier+'"]'),originalBackgroundColor=$choice.css("background-color"),originalColor=$choice.css("color");report.update({level:"warning",message:__("The highlighted choice cannot be associated more than %d time(s).").replace("%d",choice.attributes.matchMax),timeout:3e3,start:function(){$choice.animate({backgroundColor:"#fff",color:"#ba122b"},250,function(){
$choice.animate({backgroundColor:"#ba122b",color:"#fff"},250)})},stop:function(){$choice.animate({backgroundColor:originalBackgroundColor,color:originalColor},500),report.update({level:level,message:msg}),inWarning=!1}})}};0===minAssociations&&maxAssociations>0?(msg=__("You must select 0 to %d choices.").replace("%d",maxAssociations),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):maxAssociations>=responseCount?this.setLevel("success"):responseCount>maxAssociations?onMaxChoicesReached(this,msg):this.reset();
})):0===minAssociations&&0===maxAssociations?(msg=__("You must select 0 to %d choices.").replace("%d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):this.setLevel("success")})):minAssociations>0&&0===maxAssociations?(msg=__("You must select %1$d to %2$d choices."),msg=msg.replace("%1$d",minAssociations),msg=msg.replace("%2$d",choiceCount),instructionMgr.appendInstruction(interaction,msg,function(choice){var responseCount=_.size(_getRawResponse(interaction));
choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):minAssociations>responseCount?this.setLevel("info"):responseCount>choiceCount?onMaxChoicesReached(this,msg):this.setLevel("success")})):minAssociations>0&&maxAssociations>0&&(minAssociations!==maxAssociations?(msg=__("You must select %1$d to %2$d choices."),msg=msg.replace("%1$d",minAssociations),msg=msg.replace("%2$d",maxAssociations)):(msg=__("You must select exactly %d choice(s)."),msg=msg.replace("%d",minAssociations)),instructionMgr.appendInstruction(interaction,msg,function(choice){
var responseCount=_.size(_getRawResponse(interaction));choice&&choice.attributes&&choice.attributes.matchMax>0&&_countAssociations(interaction,choice)>choice.attributes.matchMax?onMatchMaxReached(interaction,choice,this,msg,this.getLevel()):minAssociations>responseCount?this.setLevel("info"):responseCount>maxAssociations?onMaxChoicesReached(this,msg):responseCount>=minAssociations&&maxAssociations>=responseCount&&this.setLevel("success")}))};superClosure()},destroy=function(interaction){var $container=containerHelper.get(interaction);$container.off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){
var $container;_.isObject(state)&&(_.isArray(state.order)&&2===state.order.length&&($container=containerHelper.get(interaction),$("thead .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[0],$(a).data("identifier")),bIndex=_.indexOf(state.order[0],$(b).data("identifier"));return aIndex>bIndex?1:bIndex>aIndex?-1:0}).detach().appendTo($("thead tr",$container)),$("tbody .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order[1],$(a).data("identifier")),bIndex=_.indexOf(state.order[1],$(b).data("identifier"));return aIndex>bIndex?1:bIndex>aIndex?-1:0}).detach().each(function(index,elt){$(elt).prependTo($("tbody tr",$container).eq(index));
})),state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[[],[]],$("thead .qti-choice",$container).each(function(){state.order[0].push($(this).data("identifier"))}),$("tbody .qti-choice",$container).each(function(){state.order[1].push($(this).data("identifier"))})),state};return{qtiClass:"matchInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,
resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState,inferValue:_inferValue}}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="clearfix add-options" data-edit="question">\n    <div class="rgt">\n        <span class="add-option" data-role="add-row"><span class="icon-add"></span>Add new row</span>\n        <span class="add-option" data-role="add-col"><span class="icon-add"></span>Add new column</span>\n    </div>\n</div>';
})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'\n    <td>\n        <label>\n            <input type="checkbox" >\n            <span class="icon-checkbox cross"></span>\n        </label>\n    </td>\n    '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",self=this,helperMissing=helpers.helperMissing;return buffer+="<tr>\n    ",(helper=helpers.choice)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choice,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",helper=helpers["for"]||depth0&&depth0["for"],options={hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data},stack1=helper?helper.call(depth0,0,depth0&&depth0.otherMatchSetCount,1,options):helperMissing.call(depth0,"for",0,depth0&&depth0.otherMatchSetCount,1,options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</tr>"})}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<td>\n    <label>\n        <input type="checkbox" >\n        <span class="icon-checkbox cross"></span>\n    </label>\n</td>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question",["jquery","lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/associateInteraction/states/Question","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.adder","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.row","tpl!taoQtiItem/qtiCreator/tpl/interactions/matchInteraction.cell","taoQtiItem/qtiCommonRenderer/helpers/sizeAdapter"],function($,_,stateFactory,Question,AssociateInteractionQuestionState,adderTpl,rowTpl,cellTpl,sizeAdapter){
"use strict";var MatchInteractionStateQuestion=stateFactory.extend(Question);return MatchInteractionStateQuestion.prototype.initForm=AssociateInteractionQuestionState.prototype.initForm,MatchInteractionStateQuestion.prototype.addNewChoiceButton=function(){var widget=this.widget,interaction=widget.element,$matchArea=widget.$container.find(".match-interaction-area"),qtiChoiceClassName="simpleAssociableChoice.matchInteraction",_postRender=function(choice){choice.postRender({ready:function(widget){widget.changeState("question")}},qtiChoiceClassName)};$matchArea.find(".add-option").length||($matchArea.append(adderTpl()),$matchArea.find(".add-options").show(),$matchArea.find(".add-option[data-role=add-col]").on("click",function(){
var choice=interaction.createChoice(0);$matchArea.find("thead > tr").append(choice.render(qtiChoiceClassName)),$matchArea.find("tbody > tr").append(cellTpl({})),_postRender(choice)}),$matchArea.find(".add-option[data-role=add-row]").on("click",function(){var choice=interaction.createChoice(1);$matchArea.find("tbody").append(rowTpl({choice:choice.render(qtiChoiceClassName),otherMatchSetCount:_.size(interaction.choices[0])})),_postRender(choice)})),$(".qti-item").on("toolbarchange",function(){$matchArea.find("tbody .mini-tlb").each(function(){var $toolbar=$(this);"false"!==$toolbar.parent().attr("contenteditable")&&$toolbar.css({left:-1*($toolbar.width()+10),top:-1
})})}),$matchArea.find("tr ").each(function(){var $elements=$(this).find('[data-html-editable="true"]');widget.on("containerBodyChange",function(){sizeAdapter.adaptSize($elements)})})},MatchInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var MatchInteractionStateAnswer=stateFactory.extend(Answer,function(){answerStateHelper.forward(this.widget)},function(){});return MatchInteractionStateAnswer;
}),define("tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<input value="',(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n       title="Score of this answer" \n       type="text" \n       data-for="',
(helper=helpers.choiceIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choiceIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n       name="score" \n       class="score" \n       placeholder = "',(helper=helpers.placeholder)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholder,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n       data-validate="$numeric" \n       data-validate-option="$allowEmpty; $event(type=keyup)" />'})}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget",["jquery","taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/toolbars/matchInteraction.score","lodash","i18n","polyfill/placeholders"],function($,commonRenderer,instructionMgr,formElement,scoreTpl,_,__){
var ResponseWidget={create:function(widget,responseMappingMode){var interaction=widget.element;commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),responseMappingMode?(instructionMgr.appendInstruction(widget.element,__("Please define the correct response and the score below.")),interaction.data("responseMappingMode",!0),ResponseWidget.createScoreWidgets(widget),ResponseWidget.createCorrectWidgets(widget)):(instructionMgr.appendInstruction(widget.element,__("Please define the correct response below.")),ResponseWidget.createCorrectWidgets(widget)),commonRenderer.render(interaction),widget.$container.find("table.matrix input[type=checkbox]").removeProp("disabled").attr("data-edit","correct").attr("data-role","correct");
},setResponse:function(interaction,response){commonRenderer.setResponse(interaction,ResponseWidget.formatResponse(response))},destroy:function(widget){var interaction=widget.element;interaction.removeData("responseMappingMode"),widget.$container.find("table.matrix input[type=checkbox]").prop("disabled","disabled"),widget.$container.find("table.matrix .score").remove(),widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction)},createScoreWidgets:function(widget){var $container=widget.$container,interaction=widget.element,response=interaction.getResponseDeclaration(),mapEntries=response.getMapEntries(),defaultValue=response.getMappingAttribute("defaultValue");
$container.find("table.matrix td>label").each(function(){var pairId=commonRenderer.inferValue(this).join(" ");$(this).append(scoreTpl({serial:interaction.getSerial(),choiceIdentifier:pairId,score:mapEntries[pairId]?mapEntries[pairId]:"",placeholder:defaultValue}))});var $scores=$container.find("table.matrix .score");$scores.on("click",function(e){e.stopPropagation(),e.preventDefault()}),widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&$scores.attr("placeholder",data.value)}),formElement.setChangeCallbacks($container,response,{score:function(response,value){var key=$(this).data("for");""===value?response.removeMapEntry(key):response.setMapEntry(key,value,!0);
}})},createCorrectWidgets:function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration();widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(ResponseWidget.unformatResponse(data.response))})},formatResponse:function(response){var formatedRes={list:{directedPair:[]}};if(1===_.size(response)){var pair=_.values(response).pop().split(" ");formatedRes={base:{directedPair:pair}}}else formatedRes={list:{directedPair:[]}},_.each(response,function(pairString){var pair=pairString.split(" ");formatedRes.list.directedPair.push(pair)});return formatedRes},unformatResponse:function(formatedResponse){var res=[];
return formatedResponse.list&&formatedResponse.list.directedPair?_.each(formatedResponse.list.directedPair,function(pair){res.push(pair.join(" "))}):formatedResponse.base&&formatedResponse.base.directedPair&&res.push(formatedResponse.base.directedPair.join(" ")),res}};return ResponseWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function(stateFactory,Correct,responseWidget,_){var MatchInteractionStateCorrect=stateFactory.create(Correct,function(){
var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();responseWidget.create(_widget),responseWidget.setResponse(interaction,_.values(response.getCorrect()))},function(){responseWidget.destroy(this.widget)});return MatchInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/ResponseWidget","lodash"],function($,stateFactory,Map,responseWidget,_){var MatchInteractionStateMap=stateFactory.create(Map,function(){var _widget=this.widget,interaction=_widget.element,response=interaction.getResponseDeclaration();
responseWidget.create(_widget,!0),responseWidget.setResponse(interaction,_.values(response.getCorrect())),_widget.on("metaChange",function(meta){"defineCorrect"===meta.key&&(meta.value?$('.match-interaction-area input[type="checkbox"]',_widget.$container).removeProp("disabled").removeClass("disabled"):$('.match-interaction-area input[type="checkbox"]',_widget.$container).prop("disabled",!0).prop("checked",!1).addClass("disabled"),meta.value===!1&&response.setCorrect([]))})},function(){responseWidget.destroy(this.widget)});return MatchInteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/Map"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/states/states"],function(Widget,states){var MatchInteractionWidget=Widget.clone();return MatchInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},MatchInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/MatchInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MatchInteraction","taoQtiItem/qtiCreator/widgets/interactions/matchInteraction/Widget"],function(_,MatchInteraction,MatchInteractionWidget){
"use strict";var CreatorMatchInteraction=_.clone(MatchInteraction);return CreatorMatchInteraction.render=function(interaction,options){MatchInteractionWidget.build(interaction,MatchInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorMatchInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-mediaInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="media-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/mediaInteraction","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","mediaElement"],function($,_,__,tpl,pciResponse,containerHelper,MediaElementPlayer){
"use strict";var getMediaType=function(mimetype){var type="";return""!==mimetype&&(-1!==mimetype.indexOf("youtube")?type="video/youtube":0===mimetype.indexOf("video")||mimetype.indexOf("application/ogg")?type="video":0===mimetype.indexOf("audio")&&(type="audio")),type},resizeVideo=function(mediaElement,$container){var height=$container.find(".media-container").height(),width=$container.find(".media-container").width();mediaElement.player.setPlayerSize(width,height),mediaElement.player.media.setVideoSize(width,height)},defaults={type:"video/mp4",video:{width:480,height:270},audio:{width:400,height:30}},render=function(interaction){var $meTag,mediaOptions,self=this,$container=containerHelper.get(interaction),$item=$container.parents(".qti-item"),media=interaction.object,mediaType=getMediaType(media.attr("type")||defaults.type),enablePause=$container.hasClass("pause"),maxPlays=parseInt(interaction.attr("maxPlays"),10)||0,url=media.attr("data")?self.resolveUrl(media.attr("data")):"",pauseFromClick=!1,features=enablePause?["playpause","progress","current","duration","volume"]:["playpause","current","duration","volume"],initMediaPlayer=function(){
!interaction.mediaElement&&$meTag&&$meTag.length&&new MediaElementPlayer($meTag,mediaOptions)},canBePlayed=function(){var current=parseInt($container.data("timesPlayed"),10);return 0===maxPlays||maxPlays>current};0===_.size(media.attributes)&&(media.attr("type",defaults.type),media.attr("width",$container.innerWidth()),media.attr("height",defaults.video.height),media.attr("data","")),mediaOptions={defaultVideoWidth:defaults.video.width,defaultVideoHeight:defaults.video.height,videoWidth:media.attr("width"),videoHeight:media.attr("height"),audioWidth:media.attr("width")||defaults.audio.width,audioHeight:media.attr("height")||defaults.audio.height,features:features,
startVolume:1,loop:!!interaction.attr("loop"),enableAutosize:!0,alwaysShowControls:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,enableKeyboard:!1,pauseOtherPlayers:!1,success:function(mediaElement,playerDom){var rTimer,playFromPauseEvent=!1,stillNeedToCallPlay=!0,$meContainer=$(playerDom).closest(".mejs-container"),$layers=$(".mejs-layers",$meContainer),$playpauseBtn=$(".mejs-playpause-button",$meContainer),$bigPlayBtn=$(".mejs-overlay-play",$meContainer),$controls=$(".mejs-controls",$meContainer),controlsHeight=$controls.outerHeight();interaction.mediaElement=mediaElement,"video/youtube"===mediaType&&_.defer(function(){
$("iframe.me-plugin",$container).css("min-height",media.attr("height"))}),$container.data("timesPlayed")||$container.data("timesPlayed",0),interaction.attr("autostart")&&canBePlayed()&&("video/youtube"!==mediaType&&(mediaElement.load(),mediaElement.play()),mediaElement.addEventListener("canplay",function(){stillNeedToCallPlay&&mediaElement.play()},!1)),mediaElement.addEventListener("play",function(event){stillNeedToCallPlay=!1,playFromPauseEvent===!0?playFromPauseEvent=!1:enablePause||($bigPlayBtn.detach(),$playpauseBtn.detach(),("video/youtube"===mediaType||"flash"===mediaElement.pluginType)&&$('<div class="overlay"></div>').width(mediaOptions.videoWidth).height(mediaOptions.videoHeight-controlsHeight).appendTo($layers));
},!1),mediaElement.addEventListener("ended",function(event){$container.data("timesPlayed",$container.data("timesPlayed")+1),containerHelper.triggerResponseChangeEvent(interaction),canBePlayed()&&!enablePause?($controls.prepend($playpauseBtn),$layers.append($bigPlayBtn),$(".overlay",$layers).remove()):canBePlayed()||($bigPlayBtn.detach(),$playpauseBtn.detach(),("video/youtube"===mediaType||"flash"===mediaElement.pluginType)&&$('<div class="overlay"></div>').width(mediaOptions.videoWidth).height(mediaOptions.videoHeight-controlsHeight).appendTo($layers),interaction.attr("loop")&&(interaction.mediaElement.pluginApi?$(playerDom).remove():interaction.mediaElement.setSrc("")));
},!1),$playpauseBtn.on("click.qti-element",function(e){pauseFromClick=!0,enablePause||(e.preventDefault(),e.stopPropagation())}),mediaElement.addEventListener("pause",function(event){pauseFromClick&&(playFromPauseEvent=!0,pauseFromClick=!1)}),resizeVideo(mediaElement,$container);var delayedResize=function(){clearTimeout(rTimer),rTimer=setTimeout(function(){resizeVideo(mediaElement,$container)},200)};$(window).off("resize.video").on("resize.video",delayedResize),$item.off("resize.gridEdit").on("resize.gridEdit",delayedResize),$container.trigger("playerready")},error:function(playerDom){$(playerDom).closest("div.mejs-container").find(".me-cannotplay").remove()}
},$meTag=$(_buildMedia(media,url,mediaType)).appendTo($(".media-container",$container)),$meTag.on("contextmenu",function(e){e.preventDefault()}).on("click.qit-element",function(e){return pauseFromClick=!0,enablePause?void 0:(e.preventDefault(),e.stopPropagation(),!1)}),$container.on("responseSet",function(){initMediaPlayer()}),initMediaPlayer()},_buildMedia=function(media,url,type){var element,attrs,inlineAttrs=function(attrs){return _.reduce(attrs,function(res,value,key){return res+=key+'="'+value+'" '},"")};return media&&(attrs={width:media.attr("width")+"px",height:media.attr("height")+"px",preload:"none"},/^http(s)?:\/\//.test(media.attr("data"))||(attrs.type=media.attr("type")),
"video/youtube"===type?element="<video "+inlineAttrs(attrs)+'>  <source type="video/youtube" src="'+url+'" /> </video>':(attrs.src=url,type||(type="video"),element="<"+type+" "+inlineAttrs(attrs)+"></"+type+">")),element},destroy=function(interaction){var $container=containerHelper.get(interaction);interaction.mediaElement&&(interaction.mediaElement.pluginApi||interaction.mediaElement.setSrc(""),interaction.mediaElement=void 0),$(".instruction-container",$container).empty(),$(".media-container",$container).empty(),$container.removeData("timesPlayed"),$(window).off("resize.video"),containerHelper.reset(interaction)},_getRawResponse=function(interaction){return[containerHelper.get(interaction).data("timesPlayed")||0];
},setResponse=function(interaction,response){if(response)try{var responseValues;responseValues=pciResponse.unserialize(response,interaction),containerHelper.get(interaction).data("timesPlayed",responseValues[0])}catch(e){}},resetResponse=function(interaction){containerHelper.get(interaction).data("timesPlayed",0)},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),
state};return{qtiClass:"mediaInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;
return buffer+='<!--\n<div class="panel">\n      TO BE COMPLETED : add "object" editor (see : http://www.imsglobal.org/question/qtiv2p1/imsqti_infov2p1.html#element10173)\n</div>\n-->\n\n<div class="panel">\n    \n    <div>\n        <label>\n            <div>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Media file path or YouTube video address",options):helperMissing.call(depth0,"__","Media file path or YouTube video address",options)))+'</div>\n            <input type="text" name="data" placeholder="Please select media file" value="',(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty;"/>\n            <div><button class=\'selectMediaFile btn-info small block\'>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select media file",options):helperMissing.call(depth0,"__","Select media file",options)))+'</button></div>\n        </label>\n    </div>\n    \n    <div>\n        <label for="width" class="spinner">Width</label>\n        <input name="width" value="',(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text"   data-increment="1" data-min="0" data-max="1920" style=\'min-width: 55px!important;\' />\n    </div>\n    \n    <div>\n        <label for="height" class="spinner">Height</label>\n        <input name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text"  data-increment="1" data-min="0" data-max="1080" style=\'min-width: 55px!important;\' />\n    </div>\n    \n</div>\n\n<div class="panel">\n    <label>\n        <input name="autostart" type="checkbox" ',
stack1=helpers["if"].call(depth0,depth0&&depth0.autostart,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Autostart",options):helperMissing.call(depth0,"__","Autostart",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data
},helper?helper.call(depth0,"The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",options):helperMissing.call(depth0,"__","The autostart attribute determines if the media object should begin as soon as the candidate starts the attempt (checked) or if the media object should be started under the control of the candidate (unchecked).",options)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <label>\n        <input name="loop" type="checkbox" ',stack1=helpers["if"].call(depth0,depth0&&depth0.loop,{hash:{},
inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Loop",options):helperMissing.call(depth0,"__","Loop",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n       '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",options):helperMissing.call(depth0,"__","The loop attribute is used to set continuous play mode. In continuous play mode, once the media object has started to play it should play continuously (subject to maxPlays).",options)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <label>\n        <input name="pause" type="checkbox" ',
stack1=helpers["if"].call(depth0,depth0&&depth0.pause,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='/>\n        <span class="icon-checkbox"></span>\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+'\n    </label>\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">\n       '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data
},helper?helper.call(depth0,"Enable the test taker to pause and restart the playing.",options):helperMissing.call(depth0,"__","Enable the test taker to pause and restart the playing.",options)))+'\n    </span>\n</div>\n\n<div class="panel">\n    <div>\n        <label for="maxPlays" class="spinner">Max plays count</label>\n        <input name="maxPlays" value="',(helper=helpers.maxPlays)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxPlays,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="1000" type="text" style=\'min-width: 55px!important;\' />\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",options):helperMissing.call(depth0,"__","The maxPlays attribute indicates that the media object can be played at most maxPlays times - it must not be possible for the candidate to play the media object more than maxPlay times. A value of 0 (the default) indicates that there is no limit.",options)))+"\n        </span>\n    </div>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","ui/resourcemgr"],function($,_,__,stateFactory,Question,formElement,formTpl){
var initQuestionState=function(){this.widget.renderInteraction()},exitQuestionState=function(){this.widget.destroyInteraction()},MediaInteractionStateQuestion=stateFactory.extend(Question,initQuestionState,exitQuestionState);return MediaInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,$form=widget.$form,$container=widget.$original,options=widget.options,interaction=widget.element,callbacks={},reRender=_.throttle(function(interaction){xmlUpdateCheat(interaction),widget.destroyInteraction(),widget.renderInteraction()},1e3),xmlUpdateCheat=function(interaction){interaction.attr("responseIdentifier",interaction.attr("responseIdentifier"));
};$form.html(formTpl({autostart:!!interaction.attr("autostart"),loop:!!interaction.attr("loop"),maxPlays:parseInt(interaction.attr("maxPlays"),10),pause:interaction.hasClass("pause"),data:interaction.object.attr("data"),type:interaction.object.attr("type"),width:interaction.object.attr("width"),height:interaction.object.attr("height")})),formElement.initWidget($form),callbacks.autostart=function(interaction,attrValue,attrName){interaction.attr(attrName,attrValue),reRender(interaction)},callbacks.loop=function(interaction,attrValue,attrName){interaction.attr(attrName,attrValue),reRender(interaction)},callbacks.maxPlays=function(interaction,attrValue,attrName){
interaction.attr(attrName,attrValue),reRender(interaction)},callbacks.pause=function(interaction,attrValue,attrName){attrValue?$container.hasClass("pause")||($container.addClass("pause"),interaction.addClass("pause")):($container.removeClass("pause"),interaction.removeClass("pause"))},callbacks.width=function(interaction,attrValue,attrName){interaction.object.attr(attrName,attrValue),reRender(interaction)},callbacks.height=function(interaction,attrValue,attrName){interaction.object.attr(attrName,attrValue),reRender(interaction)},callbacks.data=function(interaction,attrValue,attrName){if(interaction.object.attr(attrName)!==attrValue){interaction.object.attr(attrName,attrValue),
xmlUpdateCheat(interaction);var dataValue=$.trim(attrValue).toLowerCase();/^http(s)?:\/\/(www\.)?youtu/.test(dataValue)&&interaction.object.attr("type","video/youtube"),interaction.object&&(!interaction.object.attr("width")||parseInt(interaction.object.attr("width"),10)<=0)&&interaction.object.attr("width",widget.$original.innerWidth()),reRender(interaction)}},formElement.setChangeCallbacks($form,interaction,callbacks,{invalidate:!0});var $src=$form.find("input[name=data]"),$uploadTrigger=$form.find(".selectMediaFile"),_openResourceMgr=function(){$uploadTrigger.resourcemgr({title:__('Please select a media file (video or audio) from the resource manager. You can add files from your computer with the button "Add file(s)".'),
appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:"video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg,application/ogg,audio/aac"},pathParam:"path",select:function(e,files){files&&files.length&&(interaction.object.attr("type",files[0].mime),
$form.find("input[name=data]").val(files[0].file).trigger("change"))},open:function(){$src.hasClass("tooltipstered")&&$src.blur().tooltipster("hide")},close:function(){$src.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$src.val()||_openResourceMgr()},MediaInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(_,stateFactory,SleepState){var initSleepState=function(){this.widget.renderInteraction(),this.widget.$original.append('<div class="overlay"></div>')},exitSleepState=function(){
this.widget.destroyInteraction(),this.widget.$original.children(".overlay").remove()};return stateFactory.extend(SleepState,initSleepState,exitSleepState)}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Sleep"],function(factory,states){return factory.createBundle(states,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget",["jquery","lodash","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/states","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction"],function($,_,Widget,states,commonRenderer){
var MediaInteractionWidget=_.extend(Widget.clone(),{initCreator:function(){var self=this,$container=this.$original,$item=$container.parents(".qti-item");this.registerStates(states),Widget.initCreator.call(this),$item.off("."+this.element.serial).on("resize."+this.element.serial,_.throttle(function(e){var width=$container.innerWidth();width>0&&(self.element.object.attr("width",$container.innerWidth()),self.destroyInteraction(),self.renderInteraction())},100))},destroy:function(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize."+this.element.serial),Widget.destroy.call(this)},renderInteraction:function(){var interaction=(this.$original,
this.element);commonRenderer.render.call(interaction.getRenderer(),interaction,{features:"full",controlPlaying:!1})},destroyInteraction:function(){var interaction=this.element;commonRenderer.resetResponse.call(interaction.getRenderer(),interaction),commonRenderer.destroy.call(interaction.getRenderer(),interaction)}});return MediaInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-interaction qti-blockInteraction qti-mediaInteraction" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n	',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n	<div class="instruction-container"></div>\n    <div class="media-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCreator/renderers/interactions/MediaInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/MediaInteraction","taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/mediaInteraction"],function(_,MediaInteraction,MediaInteractionWidget,tpl){"use strict";return MediaInteraction=_.clone(MediaInteraction),MediaInteraction.template=tpl,MediaInteraction.render=function(interaction,options){
options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),MediaInteractionWidget.build(interaction,MediaInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},MediaInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){return" qti-horizontal"}function program5(depth0,data){return" qti-vertical"}function program7(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program9(depth0,data){return"horizontal"}function program11(depth0,data){return"vertical"}function program13(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program15(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program17(depth0,data){return"icon-down"}function program19(depth0,data){return"icon-right"}function program21(depth0,data){return"icon-up"}function program23(depth0,data){return"icon-left"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-orderInteraction',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" \n     data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" \n     data-qti-class="orderInteraction" \n     data-orientation="',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(11,program11,data),fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="order-interaction-area">\n        <ul class="choice-area square source solid block-listing ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n            ',options={hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{
hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </ul>\n        <div class="arrow-bar middle">\n            <span class="icon-add-to-selection ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(19,program19,data),fn:self.program(17,program17,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"></span>\n            <span class="icon-remove-from-selection ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(23,program23,data),fn:self.program(21,program21,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+=' inactive"></span>\n        </div>\n        <ul class="result-area decimal target solid block-listing ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n        </ul>\n        <div class="arrow-bar">\n            <span class="icon-move-before ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{hash:{},inverse:self.program(21,program21,data),fn:self.program(23,program23,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n            <span class="icon-move-after ',stack1=helpers["if"].call(depth0,depth0&&depth0.horizontal,{
hash:{},inverse:self.program(17,program17,data),fn:self.program(19,program19,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' inactive"></span>\n        </div>\n    </div>\n    <div class="notification-container"></div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction",["lodash","jquery","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/orderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse"],function(_,$,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";
var render=function(interaction){var $container=containerHelper.get(interaction),$choiceArea=$container.find(".choice-area"),$resultArea=$container.find(".result-area"),$iconAdd=$container.find(".icon-add-to-selection"),$iconRemove=$container.find(".icon-remove-from-selection"),$iconBefore=$container.find(".icon-move-before"),$iconAfter=$container.find(".icon-move-after"),$activeChoice=null,_activeControls=function(){$iconAdd.addClass("inactive"),$iconRemove.removeClass("inactive").addClass("active"),$iconBefore.removeClass("inactive").addClass("active"),$iconAfter.removeClass("inactive").addClass("active")},_resetControls=function(){$iconAdd.removeClass("inactive"),
$iconRemove.removeClass("active").addClass("inactive"),$iconBefore.removeClass("active").addClass("inactive"),$iconAfter.removeClass("active").addClass("inactive")},_setSelection=function($choice){$activeChoice&&$activeChoice.removeClass("active"),$activeChoice=$choice,$activeChoice.addClass("active"),_activeControls()},_resetSelection=function(){$activeChoice&&($activeChoice.removeClass("active"),$activeChoice=null),_resetControls()};$container.on("mousedown.commonRenderer",function(e){_resetSelection()}),$choiceArea.on("mousedown.commonRenderer",">li:not(.deactivated)",function(e){e.stopPropagation(),_resetSelection(),$iconAdd.addClass("triggered"),setTimeout(function(){
$iconAdd.removeClass("triggered")},150),$resultArea.append($(this)),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)}),$resultArea.on("mousedown.commonRenderer",">li",function(e){e.stopPropagation();var $choice=$(this);$choice.hasClass("active")?_resetSelection():_setSelection($(this))}),$iconRemove.on("mousedown.commonRenderer",function(e){e.stopPropagation(),$activeChoice&&($choiceArea.append($activeChoice),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction)),_resetSelection()}),$iconBefore.on("mousedown.commonRenderer",function(e){e.stopPropagation();
var $prev=$activeChoice.prev();$prev.length&&($prev.before($activeChoice),containerHelper.triggerResponseChangeEvent(interaction))}),$iconAfter.on("mousedown.commonRenderer",function(e){e.stopPropagation();var $next=$activeChoice.next();$next.length&&($next.after($activeChoice),containerHelper.triggerResponseChangeEvent(interaction))}),_setInstructions(interaction),$(document).on("attributeChange.qti-widget.commonRenderer",function(e,data){data.element.getSerial()===interaction.getSerial()&&("maxChoices"===data.key||"minChoices"===data.key)&&(instructionMgr.removeInstructions(interaction),_setInstructions(interaction),instructionMgr.validateInstructions(interaction));
}),_freezeSize($container)},_freezeSize=function($container){var $orderArea=$container.find(".order-interaction-area");$orderArea.height($orderArea.height())},_setInstructions=function(interaction){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container),min=parseInt(interaction.attr("minChoices")),max=parseInt(interaction.attr("maxChoices"));if(min&&instructionMgr.appendInstruction(interaction,__("You must use at least %d choices",min),function(){$resultArea.find(">li").length>=min?this.setLevel("success"):this.reset()}),max&&max<_.size(interaction.getChoices())){var instructionMax=instructionMgr.appendInstruction(interaction,__("You can use maximum %d choices",max),function(){
$resultArea.find(">li").length>=max?($choiceArea.find(">li").addClass("deactivated"),this.setMessage(__("Maximum choices reached"))):($choiceArea.find(">li").removeClass("deactivated"),this.reset())});$choiceArea.on("mousedown.commonRenderer",">li.deactivated",function(){var $choice=$(this);$choice.addClass("brd-error"),instructionMax.setLevel("warning",2e3),setTimeout(function(){$choice.removeClass("brd-error")},150)})}},resetResponse=function(interaction){var $container=containerHelper.get(interaction),initialOrder=_.keys(interaction.getChoices()),$choiceArea=$(".choice-area",$container).append($(".result-area>li",$container)),$choices=$choiceArea.children(".qti-choice");
$container.find(".qti-choice.active").mousedown(),$choices.detach().sort(function(choice1,choice2){return _.indexOf(initialOrder,$(choice1).data("serial"))>_.indexOf(initialOrder,$(choice2).data("serial"))}),$choiceArea.prepend($choices)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction),$choiceArea=$(".choice-area",$container),$resultArea=$(".result-area",$container);if(null===response||_.isEmpty(response))resetResponse(interaction);else try{_.each(pciResponse.unserialize(response,interaction),function(identifier){$resultArea.append($choiceArea.find("[data-identifier="+identifier+"]"))})}catch(e){throw new Error("wrong response format in argument : "+e);
}instructionMgr.validateInstructions(interaction)},_getRawResponse=function(interaction){var $container=containerHelper.get(interaction),response=[];return $(".result-area>li",$container).each(function(){response.push($(this).data("identifier"))}),response},getResponse=function(interaction){return pciResponse.serialize(_getRawResponse(interaction),interaction)},getCustomData=function(interaction,data){return _.merge(data||{},{horizontal:"horizontal"===interaction.attr("orientation")})},destroy=function(interaction){var $container=containerHelper.get(interaction),selectors=[".choice-area",".result-area",".icon-add-to-selection",".icon-remove-from-selection",".icon-move-before",".icon-move-after"];
$container.find(selectors.join(",")).andSelf().off(".commonRenderer"),$(document).off(".commonRenderer"),$container.find(".order-interaction-area").removeAttr("style"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){var $container;_.isObject(state)&&(state.response&&(interaction.resetResponse(),interaction.setResponse(state.response)),_.isArray(state.order)&&state.order.length===_.size(interaction.getChoices())&&($container=containerHelper.get(interaction),$(".choice-area .qti-choice",$container).sort(function(a,b){var aIndex=_.indexOf(state.order,$(a).data("identifier")),bIndex=_.indexOf(state.order,$(b).data("identifier"));
return aIndex>bIndex?1:bIndex>aIndex?-1:0}).detach().appendTo($(".choice-area",$container))))},getState=function(interaction){var $container,state={},response=interaction.getResponse();return response&&(state.response=response),interaction.attr("shuffle")===!0&&($container=containerHelper.get(interaction),state.order=[],$(".choice-area .qti-choice",$container).each(function(){state.order.push($(this).data("identifier"))})),state};return{qtiClass:"orderInteraction",getData:getCustomData,template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState
}}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/choiceInteraction/states/Question"],function(stateFactory,Question,ChoiceInteractionQuestionState){var OrderInteractionStateQuestion=stateFactory.extend(Question);return OrderInteractionStateQuestion.prototype.initForm=function(){ChoiceInteractionQuestionState.prototype.initForm.call(this,!1)},OrderInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer"],function(stateFactory,Answer){
var OrderInteractionStateAnswer=stateFactory.extend(Answer,function(){this.widget.changeState("correct")},function(){});return OrderInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","lodash","i18n"],function(stateFactory,Correct,commonRenderer,instructionMgr,_,__){var InlineChoiceInteractionStateCorrect=stateFactory.create(Correct,function(){_createResponseWidget(this.widget);
},function(){_destroyResponseWidget(this.widget)}),_createResponseWidget=function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect());instructionMgr.appendInstruction(widget.element,__("Please define the correct order in the box to the right.")),commonRenderer.render(widget.element),commonRenderer.setResponse(interaction,_formatResponse(correctResponse)),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(_unformatResponse(data.response))})},_destroyResponseWidget=function(widget){widget.$container.off("responseChange.qti-widget"),commonRenderer.resetResponse(widget.element),
commonRenderer.destroy(widget.element)},_formatResponse=function(response){return{list:{identifier:response}}},_unformatResponse=function(formatedResponse){var res=[];return formatedResponse.list&&formatedResponse.list.identifier&&(res=formatedResponse.list.identifier),res};return InlineChoiceInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/Correct"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/states/states"],function(Widget,states){var OrderInteractionWidget=Widget.clone();return OrderInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},OrderInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/OrderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/OrderInteraction","taoQtiItem/qtiCreator/widgets/interactions/orderInteraction/Widget"],function(_,OrderInteraction,OrderInteractionWidget){
"use strict";var CreatorOrderInteraction=_.clone(OrderInteraction);return CreatorOrderInteraction.render=function(interaction,options){OrderInteractionWidget.build(interaction,OrderInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorOrderInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;
return buffer+='<div class="qti-interaction qti-customInteraction" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>"})}),define("qtiCustomInteractionContext",[],function(){window._pciHooks=window._pciHooks||{};var taoQtiCustomInteractionContext={
register:function(pciHook){window._pciHooks[pciHook.getTypeIdentifier()]=pciHook},notifyReady:function(pciInstance){},notifyDone:function(pciInstance){},createPciInstance:function(pciTypeIdentifier){if(window._pciHooks[pciTypeIdentifier]){var instance={},proto=window._pciHooks[pciTypeIdentifier];for(var name in proto)"function"==typeof proto[name]?instance[name]=proto[name]:null!==proto[name]&&"object"==typeof proto[name]?instance[name]=proto[name].constructor():instance[name]=proto[name];return instance}throw"no portable custom interaction hook found with the id "+pciTypeIdentifier}};return taoQtiCustomInteractionContext}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction",["lodash","context","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/customInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/PortableElement","qtiCustomInteractionContext","taoQtiItem/qtiItem/helper/util"],function(_,context,Promise,tpl,containerHelper,PortableElement,qtiCustomInteractionContext,util){
"use strict";var _getPci=function(interaction){var pciTypeIdentifier,pci=interaction.data("pci")||void 0;if(!pci){if(pciTypeIdentifier=interaction.typeIdentifier,pci=qtiCustomInteractionContext.createPciInstance(pciTypeIdentifier),!pci)throw"no custom interaction hook found for the type "+pciTypeIdentifier;interaction.data("pci",pci),pci._taoCustomInteraction=interaction}return pci},render=function(interaction,options){var self=this;return options=options||{},new Promise(function(resolve,reject){var runtimeLocation,state={},localRequireConfig={paths:{}},response={base:null},id=interaction.attr("responseIdentifier"),typeIdentifier=interaction.typeIdentifier,runtimeLocations=options.runtimeLocations?options.runtimeLocations:self.getOption("runtimeLocations"),config=_.clone(interaction.properties),$dom=containerHelper.get(interaction).children(),entryPoint=interaction.entryPoint.replace(/\.js$/,"");
runtimeLocation=runtimeLocations&&runtimeLocations[typeIdentifier]?runtimeLocations[typeIdentifier]:self.getAssetManager().resolveBy("portableElementLocation",typeIdentifier),runtimeLocation&&(localRequireConfig.paths[typeIdentifier]=runtimeLocation,require.config(localRequireConfig)),require([entryPoint],function(){var pci=_getPci(interaction);return pci?(pci.initialize(id,$dom[0],config),pci.setSerializedState(state),pci.setResponse(response),interaction.onPci("responseChange",function(){containerHelper.triggerResponseChangeEvent(interaction)}),resolve()):reject("Unable to initiliaze pci : "+id)},reject)})},setResponse=function(interaction,response){_getPci(interaction).setResponse(response);
},getResponse=function(interaction){return _getPci(interaction).getResponse()},resetResponse=function(interaction){_getPci(interaction).resetResponse()},destroy=function(interaction){_getPci(interaction).destroy()},setSerializedState=function(interaction,serializedState){_getPci(interaction).setSerializedState(serializedState)},getSerializedState=function(interaction){return _getPci(interaction).getSerializedState()};return{qtiClass:"customInteraction",template:tpl,getData:function(customInteraction,data){var markup=data.markup;return markup=util.removeMarkupNamespaces(markup),markup=PortableElement.fixMarkupMediaSources(markup,this),data.markup=markup,data},
render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,getSerializedState:getSerializedState,setSerializedState:setSerializedState}}),define("taoQtiItem/qtiCreator/renderers/interactions/PortableCustomInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/PortableCustomInteraction","taoQtiItem/qtiCreator/editor/customInteractionRegistry","taoQtiItem/qtiCreator/helper/commonRenderer"],function(_,Renderer,ciRegistry,commonRenderer){"use strict";var CreatorCustomInteraction=_.clone(Renderer);return CreatorCustomInteraction.render=function(interaction,options){
var widget,pciCreator=ciRegistry.getCreator(interaction.typeIdentifier),renderOptions={runtimeLocations:{}};renderOptions.runtimeLocations[interaction.typeIdentifier]=ciRegistry.getBaseUrl(interaction.typeIdentifier),Renderer.render.call(commonRenderer.get(),interaction,renderOptions),widget=pciCreator.getWidget().build(interaction,Renderer.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorCustomInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data
}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-graphicInteraction qti-selectPointInteraction clearfix',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{
hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n    <div class="instruction-container"></div>\n    <div class="image-editor solid">\n        <div id=\'graphic-paper-',(helper=helpers.serial)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'\' class="main-image-box"></div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction",["jquery","lodash","i18n","core/promise","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/selectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager"],function($,_,__,Promise,tpl,graphic,pciResponse,containerHelper,instructionMgr){
"use strict";var render=function(interaction){var self=this;return new Promise(function(resolve,reject){var $container=containerHelper.get(interaction),background=interaction.object.attributes;$container.off("resized.qti-widget.resolve").one("resized.qti-widget.resolve",resolve),interaction.paper=graphic.responsivePaper("graphic-paper-"+interaction.serial,interaction.serial,{width:background.width,height:background.height,img:self.resolveUrl(background.data),imgId:"bg-image-"+interaction.serial,container:$container}),_enableSelection(interaction),instructionMgr.minMaxChoiceInstructions(interaction,{min:interaction.attr("minChoices"),max:interaction.attr("maxChoices"),
choiceCount:!1,getResponse:_getRawResponse,onError:function(data){data&&graphic.highlightError(data.target,"success")}})})},_enableSelection=function(interaction){function changePoint(target){isTouch&&target&&graphic.createTouchCircle(interaction.paper,target.getBBox()),containerHelper.triggerResponseChangeEvent(interaction),instructionMgr.validateInstructions(interaction,{target:target})}var maxChoices=interaction.attr("maxChoices"),$container=containerHelper.get(interaction),$imageBox=$container.find(".main-image-box"),isResponsive=$container.hasClass("responsive"),image=interaction.paper.getById("bg-image-"+interaction.serial),isTouch=!1;image.touchstart(function(){
isTouch=!0,image.untouchstart()}),image.click(function(event){if(maxChoices>0&&_getRawResponse(interaction).length>=maxChoices)return void instructionMgr.validateInstructions(interaction);var point=graphic.getPoint(event,interaction.paper,$imageBox,isResponsive);graphic.createTarget(interaction.paper,{point:point,create:changePoint,remove:function(){changePoint()}})})},_getRawResponse=function(interaction){var points=[];return interaction.paper.forEach(function(element){var point=element.data("point");"object"==typeof point&&point.x&&point.y&&points.push([Math.round(point.x),Math.round(point.y)])}),points},setResponse=function(interaction,response){var responseValues;
if(response&&interaction.paper){try{responseValues=pciResponse.unserialize(response,interaction)}catch(e){}_.isArray(responseValues)&&_(responseValues).flatten().map(function(value,index){return index%2===0?{x:value,y:responseValues[index+1]}:void 0}).filter(_.isObject).forEach(function(point){graphic.createTarget(interaction.paper,{point:point})})}},resetResponse=function(interaction){interaction.paper.forEach(function(element){var point=element.data("point");"object"==typeof point&&graphic.trigger(element,"click")})},getResponse=function(interaction){var response=(_getRawResponse(interaction),pciResponse.serialize(_getRawResponse(interaction),interaction));return response;
},destroy=function(interaction){var $container;interaction.paper&&($container=containerHelper.get(interaction),$(window).off("resize.qti-widget."+interaction.serial),$container.off("resize.qti-widget."+interaction.serial),interaction.paper.clear(),instructionMgr.removeInstructions(interaction),$(".main-image-box",$container).empty().removeAttr("style"),$(".image-editor",$container).removeAttr("style")),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),
state};return{qtiClass:"selectPointInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep"],function(stateFactory,SleepState){"use strict";var initSleepState=function(){var widget=this.widget,interaction=widget.element;widget.on("metaChange",function(data){"responsive"===data.key&&(data.value===!0?interaction.addClass("responsive"):interaction.removeClass("responsive"));
})},exitSleepState=function(){$(".image-editor.solid, .block-listing.source",this.widget.$container).css("min-width",0)};return stateFactory.extend(SleepState,initSleepState,exitSleepState)}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='<div class="panel">\n\n    \n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Interaction Background",options):helperMissing.call(depth0,"__","Interaction Background",options)))+'</h3>\n\n    <div class="panel">\n        <label for="data">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"File",options):helperMissing.call(depth0,"__","File",options)))+'</label>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n        <div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The file path to the image.",options):helperMissing.call(depth0,"__","The file path to the image.",options)))+'</div>\n        <input type="text" name="data" value="',
(helper=helpers.data)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.data,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$notEmpty; $fileExists(baseUrl=',(helper=helpers.baseUrl)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseUrl,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+')"/>\n        <button class="btn-info small block" data-role="upload-trigger">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Select image",options):helperMissing.call(depth0,"__","Select image",options)))+'</button>\n    </div>\n\n    <div class="panel media-sizer-panel">\n        <!-- media sizer goes here -->\n    </div>\n    <input name="width" value="',
(helper=helpers.width)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.width,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n    <input name="height" value="',(helper=helpers.height)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.height,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" />\n\n\n    <input name="type" value="',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="hidden" readonly />\n\n    <hr>\n\n    <h3>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Allowed choices",options):helperMissing.call(depth0,"__","Allowed choices",options)))+'</h3>\n        <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n        <span class="tooltip-content">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The minimum number of choices that the candidate is required to select to form a valid response.",options):helperMissing.call(depth0,"__","The minimum number of choices that the candidate is required to select to form a valid response.",options)))+"<br>\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The maximum number of choices that the candidate is allowed to select.",options):helperMissing.call(depth0,"__","The maximum number of choices that the candidate is allowed to select.",options)))+'\n        </span>\n\n\n    <div class="panel">\n        <div>\n            <label for="minChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Min",options):helperMissing.call(depth0,"__","Min",options)))+'</label>\n        <input name="minChoices" value="',(helper=helpers.minChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.minChoices,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" type="text" />\n    </div>\n        <div>\n            <label for="maxChoices" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Max",options):helperMissing.call(depth0,"__","Max",options)))+'</label>\n        <input name="maxChoices" value="',(helper=helpers.maxChoices)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.maxChoices,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" type="text" />\n    </div>\n    </div>\n\n</div>\n'})}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question",["jquery","lodash","util/image","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/helpers/imageSelector","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/interactions/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/selectPoint","taoQtiItem/qtiCreator/widgets/interactions/helpers/resourceManager","taoQtiItem/qtiCreator/widgets/interactions/helpers/bgImage","ui/mediasizer"],function($,_,imageUtil,stateFactory,Question,imageSelector,formElement,interactionFormElement,formTpl,resourceManager,bgImage){
"use strict";var initQuestionState=function(){},exitQuestionState=function(){var widget=this.widget,interaction=widget.element,valid=!!interaction.object.attr("data");widget.isValid("selectPointInteraction",valid)},SelectPointInteractionStateQuestion=stateFactory.extend(Question,initQuestionState,exitQuestionState);return SelectPointInteractionStateQuestion.prototype.initForm=function(){var widget=this.widget,options=widget.options,interaction=widget.element,$form=widget.$form;$form.html(formTpl({baseUrl:options.baseUrl,maxChoices:parseInt(interaction.attr("maxChoices")),minChoices:parseInt(interaction.attr("minChoices")),choicesCount:_.size(interaction.getChoices()),
data:interaction.object.attr("data"),width:interaction.object.attr("width"),height:interaction.object.attr("height"),type:interaction.object.attr("type")})),imageSelector($form,options),formElement.initWidget($form),bgImage.setupImage(widget),bgImage.setChangeCallbacks(widget,formElement,formElement.getMinMaxAttributeCallbacks($form,"minChoices","maxChoices")),interactionFormElement.syncMaxChoices(widget)},SelectPointInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){
function initAnswerState(){this.widget.changeState("map")}function exitAnswerState(){}return stateFactory.extend(Answer,initAnswerState,exitAnswerState)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/Graphic","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicInteractionShapeEditor","taoQtiItem/qtiCreator/widgets/interactions/helpers/graphicScorePopup","tpl!taoQtiItem/qtiCreator/tpl/forms/response/graphicScoreMappingForm","taoQtiItem/qtiCreator/widgets/helpers/formElement","ui/incrementer","ui/tooltipster"],function($,_,__,stateFactory,Map,commonRenderer,instructionMgr,graphicHelper,PciResponse,answerStateHelper,shapeEditor,grahicScorePopup,mappingFormTpl,formElement,incrementer,tooltipster){
function initMapState(){var widget=this.widget,interaction=widget.element,response=(widget.$original,interaction.getResponseDeclaration());widget._targets=[],interaction.paper&&(commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.appendInstruction(interaction,__("Please create areas that correspond to the response and associate them a score.\nYou can also position the target to the exact point as the correct response.")),interaction.responseMappingMode=!0,_.isPlainObject(response.mapEntries)&&(response.mapEntries=_.values(response.mapEntries)),interaction.paper=widget.createPaper(),setCurrentResponses(widget),widget._editor=createEditor(widget),
listenResponseAttrChange(widget))}function areaId(area){return area.shape+"-"+area.coords.replace(/,*/g,"-")}function getAreaIndex(response,id){var found=!1;return _.forEach(response.mapEntries,function(area,index){return areaId(area)===id?(found=index,!1):void 0}),found}function setCurrentResponses(widget){var interaction=widget.element,$container=widget.$original,response=interaction.getResponseDeclaration(),corrects=_.values(response.getCorrect());_.forEach(response.mapEntries,function(area){var shape=widget.createResponseArea(area.shape,area.coords);setUpScoringArea(widget,area,shape,!1)}),answerStateHelper.defineCorrect(response)&&corrects.length&&_.forEach(corrects,function(correct){
var point=correct.split(" ");if(point.length>=2){var target=graphicHelper.createTarget(interaction.paper,{point:{x:point[0],y:point[1]}});widget._targets.push(target.id)}}),interaction.paper.getById("bg-image-"+interaction.serial).click(function(){$(".-mapping-editor",$container).hide()})}function createEditor(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),editor=shapeEditor(widget,{currents:response.mapEntries.map(areaId).concat(widget._targets),target:!0,shapeCreated:function(shape,type){var point,corrects,area;"target"===type?(point=shape.data("target"),corrects=response.getCorrect()||[],corrects.push(qtiPoint(point)),
response.setCorrect(corrects)):(area={shape:"path"===type?"poly":type,coords:graphicHelper.qtiCoords(shape),mappedValue:response.mappingAttributes.defaultValue||"0"},setUpScoringArea(widget,area,shape,!0),response.mapEntries.push(area))},shapeRemoved:function(id,data){var scoreElt;/^target/.test(id)&&data.target?response.setCorrect(_.without(response.getCorrect(),qtiPoint(data.target))):(scoreElt=interaction.paper.getById("score-"+id),scoreElt&&scoreElt.remove(),$("#score-popup-"+id).remove(),_.remove(response.mapEntries,function(area){return id&&areaId(area)===id}))},enterHandling:function(shape){"set"===shape.type?shape.forEach(function(setElt){return"path"===setElt.type?void setElt.attr(graphicHelper._style["target-hover"]):void 0;
}):(shape.toFront(),$("#score-popup-"+shape.id).show())},quitHandling:function(shape){if("set"===shape.type)shape.forEach(function(setElt){return"path"===setElt.type?void setElt.attr(graphicHelper._style["target-success"]):void 0});else{var scoreElt=interaction.paper.getById("score-"+shape.id);scoreElt&&scoreElt.show().toFront(),$("#score-popup-"+shape.id).hide()}},shapeChanging:function(shape){var scoreElt=interaction.paper.getById("score-"+shape.id);scoreElt&&scoreElt.remove(),$("#score-popup-"+shape.id).remove()},shapeChange:function(shape){var mapEntry,index=getAreaIndex(response,shape.id);index!==!1&&(mapEntry=response.mapEntries[index],response.mapEntries[index].coords=graphicHelper.qtiCoords(shape),
setUpScoringArea(widget,mapEntry,shape,mapEntry.mappedValue===response.mappingAttributes.defaultValue),shape.id=areaId(mapEntry))}});return editor.create(),editor}function qtiPoint(point){return Math.round(point.x)+" "+Math.round(point.y)}function setUpScoringArea(widget,area,shape,defaults){var interaction=widget.element,$container=widget.$original,isResponsive=$container.hasClass("responsive"),response=interaction.getResponseDeclaration(),id=areaId(area),$imageBox=$(".main-image-box",$container),$popup=grahicScorePopup(interaction.paper,shape,$imageBox,isResponsive),scoreElt=(area.mappedValue||response.mappingAttributes.defaultValue||"0",graphicHelper.createShapeText(interaction.paper,shape,{
id:"score-"+id,content:area.mappedValue+"",style:"score-text-default",title:__("Score value"),shapeClick:!0}));scoreElt.data("default",!!defaults),shape.id=id,$popup.attr("id","score-popup-"+id);var $form=$(mappingFormTpl({score:area.mappedValue,scoreMin:response.getMappingAttribute("lowerBound"),scoreMax:response.getMappingAttribute("upperBound"),noCorrect:!0}));formElement.setChangeCallbacks($form,response,{score:function(response,value){""===value?scoreElt.attr({text:response.mappingAttributes.defaultValue}).data("default",!0):scoreElt.attr({text:value}).data("default",!1),area.mappedValue=parseFloat(value)}}),$form.appendTo($popup)}function listenResponseAttrChange(widget){
var interaction=widget.element,$container=widget.$container,$target=$container.find('[data-type="target"]'),$separator=$target.prev(".separator");widget.on("mappingAttributeChange",function(data){"defaultValue"===data.key&&interaction.paper.forEach(function(element){/^score/.test(element.id)&&element.data("default")===!0&&element.attr({text:data.value})})}),widget.on("metaChange",function(data){"defineCorrect"===data.key&&(data.value?($target.show(),$separator.show()):($target.hide(),$separator.hide(),_.forEach(widget._targets,function(targetId){var target=interaction.paper.getById(targetId),layer=interaction.paper.getById("layer-"+targetId);target.remove(),layer.remove();
})))})}function exitMapState(){var widget=this.widget,interaction=widget.element;interaction.paper&&(widget._editor&&widget._editor.destroy(),commonRenderer.resetResponse(interaction),commonRenderer.destroy(interaction),instructionMgr.removeInstructions(interaction),interaction.paper=this.widget.createPaper())}return stateFactory.create(Map,initMapState,exitMapState)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Sleep","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/Map"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget",["jquery","lodash","i18n","taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/graphicInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/states/states","taoQtiItem/qtiCommonRenderer/helpers/Graphic"],function($,_,__,Widget,GraphicWidget,states,graphicHelper){var SelectPointInteractionWidget=_.extend(Widget.clone(),GraphicWidget,{initCreator:function(options){var paper;this.baseUrl=options.baseUrl,this.choiceForm=options.choiceForm,this.registerStates(states),
Widget.initCreator.call(this),paper=this.createPaper(),paper&&(this.element.paper=paper)},destroy:function(){var $container=this.$original,$item=$container.parents(".qti-item");$item.off("resize.gridEdit."+this.element.serial),$(window).off("resize.qti-widget."+this.element.serial),$container.off("resize.qti-widget."+this.element.serial),Widget.destroy.call(this)},createResponseArea:function(shapeType,coords){return graphicHelper.createElement(this.element.paper,shapeType,coords,{touchEffect:!1})}});return SelectPointInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/SelectPointInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SelectPointInteraction","taoQtiItem/qtiCreator/widgets/interactions/selectPointInteraction/Widget"],function(_,SelectPointInteraction,SelectPointInteractionWidget){
"use strict";var CreatorSelectPointInteraction=_.clone(SelectPointInteraction);return CreatorSelectPointInteraction.render=function(interaction,options){options=options||{},options.baseUrl=this.getOption("baseUrl"),options.choiceForm=this.getOption("choiceOptionForm"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),SelectPointInteractionWidget.build(interaction,SelectPointInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorSelectPointInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}function program5(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<div ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-blockInteraction qti-sliderInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,
null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="sliderInteraction" >\r\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\r\n    <div class="instruction-container"></div>\r\n</div>\r\n';
})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/sliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","nouislider"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse){"use strict";var _slideTo=function(options){options.sliderCurrentValue.find(".qti-slider-cur-value").text(options.value),options.sliderValue.val(options.value)},render=function(interaction){var attributes=interaction.getAttributes(),$container=interaction.getContainer(),$el=$("<div />").attr({
id:attributes.responseIdentifier+"-qti-slider","class":"qti-slider"}),$sliderLabels=$("<div />").attr({"class":"qti-slider-values"}),$sliderCurrentValue=$("<div />").attr({id:attributes.responseIdentifier+"-qti-slider-cur-value","class":"qti-slider-cur-value"}),$sliderValue=$("<input />").attr({type:"hidden",id:attributes.responseIdentifier+"-qti-slider-value"}),orientation="horizontal",reverse="undefined"!=typeof attributes.reverse&&attributes.reverse?!0:!1,min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),step="undefined"!=typeof attributes.step&&attributes.step?parseInt(attributes.step):1,steps=(max-min)/step;$sliderCurrentValue.append('<span class="qti-slider-cur-value-text">'+__("Current value:")+" </span>").append('<span class="qti-slider-cur-value"></span>'),
$sliderLabels.append('<span class="slider-min">'+(reverse?max:min)+"</span>").append('<span class="slider-max">'+(reverse?min:max)+"</span>"),interaction.getContainer().append($el).append($sliderLabels).append($sliderCurrentValue).append($sliderValue),"undefined"!=typeof attributes.orientation&&$.inArray(attributes.orientation,["horizontal","vertical"])>-1&&(orientation=attributes.orientation);var sliderSize=0;if("horizontal"===orientation)$container.addClass("qti-slider-horizontal");else{var maxHeight=300;sliderSize=20*steps,sliderSize>maxHeight&&(sliderSize=maxHeight),$container.addClass("qti-slider-vertical"),$el.height(sliderSize+"px"),$sliderLabels.height(sliderSize+"px");
}if("undefined"!=typeof attributes.stepLabel&&attributes.stepLabel){var middleStep=parseInt(steps/2),leftOffset=100/steps*middleStep,middleValue=reverse?max-middleStep*step:min+middleStep*step;"horizontal"===orientation?$sliderLabels.find(".slider-min").after('<span class="slider-middle" style="left:'+leftOffset+'%">'+middleValue+"</span>"):$sliderLabels.find(".slider-min").after('<span class="slider-middle" style="top:'+leftOffset+'%">'+middleValue+"</span>")}$el.noUiSlider({start:reverse?max:min,range:{min:min,max:max},step:step,orientation:orientation}).on("slide",function(e){var val=parseInt($(this).val());interaction.attr("reverse")&&(val=max+min-val),val=Math.round(1e3*val)/1e3,
_slideTo({value:val,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),containerHelper.triggerResponseChangeEvent(interaction)}),_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue})},resetResponse=function(interaction){var attributes=interaction.getAttributes(),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound),reverse="undefined"!=typeof attributes.reverse&&attributes.reverse?!0:!1,startValue=reverse?max:min;
_slideTo({value:min,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(startValue)},setResponse=function(interaction,response){var value,attributes=interaction.getAttributes(),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value"),$sliderCurrentValue=$("#"+attributes.responseIdentifier+"-qti-slider-cur-value"),$el=$("#"+attributes.responseIdentifier+"-qti-slider"),min=parseInt(attributes.lowerBound),max=parseInt(attributes.upperBound);value=pciResponse.unserialize(response,interaction)[0],_slideTo({value:value,sliderValue:$sliderValue,sliderCurrentValue:$sliderCurrentValue}),$el.val(interaction.attr("reverse")?max+min-value:value);
},_getRawResponse=function(interaction){var value,attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),min=parseInt(attributes.lowerBound),$sliderValue=$("#"+attributes.responseIdentifier+"-qti-slider-value");return"integer"===baseType?value=parseInt($sliderValue.val()):"float"===baseType&&(value=parseFloat($sliderValue.val())),isNaN(value)?min:value},getResponse=function(interaction){return pciResponse.serialize([_getRawResponse(interaction)],interaction)},destroy=function(interaction){var $container=interaction.getContainer();$container.empty(),containerHelper.reset(interaction)},setState=function(interaction,state){
_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"sliderInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function";return buffer+='\n<div class="panel">\n    <label for="lowerBound" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Lower Bound",options):helperMissing.call(depth0,"__","Lower Bound",options)))+'</label>\n    <input name="lowerBound" value="',(helper=helpers.lowerBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.lowerBound,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The lower bound of the slider",options):helperMissing.call(depth0,"__","The lower bound of the slider",options)))+'</span>\n    <label for="upperBound" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Upper Bound",options):helperMissing.call(depth0,"__","Upper Bound",options)))+'</label>\n    <input name="upperBound" value="',(helper=helpers.upperBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperBound,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"The upper bound of the slider",options):helperMissing.call(depth0,"__","The upper bound of the slider",options)))+'</span>\n</div>\n\n<div class="panel">\n    <label for="step" class="spinner">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Step",options):helperMissing.call(depth0,"__","Step",options)))+'</label>\n    <input name="step" value="',(helper=helpers.step)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.step,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="0" data-max="',
(helper=helpers.upperBound)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.upperBound,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content:first" data-tooltip-theme="info"></span>\n    <span class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The number of units corresponding to a step on the slider",options):helperMissing.call(depth0,"__","The number of units corresponding to a step on the slider",options)))+"</span>\n</div>\n";
})}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/slider"],function(stateFactory,Question,formElement,formTpl){var SliderInteractionStateQuestion=stateFactory.extend(Question);return SliderInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({lowerBound:parseFloat(interaction.attr("lowerBound")),upperBound:parseFloat(interaction.attr("upperBound")),
orientation:interaction.attr("orientation"),reverse:!!interaction.attr("reverse"),step:parseInt(interaction.attr("step")),stepLabel:!!interaction.attr("stepLabel")})),formElement.initWidget($form);var callbacks={};callbacks.lowerBound=function(interaction,attrValue,attrName){interaction.attr("lowerBound",parseFloat(attrValue));var lowerBound=interaction.attr("lowerBound"),upperBound=interaction.attr("upperBound"),sliderLength=upperBound-lowerBound,step=interaction.attr("step"),reverse=!!interaction.attr("reverse");lowerBound>upperBound&&(callbacks.upperBound(interaction,lowerBound),_widget.$form.find('input[name="upperBound"]').val(lowerBound)),step>sliderLength&&sliderLength>=0&&(callbacks.step(interaction,sliderLength),
_widget.$form.find('input[name="step"]').val(sliderLength)),_widget.$container.find(reverse?".slider-max":".slider-min").text(attrValue),_widget.$container.find("span.qti-slider-cur-value").text(lowerBound),_widget.$container.find(".qti-slider").noUiSlider({range:{min:lowerBound,max:upperBound}},!0),_widget.$container.find(".qti-slider").val(lowerBound)},callbacks.upperBound=function(interaction,attrValue,attrName){interaction.attr("upperBound",parseFloat(attrValue));var lowerBound=interaction.attr("lowerBound"),upperBound=interaction.attr("upperBound"),sliderLength=upperBound-lowerBound,step=interaction.attr("step"),reverse=!!interaction.attr("reverse");lowerBound>upperBound&&(callbacks.lowerBound(interaction,upperBound),
_widget.$form.find('input[name="lowerBound"]').val(upperBound)),step>sliderLength&&sliderLength>=0&&(callbacks.step(interaction,sliderLength),_widget.$form.find('input[name="step"]').val(sliderLength)),_widget.$form.find('input[name="step"]').incrementer("options",{max:upperBound}),_widget.$container.find(reverse?".slider-min":".slider-max").text(attrValue),_widget.$container.find(".qti-slider").noUiSlider({range:{min:interaction.attr("lowerBound"),max:interaction.attr("upperBound")}},!0)},callbacks.orientation=function(interaction,attrValue,attrName){interaction.attr("orientation",attrValue);interaction.attr("orientation")?interaction.attr("orientation"):"horizontal",
interaction.attr("reverse");_widget.$container.find(".qti-slider").noUiSlider({orientation:interaction.attr("orientation")},!0)},callbacks.reverse=function(interaction,attrValue,attrName){interaction.attr("reverse",!!attrValue);var reverse=interaction.attr("reverse"),lowerBound=parseInt(interaction.attr("lowerBound")),upperBound=parseInt(interaction.attr("upperBound")),$sliderElt=_widget.$container.find(".qti-slider"),start=reverse?upperBound:lowerBound;$sliderElt.noUiSlider({start:start},!0),_widget.$container.find("span.qti-slider-cur-value").text(lowerBound),_widget.$container.find(".slider-min").text(reverse?upperBound:lowerBound),_widget.$container.find(".slider-max").text(reverse?lowerBound:upperBound);
},callbacks.step=function(interaction,attrValue,attrName){var lowerBound=interaction.attr("lowerBound"),upperBound=interaction.attr("upperBound"),currentStep=parseInt(attrValue),sliderLength=upperBound-lowerBound;sliderLength>=currentStep&&(interaction.attr("step",currentStep),_widget.$container.find(".qti-slider").noUiSlider({step:interaction.attr("step")},!0),_widget.$form.find('input[name="step"]').incrementer("options",{max:sliderLength}))},callbacks.stepLabel=function(interaction,attrValue,attrName){if(interaction.attr("stepLabel",!!attrValue),_widget.$container.find("span.slider-middle").remove(),interaction.attr("stepLabel")){var upperBound=interaction.attr("upperBound"),lowerBound=interaction.attr("lowerBound"),step=interaction.attr("step"),reverse=interaction.attr("reverse"),steps=parseInt((upperBound-lowerBound)/step),middleStep=parseInt(steps/2),leftOffset=100/steps*middleStep,middleValue=reverse?upperBound-middleStep*step:lowerBound+middleStep*step;
_widget.$container.find(".slider-min").after('<span class="slider-middle" style="left:'+leftOffset+'%">'+middleValue+"</span>")}},formElement.setChangeCallbacks($form,interaction,callbacks)},SliderInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){var SliderInteractionStateAnswer=stateFactory.extend(Answer,function(){this.widget.changeState("correct")},function(){});return SliderInteractionStateAnswer;
}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","lodash","i18n"],function(stateFactory,Correct,commonRenderer,instructionMgr,_,__){var SliderInteractionStateCorrect=stateFactory.create(Correct,function(){_createResponseWidget(this.widget)},function(){_destroyResponseWidget(this.widget)}),_createResponseWidget=function(widget){var interaction=widget.element,response=interaction.getResponseDeclaration(),correctResponse=_.values(response.getCorrect());
commonRenderer.setResponse(interaction,_formatResponse(correctResponse));var $sliderElt=widget.$container.find(".qti-slider");$sliderElt.removeAttr("disabled"),instructionMgr.appendInstruction(interaction,__("Please define the correct response using the slider.")),widget.$container.on("responseChange.qti-widget",function(e,data){response.setCorrect(_unformatResponse(data.response))})},_destroyResponseWidget=function(widget){var $sliderElt=widget.$container.find(".qti-slider"),lowerBound=widget.element.attributes.lowerBound;$sliderElt.attr("disabled","disabled"),$sliderElt.val(lowerBound),widget.$container.find("span.qti-slider-cur-value").text(""+lowerBound),
instructionMgr.removeInstructions(widget.element),widget.$container.off("responseChange.qti-widget")},_formatResponse=function(response){return{base:{integer:response}}},_unformatResponse=function(formatedResponse){return[formatedResponse.base.integer]};return SliderInteractionStateCorrect}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/Correct"],function(factory,states){
return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/states/states"],function(Widget,states){var SliderInteractionWidget=Widget.clone();return SliderInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this),this.$container.find(".qti-slider").attr("disabled","disabled")},SliderInteractionWidget}),define("taoQtiItem/qtiCreator/renderers/interactions/SliderInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/SliderInteraction","taoQtiItem/qtiCreator/widgets/interactions/sliderInteraction/Widget"],function(_,SliderInteraction,SliderInteractionWidget){
"use strict";var CreatorSliderInteraction=_.clone(SliderInteraction);return CreatorSliderInteraction.render=function(interaction,options){SliderInteraction.render(interaction),SliderInteractionWidget.build(interaction,SliderInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorSliderInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='id="'+escapeExpression((stack1=depth0&&depth0.attributes,
stack1=null==stack1||stack1===!1?stack1:stack1.id,typeof stack1===functionType?stack1.apply(depth0):stack1))+'"'}function program3(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=depth0&&depth0.attributes,stack1=null==stack1||stack1===!1?stack1:stack1["class"],typeof stack1===functionType?stack1.apply(depth0):stack1))}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<input ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1.id),{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' class="qti-interaction qti-inlineInteraction qti-textEntryInteraction',stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.attributes,null==stack1||stack1===!1?stack1:stack1["class"]),{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-qti-class="textEntryInteraction" type="text">\n';
})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction",["jquery","lodash","i18n","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/textEntryInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","taoQtiItem/qtiCommonRenderer/helpers/PciResponse","util/locale","polyfill/placeholders","tooltipster"],function($,_,__,tpl,containerHelper,instructionMgr,pciResponse,locale){"use strict";var render=function(interaction){var attributes=interaction.getAttributes(),$el=interaction.getContainer();attributes.expectedLength&&$el.css("width",parseInt(attributes.expectedLength)+"ch"),
attributes.patternMask&&$el.tooltipster({theme:"tao-error-tooltip",content:__("This is not a valid answer"),delay:350,trigger:"custom"}),attributes.placeholderText&&$el.attr("placeholder",attributes.placeholderText),$el.on("keyup.commonRenderer",_.debounce(function(){var regex;attributes.patternMask&&(regex=new RegExp("^"+attributes.patternMask+"$"),regex.test($el.val())?$el.tooltipster("hide").removeClass("invalid"):$el.tooltipster("show").addClass("invalid")),containerHelper.triggerResponseChangeEvent(interaction)},600)).on("keydown.commonRenderer",function(){attributes.patternMask&&$el.tooltipster("hide")})},resetResponse=function(interaction){interaction.getContainer().val("");
},setResponse=function(interaction,response){var responseValue;try{responseValue=pciResponse.unserialize(response,interaction)}catch(e){}responseValue&&responseValue.length&&interaction.getContainer().val(responseValue[0])},getResponse=function(interaction){var value,ret={base:{}},$el=interaction.getContainer(),attributes=interaction.getAttributes(),baseType=interaction.getResponseDeclaration().attr("baseType"),numericBase=attributes.base||10;return $el.hasClass("invalid")||attributes.placeholderText&&$el.val()===attributes.placeholderText?value="":"integer"===baseType?value=locale.parseInt($el.val(),numericBase):"float"===baseType?value=locale.parseFloat($el.val()):"string"===baseType&&(value=$el.val()),
ret.base[baseType]=isNaN(value)&&"number"==typeof value?"":value,ret},destroy=function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state};return{qtiClass:"textEntryInteraction",template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,
getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="panel">\r\n    <label for="placeholderText" class="spinner">Placeholder Text</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="placeholderText" value="',
(helper=helpers.placeholderText)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.placeholderText,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" />\r\n    <span class="tooltip-content">\r\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",options):helperMissing.call(depth0,"__","In visual environments, string interactions are typically represented by empty boxes into which the candidate writes or types.  Delivery engines should use the value of this attribute (if provided) instead of their default placeholder text when this is required.",options)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="patternMask" class="spinner">Pattern Mask</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="patternMask" value="',
(helper=helpers.patternMask)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.patternMask,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" type="text" data-validate="$validRegex;" placeholder="e.g. [A-Z][a-z]{3,}"/>\r\n    <span class="tooltip-content">\r\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid.Care is needed to ensure that the format of the required input is clear to the candidate, especially when validity checking of responses is required for progression through a test. This could be done by providing an illustrative sample response in the prompt, for example.",options):helperMissing.call(depth0,"__","If given, the pattern mask specifies a regular expression that the candidate's response must match in order to be considered valid.Care is needed to ensure that the format of the required input is clear to the candidate, especially when validity checking of responses is required for progression through a test. This could be done by providing an illustrative sample response in the prompt, for example.",options)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="expectedLength" class="spinner">Expected Length</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="expectedLength" value="',
(helper=helpers.expectedLength)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expectedLength,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="1" data-max="100" type="text" />\r\n    <span class="tooltip-content">\r\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The expectedLength attribute provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",options):helperMissing.call(depth0,"__","The expectedLength attribute provides a hint to the candidate as to the expected overall length of the desired response measured in number of characters. This is not a validity constraint.",options)))+'\r\n    </span>\r\n</div>\r\n<div class="panel">\r\n    <label for="base" class="spinner">Base</label>\r\n    <span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\r\n    <input name="base" value="',
(helper=helpers.base)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.base,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-increment="1" data-min="1" data-max="100" type="text" />\r\n    <span class="tooltip-content">\r\n        '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",options):helperMissing.call(depth0,"__","If the string interaction is bound to a numeric response variable then the base attribute must be used to set the number base in which to interpret the value entered by the candidate.",options)))+"\r\n    </span>\r\n</div>\r\n";
})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/textEntry"],function(stateFactory,Question,formElement,formTpl){var TextEntryInteractionStateQuestion=stateFactory.extend(Question);return TextEntryInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element;$form.html(formTpl({base:parseInt(interaction.attr("base")),patternMask:interaction.attr("patternMask"),
placeholderText:interaction.attr("placeholderText"),expectedLength:parseInt(interaction.attr("expectedLength"))})),formElement.initWidget($form),formElement.setChangeCallbacks($form,interaction,{base:formElement.getAttributeChangeCallback(),patternMask:formElement.getAttributeChangeCallback(),placeholderText:formElement.getAttributeChangeCallback(),expectedLength:formElement.getAttributeChangeCallback()})},TextEntryInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState"],function(stateFactory,Answer,answerStateHelper){
var TextEntryInteractionStateAnswer=stateFactory.extend(Answer,function(){answerStateHelper.forward(this.widget)},function(){});return TextEntryInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Correct","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","lodash","i18n"],function($,stateFactory,Correct,instructionMgr,_,__){var TextEntryInteractionStateCorrect=stateFactory.create(Correct,function(){var $container=this.widget.$container,response=this.widget.element.getResponseDeclaration(),correct=_.values(response.getCorrect()).pop()||"";
$container.find("tr[data-edit=correct] input[name=correct]").focus().val(correct),$container.on("keyup.correct","tr[data-edit=correct] input[name=correct]",function(){var value=$(this).val();response.setCorrect(value)}),instructionMgr.appendInstruction(this.widget.element,__("Please type the correct response in the box below."))},function(){this.widget.$container.off(".correct"),instructionMgr.removeInstructions(this.widget.element)});return TextEntryInteractionStateCorrect}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
return'checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<tr class="" data-edit="map">\r\n    <td data-text><input type="text" name="text" value="',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-old-text="',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/></td>\r\n    <td class="mini-tlb" colspan="2">\r\n        <label>\r\n            <input name="correct" type="radio" ',stack1=helpers["if"].call(depth0,depth0&&depth0.correct,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=' />\r\n            <span class="icon-radio"></span>\r\n        </label>\r\n        <input name="score" class="score" value="',(helper=helpers.score)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.score,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" data-for="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-validate="$numeric" data-validate-option="$allowEmpty; $event(type=keyup)"/>\r\n        <span class="icon-bin" data-role="delete-option"></span>\r\n    </td>\r\n</tr>'})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Map","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntry","lodash"],function($,stateFactory,Map,formElement,optionTpl,_){
var _getRelatedTextKey=function($elt){return $elt.closest("tr").find("input[name=text]").val()},TextEntryInteractionStateMap=stateFactory.create(Map,function(){this.initMapEntries(),this.initFormCallbacks(),this.hideCorrectInput()},function(){this.widget.$container.off(".map"),this.widget.$container.find("tr[data-edit=map]:not([data-add-option])").remove()});return TextEntryInteractionStateMap.prototype.hideCorrectInput=function(){var $correct=this.widget.$container.find("tr[data-edit=correct]");this.widget.on("metaChange",function(data){"defineCorrect"===data.key&&$correct.hide()}),$correct.hide(),_.delay(function(){$correct.hide()},200)},TextEntryInteractionStateMap.prototype.initFormCallbacks=function(){
var $container=this.widget.$container,response=this.widget.element.getResponseDeclaration();formElement.setChangeCallbacks($container,response,{text:_.throttle(function(response,value){var $text=$(this),oldText=$text.data("old-text"),$tr=$text.closest("tr"),correct=!!$tr.find("input[name=correct]:checked").length,score=parseInt($tr.find(".score").val());isNaN(score)||(response.removeMapEntry(oldText,!0),response.setMapEntry(value,score),$text.data("old-text",value),correct&&response.setCorrect(value))},600),correct:function(response){var text=_getRelatedTextKey($(this));response.setCorrect(text)},score:function(response,value){var text=_getRelatedTextKey($(this)),score=parseFloat(value);
isNaN(score)||response.setMapEntry(text,score)}})},TextEntryInteractionStateMap.prototype.initMapEntries=function(){var _this=this,response=this.widget.element.getResponseDeclaration(),correctValue=_.values(response.getCorrect()).pop(),$container=this.widget.$container,$addOption=$container.find("tr[data-add-option]"),appendOption=function(text,score){var $newOption=$(optionTpl({text:text||"",score:score||0,correct:text===correctValue}));$newOption.show(),$addOption.before($newOption),preventNullMapEntries()},preventNullMapEntries=function(){var $deleteButtons=$container.find("tbody [data-role=delete-option]");1===$deleteButtons.length?$deleteButtons.css("visibility","hidden"):$deleteButtons.css("visibility","visible");
};_.size(response.mapEntries)||(response.mapEntries={"":0}),_.forIn(response.mapEntries,function(score,text){appendOption(text,score)}),$container.on("click.map","[data-role=delete-option]",function(){var $del=$(this),text=_getRelatedTextKey($del),correct=!!$del.closest("tr").find("input[name=correct]:checked").length;response.removeMapEntry(text,!0),$del.closest("tr").remove(),preventNullMapEntries(),correct&&response.resetCorrect()}).on("click.map",".add-option",function(){appendOption("",0),_this.initFormCallbacks()})},TextEntryInteractionStateMap}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Correct","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/Map"],function(factory,states){
return factory.createBundle(states,arguments)}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="widget-box widget-inline widget-textEntryInteraction qti-interaction" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-edit="active">\r\n    <div class="qti-interaction qti-textEntryInteraction">\r\n        <table>\r\n            <colgroup>\r\n                <col class="text">\r\n                <col class="icon">\r\n                <col class="icon">\r\n            </colgroup>\r\n            <tbody>\r\n                <tr data-edit="question">\r\n                    <td class="main-option"></td>\r\n                    <td colspan="2"></td>\r\n                </tr>\r\n                <tr data-edit="correct">\r\n                    <td data-text>\r\n                        <div class="instruction-container"></div>\r\n                        <input type="text" name="correct" value="',
(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" /></td>\r\n                    <td class="mini-tlb" colspan="2">\r\n                    </td>\r\n                </tr>\r\n                <tr data-add-option data-edit="map">\r\n                    <td>\r\n                        <div class="add-option">\r\n                            <span class="icon-add"></span>\r\n                            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Add another option",options):helperMissing.call(depth0,"__","Add another option",options)))+'\r\n                        </div>\r\n                    </td>\r\n                    <td colspan="2"></td>\r\n                </tr>\r\n                <tr data-edit="custom">\r\n                    <td colspan="3">\r\n                        <!-- Input solely provides visual in response state -->\r\n                        <input type="text" />\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </div>\r\n\r\n</div>';
})}),define("taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget",["lodash","taoQtiItem/qtiCreator/widgets/interactions/inlineInteraction/Widget","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/states/states","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction"],function(_,InteractionWidget,states,interactionTpl){var TextEntryInteractionWidget=InteractionWidget.clone();return TextEntryInteractionWidget.initCreator=function(){this.registerStates(states),InteractionWidget.initCreator.call(this),this.$container.find(".tlb-title").remove()},TextEntryInteractionWidget.renderInteraction=function(){var interaction=this.element,tplData={
tag:interaction.qtiClass,serial:interaction.serial,attributes:interaction.attributes};return interactionTpl(tplData)},TextEntryInteractionWidget.buildContainer=function(){var previous,next;this.$original.length&&(previous=this.$original[0].previousSibling,next=this.$original[0].nextSibling,(!previous||3===previous.nodeType&&""===previous.nodeValue||3!==previous.nodeType)&&this.$original.before("&nbsp;"),(!next||3===next.nodeType&&""===next.nodeValue||3!==next.nodeType)&&this.$original.after("&nbsp;")),this.$itemContainer=this.$original.parents(".item-editor-item"),this.$itemContainer.append(this.renderInteraction()),this.$container=this.$itemContainer.find(".widget-textEntryInteraction[data-serial="+this.element.getSerial()+"]");
},TextEntryInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<span class="widget-box textEntryInteraction-placeholder" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" data-qti-class="textEntryInteraction">\r\n    <label>&nbsp;</label>\r\n</span>'})}),define("taoQtiItem/qtiCreator/renderers/interactions/TextEntryInteraction",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/TextEntryInteraction","taoQtiItem/qtiCreator/widgets/interactions/textEntryInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/inlineInteraction/textEntryInteraction.placeholder"],function($,_,TextEntryInteraction,TextEntryInteractionWidget,tpl){"use strict";var CreatorTextEntryInteraction=_.clone(TextEntryInteraction);return CreatorTextEntryInteraction.template=tpl,CreatorTextEntryInteraction.render=function(interaction,options){
options=options||{},TextEntryInteractionWidget.build(interaction,$('.textEntryInteraction-placeholder[data-serial="'+interaction.serial+'"]'),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},CreatorTextEntryInteraction}),define("tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
stack1||0===stack1?stack1:""}function program3(depth0,data){var stack1,helper;return(helper=helpers["visible-file-upload-preview"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["visible-file-upload-preview"],stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',
(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n	',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n	<div class="instruction-container"></div>\n    <div class="file-upload fixed-grid-row lft">\n        <div class="progressbar"></div>\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n        <input type="file"/>\n    </div>\n    <div class="file-upload-preview lft ',
stack1=helpers["if"].call(depth0,depth0&&depth0.isPreviewable,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n        <p class="nopreview">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No preview available",options):helperMissing.call(depth0,"__","No preview available",options)))+'</p>\n    </div>\n\n    <div class="file-upload-preview-popup modal">\n        <div class="modal-body">\n        </div>\n    </div>\n</div>\n'})}),define("taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction",["jquery","lodash","i18n","context","tpl!taoQtiItem/qtiCommonRenderer/tpl/interactions/uploadInteraction","taoQtiItem/qtiCommonRenderer/helpers/container","taoQtiItem/qtiCommonRenderer/helpers/instructions/instructionManager","ui/progressbar","ui/previewer","ui/modal","ui/waitForMedia","filereader"],function($,_,__,context,tpl,containerHelper,instructionMgr){
"use strict";var _response={base:null},_initialInstructions=__("Browse your computer and select the appropriate file."),_readyInstructions=__("The selected file is ready to be sent."),_handleSelectedFiles=function(interaction,file){instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions);var $container=containerHelper.get(interaction),filename=file.name,filetype=(file.size,file.type);$container.find(".file-name").empty().append(filename);var reader=new FileReader;reader.onload=function(e){instructionMgr.removeInstructions(interaction),instructionMgr.appendInstruction(interaction,_readyInstructions,function(){
this.setLevel("success")}),instructionMgr.validateInstructions(interaction),$container.find(".progressbar").progressbar("value",100);var base64Data=e.target.result,commaPosition=base64Data.indexOf(","),base64Raw=base64Data.substring(commaPosition+1);_response={base:{file:{data:base64Raw,mime:filetype,name:filename}}};var visibleFileUploadPreview=getCustomData(interaction),$previewArea=$container.find(".file-upload-preview");$previewArea.toggleClass("visible-file-upload-preview runtime-visible-file-upload-preview",visibleFileUploadPreview.isPreviewable).previewer({url:reader.result,name:filename,type:filetype.substr(0,filetype.indexOf("/"))}),$previewArea.waitForMedia(function(){
var imgNaturalWidth,isOversized,modalWidth,$originalImg=$previewArea.find("img"),$largeDisplay=$(".file-upload-preview-popup"),$item=$(".qti-item"),itemWidth=$item.width(),winWidth=$(window).width()-80,fullHeight=$("body").height();$originalImg.length&&(imgNaturalWidth=$originalImg[0].naturalWidth,isOversized=imgNaturalWidth>itemWidth,modalWidth=Math.min(winWidth,imgNaturalWidth),$previewArea.toggleClass("clickable",isOversized),isOversized&&$previewArea.on("click",function(){$(".upload-ia-modal-bg").remove();var $modalBody=$largeDisplay.find(".modal-body");$modalBody.empty().append($originalImg.clone()),$largeDisplay.on("opened.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","hidden"),
$largeDisplay.css({width:modalWidth,height:fullHeight,left:(modalWidth-itemWidth-40)/-2})}).on("closed.modal",function(){$(".tao-item-scope.tao-preview-scope").css("overflow","auto")}).modal({modalOverlayClass:"modal-bg upload-ia-modal-bg"})}))})},reader.onloadstart=function(e){instructionMgr.removeInstructions(interaction),$container.find(".progressbar").progressbar("value",0)},reader.onprogress=function(e){var percentProgress=Math.ceil(Math.round(e.loaded)/Math.round(e.total)*100);$container.find(".progressbar").progressbar("value",percentProgress)},reader.readAsDataURL(file)},_resetGui=function(interaction){var $container=containerHelper.get(interaction);$container.find(".file-name").text(__("No file selected")),
$container.find(".btn-info").text(__("Browse...")),$container.find(".file-upload-preview").toggleClass("visible-file-upload-preview",interaction.attr("type")&&0===interaction.attr("type").indexOf("image"))},render=function(interaction,options){var $container=containerHelper.get(interaction);_resetGui(interaction),instructionMgr.appendInstruction(interaction,_initialInstructions);var changeListener=function(e){var file=e.target.files[0];"undefined"!=typeof file&&_handleSelectedFiles(interaction,file)},$input=$container.find("input");$container.find(".progressbar").progressbar(),window.File&&window.FileReader&&window.FileList?$input.bind("change",changeListener):$input.fileReader({
id:"fileReaderSWFObject",filereader:context.taobase_www+"js/lib/polyfill/filereader.swf",callback:function(){$input.bind("change",changeListener)}}),$input.bind("mousedown",function(e){return e.preventDefault(),$(this).blur(),!1})},resetResponse=function(interaction){containerHelper.get(interaction);_resetGui(interaction)},setResponse=function(interaction,response){var $container=containerHelper.get(interaction);if(null!==response.base){var filename="undefined"!=typeof response.base.file.name?response.base.file.name:"previously-uploaded-file";$container.find(".file-name").empty().text(filename)}_response=response},getResponse=function(interaction){return _response;
},destroy=function(interaction){$(document).off(".commonRenderer"),containerHelper.get(interaction).off(".commonRenderer"),instructionMgr.removeInstructions(interaction),containerHelper.reset(interaction)},setState=function(interaction,state){_.isObject(state)&&state.response&&(interaction.resetResponse(),interaction.setResponse(state.response))},getState=function(interaction){var state={},response=interaction.getResponse();return response&&(state.response=response),state},getCustomData=function(interaction,data){return _.merge(data||{},{isPreviewable:interaction.attr("type")&&0===interaction.attr("type").indexOf("image")})};return{qtiClass:"uploadInteraction",
template:tpl,render:render,getContainer:containerHelper.get,setResponse:setResponse,getResponse:getResponse,resetResponse:resetResponse,destroy:destroy,setState:setState,getState:getState,getData:getCustomData,resetGui:_resetGui}}),define("tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    		<option value="',(helper=helpers.mime)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mime,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" ',stack1=helpers["if"].call(depth0,depth0&&depth0.selected,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</option>\n    	"}function program2(depth0,data){return'selected="selected"'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;
return buffer+="<h3>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"MIME-type",options):helperMissing.call(depth0,"__","MIME-type",options)))+'</h3>\n<span class="icon-help tooltipstered" data-tooltip="~ .tooltip-content" data-tooltip-theme="info"></span>\n<div class="tooltip-content">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"The MIME-type attribute describes which kind of file may be uploaded.",options):helperMissing.call(depth0,"__","The MIME-type attribute describes which kind of file may be uploaded.",options)))+'</div>\n\n<div class="reset-group">\n    <select name="type" class="select2" data-has-search="false">\n    	',
stack1=helpers.each.call(depth0,depth0&&depth0.types,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </select>\n</div>\n"})}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question",["lodash","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/Question","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/helper/uploadMime","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/upload"],function(_,__,stateFactory,Question,formElement,uploadHelper,formTpl){"use strict";
var UploadInteractionStateQuestion=stateFactory.extend(Question);return UploadInteractionStateQuestion.prototype.initForm=function(){var _widget=this.widget,$form=_widget.$form,interaction=_widget.element,callbacks={},types=uploadHelper.getMimeTypes(),$previewZone=_widget.$container.find(".qti-interaction .file-upload-preview"),isImage=function(mime){return mime&&0===mime.indexOf("image")},selectedMime="",previewClassName="visible-file-upload-preview";if(types.unshift({mime:"any/kind",label:__("-- Any kind of file --")}),"undefined"!=typeof interaction.attr("type"))if(""===interaction.attr("type"))delete interaction.attributes.type;else for(var i in types)interaction.attr("type")===types[i].mime&&(types[i].selected=!0,
selectedMime=types[i].mime);$form.html(formTpl({types:types})),formElement.initWidget($form),$previewZone.toggleClass(previewClassName,isImage(selectedMime)),callbacks.type=function(interaction,attrValue){$previewZone.toggleClass(previewClassName,isImage(attrValue)),"any/kind"===attrValue?interaction.removeAttr("type"):interaction.attr("type",attrValue)},formElement.setChangeCallbacks($form,interaction,callbacks)},UploadInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/blockInteraction/states/states","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/Question"],function(factory,states){
return factory.createBundle(states,arguments,["answer","correct","map"])}),define("taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/states/states"],function(Widget,states){var UploadInteractionWidget=Widget.clone();return UploadInteractionWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},UploadInteractionWidget}),define("tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program3(depth0,data){var stack1,helper;return(helper=helpers["visible-file-upload-preview"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["visible-file-upload-preview"],stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;
return buffer+='<div class="qti-interaction qti-blockInteraction qti-uploadInteraction" data-serial="',(helper=helpers.serial)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.serial,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n	',stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n	<div class="instruction-container"></div>\n    <div class="fixed-grid-row file-upload lft">\n        <span class="btn-info small col-4"></span>\n        <span class="file-name placeholder col-8 truncate"></span>\n    </div>\n    <div class="file-upload-preview lft ',
stack1=helpers["if"].call(depth0,depth0&&depth0.isPreviewable,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n        <p class="nopreview">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"No preview available",options):helperMissing.call(depth0,"__","No preview available",options)))+"</p>\n    </div>\n</div>\n\n\n"})}),define("taoQtiItem/qtiCreator/renderers/interactions/UploadInteraction",["lodash","taoQtiItem/qtiCommonRenderer/renderers/interactions/UploadInteraction","taoQtiItem/qtiCreator/widgets/interactions/uploadInteraction/Widget","tpl!taoQtiItem/qtiCreator/tpl/interactions/uploadInteraction"],function(_,UploadInteraction,UploadInteractionWidget,tpl){
"use strict";return UploadInteraction=_.clone(UploadInteraction),UploadInteraction.template=tpl,UploadInteraction.render=function(interaction,options){UploadInteraction.resetGui(interaction),UploadInteractionWidget.build(interaction,UploadInteraction.getContainer(interaction),this.getOption("interactionOptionForm"),this.getOption("responseOptionForm"),options)},UploadInteraction}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/Widget",["taoQtiItem/qtiCreator/widgets/interactions/Widget","taoQtiItem/qtiCreator/editor/customInteractionRegistry","lodash"],function(Widget,ciRegistry,_){var CustomInteractionWidget=Widget.clone();return CustomInteractionWidget.initCreator=function(){
Widget.initCreator.call(this)},CustomInteractionWidget.createToolbar=function(options){var creator=ciRegistry.get(this.element.typeIdentifier);return options=_.defaults(options||{},{title:creator.manifest.label}),Widget.createToolbar.call(this,options)},CustomInteractionWidget}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Question",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Question","jquery","lib/farbtastic/farbtastic"],function(stateFactory,Question,$){var CustomInteractionStateQuestion=stateFactory.extend(Question);return CustomInteractionStateQuestion.prototype.initColorPickers=function(){
var $colorTriggers=this.widget.$form.find(".color-trigger:not([data-color-picker=initialized])");$colorTriggers.each(function(){var $colorTrigger=$(this),$input=$colorTrigger.siblings("input"),color=$input.val();$colorTrigger.css("background-color",color)}),$colorTriggers.on("click.color-picker",function(){var $colorTrigger=$(this),$context=$colorTrigger.closest(".item-editor-color-picker"),$container=$context.find(".color-picker-container").show(),$colorPicker=$container.find(".color-picker"),$colorPickerInput=$container.find(".color-picker-input"),$input=$colorTrigger.siblings('input[type="hidden"]'),color=$input.val();$colorPicker.farbtastic(".color-picker-input",$context),
$colorPickerInput.val(color).trigger("keyup"),$container.find(".closer").off("click").on("click",function(){$container.hide(),$colorPicker.off(".farbtastic")}),$colorPicker.off(".farbtastic").on("colorchange.farbtastic",function(e,color){$colorTrigger.css("background-color",color),$input.val(color).trigger("change")})}),$colorTriggers.attr("data-color-picker","initialized")},CustomInteractionStateQuestion.prototype.destroyColorPickers=function(){var $colorTriggers=this.widget.$form.find(".color-trigger");$colorTriggers.off(".color-picker"),$colorTriggers.removeAttr("data-color-picker")},CustomInteractionStateQuestion}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Sleep","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay"],function(stateFactory,SleepState,overlayTpl){
return stateFactory.extend(SleepState,function(){this.widget.$container.append(overlayTpl())},function(){this.widget.$container.children(".overlay").remove()})}),define("taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/states","taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Question","taoQtiItem/qtiCreator/widgets/interactions/customInteraction/states/Sleep"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoQtiItem/qtiCreator/widgets/interactions/mediaInteraction/states/Answer",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/interactions/states/Answer","taoQtiItem/qtiCreator/widgets/interactions/helpers/answerState","tpl!taoQtiItem/qtiCreator/tpl/forms/interactions/media","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(stateFactory,Answer,answerStateHelper,formTpl,formElement){
var MediaInteractionStateAnswer=stateFactory.extend(Answer,function(){var _widget=this.widget;_widget.element},function(){this.widget});return MediaInteractionStateAnswer.prototype.initResponseForm=function(){var _widget=this.widget;_widget.$form,_widget.element},MediaInteractionStateAnswer}),define("taoQtiItem/qtiCreator/widgets/static/portableInfoControl/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget"],function(Widget){var InfoControlWidget=Widget.clone();return InfoControlWidget.initCreator=function(){Widget.initCreator.call(this)},InfoControlWidget}),define("taoQtiItem/qtiCreator/widgets/static/portableInfoControl/states/Sleep",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/states/Sleep","tpl!taoQtiItem/qtiCreator/tpl/notifications/widgetOverlay"],function(stateFactory,SleepState,overlayTpl){
return stateFactory.extend(SleepState,function(){},function(){})}),define("taoQtiItem/qtiCreator/widgets/static/portableInfoControl/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/portableInfoControl/states/Sleep"],function(factory,states){return factory.createBundle(states,arguments,["answer","correct","map"])}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/container",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,functionType="function";
return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/Container",["tpl!taoQtiItem/qtiXmlRenderer/tpl/container"],function(tpl){var xhtmlEntities=function(html){return html.replace(/&nbsp;/g,"&#160;")},xhtmlEncode=function(encodedStr){var returnValue="";return encodedStr&&(returnValue=encodedStr,returnValue=returnValue.replace(/<br([^>]*)?>/gi,"<br />"),returnValue=returnValue.replace(/<hr([^>]*)?>/gi,"<hr />"),returnValue=returnValue.replace(/(<img([^>]*)?\s?[^\/]>)+/gi,function($0,$1){
return $0.replace(">"," />")})),returnValue};return{qtiClass:"_container",template:tpl,getData:function(container,data){return data.body=xhtmlEntities(data.body),data.body=xhtmlEncode(data.body),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/element",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{
hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">"}function program2(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,
options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program4(depth0,data){var stack1,helper,buffer="";return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+=" />"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this;return stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.program(4,program4,data),fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/Img",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"img",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/include",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},
data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />"})}),define("taoQtiItem/qtiXmlRenderer/renderers/Include",["tpl!taoQtiItem/qtiXmlRenderer/tpl/include"],function(tpl){return{qtiClass:"include",template:tpl,getData:function(xi,data){var ns=xi.getNamespace();return ns&&ns.name&&(data.tag=ns.name+":include"),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/item",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return stack1=helpers["if"].call(depth0,null==data||data===!1?data:data.key,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" "}function program2(depth0,data){var stack1,buffer="";return buffer+="xmlns:"+escapeExpression((stack1=null==data||data===!1?data:data.key,typeof stack1===functionType?stack1.apply(depth0):stack1))+'="'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'"'}function program4(depth0,data){var buffer="";return buffer+='xmlns="'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'"';
}function program6(depth0,data){var stack1,helper,options;return helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),stack1||0===stack1?stack1:""}function program8(depth0,data){var stack1,buffer="";return buffer+="\n        ",stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),buffer}function program10(depth0,data){var stack1,helper,buffer="";return buffer+=' class="',(helper=helpers["class"])?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0["class"],stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"'}function program12(depth0,data){return'\n            <div class="empty"></div>\n        '}function program14(depth0,data){var stack1,helper,buffer="";return buffer+="\n            ",(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program16(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,
stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,blockHelperMissing=helpers.blockHelperMissing;return buffer+='<?xml version="1.0" encoding="UTF-8"?>\n<assessmentItem \n    ',stack1=helpers.each.call(depth0,depth0&&depth0.namespaces,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",(helper=helpers.xsi)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.xsi,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'schemaLocation="',(helper=helpers.schemaLocations)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.schemaLocations,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"\n    ',stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",options={hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data},(helper=helpers.responses)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.responses,
stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.responses||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data},(helper=helpers.outcomes)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.outcomes,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.outcomes||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),
options={hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data},(helper=helpers.stylesheets)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.stylesheets,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.stylesheets||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    \n    <itemBody",stack1=helpers["if"].call(depth0,depth0&&depth0["class"],{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{
hash:{},inverse:self.program(14,program14,data),fn:self.program(12,program12,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </itemBody>\n    \n    ",(helper=helpers.responseProcessing)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseProcessing,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data},(helper=helpers.feedbacks)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.feedbacks,stack1=typeof helper===functionType?helper.call(depth0,options):helper),
helpers.feedbacks||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    \n    ",(helper=helpers.apipAccessibility)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.apipAccessibility,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</assessmentItem>\n"})}),define("taoQtiItem/qtiXmlRenderer/renderers/Item",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/item"],function(_,tpl,rendererConfig){"use strict";return{qtiClass:"assessmentItem",template:tpl,
getData:function(item,data){var renderer=this,defaultData={"class":data.attributes["class"]||"",responses:[],outcomes:[],stylesheets:[],feedbacks:[],namespaces:item.getNamespaces(),schemaLocations:"",xsi:"xsi:",empty:item.isEmpty(),responseProcessing:item.responseProcessing?item.responseProcessing.render(renderer):"",apipAccessibility:item.getApipAccessibility()||""};return _.forIn(item.getSchemaLocations(),function(url,uri){defaultData.schemaLocations+=uri+" "+url+" "}),defaultData.schemaLocations=defaultData.schemaLocations.trim(),_.each(item.responses,function(response){defaultData.responses.push(response.render(renderer))}),_.each(item.outcomes,function(outcome){
defaultData.outcomes.push(outcome.render(renderer))}),_.each(item.stylesheets,function(stylesheet){defaultData.stylesheets.push(stylesheet.render(renderer))}),_.each(item.modalFeedbacks,function(feedback){defaultData.feedbacks.push(feedback.render(renderer))}),data=_.merge({},data||{},defaultData),delete data.attributes["class"],data.attributes.title=_.escape(data.attributes.title),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Math",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"math",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/Object",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"object",
template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/outcomeDeclaration",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){return"/>\n"}function program5(depth0,data){var stack1,buffer="";return buffer+=">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.defaultValue,
null==stack1||stack1===!1?stack1:stack1.length),{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</outcomeDeclaration>"}function program6(depth0,data){var stack1,buffer="";return buffer+="<defaultValue>\n        ",stack1=helpers.each.call(depth0,depth0&&depth0.defaultValue,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</defaultValue>\n    "}function program7(depth0,data){var buffer="";return buffer+="<value>"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+"</value>\n        "}this.compilerInfo=[4,">= 1.0.0"],
helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="\n<outcomeDeclaration",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("taoQtiItem/qtiXmlRenderer/renderers/OutcomeDeclaration",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/outcomeDeclaration"],function(_,tpl){
return{qtiClass:"outcomeDeclaration",template:tpl,getData:function(outcomeDeclaration,data){var defaultValue=[];outcomeDeclaration.defaultValue&&(defaultValue="object"==typeof outcomeDeclaration.defaultValue?_.values(outcomeDeclaration.defaultValue):[outcomeDeclaration.defaultValue]);var defaultData={empty:!_.size(defaultValue),defaultValue:defaultValue};return _.merge(data||{},defaultData)}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/portableInfoControl",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data,depth1){var stack1,buffer="";return buffer+="\n                <"+escapeExpression((stack1=depth1&&depth1.ns,
stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+'lib id="'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'"/>\n                '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+="<infoControl ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),
(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+'portableInfoControl infoControlTypeIdentifier="',(helper=helpers.typeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.typeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" hook="',(helper=helpers.entryPoint)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.entryPoint,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n\n        <'+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+'resources location="http://imsglobal.org/pci/1.0.15/sharedLibraries.xml">\n            <'+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+"libraries>\n                ",stack1=helpers.each.call(depth0,depth0&&depth0.libraries,{hash:{},inverse:self.noop,fn:self.programWithDepth(1,program1,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n            </"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+"libraries>\n        </"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+"resources>\n\n        ",helper=helpers.portableElementProperties||depth0&&depth0.portableElementProperties,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.properties,(stack1=depth0&&depth0.ns,null==stack1||stack1===!1?stack1:stack1.pic),options):helperMissing.call(depth0,"portableElementProperties",depth0&&depth0.properties,(stack1=depth0&&depth0.ns,
null==stack1||stack1===!1?stack1:stack1.pic),options),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+"markup>\n            ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+"markup>\n\n    </"+escapeExpression((stack1=depth0&&depth0.ns,
stack1=null==stack1||stack1===!1?stack1:stack1.pic,typeof stack1===functionType?stack1.apply(depth0):stack1))+"portableInfoControl>\n</infoControl>"})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/properties",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+=' key="',(helper=helpers.key)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.key,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"'}function program3(depth0,data,depth1){
var stack1,buffer="";return stack1=helpers["if"].call(depth0,depth0&&depth0.key,{hash:{},inverse:self.program(6,program6,data),fn:self.programWithDepth(4,program4,data,depth1),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program4(depth0,data,depth2){var stack1,helper,buffer="";return buffer+="<"+escapeExpression((stack1=depth2&&depth2.ns,typeof stack1===functionType?stack1.apply(depth0):stack1))+'entry key="',(helper=helpers.key)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.key,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',(helper=helpers.value)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</"+escapeExpression((stack1=depth2&&depth2.ns,typeof stack1===functionType?stack1.apply(depth0):stack1))+"entry>\n        "}function program6(depth0,data){var stack1,helper,buffer="";return buffer+="\n            ",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<",(helper=helpers.ns)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.ns,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"properties",stack1=helpers["if"].call(depth0,depth0&&depth0.key,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",stack1=helpers.each.call(depth0,depth0&&depth0.entries,{hash:{},inverse:self.noop,fn:self.programWithDepth(3,program3,data,depth0),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</",(helper=helpers.ns)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.ns,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"properties>"})}),define("taoQtiItem/qtiXmlRenderer/helper/portableElementTpl",["lodash","handlebars","tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/properties"],function(_,Handlebars,propertiesTpl){function renderPortableElementProperties(properties,ns,name){var entries=[];return _.forIn(properties,function(value,key){_.isObject(value)?entries.push({value:renderPortableElementProperties(value,ns,key)
}):entries.push({key:key,value:value})}),propertiesTpl({entries:entries,ns:ns,key:name})}Handlebars.registerHelper("portableElementProperties",function(properties,ns){return renderPortableElementProperties(properties,ns,"")})}),define("taoQtiItem/qtiXmlRenderer/renderers/PortableInfoControl",["tpl!taoQtiItem/qtiXmlRenderer/tpl/portableInfoControl","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiXmlRenderer/helper/portableElementTpl"],function(tpl,util){"use strict";return{qtiClass:"infoControl",template:tpl,getData:function(infoControl,data){var markupNs=infoControl.getMarkupNamespace();return data.markup=util.addMarkupNamespace(infoControl.markup,markupNs?markupNs.name:""),
infoControl.attr("id")||infoControl.attr("id",util.buildId(infoControl.getRelatedItem(),infoControl.typeIdentifier)),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responseDeclaration",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return"/>"}function program3(depth0,data){var stack1,buffer="";return buffer+=">",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.defaultValue,null==stack1||stack1===!1?stack1:stack1.length),{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.correctResponse,
null==stack1||stack1===!1?stack1:stack1.length),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.isAreaMapping,{hash:{},inverse:self.program(20,program20,data),fn:self.program(14,program14,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </responseDeclaration>"}function program4(depth0,data){var stack1,buffer="";return buffer+="\n    <defaultValue>",stack1=helpers.each.call(depth0,depth0&&depth0.defaultValue,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </defaultValue>\n    ";
}function program5(depth0,data){var buffer="";return buffer+="\n        <value>"+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+"</value>\n        "}function program7(depth0,data){var stack1,buffer="";return buffer+="\n    <correctResponse>",stack1=helpers.each.call(depth0,depth0&&depth0.correctResponse,{hash:{},inverse:self.noop,fn:self.programWithDepth(8,program8,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </correctResponse>\n    "}function program8(depth0,data,depth1){var stack1,buffer="";return stack1=helpers["if"].call(depth0,depth1&&depth1.isRecord,{hash:{},inverse:self.program(12,program12,data),
fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program9(depth0,data){var stack1,buffer="";return stack1=helpers["if"].call(depth0,depth0&&depth0.value,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        "}function program10(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <value fieldIdentifier="',(helper=helpers.fieldIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.fieldIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" baseType="',
(helper=helpers.baseType)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.baseType,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"><![CDATA[',(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="]]></value>\n        "}function program12(depth0,data){var stack1,buffer="";return buffer+="\n        <value><![CDATA[",stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,(stack1||0===stack1)&&(buffer+=stack1),
buffer+="]]></value>\n        "}function program14(depth0,data){var stack1,buffer="";return stack1=helpers["if"].call(depth0,depth0&&depth0.hasMapEntries,{hash:{},inverse:self.noop,fn:self.program(15,program15,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program15(depth0,data){var stack1,buffer="";return buffer+="<areaMapping",stack1=helpers.each.call(depth0,depth0&&depth0.mappingAttributes,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers.each.call(depth0,depth0&&depth0.mapEntries,{hash:{},inverse:self.noop,fn:self.program(18,program18,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </areaMapping>\n        "}function program16(depth0,data){var stack1,buffer="";return buffer+=" "+escapeExpression((stack1=null==data||data===!1?data:data.key,typeof stack1===functionType?stack1.apply(depth0):stack1))+'="'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'"'}function program18(depth0,data){var stack1,helper,buffer="";return buffer+='\n            <areaMapEntry shape="',(helper=helpers.shape)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.shape,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),
buffer+=escapeExpression(stack1)+'" coords="',(helper=helpers.coords)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.coords,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" mappedValue="',(helper=helpers.mappedValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.mappedValue,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />'}function program20(depth0,data){var stack1,buffer="";return stack1=helpers["if"].call(depth0,depth0&&depth0.hasMapEntries,{hash:{},inverse:self.noop,fn:self.program(21,program21,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    "}function program21(depth0,data){var stack1,buffer="";return buffer+="<mapping",stack1=helpers.each.call(depth0,depth0&&depth0.mappingAttributes,{hash:{},inverse:self.noop,fn:self.program(16,program16,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers.each.call(depth0,depth0&&depth0.mapEntries,{hash:{},inverse:self.noop,fn:self.program(22,program22,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </mapping>\n        "}function program22(depth0,data){var stack1,buffer="";return buffer+='\n            <mapEntry mapKey="'+escapeExpression((stack1=null==data||data===!1?data:data.key,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'" mappedValue="'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'" caseSensitive="false"/>'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;return buffer+="<responseDeclaration ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),
(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.empty,{hash:{},inverse:self.program(3,program3,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n"})}),define("taoQtiItem/qtiXmlRenderer/renderers/ResponseDeclaration",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responseDeclaration"],function(_,tpl){return{qtiClass:"responseDeclaration",template:tpl,getData:function(responseDeclaration,data){var defaultData={empty:!_.size(responseDeclaration.mapEntries)&&!_.size(responseDeclaration.correctResponse)&&!_.size(responseDeclaration.defaultValue),correctResponse:_.values(responseDeclaration.correctResponse),
isAreaMapping:"point"===responseDeclaration.attributes.baseType,mappingAttributes:responseDeclaration.mappingAttributes,hasMapEntries:_.size(responseDeclaration.mapEntries),mapEntries:responseDeclaration.mapEntries,defaultValue:responseDeclaration.defaultValue,isRecord:"record"===responseDeclaration.attributes.cardinality};return _.merge(defaultData,data||{})}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responseProcessing",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return(helper=helpers.xml)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.xml,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='<responseProcessing template="',(helper=helpers.template)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.template,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"/>'}function program5(depth0,data){var stack1,helper,options,buffer="";return buffer+="<responseProcessing>\n    ",options={hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data},(helper=helpers.responseRules)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.responseRules,
stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.responseRules||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    ",options={hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data},(helper=helpers.feedbackRules)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.feedbackRules,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.feedbackRules||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n</responseProcessing>"}function program6(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return stack1=helpers["if"].call(depth0,depth0&&depth0.custom,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.template,{hash:{},inverse:self.noop,
fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.templateDriven,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/match_correct",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier="',
(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            <correct identifier="',(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n        </match>\n        <setOutcomeValue identifier="',(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.outcomeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <sum>\n                <variable identifier="',(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n                <baseValue baseType="integer">1</baseValue>\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>'})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<responseCondition>\n    <responseIf>\n        <not>\n            <isNull>\n                <variable identifier="',(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            </isNull>\n        </not>\n        <setOutcomeValue identifier="',
(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <sum>\n                <variable identifier="',(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n                <mapResponse identifier="',(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>'})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response_point",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<responseCondition>\n    <responseIf>\n        <not>\n            <isNull>\n                <variable identifier="',
(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            </isNull>\n        </not>\n        <setOutcomeValue identifier="',(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <sum>\n                <variable identifier="',(helper=helpers.outcomeIdentifier)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.outcomeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n                <mapResponsePoint identifier="',(helper=helpers.responseIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.responseIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            </sum>\n        </setOutcomeValue>\n    </responseIf>\n</responseCondition>'})}),define("taoQtiItem/qtiXmlRenderer/renderers/ResponseProcessing",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responseProcessing","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/match_correct","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/map_response_point"],function(_,tpl,correctTpl,mapTpl,mapPointTpl){
var _renderInteractionRp=function(interaction){var ret="",response=interaction.getResponseDeclaration();return response.template&&(ret=_renderRpTpl(response.template,{responseIdentifier:response.id(),outcomeIdentifier:"SCORE"})),ret},_renderRpTpl=function(rpTpl,data){var ret="";switch(rpTpl){case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/match_correct":case"MATCH_CORRECT":ret=correctTpl(data);break;case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response":case"MAP_RESPONSE":ret=mapTpl(data);break;case"http://www.imsglobal.org/question/qti_v2p1/rptemplates/map_response_point":case"MAP_RESPONSE_POINT":ret=mapPointTpl(data);break;default:
throw new Error("unknown rp template : "+rpTpl)}return ret},_renderFeedbackRules=function(renderer,response){var ret=[];return _.each(response.getFeedbackRules(),function(rule){ret.push(rule.render(renderer))}),ret};return{qtiClass:"responseProcessing",template:tpl,getData:function(responseProcessing,data){var defaultData={},_renderer=this;switch(responseProcessing.processingType){case"custom":defaultData.custom=!0,defaultData.xml=responseProcessing.xml;break;case"templateDriven":var interactions=responseProcessing.getRelatedItem().getInteractions();if(1===interactions.length){var response=interactions[0].getResponseDeclaration();if(0===_.size(response.getFeedbackRules())&&"RESPONSE"===response.id()){
defaultData.template=response.template;break}}defaultData.templateDriven=!0,defaultData.responseRules=[],_.each(interactions,function(interaction){defaultData.responseRules.push(_renderInteractionRp(interaction))}),defaultData.feedbackRules=[],_.each(interactions,function(interaction){defaultData.feedbackRules=_.union(defaultData.feedbackRules,_renderFeedbackRules(_renderer,interaction.getResponseDeclaration()))})}return _.merge(data||{},defaultData)}}}),define("taoQtiItem/qtiXmlRenderer/renderers/RubricBlock",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element","lodash"],function(tpl,_){return{qtiClass:"rubricBlock",template:tpl,getData:function(rubricBlock,data){var newData={
view:data.attributes.view?_.values(data.attributes.view).join(" "):""};return _.merge(data||{},newData)}}}),define("taoQtiItem/qtiXmlRenderer/renderers/Stylesheet",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"stylesheet",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/AssociableHotspot",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"associableHotspot",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/Gap",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"gap",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/choices/gapImg",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",helperMissing=helpers.helperMissing,self=this,functionType="function";return buffer+="<gapImg",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    ",(helper=helpers.renderedObject)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.renderedObject,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</gapImg>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/GapImg",["tpl!taoQtiItem/qtiXmlRenderer/tpl/choices/gapImg"],function(tpl){return{qtiClass:"gapImg",template:tpl,getData:function(gapImg,data){return data.renderedObject=gapImg.object.render(this),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/GapText",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){
return{qtiClass:"gapText",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/HotspotChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"hotspotChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/Hottext",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"hottext",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/InlineChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"inlineChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleAssociableChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){
return{qtiClass:"simpleAssociableChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/choices/SimpleChoice",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"simpleChoice",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/feedbacks/ModalFeedback",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/element","taoQtiItem/qtiItem/helper/container"],function(_,tpl,containerHelper){"use strict";function encodeOutcomeInfo(fb){var relatedResponse=fb.data("relatedResponse");relatedResponse&&relatedResponse.attr("identifier")&&containerHelper.setEncodedData(fb,"relatedOutcome",relatedResponse.attr("identifier"))}return{qtiClass:"modalFeedback",
template:tpl,getData:function(fb,data){return encodeOutcomeInfo(fb),data.body=fb.getBody().render(this),data.attributes.title=_.escape(data.attributes.title),data}}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),
buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1,helper;return(helper=helpers.object)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.object,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:"";
}function program9(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.object,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,
stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/AssociateInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){
return{qtiClass:"associateInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/ChoiceInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"choiceInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/EndAttemptInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"endAttemptInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/ExtendedTextInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"extendedTextInteraction",
template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GapMatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"gapMatchInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicAssociateInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"graphicAssociateInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/graphicGapMatchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){
var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,
stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,functionType="function",self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<graphicGapMatchInteraction",stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n    ",(helper=helpers.object)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.object,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.gapImgs)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.gapImgs,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.gapImgs||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),options={
hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</graphicGapMatchInteraction>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicGapMatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/graphicGapMatchInteraction"],function(tpl){return{qtiClass:"graphicGapMatchInteraction",
template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/GraphicOrderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"graphicOrderInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/HotspotInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"hotspotInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/hottextInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";
return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{
hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">";
})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/HottextInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/hottextInteraction"],function(tpl){return{qtiClass:"hottextInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/InlineChoiceInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"inlineChoiceInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/matchInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";
return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,
stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data
}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <simpleMatchSet>\n        ",options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.matchSet1)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet1,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.matchSet1||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),
buffer+="\n    </simpleMatchSet>\n    <simpleMatchSet>\n        ",options={hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data},(helper=helpers.matchSet2)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.matchSet2,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.matchSet2||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </simpleMatchSet>\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/MatchInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/matchInteraction"],function(tpl){return{qtiClass:"matchInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/mediaInteraction",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),
(stack1||0===stack1)&&(buffer+=stack1),buffer}function program3(depth0,data){var stack1,helper;return(helper=helpers.prompt)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.prompt,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}function program5(depth0,data){var stack1,helper,options,buffer="";return buffer+=" ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,(stack1=depth0&&depth0.object,null==stack1||stack1===!1?stack1:stack1.attributes),"="," ",'"',options):helperMissing.call(depth0,"join",(stack1=depth0&&depth0.object,
null==stack1||stack1===!1?stack1:stack1.attributes),"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program7(depth0,data){var stack1;return stack1=typeof depth0===functionType?depth0.apply(depth0):depth0,stack1||0===stack1?stack1:""}function program9(depth0,data){var stack1,helper;return(helper=helpers.body)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.body,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,functionType="function",escapeExpression=this.escapeExpression,self=this,blockHelperMissing=helpers.blockHelperMissing;
return buffer+="<",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.attributes,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">",stack1=helpers["if"].call(depth0,depth0&&depth0.prompt,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n    <object ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.object,
null==stack1||stack1===!1?stack1:stack1.attributes),{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />",options={hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data},(helper=helpers.choices)?stack1=helper.call(depth0,options):(helper=depth0&&depth0.choices,stack1=typeof helper===functionType?helper.call(depth0,options):helper),helpers.choices||(stack1=blockHelperMissing.call(depth0,stack1,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data})),(stack1||0===stack1)&&(buffer+=stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.body,{hash:{},inverse:self.noop,
fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\r\n</",(helper=helpers.tag)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.tag,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/MediaInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/mediaInteraction"],function(tpl){return{qtiClass:"mediaInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/OrderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){
return{qtiClass:"orderInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/main",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data,depth1){var stack1,buffer="";return buffer+="\n                <"+escapeExpression((stack1=depth1&&depth1.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+'lib id="'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+'"/>\n                '}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+="<customInteraction ",helper=helpers.join||depth0&&depth0.join,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.attributes,"="," ",'"',options):helperMissing.call(depth0,"join",depth0&&depth0.attributes,"="," ",'"',options),(stack1||0===stack1)&&(buffer+=stack1),buffer+=">\n    <"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+'portableCustomInteraction customInteractionTypeIdentifier="',
(helper=helpers.typeIdentifier)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.typeIdentifier,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" hook="',(helper=helpers.entryPoint)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.entryPoint,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n\n        <'+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+'responseSchema href="http://imsglobal.org/schema/json/v1.0/response.json"/>\n\n        <'+escapeExpression((stack1=depth0&&depth0.ns,
stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+'resources location="http://imsglobal.org/pci/1.0.15/sharedLibraries.xml">\n            <'+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+"libraries>\n                ",stack1=helpers.each.call(depth0,depth0&&depth0.libraries,{hash:{},inverse:self.noop,fn:self.programWithDepth(1,program1,data,depth0),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,
typeof stack1===functionType?stack1.apply(depth0):stack1))+"libraries>\n        </"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+"resources>\n\n        ",helper=helpers.portableElementProperties||depth0&&depth0.portableElementProperties,options={hash:{},data:data},stack1=helper?helper.call(depth0,depth0&&depth0.properties,(stack1=depth0&&depth0.ns,null==stack1||stack1===!1?stack1:stack1.pci),options):helperMissing.call(depth0,"portableElementProperties",depth0&&depth0.properties,(stack1=depth0&&depth0.ns,null==stack1||stack1===!1?stack1:stack1.pci),options),
(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+"markup>\n            ",(helper=helpers.markup)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.markup,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </"+escapeExpression((stack1=depth0&&depth0.ns,stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+"markup>\n\n    </"+escapeExpression((stack1=depth0&&depth0.ns,
stack1=null==stack1||stack1===!1?stack1:stack1.pci,typeof stack1===functionType?stack1.apply(depth0):stack1))+"portableCustomInteraction>\n</customInteraction>"})}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/PortableCustomInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/portableCustomInteraction/main","taoQtiItem/qtiItem/helper/util","taoQtiItem/qtiXmlRenderer/helper/portableElementTpl"],function(tpl,util){return{qtiClass:"customInteraction",template:tpl,getData:function(interaction,data){var markupNs=interaction.getMarkupNamespace();return data.markup=util.addMarkupNamespace(interaction.markup,markupNs?markupNs.name:""),data}}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/Prompt",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){
return{qtiClass:"prompt",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/SelectPointInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"selectPointInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/SliderInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){return{qtiClass:"sliderInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/TextEntryInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/element"],function(tpl){return{qtiClass:"textEntryInteraction",template:tpl}}),define("taoQtiItem/qtiXmlRenderer/renderers/interactions/UploadInteraction",["tpl!taoQtiItem/qtiXmlRenderer/tpl/interactions/blockInteraction"],function(tpl){
return{qtiClass:"uploadInteraction",template:tpl}}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,functionType="function";return(helper=helpers.rule)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.rule,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),stack1||0===stack1?stack1:""})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_condition",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
function program1(depth0,data){var stack1,buffer="";return stack1=helpers["if"].call(depth0,depth0&&depth0.mapResponsePoint,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program2(depth0,data){var stack1,helper,buffer="";return buffer+='\n            <mapResponsePoint identifier="',(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />'}function program4(depth0,data){var stack1,helper,buffer="";
return buffer+='\n            <mapResponse identifier="',(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />'}function program6(depth0,data){var stack1,helper,buffer="";return buffer+='\n            <variable identifier="',(helper=helpers.outcome)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.outcome,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />'}function program8(depth0,data){var stack1,buffer="";
return buffer+='\n    <responseElse>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1["else"],typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+="<responseCondition>\n    <responseIf>\n        <",(helper=helpers.condition)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.condition,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+">",stack1=helpers["if"].call(depth0,depth0&&depth0.response,{hash:{},inverse:self.program(6,program6,data),fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n            <baseValue baseType="float">',(helper=helpers.comparedValue)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.comparedValue,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</baseValue>\n        </",(helper=helpers.condition)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.condition,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.then,
typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||stack1===!1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(8,program8,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>"})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_correct",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='\n    <responseElse>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,
stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1["else"],typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier="',
(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            <correct identifier="',(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n        </match>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,
stack1=null==stack1||stack1===!1?stack1:stack1.then,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||stack1===!1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>"})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_incorrect",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,buffer="";return buffer+='\n    <responseElse>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,
stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1["else"],typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<responseCondition>\n    <responseIf>\n        <not>\n            <match>\n                <variable identifier="',
(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n                <correct identifier="',(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            </match>\n        </not>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.outcome,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.then,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||stack1===!1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>"})}),define("tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_choices",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n<responseCondition>\n    <responseIf>\n        <match>\n            <variable identifier="',(helper=helpers.response)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.response,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" />\n            ',stack1=helpers["if"].call(depth0,depth0&&depth0.multiple,{hash:{},inverse:self.program(5,program5,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),
buffer+='\n        </match>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.then,typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseIf>",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.feedback,null==stack1||stack1===!1?stack1:stack1["else"]),{hash:{},inverse:self.noop,fn:self.program(7,program7,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</responseCondition>\n"}function program2(depth0,data){var stack1,buffer="";return buffer+="\n            <multiple>\n                ",stack1=helpers.each.call(depth0,depth0&&depth0.choices,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n            </multiple>\n            "}function program3(depth0,data){var buffer="";return buffer+='\n                <baseValue baseType="identifier">'+escapeExpression(typeof depth0===functionType?depth0.apply(depth0):depth0)+"</baseValue>\n                "}function program5(depth0,data){
var stack1,helper,buffer="";return buffer+='\n            <baseValue baseType="identifier">',(helper=helpers.choice)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.choice,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</baseValue>\n            "}function program7(depth0,data){var stack1,buffer="";return buffer+='\n    <responseElse>\n        <setOutcomeValue identifier="'+escapeExpression((stack1=depth0&&depth0.feedback,stack1=null==stack1||stack1===!1?stack1:stack1.outcome,typeof stack1===functionType?stack1.apply(depth0):stack1))+'">\n            <baseValue baseType="identifier">'+escapeExpression((stack1=depth0&&depth0.feedback,
stack1=null==stack1||stack1===!1?stack1:stack1["else"],typeof stack1===functionType?stack1.apply(depth0):stack1))+"</baseValue>\n        </setOutcomeValue>\n    </responseElse>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,functionType="function",escapeExpression=this.escapeExpression,self=this;return stack1=helpers.unless.call(depth0,depth0&&depth0.noData,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiItem/qtiXmlRenderer/renderers/responses/SimpleFeedbackRule",["lodash","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_condition","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_correct","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_incorrect","tpl!taoQtiItem/qtiXmlRenderer/tpl/responses/rule_choices"],function(_,tpl,tplCondition,tplCorrect,tplIncorrect,tplChoices){
return{qtiClass:"_simpleFeedbackRule",template:tpl,getData:function(rule,data){var _values,template=null,ruleXml="",tplData={response:rule.comparedOutcome.id(),feedback:{outcome:rule.feedbackOutcome.id(),then:rule.feedbackThen.id(),"else":rule.feedbackElse?rule.feedbackElse.id():""}};switch(rule.condition){case"correct":template=tplCorrect;break;case"incorrect":template=tplIncorrect;break;case"lt":case"lte":case"equal":case"gte":case"gt":template=tplCondition,tplData.condition=rule.condition,tplData.comparedValue=rule.comparedValue;break;case"choices":template=tplChoices,tplData.condition=rule.condition,tplData.multiple=rule.comparedOutcome.isCardinality(["multiple","ordered"]),
_values=[],_.each(rule.comparedValue,function(choice){choice.parent()&&_values.push(choice.id())}),tplData.multiple?tplData.choices=_values:_values.length?tplData.choice=_.head(_values):tplData.noData=!0;break;default:throw new Error("unknown condition in simple feedback rule rendering : "+rule.condition)}return template&&(ruleXml=template(tplData)),_.merge(data||{},{rule:ruleXml})}}});
//# sourceMappingURL=controllers.min.js.map