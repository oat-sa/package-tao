version: '3'

services:
    tao-nginx:
        container_name: tao-nginx
        image: nginx:stable
        networks:
            - tao
            - oat-docker
        volumes:
            - .:/var/www/html:cached
            - ./docker/nginx/nginx.conf:/etc/nginx/conf.d/default.conf:cached
        working_dir: /etc/nginx/conf.d
        labels:
            - "traefik.backend=tao-nginx"
            - "traefik.frontend.rule=Host:tao.docker.localhost"
            - "traefik.docker.network=oat-docker"
            - "traefik.port=80"
            -
    tao-phpfpm:
        container_name: tao-phpfpm
        build:
            context: ./docker/phpfpm
        expose:
            - 9000
        networks:
            - tao
            - oat-docker
        volumes:
            - .:/var/www/html
        working_dir: /var/www/html

    tao-mariadb:
        container_name: tao-mariadb
        image: mariadb:latest
        networks:
            - tao
        ports:
            - 3306
        environment:
            MYSQL_ROOT_PASSWORD: r00t
            MYSQL_USER: tao
            MYSQL_PASSWORD: tao
            MYSQL_DATABASE: tao
        volumes:
            - tao-mariadb_data:/var/lib/mysql:cached

    tao-redis:
        container_name: tao-redis
        image: redis
        command: ["redis-server", "--appendonly", "yes"]
        networks:
            - tao
        ports:
            - 6379
        volumes:
            - tao-redis_data:/data

volumes:
    tao-mariadb_data:
        driver: local
    tao-redis_data:
        driver: local

networks:
    tao:
        driver: bridge
    oat-docker:
        external: true
