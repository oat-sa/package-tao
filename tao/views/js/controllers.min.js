define("controller/routes",[],function(){"use strict";return{Main:{actions:{index:"controller/main",getSectionActions:"controller/main/actions",getSectionTrees:"controller/main/trees",login:"controller/login"}},PasswordRecovery:{actions:{index:"controller/passwordRecovery"}},Lock:{actions:{locked:"controller/Lock/locked"}},ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}},Users:{deps:"controller/users/disable-edit",actions:{index:"controller/users/index",add:"controller/users/add"}}}}),define("tao/controller/Lock/locked",["jquery","i18n","helpers","lock","layout/section","ui/feedback"],function($,__,helpers,Lock,sectionApi,feedback){"use strict";
return{start:function(){$(".forcerelease").click(function(e){e.preventDefault(),$.ajax({url:helpers._url("forceRelease","Lock","tao"),type:"POST",data:{uri:$(this).data("id")},dataType:"json",success:function(response){response.success?(feedback().success(__("The lock has been released")),$(".tree").trigger("refresh.taotree")):feedback().error(__("Unable to release the lock"))},error:function(){feedback().error(__("Unable to release the lock"))}})})}}}),define("tao/controller/login",["jquery","lodash","i18n","module","ui/feedback","layout/version-warning"],function($,_,__,module,feedback,versionWarning){"use strict";function submitForm(){$fakeForm.find(":input").each(function(){
var $field=$(this);$loginForm.find('input[name="'+$field.attr("name")+'"]').val($field.val())}),$loginForm.submit()}function displayMessages(messages){var $fields=$context.find(":input"),renderer=feedback();_.forEach(messages,function(message,type){message&&(_.isFunction(renderer[type])&&renderer[type](message),$fields.addClass(type))})}var conf=module.config(),messages=conf.message||{},$context=$(".entry-point-container"),$loginForm=$context.find("#loginForm"),$fakeForm=$context.find(".fakeForm");versionWarning.init(),!messages.error&&$context.find(".form-error").length&&(messages.error=__("All fields are required")),displayMessages(messages),$fakeForm.find('input[type="submit"], button[type="submit"]').off("click").on("click",function(e){
e.preventDefault(),submitForm()}),$fakeForm.on("keypress",function(e){13===e.which&&(e.preventDefault(),submitForm())})}),define("tao/controller/main",["jquery","i18n","context","helpers","uiForm","layout/section","layout/actions","layout/tree","layout/version-warning","layout/section-height","layout/loading-bar","layout/nav","layout/search"],function($,__,context,helpers,uiForm,section,actions,treeFactory,versionWarning,sectionHeight,loadingBar,nav,search){"use strict";return{start:function(){var $doc=$(document);versionWarning.init(),$doc.ajaxSend(function(){loadingBar.start()}),$doc.ajaxComplete(function(){loadingBar.stop()}),nav.init(),search.init(),section.on("activate",function(section){
if(window.scrollTo(0,0),section&&section.id)switch(context.section=section.id,actions.init(section.panel),section.type){case"tree":section.panel.addClass("content-panel"),sectionHeight.init(section.panel),$(".taotree",section.panel).each(function(){var $treeElt=$(this),$actionBar=$(".tree-action-bar-box",section.panel),rootNode=$treeElt.data("rootnode"),treeUrl=context.root_url,treeActions={};$.each($treeElt.data("actions"),function(key,val){actions.getBy(val)&&(treeActions[key]=val)}),treeUrl+=/\/$/.test(treeUrl)?$treeElt.data("url").replace(/^\//,""):$treeElt.data("url"),treeFactory($treeElt,treeUrl,{serverParameters:{extension:context.shownExtension,perspective:context.shownStructure,
section:context.section,classUri:rootNode?rootNode:void 0},actions:treeActions}),$treeElt.on("ready.taotree",function(){$actionBar.addClass("active"),sectionHeight.setHeights(section.panel)})}),$(".navi-container",section.panel).show();break;case"content":this.loadContentBlock()}}).init(),helpers.init(),uiForm.init()}}}),define("tao/controller/passwordRecovery",["jquery","i18n","module","ui/feedback","layout/version-warning"],function($,__,module,feedback,versionWarning){"use strict";var feedbackType,conf=module.config();if(versionWarning.init(),conf.message)for(feedbackType in conf.message)conf.message[feedbackType]&&feedback()[feedbackType](conf.message[feedbackType]);
}),define("tao/controller/routes",[],function(){"use strict";return{Main:{actions:{index:"controller/main",getSectionActions:"controller/main/actions",getSectionTrees:"controller/main/trees",login:"controller/login"}},PasswordRecovery:{actions:{index:"controller/passwordRecovery"}},Lock:{actions:{locked:"controller/Lock/locked"}},ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}},Users:{deps:"controller/users/disable-edit",actions:{index:"controller/users/index",add:"controller/users/add"}}}}),define("tao/controller/settings/extensionManager",["jquery","i18n","context","helpers","ui/feedback"],function($,__,context,helpers,feedback){function getDependencies(extension){
var dependencies=[];return $("#"+extension+" .dependencies li:not(.installed)").each(function(){var ext=$(this).attr("rel"),deps=getDependencies(ext);deps.push(ext),dependencies=dependencies.concat(deps)}),dependencies}function getUnique(orig){for(var a=[],i=0;i<orig.length;i++)$.inArray(orig[i],a)<0&&a.push(orig[i]);return a}function progressConsole(msg){$("#installProgress .console").append("<p>"+msg+"</p>"),$("#installProgress .console").prop({scrollTop:$("#installProgress .console").prop("scrollHeight")})}function installNextExtension(){var ext=toInstall[indexCurrentToInstall];$("#installProgress p.status").text(__("Installing extension %s...").replace("%s",ext)),
progressConsole(__("Installing extension %s...").replace("%s",ext)),$.ajax({type:"POST",url:helpers._url("install","ExtensionsManager","tao"),data:"id="+ext,dataType:"json",success:function(data){helpers.loaded(),data.success?(progressConsole(__("> Extension %s succesfully installed.").replace("%s",ext)),$("li.ext-id.ext-"+ext).addClass("installed"),$("tr#"+ext).slideUp("normal",function(){var $tr=$("<tr></tr>").appendTo($("#extensions-manager-container tbody")).hide(),$orig=$("tr#"+ext+" td");$tr.append('<td class="ext-id bordered">'+$($orig[0]).text()+"</td>"),$tr.append('<td class="author">'+$($orig[1]).text()+"</td>"),$tr.append('<td class="version">'+$($orig[2]).text()+"</td>"),
$tr.slideDown("normal",function(){$("tr#"+ext).remove(),styleTables(),0==$("#available-extensions-container table tbody tr").length&&noAvailableExtensions(),$("#installProgress .bar").animate({width:"+="+percentByExt+"%"},1e3,function(){indexCurrentToInstall++,hasNextExtensionToInstall()})})})):(installError=1,progressConsole("Installation of "+ext+" failed")),feedback().info(data.message)}}),installError&&progressConsole(__("A fatal error occured during the installation process."))}function postInstall(){return progressConsole(__("Post install processing")),$.ajax({type:"GET",url:helpers._url("postInstall","ExtensionsManager","tao")})}function hasNextExtensionToInstall(){
indexCurrentToInstall>=toInstall.length?(toInstall=[],$("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),postInstall().done(function(data){helpers.loaded(),$("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),$("#installProgress p.status").text(__("Installation done.")),progressConsole(__("> Installation done.")),progressConsole(__("... reloading page.")),setTimeout(function(){window.location.reload(!0)},1e3)})):installNextExtension()}function styleTables(){$("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),$("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),
$("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd")}function noAvailableExtensions(){var $noAvailableExtElement=$("<div/>");$noAvailableExtElement.attr("id","noExtensions").addClass("ui-state-highlight").text(__("No extensions available.")),$("#available-extensions-container").empty().append($noAvailableExtElement)}var ext_installed=[],toInstall=[],indexCurrentToInstall=-1,percentByExt=0,installError=0;return{start:function(){styleTables(),$("#installProgress").hide(),$("#extensions-manager-container .ext-id").each(function(){var ext=$(this).text();ext_installed.push(ext),$(".ext-id.ext-"+ext).addClass("installed")}),$("#available-extensions-container tr input").click(function(event){
event.stopPropagation()}),$("#available-extensions-container tr input:checkbox").click(function(){var $installButton=$("#installButton");$(this).parent().parent().parent().find("input:checkbox:checked").length>0?$installButton.attr("disabled",!1):$installButton.attr("disabled",!0)}),$("#available-extensions-container #installButton").click(function(event){return toInstall=[],$("#available-extensions-container input:checked").each(function(){var ext=$(this).prop("name").split("_")[1],deps=getDependencies(ext);deps.length&&(toInstall=toInstall.concat(deps)),toInstall.push(ext)}),toInstall=getUnique(toInstall),toInstall.length?(percentByExt=100/toInstall.length,
$("#installProgress p.status").text(__("%s extension(s) to install.").replace("%s",toInstall.length)),$("#installProgress .bar").width(0),$("#installProgress .console").empty(),progressConsole(__("Do you wish to install the following extension(s):\n%s?").replace("%s",toInstall.join(", "))),$("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:__("No"),click:function(){$(this).dialog("close")}},{text:__("Yes"),click:function(){progressConsole(__("Preparing installation...")),$(".ui-dialog-buttonpane").remove(),installError=0,indexCurrentToInstall=0,installNextExtension()}}]}),void event.preventDefault()):(window.alert(__("Nothing to install !")),
!1)})}}}),define("tao/controller/users/add",["jquery","module","helpers","users"],function($,module,helpers,users){"use strict";return{start:function(){var conf=module.config(),url=helpers._url("checkLogin","Users","tao");users.checkLogin(conf.loginId,url),conf.exit===!0&&setTimeout(function(){window.location=helpers._url("index","Main","tao",{structure:"users",ext:"tao",section:"list_users"})},1e3)}}}),define("tao/controller/users/disable-edit",["layout/section"],function(section){"use strict";return{start:function(){section.get("edit_user").disable()}}}),define("tao/controller/users/index",["jquery","i18n","helpers","layout/section","ui/feedback","ui/datatable"],function($,__,helpers,section,feedback){
"use strict";var editUser=function(uri){section.get("edit_user").enable().loadContentBlock(helpers._url("edit","Users","tao"),{uri:uri}).show()},removeUser=function(uri){window.confirm(__("Please confirm user deletion"))&&$.ajax({url:helpers._url("delete","Users","tao"),data:{uri:uri},type:"POST"}).done(function(response){response.deleted?feedback().success(response.message):feedback().error(response.message),$("#user-list").datatable("refresh")})};return{start:function(){var $userList=$("#user-list");section.on("show",function(section){"list_users"===section.id&&$userList.datatable("refresh")}),$userList.datatable({url:helpers._url("data","Users","tao"),filter:!0,
actions:{edit:editUser,remove:removeUser},model:[{id:"login",label:__("Login"),sortable:!0},{id:"firstname",label:__("First Name"),sortable:!0},{id:"lastname",label:__("Last Name"),sortable:!0},{id:"email",label:__("Email"),sortable:!0},{id:"roles",label:__("Roles"),sortable:!1},{id:"dataLg",label:__("Data Language"),sortable:!0},{id:"guiLg",label:__("Interface Language"),sortable:!0}]})}}});
//# sourceMappingURL=controllers.min.js.map