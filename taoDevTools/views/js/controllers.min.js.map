{"version":3,"file":"routes.js","sources":["routes.js","ControllerMap/index.js","ScriptRunner/index.js","fontConversion/fileUpload.js","settings/extensionManager.js"],"names":["define","ExtensionsManager","actions","index","ScriptRunner","FontConversion","StudentTollGenerator","$","helpers","feedback","start","click","event","action","target","data","ajax","type","url","_url","dataType","success","loaded","message","error","ui","uploader","container","uploadUrl","on","e","file","interactionHook","__","section","getDependencies","extension","dependencies","each","ext","this","attr","deps","push","concat","getUnique","orig","a","i","length","inArray","progressConsole","msg","append","prop","scrollTop","installNextExtension","toInstall","indexCurrentToInstall","text","replace","animate","width","percentByExt","hasNextExtensionToInstall","installError","info","backgroundColor","window","location","reload","styleTables","removeClass","addClass","ext_installed","hide","preventDefault","create","id","name","uri","val","show","stopPropagation","$installButton","parent","find","split","alert","empty","join","dialog","modal","height","buttons","remove","setTimeout"],"mappings":"AAAAA,OAAA,mCAAA,WACA,OACAC,mBACAC,SACAC,MAAA,yCAGAC,cACAF,SACAC,MAAA,kCAGAE,gBACAH,SACAC,MAAA,yCAGAG,sBACAJ,SACAC,MAAA,4CCLAH,OAAA,6CAAA,cAEAA,OChBA,6CAAA,SAAA,UAAA,eAAA,SAAAO,EAAAC,QAAAC,UACA,OACAC,MAAA,WAEAH,EAAA,WAAAI,MAAA,SAAAC,OACA,GAAAC,QAAAN,EAAAK,MAAAE,QAAAC,KAAA,SACAR,GAAAS,MACAC,KAAA,OACAC,IAAAV,QAAAW,KAAAN,OAAA,eAAA,eACAO,SAAA,OACAC,QAAA,SAAAN,MACAP,QAAAc,SACAP,KAAAM,QACAZ,WAAAY,QAAAN,KAAAQ,SAEAd,WAAAe,MAAAT,KAAAQ;UAWAvB,OC1BA,oDAAA,SAAA,KAAA,cAAA,eAAA,SAAAO,EAAAkB,GAAAC,SAAAjB,UAEA,GAAAkB,WAAApB,EAAA,oBAEAoB,WAAAD,UACAE,UAAAD,UAAAZ,KAAA,SAGAY,UAAAE,GAAA,kBAAA,SAAAC,EAAAC,KAAAC,iBACAvB,WAAAY,QAAAW,gBAAAX,WAGAM,UAAAE,GAAA,gBAAA,SAAAC,EAAAC,KAAAC,iBACAvB,WAAAe,MAAAQ,gBAAAT,aCbAvB,OAAA,oDAAA,SAAA,OAAA,UAAA,iBAAA,eAAA,SAAAO,EAAA0B,GAAAzB,QAAA0B,QAAAzB,UAQA,QAAA0B,iBAAAC,WACA,GAAAC,gBAOA;MANA9B,GAAA,IAAA6B,UAAA,qCAAAE,KAAA,WACA,GAAAC,KAAAhC,EAAAiC,MAAAC,KAAA,OACAC,KAAAP,gBAAAI,IACAG,MAAAC,KAAAJ,KACAF,aAAAA,aAAAO,OAAAF,QAEAL,aAIA,QAAAQ,WAAAC,MAEA,IAAA,GADAC,MACAC,EAAA,EAAAA,EAAAF,KAAAG,OAAAD,IACAzC,EAAA2C,QAAAJ,KAAAE,GAAAD,GAAA,GACAA,EAAAJ,KAAAG,KAAAE,GAGA,OAAAD,GAGA,QAAAI,iBAAAC,KACA7C,EAAA,6BAAA8C,OAAA,MAAAD,IAAA,QACA7C,EAAA,6BAAA+C,MAAAC,UAAAhD,EAAA,6BAAA+C,KAAA,kBAGA,QAAAE,wBACA,GAAAjB,KAAAkB,UAAAC,sBACAnD,GAAA,6BAAAoD,KAAA1B,GAAA,8BAAA2B,QAAA,KAAArB,MACAY,gBAAAlB,GAAA,8BAAA2B,QAAA,KAAArB,MACAhC,EAAAS,MACAC,KAAA,OACAC,IAAAV,QAAAW,KAAA,UAAA,oBAAA,OACAJ,KAAA,MAAAwB,IACAnB,SAAA,OACAC,QAAA,SAAAN,MACAP,QAAAc,SACAP,KAAAM,SACA8B,gBAAAlB,GAAA,yCAAA2B,QAAA,KAAArB,MAEAhC,EAAA,yBAAAsD,SAAAC,MAAA,KAAAC,aAAA,KAAA,IAAA,WAEAL,wBACAM;KAGAC,aAAA,EACAd,gBAAA,mBAAAZ,IAAA,YAEA9B,WAAAyD,KAAAnD,KAAAQ,YAIA0C,cACAd,gBAAAlB,GAAA,2DAIA,QAAA+B,6BACAN,uBAAAD,UAAAR,QACAQ,aACAlD,EAAA,yBAAAsD,SAAAM,gBAAA,OAAAL,MAAA,QAAA,KACAX,gBAAAlB,GAAA,wBACA1B,EAAAS,MACAC,KAAA,MACAC,IAAAX,EAAAA,EAAA,gBAAA,IAAA+C,KAAA,QACAjC,QAAA,WACAb,QAAAc,SACAf,EAAA,yBAAAsD,SAAAM,gBAAA,QAAA,KACA5D,EAAA,6BAAAoD,KAAA1B,GAAA,uBACAkB,gBAAAlB,GAAA,yBACAmC,OAAAC,SAAAC;KAIAd,uBAIA,QAAAe,eAGAhE,EAAA,gCAAAiE,YAAA,gBACAA,YAAA,iBAEAjE,EAAA,gDAAAkE,SAAA,iBACAlE,EAAA,+CAAAkE,SAAA,gBA7FA,GAAAC,kBACAjB,aACAC,sBAAA,GACAK,aAAA,EACAE,aAAA,CAqGA,QACAvD,MAAA,WAGA6D,cAEAhE,EAAA,oBAAAoE,OAEApE,EAAA,cAAAI,MAAA,SAAAmB,GACAA,EAAA8C,iBACA1C,QAAA2C,QACAC,GAAA,wBACAC,KAAA9C,GAAA,wBACAf,IAAAV,QAAAW,KAAA,SAAA,oBAAA,eAAA6D,IAAAzE,EAAA,YAAA0E,UAEAC;GAIA3E,EAAA,yCAAA+B,KAAA,WACA,GAAAC,KAAAhC,EAAAiC,MAAAmB,MACAe,eAAA/B,KAAAJ,KACAhC,EAAA,eAAAgC,KAAAkC,SAAA,eAGAlE,EAAA,4CAAAI,MAAA,SAAAC,OACAA,MAAAuE,oBAGA5E,EAAA,qDAAAI,MAAA,WACA,GAAAyE,gBAAA7E,EAAA,iBACAA,GAAAiC,MAAA6C,SAAAA,SAAAA,SAAAC,KAAA,0BAAArC,OAAA,EACAmC,eAAA3C,KAAA,YAAA,GAGA2C,eAAA3C,KAAA,YAAA,KAIAlC,EAAA,kBAAAI,MAAA,SAAAC,OAUA,MARA6C,cACAlD,EAAA,iDAAA+B,KAAA,WACA,GAAAC,KAAAhC,EAAAiC,MAAAc,KAAA,QAAAiC,MAAA,KAAA,GACA7C,KAAAP,gBAAAI,IACAG;KAAAO,SAAAQ,UAAAA,UAAAb,OAAAF,OACAe,UAAAd,KAAAJ,OAEAkB,UAAAZ,UAAAY,WACA,GAAAA,UAAAR,QACAuC,MAAAvD,GAAA,0BACA,IAGA8B,aAAA,IAAAN,UAAAR,OAGA1C,EAAA,6BAAAoD,KAAA1B,GAAA,+BAAA2B,QAAA,KAAAH,UAAAR,SACA1C,EAAA,yBAAAuD,MAAA,GACAvD,EAAA,6BAAAkF,QACAtC,gBAAAlB,GAAA,2DAAA2B,QAAA,KAAAH,UAAAiC,KAAA,QACAnF,EAAA,oBAAAoF,QACAC,OAAA,EACA9B,MAAA,IACA+B,OAAA,IACAC,UAEAnC,KAAA1B,GAAA,MACAtB,MAAA,WACAJ,EAAAiC,MAAAmD,OAAA,YAIAhC,KAAA1B,GAAA,OACAtB,MAAA,WAEAwC,gBAAAlB,GAAA,8BACA1B,EAAA,yBAAAwF,SACA9B,aAAA,EACAP,sBAAA,EACAF;UAKA5C,OAAAgE,oBAGArE,EAAA,kBAAAI,MAAA,SAAAC,OACA,GAAAkE,IAAAvE,EAAAK,MAAAE,QAAAC,KAAA,QACAR,GAAAS,MACAC,KAAA,OACAC,IAAAV,QAAAW,KAAA,UAAA,oBAAA,eACAJ,KAAA,MAAA+D,GACA1D,SAAA,OACAC,QAAA,SAAAN,MACAA,KAAAM,SACAZ,WAAAY,QAAAN,KAAAQ,SACAyE,WAAA,WACA5B,OAAAC,SAAAC,UACA,MAEA7D,WAAAyD,KAAAnD,KAAAQ,cAMAhB,EAAA,iBAAAI,MAAA,SAAAC,OACA,GAAAkE,IAAAvE,EAAAK,MAAAE,QAAAC,KAAA,QACAR,GAAAS,MACAC,KAAA,OACAC,IAAAV,QAAAW,KAAA,SAAA,oBAAA,eACAJ,KAAA,MAAA+D,GACA1D,SAAA,OACAC,QAAA,SAAAN,MACAA,KAAAM,SACAZ,WAAAY,QAAAN,KAAAQ,SACAyE,WAAA,WACA5B,OAAAC,SAAAC;EACA,MAEA7D,WAAAyD,KAAAnD,KAAAQ,cAMAhB,EAAA,oBAAAI,MAAA,SAAAC,OACA,GAAAkE,IAAAvE,EAAAK,MAAAE,QAAAC,KAAA,QACAR,GAAAS,MACAC,KAAA,OACAC,IAAAV,QAAAW,KAAA,YAAA,oBAAA,eACAJ,KAAA,MAAA+D,GACA1D,SAAA,OACAC,QAAA,SAAAN,MACAA,KAAAM,SACAZ,WAAAY,QAAAN,KAAAQ,SACAyE,WAAA,WACA5B,OAAAC,SAAAC,UACA,MAEA7D,WAAAyD,KAAAnD,KAAAQ","sourcesContent":["define('taoDevTools/controller/routes',[],function(){\n    return {\n        'ExtensionsManager' : {\n            'actions' : {\n                'index' : 'controller/settings/extensionManager'\n            }\n        },\n        'ScriptRunner' : {\n            'actions' : {\n                'index' : 'controller/ScriptRunner/index'\n            }\n        },\n        'FontConversion' : {\n            'actions' : {\n                'index' : 'controller/fontConversion/fileUpload'\n            }\n        },\n        'StudentTollGenerator' : {\n            'actions' : {\n                'index' : 'controller/fontConversion/fileUpload'\n            }\n        }\n    };\n});\n\n","/*\ndefine(['jquery', 'helpers', 'context','jsTree/jquery.tree'], function($, helpers, context){\n\t$(document).ready(function () {\n\t    // Create jqxTree\n\t    \n\t    $('#jqxTree').tree({\n\t    \tui: {\n\t\t\t\ttheme_name : \"custom\",\n\t            theme_path : context.taobase_www + 'js/lib/jsTree/themes/custom/style.css'\n\t\t\t}\n\t    });\n\t});\n});\n*/;\ndefine(\"taoDevTools/controller/ControllerMap/index\", function(){});\n\n","define('taoDevTools/controller/ScriptRunner/index',['jquery', 'helpers', 'ui/feedback'], function($, helpers, feedback){\n\treturn {\n        start : function(){\n            \n            $('.script').click(function(event) {\n            \tvar action = $(event.target).data('action');\n            \t$.ajax({\n                    type: \"POST\",\n                    url: helpers._url(action, 'ScriptRunner', 'taoDevTools'),\n                    dataType: 'json',\n                    success: function(data) {\n                        helpers.loaded();\n                        if (data.success) {\n                            feedback().success(data.message);\n                        } else {\n                        \tfeedback().error(data.message);\n                        }\n                    }\n            \t});\n            });\n            \n        }\n    };\n\n});\n\n","define('taoDevTools/controller/fontConversion/fileUpload',['jquery', 'ui', 'ui/uploader', 'ui/feedback'], function($, ui, uploader, feedback){\n\n    var container = $('#upload-container');\n\n    container.uploader({\n        uploadUrl   : container.data('url')\n    });\n\n    container.on('upload.uploader', function(e, file, interactionHook){\n        feedback().success(interactionHook.success);\n    });\n\n    container.on('fail.uploader', function(e, file, interactionHook){\n        feedback().error(interactionHook.message);\n    });\n});\n\n","define('taoDevTools/controller/settings/extensionManager',['jquery', 'i18n',  'helpers', 'layout/section', 'ui/feedback'], function($, __, helpers, section, feedback){\n\n    var ext_installed = [];\n    var toInstall = [];\n    var indexCurrentToInstall = -1;\n    var percentByExt = 0;\n    var installError = 0;\n\n    function getDependencies(extension) {\n            var dependencies = [];\n            $('#' + extension + ' .dependencies li:not(.installed)').each(function() {\n                    var ext = $(this).attr('rel');\n                    var deps = getDependencies(ext);\n                    deps.push(ext);\n                    dependencies = dependencies.concat(deps);\n            });\n            return dependencies;\n    }\n\n    //Give an array with unique values\n    function getUnique(orig){\n            var a = [];\n            for (var i = 0; i < orig.length; i++) {\n                if ($.inArray(orig[i], a) < 0){\n                     a.push(orig[i]);\n                }\n            }\n            return a;\n    }\n\n    function progressConsole(msg) {\n            $('#installProgress .console').append('<p>' + msg + '</p>');\n            $('#installProgress .console').prop({scrollTop: $('#installProgress .console').prop(\"scrollHeight\")});\n    }\n\n    function installNextExtension() {\n            var ext = toInstall[indexCurrentToInstall];\n            $('#installProgress p.status').text(__('Installing extension %s...').replace('%s', ext));\n            progressConsole(__('Installing extension %s...').replace('%s', ext));\n            $.ajax({\n                    type: \"POST\",\n                    url: helpers._url('install', 'ExtensionsManager', 'tao'),\n                    data: 'id='+ext,\n                    dataType: 'json',\n                    success: function(data) {\n                            helpers.loaded();\n                            if (data.success) {\n                                    progressConsole(__('> Extension %s succesfully installed.').replace('%s', ext));\n\n                                    $('#installProgress .bar').animate({width:'+=' + percentByExt + '%'}, 1000, function() {\n                                            //Next\n                                            indexCurrentToInstall++;\n                                            hasNextExtensionToInstall();\n                                    });\n                            } else {\n                                    installError = 1;\n                                    progressConsole('Installation of ' + ext + ' failed');\n                            }\n                            feedback().info(data.message);\n                    }\n            });\n\n            if (installError) {\n                    progressConsole(__('A fatal error occured during the installation process.'));\n            }\n    }\n\n    function hasNextExtensionToInstall() {\n            if (indexCurrentToInstall >= toInstall.length) {\n                    toInstall = [];\n                    $('#installProgress .bar').animate({backgroundColor:'#bb6',width:'100%'}, 1000);\n                    progressConsole(__('Generating cache...'));\n                    $.ajax({\n                            type: \"GET\",\n                            url: $($('#main-menu a')[0]).prop('href'),\n                            success: function(data) {\n                                    helpers.loaded();\n                                    $('#installProgress .bar').animate({backgroundColor:'#6b6'}, 1000);\n                                    $('#installProgress p.status').text(__('Installation done.'));\n                                    progressConsole(__('> Installation done.'));\n                                    window.location.reload();\n                            }\n                    });\n            } else {\n                    installNextExtension();\n            }\n    }\n\n    function styleTables(){\n            // Clean all to make this function able to \"restyle\" after\n            // data refresh.\n            $('#Extensions_manager table tr').removeClass('extensionOdd')\n                                                                             .removeClass('extensionEven');\n\n            $('#Extensions_manager table tr:nth-child(even)').addClass('extensionEven');\n            $('#Extensions_manager table tr:nth-child(odd)').addClass('extensionOdd');\n    }\n\n    function noAvailableExtensions(){\n            var $noAvailableExtElement = $('<div/>');\n            $noAvailableExtElement.attr('id', 'noExtensions')\n                                                      .addClass('ui-state-highlight')\n                                                      .text(__('No extensions available.'));\n\n            $('#available-extensions-container').empty().append($noAvailableExtElement);\n    }\n    \n    return {\n        start : function(){\n            \n            // Table styling.\n            styleTables();\n\n            $('#installProgress').hide();\n            \n            $('#addButton').click(function(e) {\n\t\te.preventDefault();\n\t\tsection.create({\n                    id : 'devtools-newextension',\n                    name : __('Create new extension'),\n                    url : helpers._url('create', 'ExtensionsManager', 'taoDevTools', {'uri': $('#openuri').val()})\n                })\n                .show();\n            });\n\n            //Detect wich extension is already installed\n            $('#extensions-manager-container .ext-id').each(function() {\n                    var ext = $(this).text();\n                    ext_installed.push(ext);\n                    $('.ext-id.ext-' + ext).addClass('installed');\n            });\n\n            $('#available-extensions-container tr input').click(function(event){\n                    event.stopPropagation();\n            });\n\n            $('#available-extensions-container tr input:checkbox').click(function() {\n                    var $installButton = $('#installButton');\n                    if ($(this).parent().parent().parent().find('input:checkbox:checked').length > 0){\n                            $installButton.attr('disabled', false);\n                    }\n                    else{\n                            $installButton.attr('disabled', true);\n                    }\n            });\n\n            $('#installButton').click(function(event) {\n                    //Prepare the list of extension to install in the order of dependency\n                    toInstall = [];\n                    $('#available-extensions-container input:checked').each(function() {\n                            var ext = $(this).prop('name').split('_')[1];\n                            var deps = getDependencies(ext);\n                            if (deps.length) toInstall = toInstall.concat(deps);\n                            toInstall.push(ext);\n                    });\n                    toInstall = getUnique(toInstall);\n                    if (toInstall.length == 0) {\n                            alert(__('Nothing to install !'));\n                            return false;\n                    }\n                    //Let's go\n                    percentByExt = 100 / toInstall.length;\n\n                    //Show the dialog with the result\n                    $('#installProgress p.status').text(__('%s extension(s) to install.').replace('%s', toInstall.length));\n                    $('#installProgress .bar').width(0);\n                    $('#installProgress .console').empty();\n                    progressConsole(__('Do you wish to install the following extension(s):\\n%s?').replace('%s', toInstall.join(', ')));\n                    $('#installProgress').dialog({\n                            modal: true,\n                            width: 400,\n                            height: 300,\n                            buttons: [\n                                    {\n                                            text: __('No'),\n                                            click: function() {\n                                                    $(this).dialog('close');\n                                            }\n                                    },\n                                    {\n                                            text: __('Yes'),\n                                            click: function() {\n                                                    //Run the install one by one\n                                                    progressConsole(__('Preparing installation...'));\n                                                    $('.ui-dialog-buttonpane').remove();\n                                                    installError = 0;\n                                                    indexCurrentToInstall = 0;\n                                                    installNextExtension();\n                                            }\n                                    }\n                            ]\n                    });\n                    event.preventDefault();\n            });\n            \n            $('.disableButton').click(function(event) {\n            \tvar id = $(event.target).data('extid');\n            \t$.ajax({\n                    type: \"POST\",\n                    url: helpers._url('disable', 'ExtensionsManager', 'taoDevTools'),\n                    data: 'id='+id,\n                    dataType: 'json',\n                    success: function(data) {\n                        if (data.success) {\n                            feedback().success(data.message);\n                            setTimeout(function(){\n                                window.location.reload();   \n                            }, 1000);\n                        } else {\n                            feedback().info(data.message);\n                        }\n                    }\n            \t});\n            });\n            \n            $('.enableButton').click(function(event) {\n            \tvar id = $(event.target).data('extid');\n            \t$.ajax({\n                    type: \"POST\",\n                    url: helpers._url('enable', 'ExtensionsManager', 'taoDevTools'),\n                    data: 'id='+id,\n                    dataType: 'json',\n                    success: function(data) {\n                        if (data.success) {\n                            feedback().success(data.message);\n                            setTimeout(function(){\n                                window.location.reload();   \n                            }, 1000);\n                        } else {\n                            feedback().info(data.message);\n                        }\n                    }\n            \t});\n            });\n            \n            $('.uninstallButton').click(function(event) {\n            \tvar id = $(event.target).data('extid');\n            \t$.ajax({\n                    type: \"POST\",\n                    url: helpers._url('uninstall', 'ExtensionsManager', 'taoDevTools'),\n                    data: 'id='+id,\n                    dataType: 'json',\n                    success: function(data) {\n                        if (data.success) {\n                            feedback().success(data.message);\n                            setTimeout(function(){\n                                window.location.reload();   \n                            }, 1000);\n                        } else {\n                            feedback().info(data.message);\n                        }\n                    }\n            \t});\n            });\n        }\n    };\n\n});\n\n"]}