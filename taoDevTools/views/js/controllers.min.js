define("taoDevTools/controller/routes",[],function(){return{ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}},ScriptRunner:{actions:{index:"controller/ScriptRunner/index"}},FontConversion:{actions:{index:"controller/fontConversion/fileUpload"}},StudentTollGenerator:{actions:{index:"controller/fontConversion/fileUpload"}}}}),define("taoDevTools/controller/ControllerMap/index",function(){}),define("taoDevTools/controller/ScriptRunner/index",["jquery","helpers","ui/feedback"],function($,helpers,feedback){return{start:function(){$(".script").click(function(event){var action=$(event.target).data("action");$.ajax({type:"POST",url:helpers._url(action,"ScriptRunner","taoDevTools"),
dataType:"json",success:function(data){helpers.loaded(),data.success?feedback().success(data.message):feedback().error(data.message)}})})}}}),define("taoDevTools/controller/fontConversion/fileUpload",["jquery","ui","ui/uploader","ui/feedback"],function($,ui,uploader,feedback){var container=$("#upload-container");container.uploader({uploadUrl:container.data("url")}),container.on("upload.uploader",function(e,file,interactionHook){feedback().success(interactionHook.success)}),container.on("fail.uploader",function(e,file,interactionHook){feedback().error(interactionHook.message)})}),define("taoDevTools/controller/settings/extensionManager",["jquery","i18n","helpers","layout/section","ui/feedback"],function($,__,helpers,section,feedback){
function getDependencies(extension){var dependencies=[];return $("#"+extension+" .dependencies li:not(.installed)").each(function(){var ext=$(this).attr("rel"),deps=getDependencies(ext);deps.push(ext),dependencies=dependencies.concat(deps)}),dependencies}function getUnique(orig){for(var a=[],i=0;i<orig.length;i++)$.inArray(orig[i],a)<0&&a.push(orig[i]);return a}function progressConsole(msg){$("#installProgress .console").append("<p>"+msg+"</p>"),$("#installProgress .console").prop({scrollTop:$("#installProgress .console").prop("scrollHeight")})}function installNextExtension(){var ext=toInstall[indexCurrentToInstall];$("#installProgress p.status").text(__("Installing extension %s...").replace("%s",ext)),
progressConsole(__("Installing extension %s...").replace("%s",ext)),$.ajax({type:"POST",url:helpers._url("install","ExtensionsManager","tao"),data:"id="+ext,dataType:"json",success:function(data){helpers.loaded(),data.success?(progressConsole(__("> Extension %s succesfully installed.").replace("%s",ext)),$("#installProgress .bar").animate({width:"+="+percentByExt+"%"},1e3,function(){indexCurrentToInstall++,hasNextExtensionToInstall()})):(installError=1,progressConsole("Installation of "+ext+" failed")),feedback().info(data.message)}}),installError&&progressConsole(__("A fatal error occured during the installation process."))}function hasNextExtensionToInstall(){
indexCurrentToInstall>=toInstall.length?(toInstall=[],$("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),progressConsole(__("Generating cache...")),$.ajax({type:"GET",url:$($("#main-menu a")[0]).prop("href"),success:function(data){helpers.loaded(),$("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),$("#installProgress p.status").text(__("Installation done.")),progressConsole(__("> Installation done.")),window.location.reload()}})):installNextExtension()}function styleTables(){$("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),$("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),
$("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd")}var ext_installed=[],toInstall=[],indexCurrentToInstall=-1,percentByExt=0,installError=0;return{start:function(){styleTables(),$("#installProgress").hide(),$("#addButton").click(function(e){e.preventDefault(),section.create({id:"devtools-newextension",name:__("Create new extension"),url:helpers._url("create","ExtensionsManager","taoDevTools"),contentBlock:!0}).show()}),$("#extensions-manager-container .ext-id").each(function(){var ext=$(this).text();ext_installed.push(ext),$(".ext-id.ext-"+ext).addClass("installed")}),$("#available-extensions-container tr input").click(function(event){event.stopPropagation();
}),$("#available-extensions-container tr input:checkbox").click(function(){var $installButton=$("#installButton");$(this).parent().parent().parent().find("input:checkbox:checked").length>0?$installButton.attr("disabled",!1):$installButton.attr("disabled",!0)}),$("#installButton").click(function(event){return toInstall=[],$("#available-extensions-container input:checked").each(function(){var ext=$(this).prop("name").split("_")[1],deps=getDependencies(ext);deps.length&&(toInstall=toInstall.concat(deps)),toInstall.push(ext)}),toInstall=getUnique(toInstall),0==toInstall.length?(alert(__("Nothing to install !")),!1):(percentByExt=100/toInstall.length,$("#installProgress p.status").text(__("%s extension(s) to install.").replace("%s",toInstall.length)),
$("#installProgress .bar").width(0),$("#installProgress .console").empty(),progressConsole(__("Do you wish to install the following extension(s):\n%s?").replace("%s",toInstall.join(", "))),$("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:__("No"),click:function(){$(this).dialog("close")}},{text:__("Yes"),click:function(){progressConsole(__("Preparing installation...")),$(".ui-dialog-buttonpane").remove(),installError=0,indexCurrentToInstall=0,installNextExtension()}}]}),void event.preventDefault())}),$(".disableButton").click(function(event){var id=$(event.target).data("extid");$.ajax({type:"POST",url:helpers._url("disable","ExtensionsManager","taoDevTools"),
data:"id="+id,dataType:"json",success:function(data){data.success?(feedback().success(data.message),setTimeout(function(){window.location.reload()},1e3)):feedback().info(data.message)}})}),$(".enableButton").click(function(event){var id=$(event.target).data("extid");$.ajax({type:"POST",url:helpers._url("enable","ExtensionsManager","taoDevTools"),data:"id="+id,dataType:"json",success:function(data){data.success?(feedback().success(data.message),setTimeout(function(){window.location.reload()},1e3)):feedback().info(data.message)}})}),$(".uninstallButton").click(function(event){var id=$(event.target).data("extid");$.ajax({type:"POST",url:helpers._url("uninstall","ExtensionsManager","taoDevTools"),
data:"id="+id,dataType:"json",success:function(data){data.success?(feedback().success(data.message),setTimeout(function(){window.location.reload()},1e3)):feedback().info(data.message)}})})}}});
//# sourceMappingURL=controllers.min.js.map