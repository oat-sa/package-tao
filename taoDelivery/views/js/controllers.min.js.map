{"version":3,"sources":["routes.js","tpl!taoDelivery/tpl/fullscreen-modal-feedback","runtime/service/fullScreen.js","runtime/service/deliveryExecution.js"],"names":["define","hb","template","Handlebars","depth0","helpers","partials","data","program1","stack1","helper","buffer","launchButton","call","hash","functionType","escapeExpression","program3","options","__","helperMissing","program5","this","compilerInfo","merge","self","unless","fsSupported","inverse","noop","fn","program","$","_","feedback","modal","dialogTpl","$dialog","$body","d","document","dElem","documentElement","fs","changeInterval","isSupported","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","fullscreenchange","prefixes","i","length","fullScreen","fullscreenElement","mozFullScreen","webkitIsFullScreen","screen","availHeight","height","window","innerHeight","awaitFsChange","event","createEvent","initEvent","clearInterval","setInterval","dispatchEvent","handleUserInput","evt","type","keyCode","which","className","triggerResize","throttle","frame","getElementById","frameWindow","contentWindow","frame$","$win","trigger","init","body","addEventListener","replace","navigator","platform","toLowerCase","indexOf","querySelector","e","on","append","width","animate","disableClosing","startClosed","loadingBar","dialogAlert","logoutEvent","resizeMainFrame","outerHeight","$headerHeight","$footerHeight","$frameContainer","$frame","forceRepaint","$target","sel","style","display","offsetHeight","start","deliveryServerConfig","requireFullScreen","find","serviceApi","onFinish","ajax","url","finishDeliveryExecution","deliveryExecution","dataType","success","location","destination","onExit","exitDeliveryExecution","setTimeout","stop","message","action","off","loadInto","get"],"mappings":"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,WAAA+B,OAGAuB,gBAAAlF,EAAA,oCACAmF,OAAAD,gBAAAW,KAAA,UACAb,cAAAhF,EAAA,iCAAA+E,eAAA,EACAE,cAAAjF,EAAA,iBAAA+E,eAAA,EAEA/E,EAAAQ,UAAA6D,GAAA,mBAAA,WACAQ,eAGA,IAAAiB,YAAA5G,QAAA4G,UAEAA,YAAAC,SAAA,WACA/F,EAAAgG,MACAC,IAAA/G,QAAAgH,wBACA3H,MACA4H,kBAAAjH,QAAAiH,mBAEArD,KAAA,OACAsD,SAAA,OACAC,QAAA,SAAA9H,MACA4D,OAAAmE,SAAA/H,KAAAgI,iBAGAC,OAAA,WACArE,OAAAmE,SAAApH,QAAAuH,wBAGAzG,EAAAQ,UACA6D,GAAA,UAAA,SAAAD;AHjFA,AGkFAO,WAAAe,UAEArB,GAAA,YAAA,WACAqC,WAAA,WACA/B,WAAAgC,QACA,OAEAtC,GAAA,eAAA,SAAAD,EAAA7F,MACAA,MACAqG,YAAArG,KAAAqI,QAAArI,KAAAsI,UAGAxC,GAAA,eAAA,WAEArE,EAAAQ,UAAAsG,IAAA,gBACA3B,OAAA2B,IAAA,oBACAA,IAAA,eAGAhB,WAAAiB,SAAA5B,OAAA6B,IAAA,IAEAhH,EAAAmC,QAAAkC,GAAA,SAAApE,EAAAkD,SAAA,WACA2B,mBACA,MAEAA;AH1GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChDA,ADiDA;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjMA,ADkMA;ACjMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"taoDelivery/controller/routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoDelivery/controller/routes',[],function(){\n    'use strict';\n\n    return {\n    };\n});\n\n","\ndefine('tpl!taoDelivery/tpl/fullscreen-modal-feedback', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"(\";\n  if (helper = helpers.launchButton) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.launchButton); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \")\";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <button class=\\\"btn-info small enter-full-screen\\\" type=\\\"button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Enter full screen\", options) : helperMissing.call(depth0, \"__\", \"Enter full screen\", options)))\n    + \"</button>\\n            \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <button class=\\\"btn-info small close-full-screen-prompt\\\" type=\\\"button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close this prompt\", options) : helperMissing.call(depth0, \"__\", \"Close this prompt\", options)))\n    + \"</button>\\n            \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"modal-feedback modal full-screen-modal\\\">\\n    <div class=\\\"modal-body clearfix\\\">\\n        <p class=\\\"message\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This test needs to be taken in full screen mode\", options) : helperMissing.call(depth0, \"__\", \"This test needs to be taken in full screen mode\", options)))\n    + \"\\n            \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.fsSupported), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n        </p>\\n        <div class=\\\"rgt\\\">\\n            \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.fsSupported), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n        </div>\\n    </div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n *\n * @author dieter <dieter@taotesting.com>\n */\ndefine('taoDelivery/controller/runtime/service/fullScreen',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/feedback',\n    'ui/modal',\n    'tpl!taoDelivery/tpl/fullscreen-modal-feedback'\n], function ($, _, __, feedback, modal, dialogTpl) {\n    'use strict';\n\n    var $dialog;\n    var $body;\n    var d = document;\n    var dElem = d.documentElement;\n\n    var fs = {\n        changeInterval: null,\n\n        isSupported: !!(d.exitFullscreen ||\n                        d.msExitFullscreen ||\n                        d.mozCancelFullScreen ||\n                        d.webkitExitFullscreen),\n\n        requestFullscreen: dElem.requestFullscreen ||\n                    dElem.msRequestFullscreen ||\n                    dElem.mozRequestFullScreen ||\n                    function() {\n                        dElem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                    },\n\n                fullscreenchange: (function() {\n                    var prefixes = ['', 'ms', 'moz', 'webkit'],\n                        i = prefixes.length;\n                    while(i--) {\n                        if('on' + prefixes[i] + 'fullscreenchange' in dElem) {\n                            return prefixes[i] + 'fullscreenchange';\n                        }\n                    }\n                    return 'myfullscreenchange';\n                }()),\n\n        fullScreen: function() {\n            return !!(d.fullscreenElement || d.mozFullScreen || d.webkitIsFullScreen ||\n                        (screen.availHeight || screen.height - 30) <= window.innerHeight);\n        },\n\n        // on older browsers wait for a full screen change to happen\n        // and fire the change event manually\n        awaitFsChange : function() {\n            var event = d.createEvent('Event');\n            event.initEvent(fs.fullscreenchange, true, true);\n            clearInterval(fs.changeInterval);\n            fs.changeInterval = setInterval(function() {\n                if(!fs.fullScreen()) {\n                    d.dispatchEvent(event);\n                }\n            }, 2000);\n        }\n    };\n\n    /**\n     * React to user input on the prompt which is either\n     * key press or click on the button\n     *\n     * @param evt\n     */\n    var handleUserInput = function handleUserInput (evt) {\n\n        // full screen needs to be initiated by pressing\n        // F11 (Windows/Linux) or Ctrl+Cmd+F (Mac)\n        if(!fs.isSupported) {\n            $dialog.modal('close');\n            return;\n        }\n\n        // accept 'enter' as only valid key stroke\n        if(evt.type === 'keydown' && (evt.keyCode || evt.which) !== 13) {\n            return;\n        }\n\n        // in all other cases either 'enter' has been hit or the enter button has been clicked\n        fs.requestFullscreen.call(dElem);\n        dElem.className += ' fullscreen';\n        $dialog.modal('close');\n    };\n\n    /**\n     * Triggers a resize\n     */\n    var triggerResize = (function() {\n        return _.throttle(function() {\n            var frame = document.getElementById('iframeDeliveryExec');\n            var frameWindow = frame && frame.contentWindow;\n            var frame$ = frameWindow && frameWindow.$;\n            var $win = frame$ && frame$(frameWindow) || $(window);\n            $win.trigger('resize');\n        }, 250);\n    })();\n\n    /**\n     * Initialize full screen\n     */\n    var init = function init() {\n\n        $body = $(document.body);\n\n        // listen either to the native or the change event created in the observer above\n        document.addEventListener(fs.fullscreenchange, function() {\n            if(!fs.fullScreen()) {\n                dElem.className = dElem.className.replace(/\\bfullscreen\\b/, '');\n                $dialog.modal('open');\n            } else {\n                triggerResize();\n            }\n        });\n        if (!fs.isSupported) {\n            fs.awaitFsChange();\n        }\n\n        modal($body);\n        $dialog = $(dialogTpl({\n            fsSupported: fs.isSupported,\n            // while this is vague chances that any Mac browser gets here are very little\n            launchButton: navigator.platform.toLowerCase().indexOf('Mac') === 0 ? 'Ctrl+âŒ˜+F' : 'F11'\n        }));\n\n        $dialog[0].querySelector('button').addEventListener('click', function(e) {\n            handleUserInput(e);\n        });\n\n        document.addEventListener('keydown', function(e) {\n            if(!fs.fullScreen()) {\n                handleUserInput(e);\n            }\n        });\n\n        $dialog.on('opened.modal', function() {\n            clearInterval(fs.changeInterval);\n        });\n\n        $dialog.on('closed.modal', function() {\n            if (!fs.isSupported) {\n                fs.awaitFsChange();\n                triggerResize();\n            }\n        });\n\n        $body.append($dialog);\n        \n        $dialog.modal({\n            width: 500,\n            animate: false,\n            disableClosing: true,\n            startClosed: true\n        });\n\n        // Note that when a page is on full screen already on load (after F5 normally)\n        // fullscreenElement and therefor fs.fullScreen() will report the wrong value!\n        if(false === ((screen.availHeight || screen.height - 30) <= window.innerHeight)) {\n            $dialog.modal('open');\n        }\n    };\n\n    /**\n     * @exports\n     */\n    return {\n        init: init\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/runtime/service/deliveryExecution',[\n    'lodash',\n    'jquery',\n    'taoDelivery/controller/runtime/service/fullScreen',\n    'layout/loading-bar',\n    'ui/dialog/alert',\n    'layout/logout-event'\n], function(_, $, fullScreen, loadingBar, dialogAlert, logoutEvent){\n    'use strict';\n\n    var $frameContainer,\n        $frame,\n        $headerHeight,\n        $footerHeight;\n\n    /**\n     * Forces a browser repaint\n     * Solution from http://stackoverflow.com/questions/3485365/how-can-i-force-webkit-to-redraw-repaint-to-propagate-style-changes?answertab=votes#tab-top\n     * @param {jQuery} $target\n     */\n    var forceRepaint = function($target) {\n        var sel = $target[0];\n        if (sel) {\n            sel.style.display = 'none';\n            sel.offsetHeight; // no need to store this anywhere, the reference is enough\n            sel.style.display = '';\n        }\n    };\n\n    function resizeMainFrame() {\n        var height = $(window).outerHeight() - $headerHeight - $footerHeight;\n        $frameContainer.height(height);\n        $frame.height(height);\n        forceRepaint($frameContainer);\n    }\n\n    return {\n        start: function(options){\n\n            if(!!options.deliveryServerConfig.requireFullScreen){\n                fullScreen.init();\n            }\n\n            $frameContainer = $('#outer-delivery-iframe-container');\n            $frame = $frameContainer.find('iframe');\n            $headerHeight = $('body > .content-wrap > header').outerHeight() || 0;\n            $footerHeight = $('body > footer').outerHeight() || 0;\n\n            $(document).on('serviceforbidden', function() {\n                logoutEvent();\n            });\n\n            var serviceApi = options.serviceApi;\n\n            serviceApi.onFinish(function() {\n                $.ajax({\n                    url : options.finishDeliveryExecution,\n                    data : {\n                        'deliveryExecution' : options.deliveryExecution\n                    },\n                    type : 'post',\n                    dataType : 'json',\n                    success : function(data) {\n                        window.location = data.destination;\n                    }\n                });\n            }).onExit(function() {\n                window.location = options.exitDeliveryExecution;\n            });\n\n            $(document)\n                .on('loading', function(e){\n                    loadingBar.start();\n                })\n                .on('unloading', function(){\n                    setTimeout(function(){\n                        loadingBar.stop();\n                    }, 300);\n                })\n                .on('messagealert', function(e, data) {\n                    if (data) {\n                        dialogAlert(data.message, data.action);\n                    }\n                })\n                .on('shutdown-com', function(){\n                    //use when we want to stop all exchange between frames\n                    $(document).off('heightchange');\n                    $frame.off('load.eventHeight')\n                           .off('load.cors');\n                });\n\n            serviceApi.loadInto($frame.get(0));\n\n            $(window).on('resize', _.throttle(function() {\n                resizeMainFrame();\n            }, 250));\n\n            resizeMainFrame();\n        }\n    };\n});\n\n"]}